<!DOCTYPE html>
<html>
  <head>
    <title>SQL Query</title>
    <script src="../dist/vgplot.js"></script>
    <link href="styles.css" rel="stylesheet">
  </head>
  <body>
    <h1>SQL Query</h1>
    <textarea style="width: 640px; height: 100px;" id="sql"></textarea>
    <br/>
    <button id="submit">Query</button>
    <br/>
    <div id="result"></div>
<script>
const { mc, table } = vgplot;
const input = document.querySelector('#sql');
const submit = document.querySelector('#submit');
const output = document.querySelector('#result');
const name = 'query_result';
let id = 0;

submit.addEventListener('click', async () => {
  const tableName = `${name}_${++id}`;
  await mc.exec(`
    DROP VIEW IF EXISTS ${name}_${id-1};
    CREATE VIEW ${tableName} AS ${input.value}
  `);
  result.replaceChildren(table({ table: tableName, height: 500 }));
});

</script>
  </body>
</html>
