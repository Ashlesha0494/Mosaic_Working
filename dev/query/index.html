<!DOCTYPE html>
<html>
  <head>
    <title>SQL Query Console</title>
    <script src="../../dist/vgplot.js"></script>
    <link href="../styles.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <strong>SQL Query Console</strong>
      <span style="margin-right: 0.5em;"></span>
        Client:
        <select id="clients">
          <option value="socket" selected>Socket</option>
          <option value="rest">REST</option>
          <option value="wasm">WASM</option>
        </select>
      </span>
    </header>
    <textarea style="width: 98%; height: 140px;" id="sql"></textarea>
    <br/>
    <button id="submit">Query</button>
    <br/>
    <div id="result"></div>
<script type="module">
import { setDatabaseClient } from '../database-client.js';

const menu = document.querySelector('#clients');
menu.addEventListener('change', () => {
  setDatabaseClient(menu.value)
});

const { mc, table } = vgplot;
const input = document.querySelector('#sql');
const submit = document.querySelector('#submit');
const output = document.querySelector('#result');
const tableName = 'query_result';

submit.addEventListener('click', async () => {
  await mc.exec(
    `DROP TABLE IF EXISTS ${tableName}; CREATE TABLE ${tableName} AS ${input.value}`
  );
  mc.cache.clear();
  result.replaceChildren(table({ table: tableName, height: 500 }));
});
</script>
  </body>
</html>
