<!DOCTYPE html>
<html>
  <head>
    <title>Seattle Weather</title>
    <script src="../dist/vgplot.js"></script>
    <link href="styles.css" rel="stylesheet">
  </head>
  <body>
    <h1>Seattle Weather</h1>
<script>
const {
  mc, plot, vconcat, from, dot, barX,
  bin, count, intervalX, highlight, selectY,
  domainXY, domainX, domainY, domainColor, rangeColor, domainR, rangeR,
  tickFormatX, labelY,
  width, Fixed, Signal
} = vgplot;

const table = 'weather';
const range = new Signal('range');
const click = new Signal('click');

const weather = ['sun', 'fog', 'drizzle', 'rain', 'snow'];
const colors = [
  domainColor(weather),
  rangeColor(['#e7ba52', '#a7a7a7', '#aec7e8', '#1f77b4', '#9467bd'])
];

document.body.appendChild(
  vconcat(
    plot(
      dot(
        from(table, { filterBy: click }),
        { x: 'doy', y: 'temp_max', fill: 'weather', r: 'precipitation', order: 'precipitation', opacity: 0.7 }
      ),
      intervalX({ as: range }),
      highlight(range, { fill: '#eee' }),
      domainXY(Fixed), tickFormatX('%b'),
      rangeR([2, 10]), domainR(Fixed),
      width(800),
      ...colors
    ),
    plot(
      barX(from(table), { x: count(), y: 'weather', fill: '#f5f5f5' }),
      barX(
        from(table, { filterBy: range }),
        { x: count(), y: 'weather', fill: 'weather' }
      ),
      selectY({ as: click }),
      domainX(Fixed),
      domainY(weather), labelY(null),
      width(800),
      ...colors
    )
  )
);

</script>
  </body>
</html>
