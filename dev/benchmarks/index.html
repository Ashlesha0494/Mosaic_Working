<!DOCTYPE html>
<html>
<head>
  <title>Benchmarks</title>
  <script src="../../dist/vgplot.js"></script>
  <link href="../styles.css" rel="stylesheet">
</head>
<body>
  <header style="margin-bottom: 1em;">
    <span style="margin-right: 0.5em;">
      Benchmark:
      <select id="benchmark">
        <option value="none"></option>
        <option value="flights-200k">Flights 200k</option>
        <option value="flights-10m">Flights 10m</option>
      </select>
    </span>

    <span style="margin-right: 0.5em;">
      Client:
      <select id="clients">
        <option value="socket" selected>Socket</option>
        <option value="rest">REST</option>
        <option value="wasm">WASM</option>
      </select>
    </span>

    <span style="margin-right: 0.5em;">
      <button id="run">Run</button>
      <button id="stop">Stop</button>
    </span>
  </header>
  <div id="view"></div>
<script type="module">
  import { setDatabaseClient } from '../database-client.js';
  import { stop } from './benchmark-utils.js';

  const host = 'localhost';
  const port = 3000;
  const clientOptions = {
    socket: `ws://${host}:${port}/`,
    rest: `http://${host}:${port}/`,
    wasm: undefined
  };

  performance.mark('page-load');

  const { coordinator, socketClient, restClient, wasmClient, namedPlots } = vgplot;
  const view = document.querySelector('#view');

  const clientMenu = document.querySelector('#clients');
  clientMenu.addEventListener('change', () => {
    setDatabaseClient(clientMenu.value, clientOptions[clientMenu.value])
  });
  await setDatabaseClient(clientMenu.value, clientOptions[clientMenu.value]);

  const benchmarkMenu = document.querySelector('#benchmark');
  const runButton = document.querySelector('#run');
  const stopButton = document.querySelector('#stop');
  runButton.addEventListener('click', () => load(benchmarkMenu.value));
  stopButton.addEventListener('click', () => stop());

  async function load(name) {
    view.innerHTML = '';
    coordinator().clear();
    namedPlots.clear();
    if (name !== 'none') {
      const benchmarks = (await import(`./${name}.js`)).default;
      benchmarks(view);
    }
  }
</script>
</body>
</html>
