var Hct=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var TQt=Hct((tee,x4)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const k4={};function Xct(t,e=!1){let n,i,r=k4;function s(c){n=t(c).then(()=>{if(i){const{value:l}=i;i=null,s(l)}else n=null})}function o(c){i={event:c}}function a(c){n?o(c):s(c)}function u(c){r!==c&&requestAnimationFrame(()=>{const l=r;r=k4,a(l)}),r=c}return e?u:a}class BS{constructor(e){this._filterBy=e,this._requestUpdate=Xct(()=>this.requestQuery(),!0),this._coordinator=null}get coordinator(){return this._coordinator}set coordinator(e){this._coordinator=e}get filterBy(){return this._filterBy}get filterIndexable(){return!0}fields(){return null}fieldInfo(e){return this}query(e){return null}queryPending(){return this}queryResult(e){return this}queryError(e){return console.error(e),this}requestQuery(e){var i;const n=e||this.query((i=this.filterBy)==null?void 0:i.predicate(this));return this._coordinator.requestQuery(this,n)}requestUpdate(){this._requestUpdate()}update(){return this}}function Z(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(i.next(l))}catch(f){o(f)}}function u(l){try{c(i.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):r(l.value).then(a,u)}c((i=i.apply(t,e||[])).next())})}function D4(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function rt(t){return this instanceof rt?(this.v=t,this):new rt(t)}function Nn(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(d){i[d]&&(r[d]=function(h){return new Promise(function(p,g){s.push([d,h,p,g])>1||a(d,h)})})}function a(d,h){try{u(i[d](h))}catch(p){f(s[0][3],p)}}function u(d){d.value instanceof rt?Promise.resolve(d.value.v).then(c,l):f(s[0][2],d)}function c(d){a("next",d)}function l(d){a("throw",d)}function f(d,h){d(h),s.shift(),s.length&&a(s[0][0],s[0][1])}}function hl(t){var e,n;return e={},i("next"),i("throw",function(r){throw r}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(r,s){e[r]=t[r]?function(o){return(n=!n)?{value:rt(t[r](o)),done:!1}:s?s(o):o}:s}}function ns(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof D4=="function"?D4(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,u){o=t[s](o),r(a,u,o.done,o.value)})}}function r(s,o,a,u){Promise.resolve(u).then(function(c){s({value:c,done:a})},o)}}const Kct=new TextDecoder("utf-8"),oM=t=>Kct.decode(t),Jct=new TextEncoder,Ik=t=>Jct.encode(t),Qct=t=>typeof t=="number",Zct=t=>typeof t=="boolean",ji=t=>typeof t=="function",Eo=t=>t!=null&&Object(t)===t,Hy=t=>Eo(t)&&ji(t.then),PS=t=>Eo(t)&&ji(t[Symbol.iterator]),Mk=t=>Eo(t)&&ji(t[Symbol.asyncIterator]),aM=t=>Eo(t)&&Eo(t.schema),NU=t=>Eo(t)&&"done"in t&&"value"in t,OU=t=>Eo(t)&&ji(t.stat)&&Qct(t.fd),RU=t=>Eo(t)&&Tk(t.body),LU=t=>"_getDOMStream"in t&&"_getNodeStream"in t,Tk=t=>Eo(t)&&ji(t.cancel)&&ji(t.getReader)&&!LU(t),BU=t=>Eo(t)&&ji(t.read)&&ji(t.pipe)&&Zct(t.readable)&&!LU(t),tlt=t=>Eo(t)&&ji(t.clear)&&ji(t.bytes)&&ji(t.position)&&ji(t.setPosition)&&ji(t.capacity)&&ji(t.getBufferIdentifier)&&ji(t.createLong),Fk=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function elt(t){const e=t[0]?[t[0]]:[];let n,i,r,s;for(let o,a,u=0,c=0,l=t.length;++u<l;){if(o=e[c],a=t[u],!o||!a||o.buffer!==a.buffer||a.byteOffset<o.byteOffset){a&&(e[++c]=a);continue}if({byteOffset:n,byteLength:r}=o,{byteOffset:i,byteLength:s}=a,n+r<i||i+s<n){a&&(e[++c]=a);continue}e[c]=new Uint8Array(o.buffer,n,i-n+s)}return e}function C4(t,e,n=0,i=e.byteLength){const r=t.byteLength,s=new Uint8Array(t.buffer,t.byteOffset,r),o=new Uint8Array(e.buffer,e.byteOffset,Math.min(i,r));return s.set(o,n),t}function Fa(t,e){const n=elt(t),i=n.reduce((l,f)=>l+f.byteLength,0);let r,s,o,a=0,u=-1;const c=Math.min(e||Number.POSITIVE_INFINITY,i);for(const l=n.length;++u<l;){if(r=n[u],s=r.subarray(0,Math.min(r.length,c-a)),c<=a+s.length){s.length<r.length?n[u]=r.subarray(s.length):s.length===r.length&&u++,o?C4(o,s,a):o=s;break}C4(o||(o=new Uint8Array(c)),s,a),a+=s.length}return[o||new Uint8Array(0),n.slice(u),i-(o?o.byteLength:0)]}function Ce(t,e){let n=NU(e)?e.value:e;return n instanceof t?t===Uint8Array?new t(n.buffer,n.byteOffset,n.byteLength):n:n?(typeof n=="string"&&(n=Ik(n)),n instanceof ArrayBuffer?new t(n):n instanceof Fk?new t(n):tlt(n)?Ce(t,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new t(0):new t(n.buffer,n.byteOffset,n.byteLength/t.BYTES_PER_ELEMENT):t.from(n)):new t(0)}const r0=t=>Ce(Int32Array,t),N4=t=>Ce(BigInt64Array,t),me=t=>Ce(Uint8Array,t),uM=t=>(t.next(),t);function*nlt(t,e){const n=function*(r){yield r},i=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Fk?n(e):PS(e)?e:n(e);return yield*uM(function*(r){let s=null;do s=r.next(yield Ce(t,s));while(!s.done)}(i[Symbol.iterator]())),new t}const ilt=t=>nlt(Uint8Array,t);function PU(t,e){return Nn(this,arguments,function*(){if(Hy(e))return yield rt(yield rt(yield*hl(ns(PU(t,yield rt(e))))));const i=function(o){return Nn(this,arguments,function*(){yield yield rt(yield rt(o))})},r=function(o){return Nn(this,arguments,function*(){yield rt(yield*hl(ns(uM(function*(a){let u=null;do u=a.next(yield u==null?void 0:u.value);while(!u.done)}(o[Symbol.iterator]())))))})},s=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Fk?i(e):PS(e)?r(e):Mk(e)?e:i(e);return yield rt(yield*hl(ns(uM(function(o){return Nn(this,arguments,function*(){let a=null;do a=yield rt(o.next(yield yield rt(Ce(t,a))));while(!a.done)})}(s[Symbol.asyncIterator]()))))),yield rt(new t)})}const rlt=t=>PU(Uint8Array,t);function slt(t,e){let n=0;const i=t.length;if(i!==e.length)return!1;if(i>0)do if(t[n]!==e[n])return!1;while(++n<i);return!0}const _s={fromIterable(t){return xv(olt(t))},fromAsyncIterable(t){return xv(alt(t))},fromDOMStream(t){return xv(ult(t))},fromNodeStream(t){return xv(llt(t))},toDOMStream(t,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(t,e){throw new Error('"toNodeStream" not available in this environment')}},xv=t=>(t.next(),t);function*olt(t){let e,n=!1,i=[],r,s,o,a=0;function u(){return s==="peek"?Fa(i,o)[0]:([r,i,a]=Fa(i,o),r)}({cmd:s,size:o}=(yield null)||{cmd:"read",size:0});const c=ilt(t)[Symbol.iterator]();try{do if({done:e,value:r}=Number.isNaN(o-a)?c.next():c.next(o-a),!e&&r.byteLength>0&&(i.push(r),a+=r.byteLength),e||o<=a)do({cmd:s,size:o}=yield u());while(o<a);while(!e)}catch(l){(n=!0)&&typeof c.throw=="function"&&c.throw(l)}finally{n===!1&&typeof c.return=="function"&&c.return(null)}return null}function alt(t){return Nn(this,arguments,function*(){let n,i=!1,r=[],s,o,a,u=0;function c(){return o==="peek"?Fa(r,a)[0]:([s,r,u]=Fa(r,a),s)}({cmd:o,size:a}=(yield yield rt(null))||{cmd:"read",size:0});const l=rlt(t)[Symbol.asyncIterator]();try{do if({done:n,value:s}=Number.isNaN(a-u)?yield rt(l.next()):yield rt(l.next(a-u)),!n&&s.byteLength>0&&(r.push(s),u+=s.byteLength),n||a<=u)do({cmd:o,size:a}=yield yield rt(c()));while(a<u);while(!n)}catch(f){(i=!0)&&typeof l.throw=="function"&&(yield rt(l.throw(f)))}finally{i===!1&&typeof l.return=="function"&&(yield rt(l.return(new Uint8Array(0))))}return yield rt(null)})}function ult(t){return Nn(this,arguments,function*(){let n=!1,i=!1,r=[],s,o,a,u=0;function c(){return o==="peek"?Fa(r,a)[0]:([s,r,u]=Fa(r,a),s)}({cmd:o,size:a}=(yield yield rt(null))||{cmd:"read",size:0});const l=new clt(t);try{do if({done:n,value:s}=Number.isNaN(a-u)?yield rt(l.read()):yield rt(l.read(a-u)),!n&&s.byteLength>0&&(r.push(me(s)),u+=s.byteLength),n||a<=u)do({cmd:o,size:a}=yield yield rt(c()));while(a<u);while(!n)}catch(f){(i=!0)&&(yield rt(l.cancel(f)))}finally{i===!1?yield rt(l.cancel()):t.locked&&l.releaseLock()}return yield rt(null)})}let clt=class{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return Z(this,void 0,void 0,function*(){const{reader:n,source:i}=this;n&&(yield n.cancel(e).catch(()=>{})),i&&i.locked&&this.releaseLock()})}read(e){return Z(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const n=yield this.reader.read();return!n.done&&(n.value=me(n)),n})}};const j$=(t,e)=>{const n=r=>i([e,r]);let i;return[e,n,new Promise(r=>(i=r)&&t.once(e,n))]};function llt(t){return Nn(this,arguments,function*(){const n=[];let i="error",r=!1,s=null,o,a,u=0,c=[],l;function f(){return o==="peek"?Fa(c,a)[0]:([l,c,u]=Fa(c,a),l)}if({cmd:o,size:a}=(yield yield rt(null))||{cmd:"read",size:0},t.isTTY)return yield yield rt(new Uint8Array(0)),yield rt(null);try{n[0]=j$(t,"end"),n[1]=j$(t,"error");do{if(n[2]=j$(t,"readable"),[i,s]=yield rt(Promise.race(n.map(h=>h[2]))),i==="error")break;if((r=i==="end")||(Number.isFinite(a-u)?(l=me(t.read(a-u)),l.byteLength<a-u&&(l=me(t.read()))):l=me(t.read()),l.byteLength>0&&(c.push(l),u+=l.byteLength)),r||a<=u)do({cmd:o,size:a}=yield yield rt(f()));while(a<u)}while(!r)}finally{yield rt(d(n,i==="error"?s:null))}return yield rt(null);function d(h,p){return l=c=null,new Promise((g,m)=>{for(const[y,b]of h)t.off(y,b);try{const y=t.destroy;y&&y.call(t,p),p=void 0}catch(y){p=y||p}finally{p!=null?m(p):g()}})}})}var Cn;(function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"})(Cn||(Cn={}));var Fr;(function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"})(Fr||(Fr={}));var Di;(function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"})(Di||(Di={}));var Ao;(function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"})(Ao||(Ao={}));var kt;(function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"})(kt||(kt={}));var ka;(function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(ka||(ka={}));const q$=2,ca=4,Pu=4,yt=4,qc=new Int32Array(2),O4=new Float32Array(qc.buffer),R4=new Float64Array(qc.buffer),Sv=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var cM;(function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"})(cM||(cM={}));let Da=class zU{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new zU(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return qc[0]=this.readInt32(e),O4[0]}readFloat64(e){return qc[Sv?0:1]=this.readInt32(e),qc[Sv?1:0]=this.readInt32(e+4),R4[0]}writeInt8(e,n){this.bytes_[e]=n}writeUint8(e,n){this.bytes_[e]=n}writeInt16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeUint16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeInt32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeUint32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeInt64(e,n){this.writeInt32(e,Number(BigInt.asIntN(32,n))),this.writeInt32(e+4,Number(BigInt.asIntN(32,n>>BigInt(32))))}writeUint64(e,n){this.writeUint32(e,Number(BigInt.asUintN(32,n))),this.writeUint32(e+4,Number(BigInt.asUintN(32,n>>BigInt(32))))}writeFloat32(e,n){O4[0]=n,this.writeInt32(e,qc[0])}writeFloat64(e,n){R4[0]=n,this.writeInt32(e,qc[Sv?0:1]),this.writeInt32(e+4,qc[Sv?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+ca+Pu)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let n=0;n<Pu;n++)e+=String.fromCharCode(this.readInt8(this.position_+ca+n));return e}__offset(e,n){const i=e-this.readInt32(e);return n<this.readInt16(i)?this.readInt16(i+n):0}__union(e,n){return e.bb_pos=n+this.readInt32(n),e.bb=this,e}__string(e,n){e+=this.readInt32(e);const i=this.readInt32(e);e+=ca;const r=this.bytes_.subarray(e,e+i);return n===cM.UTF8_BYTES?r:this.text_decoder_.decode(r)}__union_with_string(e,n){return typeof e=="string"?this.__string(n):this.__union(e,n)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+ca}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Pu)throw new Error("FlatBuffers: file identifier must be length "+Pu);for(let n=0;n<Pu;n++)if(e.charCodeAt(n)!=this.readInt8(this.position()+ca+n))return!1;return!0}createScalarList(e,n){const i=[];for(let r=0;r<n;++r){const s=e(r);s!==null&&i.push(s)}return i}createObjList(e,n){const i=[];for(let r=0;r<n;++r){const s=e(r);s!==null&&i.push(s.unpack())}return i}},zS=class UU{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let n;e?n=e:n=1024,this.bb=Da.allocate(n),this.space=n}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,n){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+n)+1&e-1;for(;this.space<i+e+n;){const r=this.bb.capacity();this.bb=UU.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(i)}pad(e){for(let n=0;n<e;n++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,n,i){(this.force_defaults||n!=i)&&(this.addInt8(n),this.slot(e))}addFieldInt16(e,n,i){(this.force_defaults||n!=i)&&(this.addInt16(n),this.slot(e))}addFieldInt32(e,n,i){(this.force_defaults||n!=i)&&(this.addInt32(n),this.slot(e))}addFieldInt64(e,n,i){(this.force_defaults||n!==i)&&(this.addInt64(n),this.slot(e))}addFieldFloat32(e,n,i){(this.force_defaults||n!=i)&&(this.addFloat32(n),this.slot(e))}addFieldFloat64(e,n,i){(this.force_defaults||n!=i)&&(this.addFloat64(n),this.slot(e))}addFieldOffset(e,n,i){(this.force_defaults||n!=i)&&(this.addOffset(n),this.slot(e))}addFieldStruct(e,n,i){n!=i&&(this.nested(n),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const n=e.capacity();if(n&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=n<<1,r=Da.allocate(i);return r.setPosition(i-n),r.bytes().set(e.bytes(),i-n),r}addOffset(e){this.prep(ca,0),this.writeInt32(this.offset()-e+ca)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let n=0;n<e;n++)this.vtable[n]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let n=this.vtable_in_use-1;for(;n>=0&&this.vtable[n]==0;n--);const i=n+1;for(;n>=0;n--)this.addInt16(this.vtable[n]!=0?e-this.vtable[n]:0);const r=2;this.addInt16(e-this.object_start);const s=(i+r)*q$;this.addInt16(s);let o=0;const a=this.space;t:for(n=0;n<this.vtables.length;n++){const u=this.bb.capacity()-this.vtables[n];if(s==this.bb.readInt16(u)){for(let c=q$;c<s;c+=q$)if(this.bb.readInt16(a+c)!=this.bb.readInt16(u+c))continue t;o=this.vtables[n];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,n,i){const r=i?yt:0;if(n){const s=n;if(this.prep(this.minalign,ca+Pu+r),s.length!=Pu)throw new TypeError("FlatBuffers: file identifier must be length "+Pu);for(let o=Pu-1;o>=0;o--)this.writeInt8(s.charCodeAt(o))}this.prep(this.minalign,ca+r),this.addOffset(e),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,n){this.finish(e,n,!0)}requiredField(e,n){const i=this.bb.capacity()-e,r=i-this.bb.readInt32(i);if(!(n<this.bb.readInt16(r)&&this.bb.readInt16(r+n)!=0))throw new TypeError("FlatBuffers: field "+n+" must be set")}startVector(e,n,i){this.notNested(),this.vector_num_elems=n,this.prep(ca,e*n),this.prep(i,e*n)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const n=this.createString(e);return this.string_maps.set(e,n),n}createString(e){if(e==null)return 0;let n;e instanceof Uint8Array?n=e:n=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,n.length,1),this.bb.setPosition(this.space-=n.length);for(let i=0,r=this.space,s=this.bb.bytes();i<n.length;i++)s[r++]=n[i];return this.endVector()}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const n=[];for(let i=0;i<e.length;++i){const r=e[i];if(r!==null)n.push(this.createObjectOffset(r));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return n}createStructOffsetList(e,n){return n(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var M2;(function(t){t[t.BUFFER=0]="BUFFER"})(M2||(M2={}));var T2;(function(t){t[t.LZ4_FRAME=0]="LZ4_FRAME",t[t.ZSTD=1]="ZSTD"})(T2||(T2={}));let flt=class Pf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBodyCompression(e,n){return(n||new Pf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,n){return e.setPosition(e.position()+yt),(n||new Pf).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):T2.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):M2.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,n){e.addFieldInt8(0,n,T2.LZ4_FRAME)}static addMethod(e,n){e.addFieldInt8(1,n,M2.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,n,i){return Pf.startBodyCompression(e),Pf.addCodec(e,n),Pf.addMethod(e,i),Pf.endBodyCompression(e)}},jU=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,n,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(n??0)),e.offset()}},qU=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,n,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(n??0)),e.offset()}},$u=class lM{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsRecordBatch(e,n){return(n||new lM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,n){return e.setPosition(e.position()+yt),(n||new lM).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,n){const i=this.bb.__offset(this.bb_pos,6);return i?(n||new qU).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,n){const i=this.bb.__offset(this.bb_pos,8);return i?(n||new jU).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new flt).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addNodes(e,n){e.addFieldOffset(1,n,0)}static startNodesVector(e,n){e.startVector(16,n,8)}static addBuffers(e,n){e.addFieldOffset(2,n,0)}static startBuffersVector(e,n){e.startVector(16,n,8)}static addCompression(e,n){e.addFieldOffset(3,n,0)}static endRecordBatch(e){return e.endObject()}},fp=class fM{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryBatch(e,n){return(n||new fM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,n){return e.setPosition(e.position()+yt),(n||new fM).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new $u).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addData(e,n){e.addFieldOffset(1,n,0)}static addIsDelta(e,n){e.addFieldInt8(2,+n,0)}static endDictionaryBatch(e){return e.endObject()}};var yg;(function(t){t[t.Little=0]="Little",t[t.Big=1]="Big"})(yg||(yg={}));var F2;(function(t){t[t.DenseArray=0]="DenseArray"})(F2||(F2={}));let Fp=class zf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInt(e,n){return(n||new zf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,n){return e.setPosition(e.position()+yt),(n||new zf).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,n){e.addFieldInt32(0,n,0)}static addIsSigned(e,n){e.addFieldInt8(1,+n,0)}static endInt(e){return e.endObject()}static createInt(e,n,i){return zf.startInt(e),zf.addBitWidth(e,n),zf.addIsSigned(e,i),zf.endInt(e)}},dp=class dM{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryEncoding(e,n){return(n||new dM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,n){return e.setPosition(e.position()+yt),(n||new dM).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Fp).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):F2.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addIndexType(e,n){e.addFieldOffset(1,n,0)}static addIsOrdered(e,n){e.addFieldInt8(2,+n,0)}static addDictionaryKind(e,n){e.addFieldInt16(3,n,F2.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}},$s=class Uf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsKeyValue(e,n){return(n||new Uf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,n){return e.setPosition(e.position()+yt),(n||new Uf).__init(e.readInt32(e.position())+e.position(),e)}key(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}value(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,n){e.addFieldOffset(0,n,0)}static addValue(e,n){e.addFieldOffset(1,n,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,n,i){return Uf.startKeyValue(e),Uf.addKey(e,n),Uf.addValue(e,i),Uf.endKeyValue(e)}},L4=class P0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBinary(e,n){return(n||new P0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,n){return e.setPosition(e.position()+yt),(n||new P0).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return P0.startBinary(e),P0.endBinary(e)}},B4=class z0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBool(e,n){return(n||new z0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,n){return e.setPosition(e.position()+yt),(n||new z0).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return z0.startBool(e),z0.endBool(e)}},Fw=class hp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDate(e,n){return(n||new hp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,n){return e.setPosition(e.position()+yt),(n||new hp).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Ao.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,Ao.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,n){return hp.startDate(e),hp.addUnit(e,n),hp.endDate(e)}},pp=class Lc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDecimal(e,n){return(n||new Lc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,n){return e.setPosition(e.position()+yt),(n||new Lc).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,n){e.addFieldInt32(0,n,0)}static addScale(e,n){e.addFieldInt32(1,n,0)}static addBitWidth(e,n){e.addFieldInt32(2,n,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,n,i,r){return Lc.startDecimal(e),Lc.addPrecision(e,n),Lc.addScale(e,i),Lc.addBitWidth(e,r),Lc.endDecimal(e)}},kw=class gp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDuration(e,n){return(n||new gp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,n){return e.setPosition(e.position()+yt),(n||new gp).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):kt.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,kt.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,n){return gp.startDuration(e),gp.addUnit(e,n),gp.endDuration(e)}},Dw=class mp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeBinary(e,n){return(n||new mp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,n){return e.setPosition(e.position()+yt),(n||new mp).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,n){return mp.startFixedSizeBinary(e),mp.addByteWidth(e,n),mp.endFixedSizeBinary(e)}},Cw=class yp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeList(e,n){return(n||new yp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,n){return e.setPosition(e.position()+yt),(n||new yp).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,n){return yp.startFixedSizeList(e),yp.addListSize(e,n),yp.endFixedSizeList(e)}},Nw=class bp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFloatingPoint(e,n){return(n||new bp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,n){return e.setPosition(e.position()+yt),(n||new bp).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Di.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,n){e.addFieldInt16(0,n,Di.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,n){return bp.startFloatingPoint(e),bp.addPrecision(e,n),bp.endFloatingPoint(e)}},Ow=class vp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInterval(e,n){return(n||new vp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,n){return e.setPosition(e.position()+yt),(n||new vp).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ka.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,ka.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,n){return vp.startInterval(e),vp.addUnit(e,n),vp.endInterval(e)}},P4=class U0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeBinary(e,n){return(n||new U0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeBinary(e,n){return e.setPosition(e.position()+yt),(n||new U0).__init(e.readInt32(e.position())+e.position(),e)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(e){return U0.startLargeBinary(e),U0.endLargeBinary(e)}},z4=class j0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeUtf8(e,n){return(n||new j0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeUtf8(e,n){return e.setPosition(e.position()+yt),(n||new j0).__init(e.readInt32(e.position())+e.position(),e)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(e){return j0.startLargeUtf8(e),j0.endLargeUtf8(e)}},U4=class q0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsList(e,n){return(n||new q0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,n){return e.setPosition(e.position()+yt),(n||new q0).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return q0.startList(e),q0.endList(e)}},Rw=class wp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMap(e,n){return(n||new wp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,n){return e.setPosition(e.position()+yt),(n||new wp).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,n){e.addFieldInt8(0,+n,0)}static endMap(e){return e.endObject()}static createMap(e,n){return wp.startMap(e),wp.addKeysSorted(e,n),wp.endMap(e)}},j4=class V0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsNull(e,n){return(n||new V0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,n){return e.setPosition(e.position()+yt),(n||new V0).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return V0.startNull(e),V0.endNull(e)}},q4=class W0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsStruct_(e,n){return(n||new W0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,n){return e.setPosition(e.position()+yt),(n||new W0).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return W0.startStruct_(e),W0.endStruct_(e)}},G0=class jf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTime(e,n){return(n||new jf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,n){return e.setPosition(e.position()+yt),(n||new jf).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):kt.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,kt.MILLISECOND)}static addBitWidth(e,n){e.addFieldInt32(1,n,32)}static endTime(e){return e.endObject()}static createTime(e,n,i){return jf.startTime(e),jf.addUnit(e,n),jf.addBitWidth(e,i),jf.endTime(e)}},Y0=class qf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTimestamp(e,n){return(n||new qf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,n){return e.setPosition(e.position()+yt),(n||new qf).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):kt.SECOND}timezone(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,kt.SECOND)}static addTimezone(e,n){e.addFieldOffset(1,n,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,n,i){return qf.startTimestamp(e),qf.addUnit(e,n),qf.addTimezone(e,i),qf.endTimestamp(e)}},Vf=class Wf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUnion(e,n){return(n||new Wf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,n){return e.setPosition(e.position()+yt),(n||new Wf).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Fr.Sparse}typeIds(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.readInt32(this.bb.__vector(this.bb_pos+n)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,n){e.addFieldInt16(0,n,Fr.Sparse)}static addTypeIds(e,n){e.addFieldOffset(1,n,0)}static createTypeIdsVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addInt32(n[i]);return e.endVector()}static startTypeIdsVector(e,n){e.startVector(4,n,4)}static endUnion(e){return e.endObject()}static createUnion(e,n,i){return Wf.startUnion(e),Wf.addMode(e,n),Wf.addTypeIds(e,i),Wf.endUnion(e)}},V4=class H0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUtf8(e,n){return(n||new H0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,n){return e.setPosition(e.position()+yt),(n||new H0).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return H0.startUtf8(e),H0.endUtf8(e)}};var We;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.FloatingPoint=3]="FloatingPoint",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct_=13]="Struct_",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.LargeList=21]="LargeList",t[t.RunEndEncoded=22]="RunEndEncoded"})(We||(We={}));let vs=class Lw{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsField(e,n){return(n||new Lw).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,n){return e.setPosition(e.position()+yt),(n||new Lw).__init(e.readInt32(e.position())+e.position(),e)}name(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):We.NONE}type(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.__union(e,this.bb_pos+n):null}dictionary(e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new dp).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}children(e,n){const i=this.bb.__offset(this.bb_pos,14);return i?(n||new Lw).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,16);return i?(n||new $s).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,n){e.addFieldOffset(0,n,0)}static addNullable(e,n){e.addFieldInt8(1,+n,0)}static addTypeType(e,n){e.addFieldInt8(2,n,We.NONE)}static addType(e,n){e.addFieldOffset(3,n,0)}static addDictionary(e,n){e.addFieldOffset(4,n,0)}static addChildren(e,n){e.addFieldOffset(5,n,0)}static createChildrenVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startChildrenVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(6,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endField(e){return e.endObject()}},ta=class wu{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsSchema(e,n){return(n||new wu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,n){return e.setPosition(e.position()+yt),(n||new wu).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):yg.Little}fields(e,n){const i=this.bb.__offset(this.bb_pos,6);return i?(n||new vs).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,8);return i?(n||new $s).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.readInt64(this.bb.__vector(this.bb_pos+n)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,n){e.addFieldInt16(0,n,yg.Little)}static addFields(e,n){e.addFieldOffset(1,n,0)}static createFieldsVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startFieldsVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(2,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static addFeatures(e,n){e.addFieldOffset(3,n,0)}static createFeaturesVector(e,n){e.startVector(8,n.length,8);for(let i=n.length-1;i>=0;i--)e.addInt64(n[i]);return e.endVector()}static startFeaturesVector(e,n){e.startVector(8,n,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,n){e.finish(n)}static finishSizePrefixedSchemaBuffer(e,n){e.finish(n,void 0,!0)}static createSchema(e,n,i,r,s){return wu.startSchema(e),wu.addEndianness(e,n),wu.addFields(e,i),wu.addCustomMetadata(e,r),wu.addFeatures(e,s),wu.endSchema(e)}};var Me;(function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"})(Me||(Me={}));var O;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t[t.DurationSecond=-27]="DurationSecond",t[t.DurationMillisecond=-28]="DurationMillisecond",t[t.DurationMicrosecond=-29]="DurationMicrosecond",t[t.DurationNanosecond=-30]="DurationNanosecond"})(O||(O={}));var Iu;(function(t){t[t.OFFSET=0]="OFFSET",t[t.DATA=1]="DATA",t[t.VALIDITY=2]="VALIDITY",t[t.TYPE=3]="TYPE"})(Iu||(Iu={}));const dlt=void 0;function Xy(t){if(t===null)return"null";if(t===dlt)return"undefined";switch(typeof t){case"number":return`${t}`;case"bigint":return`${t}`;case"string":return`"${t}"`}return typeof t[Symbol.toPrimitive]=="function"?t[Symbol.toPrimitive]("string"):ArrayBuffer.isView(t)?t instanceof BigInt64Array||t instanceof BigUint64Array?`[${[...t].map(e=>Xy(e))}]`:`[${t}]`:ArrayBuffer.isView(t)?`[${t}]`:JSON.stringify(t,(e,n)=>typeof n=="bigint"?`${n}`:n)}const hlt=Symbol.for("isArrowBigNum");function Co(t,...e){return e.length===0?Object.setPrototypeOf(Ce(this.TypedArray,t),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(t,...e),this.constructor.prototype)}Co.prototype[hlt]=!0;Co.prototype.toJSON=function(){return`"${Jy(this)}"`};Co.prototype.valueOf=function(){return VU(this)};Co.prototype.toString=function(){return Jy(this)};Co.prototype[Symbol.toPrimitive]=function(t="default"){switch(t){case"number":return VU(this);case"string":return Jy(this);case"default":return plt(this)}return Jy(this)};function Wp(...t){return Co.apply(this,t)}function Gp(...t){return Co.apply(this,t)}function Ky(...t){return Co.apply(this,t)}Object.setPrototypeOf(Wp.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Gp.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Ky.prototype,Object.create(Uint32Array.prototype));Object.assign(Wp.prototype,Co.prototype,{constructor:Wp,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(Gp.prototype,Co.prototype,{constructor:Gp,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Ky.prototype,Co.prototype,{constructor:Ky,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});function VU(t){const{buffer:e,byteOffset:n,length:i,signed:r}=t,s=new BigUint64Array(e,n,i),o=r&&s.at(-1)&BigInt(1)<<BigInt(63);let a=BigInt(o?1:0),u=BigInt(0);if(o){for(const c of s)a+=~c*(BigInt(1)<<BigInt(32)*u++);a*=BigInt(-1)}else for(const c of s)a+=c*(BigInt(1)<<BigInt(32)*u++);return a}const Jy=t=>{if(t.byteLength===8)return`${new t.BigIntArray(t.buffer,t.byteOffset,1)[0]}`;if(!t.signed)return V$(t);let e=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return V$(t);e=e.slice();let i=1;for(let s=0;s<e.length;s++){const o=e[s],a=~o+i;e[s]=a,i&=o===0?1:0}return`-${V$(e)}`},plt=t=>t.byteLength===8?new t.BigIntArray(t.buffer,t.byteOffset,1)[0]:Jy(t);function V$(t){let e="";const n=new Uint32Array(2);let i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);const r=new Uint32Array((i=new Uint16Array(i).reverse()).buffer);let s=-1;const o=i.length-1;do{for(n[0]=i[s=0];s<o;)i[s++]=n[1]=n[0]/10,n[0]=(n[0]-n[1]*10<<16)+i[s];i[s]=n[1]=n[0]/10,n[0]=n[0]-n[1]*10,e=`${n[0]}${e}`}while(r[0]||r[1]||r[2]||r[3]);return e??"0"}let glt=class WU{static new(e,n){switch(n){case!0:return new Wp(e);case!1:return new Gp(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Wp(e)}return e.byteLength===16?new Ky(e):new Gp(e)}static signed(e){return new Wp(e)}static unsigned(e){return new Gp(e)}static decimal(e){return new Ky(e)}constructor(e,n){return WU.new(e,n)}};function ir(t){if(typeof t=="bigint"&&(t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER))throw new TypeError(`${t} is not safe to convert to a number.`);return Number(t)}var GU,YU,HU,XU,KU,JU,QU,ZU,tj,ej,nj,ij,rj,sj,oj,aj,uj,cj,lj,fj,dj,hj;let bt=class hM{static isNull(e){return(e==null?void 0:e.typeId)===O.Null}static isInt(e){return(e==null?void 0:e.typeId)===O.Int}static isFloat(e){return(e==null?void 0:e.typeId)===O.Float}static isBinary(e){return(e==null?void 0:e.typeId)===O.Binary}static isLargeBinary(e){return(e==null?void 0:e.typeId)===O.LargeBinary}static isUtf8(e){return(e==null?void 0:e.typeId)===O.Utf8}static isLargeUtf8(e){return(e==null?void 0:e.typeId)===O.LargeUtf8}static isBool(e){return(e==null?void 0:e.typeId)===O.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===O.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===O.Date}static isTime(e){return(e==null?void 0:e.typeId)===O.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===O.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===O.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===O.Duration}static isList(e){return(e==null?void 0:e.typeId)===O.List}static isStruct(e){return(e==null?void 0:e.typeId)===O.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===O.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===O.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===O.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===O.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===O.Dictionary}static isDenseUnion(e){return hM.isUnion(e)&&e.mode===Fr.Dense}static isSparseUnion(e){return hM.isUnion(e)&&e.mode===Fr.Sparse}constructor(e){this.typeId=e}};GU=Symbol.toStringTag;bt[GU]=(t=>(t.children=null,t.ArrayType=Array,t.OffsetArrayType=Int32Array,t[Symbol.toStringTag]="DataType"))(bt.prototype);let wl=class extends bt{constructor(){super(O.Null)}toString(){return"Null"}};YU=Symbol.toStringTag;wl[YU]=(t=>t[Symbol.toStringTag]="Null")(wl.prototype);let _l=class extends bt{constructor(e,n){super(O.Int),this.isSigned=e,this.bitWidth=n}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}};HU=Symbol.toStringTag;_l[HU]=(t=>(t.isSigned=null,t.bitWidth=null,t[Symbol.toStringTag]="Int"))(_l.prototype);let Qy=class extends _l{constructor(){super(!0,32)}get ArrayType(){return Int32Array}};Object.defineProperty(Qy.prototype,"ArrayType",{value:Int32Array});let Zy=class extends bt{constructor(e){super(O.Float),this.precision=e}get ArrayType(){switch(this.precision){case Di.HALF:return Uint16Array;case Di.SINGLE:return Float32Array;case Di.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}};XU=Symbol.toStringTag;Zy[XU]=(t=>(t.precision=null,t[Symbol.toStringTag]="Float"))(Zy.prototype);let k2=class extends bt{constructor(){super(O.Binary)}toString(){return"Binary"}};KU=Symbol.toStringTag;k2[KU]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Binary"))(k2.prototype);class D2 extends bt{constructor(){super(O.LargeBinary)}toString(){return"LargeBinary"}}JU=Symbol.toStringTag;D2[JU]=(t=>(t.ArrayType=Uint8Array,t.OffsetArrayType=BigInt64Array,t[Symbol.toStringTag]="LargeBinary"))(D2.prototype);let C2=class extends bt{constructor(){super(O.Utf8)}toString(){return"Utf8"}};QU=Symbol.toStringTag;C2[QU]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Utf8"))(C2.prototype);class N2 extends bt{constructor(){super(O.LargeUtf8)}toString(){return"LargeUtf8"}}ZU=Symbol.toStringTag;N2[ZU]=(t=>(t.ArrayType=Uint8Array,t.OffsetArrayType=BigInt64Array,t[Symbol.toStringTag]="LargeUtf8"))(N2.prototype);let O2=class extends bt{constructor(){super(O.Bool)}toString(){return"Bool"}};tj=Symbol.toStringTag;O2[tj]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Bool"))(O2.prototype);let R2=class extends bt{constructor(e,n,i=128){super(O.Decimal),this.scale=e,this.precision=n,this.bitWidth=i}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};ej=Symbol.toStringTag;R2[ej]=(t=>(t.scale=null,t.precision=null,t.ArrayType=Uint32Array,t[Symbol.toStringTag]="Decimal"))(R2.prototype);let L2=class extends bt{constructor(e){super(O.Date),this.unit=e}toString(){return`Date${(this.unit+1)*32}<${Ao[this.unit]}>`}};nj=Symbol.toStringTag;L2[nj]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Date"))(L2.prototype);let t1=class extends bt{constructor(e,n){super(O.Time),this.unit=e,this.bitWidth=n}toString(){return`Time${this.bitWidth}<${kt[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}};ij=Symbol.toStringTag;t1[ij]=(t=>(t.unit=null,t.bitWidth=null,t[Symbol.toStringTag]="Time"))(t1.prototype);let B2=class extends bt{constructor(e,n){super(O.Timestamp),this.unit=e,this.timezone=n}toString(){return`Timestamp<${kt[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}};rj=Symbol.toStringTag;B2[rj]=(t=>(t.unit=null,t.timezone=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Timestamp"))(B2.prototype);let P2=class extends bt{constructor(e){super(O.Interval),this.unit=e}toString(){return`Interval<${ka[this.unit]}>`}};sj=Symbol.toStringTag;P2[sj]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Interval"))(P2.prototype);let z2=class extends bt{constructor(e){super(O.Duration),this.unit=e}toString(){return`Duration<${kt[this.unit]}>`}};oj=Symbol.toStringTag;z2[oj]=(t=>(t.unit=null,t.ArrayType=BigInt64Array,t[Symbol.toStringTag]="Duration"))(z2.prototype);let U2=class extends bt{constructor(e){super(O.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};aj=Symbol.toStringTag;U2[aj]=(t=>(t.children=null,t[Symbol.toStringTag]="List"))(U2.prototype);let Hi=class extends bt{constructor(e){super(O.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}};uj=Symbol.toStringTag;Hi[uj]=(t=>(t.children=null,t[Symbol.toStringTag]="Struct"))(Hi.prototype);let j2=class extends bt{constructor(e,n,i){super(O.Union),this.mode=e,this.children=i,this.typeIds=n=Int32Array.from(n),this.typeIdToChildIndex=n.reduce((r,s,o)=>(r[s]=o)&&r||r,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}};cj=Symbol.toStringTag;j2[cj]=(t=>(t.mode=null,t.typeIds=null,t.children=null,t.typeIdToChildIndex=null,t.ArrayType=Int8Array,t[Symbol.toStringTag]="Union"))(j2.prototype);let q2=class extends bt{constructor(e){super(O.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};lj=Symbol.toStringTag;q2[lj]=(t=>(t.byteWidth=null,t.ArrayType=Uint8Array,t[Symbol.toStringTag]="FixedSizeBinary"))(q2.prototype);let V2=class extends bt{constructor(e,n){super(O.FixedSizeList),this.listSize=e,this.children=[n]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};fj=Symbol.toStringTag;V2[fj]=(t=>(t.children=null,t.listSize=null,t[Symbol.toStringTag]="FixedSizeList"))(V2.prototype);let W2=class extends bt{constructor(e,n=!1){var i,r,s;if(super(O.Map),this.children=[e],this.keysSorted=n,e&&(e.name="entries",!((i=e==null?void 0:e.type)===null||i===void 0)&&i.children)){const o=(r=e==null?void 0:e.type)===null||r===void 0?void 0:r.children[0];o&&(o.name="key");const a=(s=e==null?void 0:e.type)===null||s===void 0?void 0:s.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}};dj=Symbol.toStringTag;W2[dj]=(t=>(t.children=null,t.keysSorted=null,t[Symbol.toStringTag]="Map_"))(W2.prototype);const mlt=(t=>()=>++t)(-1);let bg=class extends bt{constructor(e,n,i,r){super(O.Dictionary),this.indices=n,this.dictionary=e,this.isOrdered=r||!1,this.id=i==null?mlt():ir(i)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}};hj=Symbol.toStringTag;bg[hj]=(t=>(t.id=null,t.indices=null,t.isOrdered=null,t.dictionary=null,t[Symbol.toStringTag]="Dictionary"))(bg.prototype);function Mu(t){const e=t;switch(t.typeId){case O.Decimal:return t.bitWidth/32;case O.Timestamp:return 2;case O.Date:return 1+e.unit;case O.Interval:return 1+e.unit;case O.FixedSizeList:return e.listSize;case O.FixedSizeBinary:return e.byteWidth;default:return 1}}let se=class{visitMany(e,...n){return e.map((i,r)=>this.visit(i,...n.map(s=>s[r])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,n=!0){return ylt(this,e,n)}getVisitFnByTypeId(e,n=!0){return _p(this,e,n)}visitNull(e,...n){return null}visitBool(e,...n){return null}visitInt(e,...n){return null}visitFloat(e,...n){return null}visitUtf8(e,...n){return null}visitLargeUtf8(e,...n){return null}visitBinary(e,...n){return null}visitLargeBinary(e,...n){return null}visitFixedSizeBinary(e,...n){return null}visitDate(e,...n){return null}visitTimestamp(e,...n){return null}visitTime(e,...n){return null}visitDecimal(e,...n){return null}visitList(e,...n){return null}visitStruct(e,...n){return null}visitUnion(e,...n){return null}visitDictionary(e,...n){return null}visitInterval(e,...n){return null}visitDuration(e,...n){return null}visitFixedSizeList(e,...n){return null}visitMap(e,...n){return null}};function ylt(t,e,n=!0){return typeof e=="number"?_p(t,e,n):typeof e=="string"&&e in O?_p(t,O[e],n):e&&e instanceof bt?_p(t,W4(e),n):e!=null&&e.type&&e.type instanceof bt?_p(t,W4(e.type),n):_p(t,O.NONE,n)}function _p(t,e,n=!0){let i=null;switch(e){case O.Null:i=t.visitNull;break;case O.Bool:i=t.visitBool;break;case O.Int:i=t.visitInt;break;case O.Int8:i=t.visitInt8||t.visitInt;break;case O.Int16:i=t.visitInt16||t.visitInt;break;case O.Int32:i=t.visitInt32||t.visitInt;break;case O.Int64:i=t.visitInt64||t.visitInt;break;case O.Uint8:i=t.visitUint8||t.visitInt;break;case O.Uint16:i=t.visitUint16||t.visitInt;break;case O.Uint32:i=t.visitUint32||t.visitInt;break;case O.Uint64:i=t.visitUint64||t.visitInt;break;case O.Float:i=t.visitFloat;break;case O.Float16:i=t.visitFloat16||t.visitFloat;break;case O.Float32:i=t.visitFloat32||t.visitFloat;break;case O.Float64:i=t.visitFloat64||t.visitFloat;break;case O.Utf8:i=t.visitUtf8;break;case O.LargeUtf8:i=t.visitLargeUtf8;break;case O.Binary:i=t.visitBinary;break;case O.LargeBinary:i=t.visitLargeBinary;break;case O.FixedSizeBinary:i=t.visitFixedSizeBinary;break;case O.Date:i=t.visitDate;break;case O.DateDay:i=t.visitDateDay||t.visitDate;break;case O.DateMillisecond:i=t.visitDateMillisecond||t.visitDate;break;case O.Timestamp:i=t.visitTimestamp;break;case O.TimestampSecond:i=t.visitTimestampSecond||t.visitTimestamp;break;case O.TimestampMillisecond:i=t.visitTimestampMillisecond||t.visitTimestamp;break;case O.TimestampMicrosecond:i=t.visitTimestampMicrosecond||t.visitTimestamp;break;case O.TimestampNanosecond:i=t.visitTimestampNanosecond||t.visitTimestamp;break;case O.Time:i=t.visitTime;break;case O.TimeSecond:i=t.visitTimeSecond||t.visitTime;break;case O.TimeMillisecond:i=t.visitTimeMillisecond||t.visitTime;break;case O.TimeMicrosecond:i=t.visitTimeMicrosecond||t.visitTime;break;case O.TimeNanosecond:i=t.visitTimeNanosecond||t.visitTime;break;case O.Decimal:i=t.visitDecimal;break;case O.List:i=t.visitList;break;case O.Struct:i=t.visitStruct;break;case O.Union:i=t.visitUnion;break;case O.DenseUnion:i=t.visitDenseUnion||t.visitUnion;break;case O.SparseUnion:i=t.visitSparseUnion||t.visitUnion;break;case O.Dictionary:i=t.visitDictionary;break;case O.Interval:i=t.visitInterval;break;case O.IntervalDayTime:i=t.visitIntervalDayTime||t.visitInterval;break;case O.IntervalYearMonth:i=t.visitIntervalYearMonth||t.visitInterval;break;case O.Duration:i=t.visitDuration;break;case O.DurationSecond:i=t.visitDurationSecond||t.visitDuration;break;case O.DurationMillisecond:i=t.visitDurationMillisecond||t.visitDuration;break;case O.DurationMicrosecond:i=t.visitDurationMicrosecond||t.visitDuration;break;case O.DurationNanosecond:i=t.visitDurationNanosecond||t.visitDuration;break;case O.FixedSizeList:i=t.visitFixedSizeList;break;case O.Map:i=t.visitMap;break}if(typeof i=="function")return i;if(!n)return()=>null;throw new Error(`Unrecognized type '${O[e]}'`)}function W4(t){switch(t.typeId){case O.Null:return O.Null;case O.Int:{const{bitWidth:e,isSigned:n}=t;switch(e){case 8:return n?O.Int8:O.Uint8;case 16:return n?O.Int16:O.Uint16;case 32:return n?O.Int32:O.Uint32;case 64:return n?O.Int64:O.Uint64}return O.Int}case O.Float:switch(t.precision){case Di.HALF:return O.Float16;case Di.SINGLE:return O.Float32;case Di.DOUBLE:return O.Float64}return O.Float;case O.Binary:return O.Binary;case O.LargeBinary:return O.LargeBinary;case O.Utf8:return O.Utf8;case O.LargeUtf8:return O.LargeUtf8;case O.Bool:return O.Bool;case O.Decimal:return O.Decimal;case O.Time:switch(t.unit){case kt.SECOND:return O.TimeSecond;case kt.MILLISECOND:return O.TimeMillisecond;case kt.MICROSECOND:return O.TimeMicrosecond;case kt.NANOSECOND:return O.TimeNanosecond}return O.Time;case O.Timestamp:switch(t.unit){case kt.SECOND:return O.TimestampSecond;case kt.MILLISECOND:return O.TimestampMillisecond;case kt.MICROSECOND:return O.TimestampMicrosecond;case kt.NANOSECOND:return O.TimestampNanosecond}return O.Timestamp;case O.Date:switch(t.unit){case Ao.DAY:return O.DateDay;case Ao.MILLISECOND:return O.DateMillisecond}return O.Date;case O.Interval:switch(t.unit){case ka.DAY_TIME:return O.IntervalDayTime;case ka.YEAR_MONTH:return O.IntervalYearMonth}return O.Interval;case O.Duration:switch(t.unit){case kt.SECOND:return O.DurationSecond;case kt.MILLISECOND:return O.DurationMillisecond;case kt.MICROSECOND:return O.DurationMicrosecond;case kt.NANOSECOND:return O.DurationNanosecond}return O.Duration;case O.Map:return O.Map;case O.List:return O.List;case O.Struct:return O.Struct;case O.Union:switch(t.mode){case Fr.Dense:return O.DenseUnion;case Fr.Sparse:return O.SparseUnion}return O.Union;case O.FixedSizeBinary:return O.FixedSizeBinary;case O.FixedSizeList:return O.FixedSizeList;case O.Dictionary:return O.Dictionary}throw new Error(`Unrecognized type '${O[t.typeId]}'`)}se.prototype.visitInt8=null;se.prototype.visitInt16=null;se.prototype.visitInt32=null;se.prototype.visitInt64=null;se.prototype.visitUint8=null;se.prototype.visitUint16=null;se.prototype.visitUint32=null;se.prototype.visitUint64=null;se.prototype.visitFloat16=null;se.prototype.visitFloat32=null;se.prototype.visitFloat64=null;se.prototype.visitDateDay=null;se.prototype.visitDateMillisecond=null;se.prototype.visitTimestampSecond=null;se.prototype.visitTimestampMillisecond=null;se.prototype.visitTimestampMicrosecond=null;se.prototype.visitTimestampNanosecond=null;se.prototype.visitTimeSecond=null;se.prototype.visitTimeMillisecond=null;se.prototype.visitTimeMicrosecond=null;se.prototype.visitTimeNanosecond=null;se.prototype.visitDenseUnion=null;se.prototype.visitSparseUnion=null;se.prototype.visitIntervalDayTime=null;se.prototype.visitIntervalYearMonth=null;se.prototype.visitDuration=null;se.prototype.visitDurationSecond=null;se.prototype.visitDurationMillisecond=null;se.prototype.visitDurationMicrosecond=null;se.prototype.visitDurationNanosecond=null;const pj=new Float64Array(1),Uh=new Uint32Array(pj.buffer);function gj(t){const e=(t&31744)>>10,n=(t&1023)/1024,i=Math.pow(-1,(t&32768)>>15);switch(e){case 31:return i*(n?Number.NaN:1/0);case 0:return i*(n?6103515625e-14*n:0)}return i*Math.pow(2,e-15)*(1+n)}function blt(t){if(t!==t)return 32256;pj[0]=t;const e=(Uh[1]&2147483648)>>16&65535;let n=Uh[1]&2146435072,i=0;return n>=1089470464?Uh[0]>0?n=31744:(n=(n&2080374784)>>16,i=(Uh[1]&1048575)>>10):n<=1056964608?(i=1048576+(Uh[1]&1048575),i=1048576+(i<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,i=(Uh[1]&1048575)+512>>10),e|n|i&65535}let Dt=class extends se{};function Rt(t){return(e,n,i)=>{if(e.setValid(n,i!=null))return t(e,n,i)}}const vlt=(t,e,n)=>{t[e]=Math.trunc(n/864e5)},kk=(t,e,n)=>{t[e]=Math.trunc(n%4294967296),t[e+1]=Math.trunc(n/4294967296)},wlt=(t,e,n)=>{t[e]=Math.trunc(n*1e3%4294967296),t[e+1]=Math.trunc(n*1e3/4294967296)},_lt=(t,e,n)=>{t[e]=Math.trunc(n*1e6%4294967296),t[e+1]=Math.trunc(n*1e6/4294967296)},mj=(t,e,n,i)=>{if(n+1<e.length){const r=ir(e[n]),s=ir(e[n+1]);t.set(i.subarray(0,s-r),r)}},xlt=({offset:t,values:e},n,i)=>{const r=t+n;i?e[r>>3]|=1<<r%8:e[r>>3]&=~(1<<r%8)},hc=({values:t},e,n)=>{t[e]=n},Dk=({values:t},e,n)=>{t[e]=n},yj=({values:t},e,n)=>{t[e]=blt(n)},Slt=(t,e,n)=>{switch(t.type.precision){case Di.HALF:return yj(t,e,n);case Di.SINGLE:case Di.DOUBLE:return Dk(t,e,n)}},bj=({values:t},e,n)=>{vlt(t,e,n.valueOf())},vj=({values:t},e,n)=>{kk(t,e*2,n.valueOf())},Elt=({stride:t,values:e},n,i)=>{e.set(i.subarray(0,t),t*n)},wj=({values:t,valueOffsets:e},n,i)=>mj(t,e,n,i),_j=({values:t,valueOffsets:e},n,i)=>mj(t,e,n,Ik(i)),Alt=(t,e,n)=>{t.type.unit===Ao.DAY?bj(t,e,n):vj(t,e,n)},xj=({values:t},e,n)=>kk(t,e*2,n/1e3),Sj=({values:t},e,n)=>kk(t,e*2,n),Ej=({values:t},e,n)=>wlt(t,e*2,n),Aj=({values:t},e,n)=>_lt(t,e*2,n),$lt=(t,e,n)=>{switch(t.type.unit){case kt.SECOND:return xj(t,e,n);case kt.MILLISECOND:return Sj(t,e,n);case kt.MICROSECOND:return Ej(t,e,n);case kt.NANOSECOND:return Aj(t,e,n)}},$j=({values:t},e,n)=>{t[e]=n},Ij=({values:t},e,n)=>{t[e]=n},Mj=({values:t},e,n)=>{t[e]=n},Tj=({values:t},e,n)=>{t[e]=n},Ilt=(t,e,n)=>{switch(t.type.unit){case kt.SECOND:return $j(t,e,n);case kt.MILLISECOND:return Ij(t,e,n);case kt.MICROSECOND:return Mj(t,e,n);case kt.NANOSECOND:return Tj(t,e,n)}},Mlt=({values:t,stride:e},n,i)=>{t.set(i.subarray(0,e),e*n)},Tlt=(t,e,n)=>{const i=t.children[0],r=t.valueOffsets,s=Os.getVisitFn(i);if(Array.isArray(n))for(let o=-1,a=r[e],u=r[e+1];a<u;)s(i,a++,n[++o]);else for(let o=-1,a=r[e],u=r[e+1];a<u;)s(i,a++,n.get(++o))},Flt=(t,e,n)=>{const i=t.children[0],{valueOffsets:r}=t,s=Os.getVisitFn(i);let{[e]:o,[e+1]:a}=r;const u=n instanceof Map?n.entries():Object.entries(n);for(const c of u)if(s(i,o,c),++o>=a)break},klt=(t,e)=>(n,i,r,s)=>i&&n(i,t,e[s]),Dlt=(t,e)=>(n,i,r,s)=>i&&n(i,t,e.get(s)),Clt=(t,e)=>(n,i,r,s)=>i&&n(i,t,e.get(r.name)),Nlt=(t,e)=>(n,i,r,s)=>i&&n(i,t,e[r.name]),Olt=(t,e,n)=>{const i=t.type.children.map(s=>Os.getVisitFn(s.type)),r=n instanceof Map?Clt(e,n):n instanceof $n?Dlt(e,n):Array.isArray(n)?klt(e,n):Nlt(e,n);t.type.children.forEach((s,o)=>r(i[o],t.children[o],s,o))},Rlt=(t,e,n)=>{t.type.mode===Fr.Dense?Fj(t,e,n):kj(t,e,n)},Fj=(t,e,n)=>{const i=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[i];Os.visit(r,t.valueOffsets[e],n)},kj=(t,e,n)=>{const i=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[i];Os.visit(r,e,n)},Llt=(t,e,n)=>{var i;(i=t.dictionary)===null||i===void 0||i.set(t.values[e],n)},Blt=(t,e,n)=>{t.type.unit===ka.DAY_TIME?Dj(t,e,n):Cj(t,e,n)},Dj=({values:t},e,n)=>{t.set(n.subarray(0,2),2*e)},Cj=({values:t},e,n)=>{t[e]=n[0]*12+n[1]%12},Nj=({values:t},e,n)=>{t[e]=n},Oj=({values:t},e,n)=>{t[e]=n},Rj=({values:t},e,n)=>{t[e]=n},Lj=({values:t},e,n)=>{t[e]=n},Plt=(t,e,n)=>{switch(t.type.unit){case kt.SECOND:return Nj(t,e,n);case kt.MILLISECOND:return Oj(t,e,n);case kt.MICROSECOND:return Rj(t,e,n);case kt.NANOSECOND:return Lj(t,e,n)}},zlt=(t,e,n)=>{const{stride:i}=t,r=t.children[0],s=Os.getVisitFn(r);if(Array.isArray(n))for(let o=-1,a=e*i;++o<i;)s(r,a+o,n[o]);else for(let o=-1,a=e*i;++o<i;)s(r,a+o,n.get(o))};Dt.prototype.visitBool=Rt(xlt);Dt.prototype.visitInt=Rt(hc);Dt.prototype.visitInt8=Rt(hc);Dt.prototype.visitInt16=Rt(hc);Dt.prototype.visitInt32=Rt(hc);Dt.prototype.visitInt64=Rt(hc);Dt.prototype.visitUint8=Rt(hc);Dt.prototype.visitUint16=Rt(hc);Dt.prototype.visitUint32=Rt(hc);Dt.prototype.visitUint64=Rt(hc);Dt.prototype.visitFloat=Rt(Slt);Dt.prototype.visitFloat16=Rt(yj);Dt.prototype.visitFloat32=Rt(Dk);Dt.prototype.visitFloat64=Rt(Dk);Dt.prototype.visitUtf8=Rt(_j);Dt.prototype.visitLargeUtf8=Rt(_j);Dt.prototype.visitBinary=Rt(wj);Dt.prototype.visitLargeBinary=Rt(wj);Dt.prototype.visitFixedSizeBinary=Rt(Elt);Dt.prototype.visitDate=Rt(Alt);Dt.prototype.visitDateDay=Rt(bj);Dt.prototype.visitDateMillisecond=Rt(vj);Dt.prototype.visitTimestamp=Rt($lt);Dt.prototype.visitTimestampSecond=Rt(xj);Dt.prototype.visitTimestampMillisecond=Rt(Sj);Dt.prototype.visitTimestampMicrosecond=Rt(Ej);Dt.prototype.visitTimestampNanosecond=Rt(Aj);Dt.prototype.visitTime=Rt(Ilt);Dt.prototype.visitTimeSecond=Rt($j);Dt.prototype.visitTimeMillisecond=Rt(Ij);Dt.prototype.visitTimeMicrosecond=Rt(Mj);Dt.prototype.visitTimeNanosecond=Rt(Tj);Dt.prototype.visitDecimal=Rt(Mlt);Dt.prototype.visitList=Rt(Tlt);Dt.prototype.visitStruct=Rt(Olt);Dt.prototype.visitUnion=Rt(Rlt);Dt.prototype.visitDenseUnion=Rt(Fj);Dt.prototype.visitSparseUnion=Rt(kj);Dt.prototype.visitDictionary=Rt(Llt);Dt.prototype.visitInterval=Rt(Blt);Dt.prototype.visitIntervalDayTime=Rt(Dj);Dt.prototype.visitIntervalYearMonth=Rt(Cj);Dt.prototype.visitDuration=Rt(Plt);Dt.prototype.visitDurationSecond=Rt(Nj);Dt.prototype.visitDurationMillisecond=Rt(Oj);Dt.prototype.visitDurationMicrosecond=Rt(Rj);Dt.prototype.visitDurationNanosecond=Rt(Lj);Dt.prototype.visitFixedSizeList=Rt(zlt);Dt.prototype.visitMap=Rt(Flt);const Os=new Dt,so=Symbol.for("parent"),Yp=Symbol.for("rowIndex");let Ck=class{constructor(e,n){return this[so]=e,this[Yp]=n,new Proxy(this,new jlt)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[Yp],n=this[so],i=n.type.children,r={};for(let s=-1,o=i.length;++s<o;)r[i[s].name]=kr.visit(n.children[s],e);return r}toString(){return`{${[...this].map(([e,n])=>`${Xy(e)}: ${Xy(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Ult(this[so],this[Yp])}},Ult=class{constructor(e,n){this.childIndex=0,this.children=e.children,this.rowIndex=n,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,kr.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}};Object.defineProperties(Ck.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[so]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Yp]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});let jlt=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[so].type.children.map(n=>n.name)}has(e,n){return e[so].type.children.findIndex(i=>i.name===n)!==-1}getOwnPropertyDescriptor(e,n){if(e[so].type.children.findIndex(i=>i.name===n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const i=e[so].type.children.findIndex(r=>r.name===n);if(i!==-1){const r=kr.visit(e[so].children[i],e[Yp]);return Reflect.set(e,n,r),r}}set(e,n,i){const r=e[so].type.children.findIndex(s=>s.name===n);return r!==-1?(Os.visit(e[so].children[r],e[Yp],i),Reflect.set(e,n,i)):Reflect.has(e,n)||typeof n=="symbol"?Reflect.set(e,n,i):!1}},$t=class extends se{};function Ct(t){return(e,n)=>e.getValid(n)?t(e,n):null}const qlt=(t,e)=>864e5*t[e],Nk=(t,e)=>4294967296*t[e+1]+(t[e]>>>0),Vlt=(t,e)=>4294967296*(t[e+1]/1e3)+(t[e]>>>0)/1e3,Wlt=(t,e)=>4294967296*(t[e+1]/1e6)+(t[e]>>>0)/1e6,Bj=t=>new Date(t),Glt=(t,e)=>Bj(qlt(t,e)),Ylt=(t,e)=>Bj(Nk(t,e)),Hlt=(t,e)=>null,Pj=(t,e,n)=>{if(n+1>=e.length)return null;const i=ir(e[n]),r=ir(e[n+1]);return t.subarray(i,r)},Xlt=({offset:t,values:e},n)=>{const i=t+n;return(e[i>>3]&1<<i%8)!==0},zj=({values:t},e)=>Glt(t,e),Uj=({values:t},e)=>Ylt(t,e*2),sf=({stride:t,values:e},n)=>e[t*n],Klt=({stride:t,values:e},n)=>gj(e[t*n]),jj=({values:t},e)=>t[e],Jlt=({stride:t,values:e},n)=>e.subarray(t*n,t*(n+1)),qj=({values:t,valueOffsets:e},n)=>Pj(t,e,n),Vj=({values:t,valueOffsets:e},n)=>{const i=Pj(t,e,n);return i!==null?oM(i):null},Qlt=({values:t},e)=>t[e],Zlt=({type:t,values:e},n)=>t.precision!==Di.HALF?e[n]:gj(e[n]),tft=(t,e)=>t.type.unit===Ao.DAY?zj(t,e):Uj(t,e),Wj=({values:t},e)=>1e3*Nk(t,e*2),Gj=({values:t},e)=>Nk(t,e*2),Yj=({values:t},e)=>Vlt(t,e*2),Hj=({values:t},e)=>Wlt(t,e*2),eft=(t,e)=>{switch(t.type.unit){case kt.SECOND:return Wj(t,e);case kt.MILLISECOND:return Gj(t,e);case kt.MICROSECOND:return Yj(t,e);case kt.NANOSECOND:return Hj(t,e)}},Xj=({values:t},e)=>t[e],Kj=({values:t},e)=>t[e],Jj=({values:t},e)=>t[e],Qj=({values:t},e)=>t[e],nft=(t,e)=>{switch(t.type.unit){case kt.SECOND:return Xj(t,e);case kt.MILLISECOND:return Kj(t,e);case kt.MICROSECOND:return Jj(t,e);case kt.NANOSECOND:return Qj(t,e)}},ift=({values:t,stride:e},n)=>glt.decimal(t.subarray(e*n,e*(n+1))),rft=(t,e)=>{const{valueOffsets:n,stride:i,children:r}=t,{[e*i]:s,[e*i+1]:o}=n,u=r[0].slice(s,o-s);return new $n([u])},sft=(t,e)=>{const{valueOffsets:n,children:i}=t,{[e]:r,[e+1]:s}=n,o=i[0];return new Ok(o.slice(r,s-r))},oft=(t,e)=>new Ck(t,e),aft=(t,e)=>t.type.mode===Fr.Dense?Zj(t,e):tq(t,e),Zj=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[n];return kr.visit(i,t.valueOffsets[e])},tq=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[n];return kr.visit(i,e)},uft=(t,e)=>{var n;return(n=t.dictionary)===null||n===void 0?void 0:n.get(t.values[e])},cft=(t,e)=>t.type.unit===ka.DAY_TIME?eq(t,e):nq(t,e),eq=({values:t},e)=>t.subarray(2*e,2*(e+1)),nq=({values:t},e)=>{const n=t[e],i=new Int32Array(2);return i[0]=Math.trunc(n/12),i[1]=Math.trunc(n%12),i},iq=({values:t},e)=>t[e],rq=({values:t},e)=>t[e],sq=({values:t},e)=>t[e],oq=({values:t},e)=>t[e],lft=(t,e)=>{switch(t.type.unit){case kt.SECOND:return iq(t,e);case kt.MILLISECOND:return rq(t,e);case kt.MICROSECOND:return sq(t,e);case kt.NANOSECOND:return oq(t,e)}},fft=(t,e)=>{const{stride:n,children:i}=t,s=i[0].slice(e*n,n);return new $n([s])};$t.prototype.visitNull=Ct(Hlt);$t.prototype.visitBool=Ct(Xlt);$t.prototype.visitInt=Ct(Qlt);$t.prototype.visitInt8=Ct(sf);$t.prototype.visitInt16=Ct(sf);$t.prototype.visitInt32=Ct(sf);$t.prototype.visitInt64=Ct(jj);$t.prototype.visitUint8=Ct(sf);$t.prototype.visitUint16=Ct(sf);$t.prototype.visitUint32=Ct(sf);$t.prototype.visitUint64=Ct(jj);$t.prototype.visitFloat=Ct(Zlt);$t.prototype.visitFloat16=Ct(Klt);$t.prototype.visitFloat32=Ct(sf);$t.prototype.visitFloat64=Ct(sf);$t.prototype.visitUtf8=Ct(Vj);$t.prototype.visitLargeUtf8=Ct(Vj);$t.prototype.visitBinary=Ct(qj);$t.prototype.visitLargeBinary=Ct(qj);$t.prototype.visitFixedSizeBinary=Ct(Jlt);$t.prototype.visitDate=Ct(tft);$t.prototype.visitDateDay=Ct(zj);$t.prototype.visitDateMillisecond=Ct(Uj);$t.prototype.visitTimestamp=Ct(eft);$t.prototype.visitTimestampSecond=Ct(Wj);$t.prototype.visitTimestampMillisecond=Ct(Gj);$t.prototype.visitTimestampMicrosecond=Ct(Yj);$t.prototype.visitTimestampNanosecond=Ct(Hj);$t.prototype.visitTime=Ct(nft);$t.prototype.visitTimeSecond=Ct(Xj);$t.prototype.visitTimeMillisecond=Ct(Kj);$t.prototype.visitTimeMicrosecond=Ct(Jj);$t.prototype.visitTimeNanosecond=Ct(Qj);$t.prototype.visitDecimal=Ct(ift);$t.prototype.visitList=Ct(rft);$t.prototype.visitStruct=Ct(oft);$t.prototype.visitUnion=Ct(aft);$t.prototype.visitDenseUnion=Ct(Zj);$t.prototype.visitSparseUnion=Ct(tq);$t.prototype.visitDictionary=Ct(uft);$t.prototype.visitInterval=Ct(cft);$t.prototype.visitIntervalDayTime=Ct(eq);$t.prototype.visitIntervalYearMonth=Ct(nq);$t.prototype.visitDuration=Ct(lft);$t.prototype.visitDurationSecond=Ct(iq);$t.prototype.visitDurationMillisecond=Ct(rq);$t.prototype.visitDurationMicrosecond=Ct(sq);$t.prototype.visitDurationNanosecond=Ct(oq);$t.prototype.visitFixedSizeList=Ct(fft);$t.prototype.visitMap=Ct(sft);const kr=new $t,la=Symbol.for("keys"),Hp=Symbol.for("vals");let Ok=class{constructor(e){return this[la]=new $n([e.children[0]]).memoize(),this[Hp]=e.children[1],new Proxy(this,new hft)}[Symbol.iterator](){return new dft(this[la],this[Hp])}get size(){return this[la].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[la],n=this[Hp],i={};for(let r=-1,s=e.length;++r<s;)i[e.get(r)]=kr.visit(n,r);return i}toString(){return`{${[...this].map(([e,n])=>`${Xy(e)}: ${Xy(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}},dft=class{constructor(e,n){this.keys=e,this.vals=n,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),kr.visit(this.vals,e)]})}},hft=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[la].toArray().map(String)}has(e,n){return e[la].includes(n)}getOwnPropertyDescriptor(e,n){if(e[la].indexOf(n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const i=e[la].indexOf(n);if(i!==-1){const r=kr.visit(Reflect.get(e,Hp),i);return Reflect.set(e,n,r),r}}set(e,n,i){const r=e[la].indexOf(n);return r!==-1?(Os.visit(Reflect.get(e,Hp),r,i),Reflect.set(e,n,i)):Reflect.has(e,n)?Reflect.set(e,n,i):!1}};Object.defineProperties(Ok.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[la]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Hp]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let G4;function aq(t,e,n,i){const{length:r=0}=t;let s=typeof e!="number"?0:e,o=typeof n!="number"?r:n;return s<0&&(s=(s%r+r)%r),o<0&&(o=(o%r+r)%r),o<s&&(G4=s,s=o,o=G4),o>r&&(o=r),i?i(t,s,o):[s,o]}const Y4=t=>t!==t;function hm(t){if(typeof t!=="object"||t===null)return Y4(t)?Y4:n=>n===t;if(t instanceof Date){const n=t.valueOf();return i=>i instanceof Date?i.valueOf()===n:!1}return ArrayBuffer.isView(t)?n=>n?slt(t,n):!1:t instanceof Map?gft(t):Array.isArray(t)?pft(t):t instanceof $n?mft(t):yft(t,!0)}function pft(t){const e=[];for(let n=-1,i=t.length;++n<i;)e[n]=hm(t[n]);return US(e)}function gft(t){let e=-1;const n=[];for(const i of t.values())n[++e]=hm(i);return US(n)}function mft(t){const e=[];for(let n=-1,i=t.length;++n<i;)e[n]=hm(t.get(n));return US(e)}function yft(t,e=!1){const n=Object.keys(t);if(!e&&n.length===0)return()=>!1;const i=[];for(let r=-1,s=n.length;++r<s;)i[r]=hm(t[n[r]]);return US(i,n)}function US(t,e){return n=>{if(!n||typeof n!="object")return!1;switch(n.constructor){case Array:return bft(t,n);case Map:return H4(t,n,n.keys());case Ok:case Ck:case Object:case void 0:return H4(t,n,e||Object.keys(n))}return n instanceof $n?vft(t,n):!1}}function bft(t,e){const n=t.length;if(e.length!==n)return!1;for(let i=-1;++i<n;)if(!t[i](e[i]))return!1;return!0}function vft(t,e){const n=t.length;if(e.length!==n)return!1;for(let i=-1;++i<n;)if(!t[i](e.get(i)))return!1;return!0}function H4(t,e,n){const i=n[Symbol.iterator](),r=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),s=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let o=0;const a=t.length;let u=s.next(),c=i.next(),l=r.next();for(;o<a&&!c.done&&!l.done&&!u.done&&!(c.value!==l.value||!t[o](u.value));++o,c=i.next(),l=r.next(),u=s.next());return o===a&&c.done&&l.done&&u.done?!0:(i.return&&i.return(),r.return&&r.return(),s.return&&s.return(),!1)}function uq(t,e,n,i){return(n&1<<i)!==0}function wft(t,e,n,i){return(n&1<<i)>>i}function X4(t,e,n){const i=n.byteLength+7&-8;if(t>0||n.byteLength<i){const r=new Uint8Array(i);return r.set(t%8===0?n.subarray(t>>3):pM(new Rk(n,t,e,null,uq)).subarray(0,i)),r}return n}function pM(t){const e=[];let n=0,i=0,r=0;for(const o of t)o&&(r|=1<<i),++i===8&&(e[n++]=r,r=i=0);(n===0||i>0)&&(e[n++]=r);const s=new Uint8Array(e.length+7&-8);return s.set(e),s}let Rk=class{constructor(e,n,i,r,s){this.bytes=e,this.length=i,this.context=r,this.get=s,this.bit=n%8,this.byteIndex=n>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}};function gM(t,e,n){if(n-e<=0)return 0;if(n-e<8){let s=0;for(const o of new Rk(t,e,n-e,t,wft))s+=o;return s}const i=n>>3<<3,r=e+(e%8===0?0:8-e%8);return gM(t,e,r)+gM(t,i,n)+_ft(t,r>>3,i-r>>3)}function _ft(t,e,n){let i=0,r=Math.trunc(e);const s=new DataView(t.buffer,t.byteOffset,t.byteLength),o=n===void 0?t.byteLength:r+n;for(;o-r>=4;)i+=W$(s.getUint32(r)),r+=4;for(;o-r>=2;)i+=W$(s.getUint16(r)),r+=2;for(;o-r>=1;)i+=W$(s.getUint8(r)),r+=1;return i}function W$(t){let e=Math.trunc(t);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const xft=-1;let Ge=class mM{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return bt.isSparseUnion(e)?this.children.some(n=>n.nullable):bt.isDenseUnion(e)?this.children.some(n=>n.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:n,values:i,nullBitmap:r,typeIds:s}=this;return n&&(e+=n.byteLength),i&&(e+=i.byteLength),r&&(e+=r.byteLength),s&&(e+=s.byteLength),this.children.reduce((o,a)=>o+a.byteLength,e)}get nullCount(){if(bt.isUnion(this.type))return this.children.reduce((i,r)=>i+r.nullCount,0);let e=this._nullCount,n;return e<=xft&&(n=this.nullBitmap)&&(this._nullCount=e=this.length-gM(n,this.offset,this.offset+this.length)),e}constructor(e,n,i,r,s,o=[],a){this.type=e,this.children=o,this.dictionary=a,this.offset=Math.floor(Math.max(n||0,0)),this.length=Math.floor(Math.max(i||0,0)),this._nullCount=Math.floor(Math.max(r||0,-1));let u;s instanceof mM?(this.stride=s.stride,this.values=s.values,this.typeIds=s.typeIds,this.nullBitmap=s.nullBitmap,this.valueOffsets=s.valueOffsets):(this.stride=Mu(e),s&&((u=s[0])&&(this.valueOffsets=u),(u=s[1])&&(this.values=u),(u=s[2])&&(this.nullBitmap=u),(u=s[3])&&(this.typeIds=u)))}getValid(e){const{type:n}=this;if(bt.isUnion(n)){const i=n,r=this.children[i.typeIdToChildIndex[this.typeIds[e]]],s=i.mode===Fr.Dense?this.valueOffsets[e]:e;return r.getValid(s)}if(this.nullable&&this.nullCount>0){const i=this.offset+e;return(this.nullBitmap[i>>3]&1<<i%8)!==0}return!0}setValid(e,n){let i;const{type:r}=this;if(bt.isUnion(r)){const s=r,o=this.children[s.typeIdToChildIndex[this.typeIds[e]]],a=s.mode===Fr.Dense?this.valueOffsets[e]:e;i=o.getValid(a),o.setValid(a,n)}else{let{nullBitmap:s}=this;const{offset:o,length:a}=this,u=o+e,c=1<<u%8,l=u>>3;(!s||s.byteLength<=l)&&(s=new Uint8Array((o+a+63&-64)>>3).fill(255),this.nullCount>0&&s.set(X4(o,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:s,_nullCount:-1}));const f=s[l];i=(f&c)!==0,n?s[l]=f|c:s[l]=f&~c}return i!==!!n&&(this._nullCount=this.nullCount+(n?-1:1)),n}clone(e=this.type,n=this.offset,i=this.length,r=this._nullCount,s=this,o=this.children){return new mM(e,n,i,r,s,o,this.dictionary)}slice(e,n){const{stride:i,typeId:r,children:s}=this,o=+(this._nullCount===0)-1,a=r===16?i:1,u=this._sliceBuffers(e,n,i,r);return this.clone(this.type,this.offset+e,n,o,u,s.length===0||this.valueOffsets?s:this._sliceChildren(s,a*e,a*n))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===O.Null)return this.clone(this.type,0,e,0);const{length:n,nullCount:i}=this,r=new Uint8Array((e+63&-64)>>3).fill(255,0,n>>3);r[n>>3]=(1<<n-(n&-8))-1,i>0&&r.set(X4(this.offset,n,this.nullBitmap),0);const s=this.buffers;return s[Iu.VALIDITY]=r,this.clone(this.type,0,e,i+(e-n),s)}_sliceBuffers(e,n,i,r){let s;const{buffers:o}=this;return(s=o[Iu.TYPE])&&(o[Iu.TYPE]=s.subarray(e,e+n)),(s=o[Iu.OFFSET])&&(o[Iu.OFFSET]=s.subarray(e,e+n+1))||(s=o[Iu.DATA])&&(o[Iu.DATA]=r===6?s:s.subarray(i*e,i*(e+n))),o}_sliceChildren(e,n,i){return e.map(r=>r.slice(n,i))}};Ge.prototype.children=Object.freeze([]);let Sft=class Bw extends se{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:n,["offset"]:i=0,["length"]:r=0}=e;return new Ge(n,i,r,r)}visitBool(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length>>3,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitInt(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitFloat(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitUtf8(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.data),s=me(e.nullBitmap),o=r0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new Ge(n,i,a,u,[o,r,s])}visitLargeUtf8(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.data),s=me(e.nullBitmap),o=N4(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new Ge(n,i,a,u,[o,r,s])}visitBinary(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.data),s=me(e.nullBitmap),o=r0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new Ge(n,i,a,u,[o,r,s])}visitLargeBinary(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.data),s=me(e.nullBitmap),o=N4(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new Ge(n,i,a,u,[o,r,s])}visitFixedSizeBinary(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length/Mu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitDate(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length/Mu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitTimestamp(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length/Mu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitTime(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length/Mu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitDecimal(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length/Mu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitList(e){const{["type"]:n,["offset"]:i=0,["child"]:r}=e,s=me(e.nullBitmap),o=r0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new Ge(n,i,a,u,[o,void 0,s],[r])}visitStruct(e){const{["type"]:n,["offset"]:i=0,["children"]:r=[]}=e,s=me(e.nullBitmap),{length:o=r.reduce((u,{length:c})=>Math.max(u,c),0),nullCount:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,void 0,s],r)}visitUnion(e){const{["type"]:n,["offset"]:i=0,["children"]:r=[]}=e,s=Ce(n.ArrayType,e.typeIds),{["length"]:o=s.length,["nullCount"]:a=-1}=e;if(bt.isSparseUnion(n))return new Ge(n,i,o,a,[void 0,void 0,void 0,s],r);const u=r0(e.valueOffsets);return new Ge(n,i,o,a,[u,void 0,void 0,s],r)}visitDictionary(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.indices.ArrayType,e.data),{["dictionary"]:o=new $n([new Bw().visit({type:n.dictionary})])}=e,{["length"]:a=s.length,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new Ge(n,i,a,u,[void 0,s,r],[],o)}visitInterval(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length/Mu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitDuration(e){const{["type"]:n,["offset"]:i=0}=e,r=me(e.nullBitmap),s=Ce(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,s,r])}visitFixedSizeList(e){const{["type"]:n,["offset"]:i=0,["child"]:r=new Bw().visit({type:n.valueType})}=e,s=me(e.nullBitmap),{["length"]:o=r.length/Mu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ge(n,i,o,a,[void 0,void 0,s],[r])}visitMap(e){const{["type"]:n,["offset"]:i=0,["child"]:r=new Bw().visit({type:n.childType})}=e,s=me(e.nullBitmap),o=r0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new Ge(n,i,a,u,[o,void 0,s],[r])}};const Eft=new Sft;function ie(t){return Eft.visit(t)}let K4=class{constructor(e=0,n){this.numChunks=e,this.getChunkIterator=n,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}};function Aft(t){return t.some(e=>e.nullable)}function cq(t){return t.reduce((e,n)=>e+n.nullCount,0)}function lq(t){return t.reduce((e,n,i)=>(e[i+1]=e[i]+n.length,e),new Uint32Array(t.length+1))}function fq(t,e,n,i){const r=[];for(let s=-1,o=t.length;++s<o;){const a=t[s],u=e[s],{length:c}=a;if(u>=i)break;if(n>=u+c)continue;if(u>=n&&u+c<=i){r.push(a);continue}const l=Math.max(0,n-u),f=Math.min(i-u,c);r.push(a.slice(l,f-l))}return r.length===0&&r.push(t[0].slice(0,0)),r}function Lk(t,e,n,i){let r=0,s=0,o=e.length-1;do{if(r>=o-1)return n<e[o]?i(t,r,n-e[r]):null;s=r+Math.trunc((o-r)*.5),n<e[s]?o=s:r=s}while(r<o)}function Bk(t,e){return t.getValid(e)}function G2(t){function e(n,i,r){return t(n[i],r)}return function(n){const i=this.data;return Lk(i,this._offsets,n,e)}}function dq(t){let e;function n(i,r,s){return t(i[r],s,e)}return function(i,r){const s=this.data;e=r;const o=Lk(s,this._offsets,i,n);return e=void 0,o}}function hq(t){let e;function n(i,r,s){let o=s,a=0,u=0;for(let c=r-1,l=i.length;++c<l;){const f=i[c];if(~(a=t(f,e,o)))return u+a;o=0,u+=f.length}return-1}return function(i,r){e=i;const s=this.data,o=typeof r!="number"?n(s,0,0):Lk(s,this._offsets,r,n);return e=void 0,o}}let It=class extends se{};function $ft(t,e){return e===null&&t.length>0?0:-1}function Ift(t,e){const{nullBitmap:n}=t;if(!n||t.nullCount<=0)return-1;let i=0;for(const r of new Rk(n,t.offset+(e||0),t.length,n,uq)){if(!r)return i;++i}return-1}function Gt(t,e,n){if(e===void 0)return-1;if(e===null)switch(t.typeId){case O.Union:break;case O.Dictionary:break;default:return Ift(t,n)}const i=kr.getVisitFn(t),r=hm(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(r(i(t,s)))return s;return-1}function pq(t,e,n){const i=kr.getVisitFn(t),r=hm(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(r(i(t,s)))return s;return-1}It.prototype.visitNull=$ft;It.prototype.visitBool=Gt;It.prototype.visitInt=Gt;It.prototype.visitInt8=Gt;It.prototype.visitInt16=Gt;It.prototype.visitInt32=Gt;It.prototype.visitInt64=Gt;It.prototype.visitUint8=Gt;It.prototype.visitUint16=Gt;It.prototype.visitUint32=Gt;It.prototype.visitUint64=Gt;It.prototype.visitFloat=Gt;It.prototype.visitFloat16=Gt;It.prototype.visitFloat32=Gt;It.prototype.visitFloat64=Gt;It.prototype.visitUtf8=Gt;It.prototype.visitLargeUtf8=Gt;It.prototype.visitBinary=Gt;It.prototype.visitLargeBinary=Gt;It.prototype.visitFixedSizeBinary=Gt;It.prototype.visitDate=Gt;It.prototype.visitDateDay=Gt;It.prototype.visitDateMillisecond=Gt;It.prototype.visitTimestamp=Gt;It.prototype.visitTimestampSecond=Gt;It.prototype.visitTimestampMillisecond=Gt;It.prototype.visitTimestampMicrosecond=Gt;It.prototype.visitTimestampNanosecond=Gt;It.prototype.visitTime=Gt;It.prototype.visitTimeSecond=Gt;It.prototype.visitTimeMillisecond=Gt;It.prototype.visitTimeMicrosecond=Gt;It.prototype.visitTimeNanosecond=Gt;It.prototype.visitDecimal=Gt;It.prototype.visitList=Gt;It.prototype.visitStruct=Gt;It.prototype.visitUnion=Gt;It.prototype.visitDenseUnion=pq;It.prototype.visitSparseUnion=pq;It.prototype.visitDictionary=Gt;It.prototype.visitInterval=Gt;It.prototype.visitIntervalDayTime=Gt;It.prototype.visitIntervalYearMonth=Gt;It.prototype.visitDuration=Gt;It.prototype.visitDurationSecond=Gt;It.prototype.visitDurationMillisecond=Gt;It.prototype.visitDurationMicrosecond=Gt;It.prototype.visitDurationNanosecond=Gt;It.prototype.visitFixedSizeList=Gt;It.prototype.visitMap=Gt;const Y2=new It;let Mt=class extends se{};function Nt(t){const{type:e}=t;if(t.nullCount===0&&t.stride===1&&(e.typeId===O.Timestamp||e instanceof _l&&e.bitWidth!==64||e instanceof t1&&e.bitWidth!==64||e instanceof Zy&&e.precision!==Di.HALF))return new K4(t.data.length,i=>{const r=t.data[i];return r.values.subarray(0,r.length)[Symbol.iterator]()});let n=0;return new K4(t.data.length,i=>{const s=t.data[i].length,o=t.slice(n,n+s);return n+=s,new Mft(o)})}let Mft=class{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}};Mt.prototype.visitNull=Nt;Mt.prototype.visitBool=Nt;Mt.prototype.visitInt=Nt;Mt.prototype.visitInt8=Nt;Mt.prototype.visitInt16=Nt;Mt.prototype.visitInt32=Nt;Mt.prototype.visitInt64=Nt;Mt.prototype.visitUint8=Nt;Mt.prototype.visitUint16=Nt;Mt.prototype.visitUint32=Nt;Mt.prototype.visitUint64=Nt;Mt.prototype.visitFloat=Nt;Mt.prototype.visitFloat16=Nt;Mt.prototype.visitFloat32=Nt;Mt.prototype.visitFloat64=Nt;Mt.prototype.visitUtf8=Nt;Mt.prototype.visitLargeUtf8=Nt;Mt.prototype.visitBinary=Nt;Mt.prototype.visitLargeBinary=Nt;Mt.prototype.visitFixedSizeBinary=Nt;Mt.prototype.visitDate=Nt;Mt.prototype.visitDateDay=Nt;Mt.prototype.visitDateMillisecond=Nt;Mt.prototype.visitTimestamp=Nt;Mt.prototype.visitTimestampSecond=Nt;Mt.prototype.visitTimestampMillisecond=Nt;Mt.prototype.visitTimestampMicrosecond=Nt;Mt.prototype.visitTimestampNanosecond=Nt;Mt.prototype.visitTime=Nt;Mt.prototype.visitTimeSecond=Nt;Mt.prototype.visitTimeMillisecond=Nt;Mt.prototype.visitTimeMicrosecond=Nt;Mt.prototype.visitTimeNanosecond=Nt;Mt.prototype.visitDecimal=Nt;Mt.prototype.visitList=Nt;Mt.prototype.visitStruct=Nt;Mt.prototype.visitUnion=Nt;Mt.prototype.visitDenseUnion=Nt;Mt.prototype.visitSparseUnion=Nt;Mt.prototype.visitDictionary=Nt;Mt.prototype.visitInterval=Nt;Mt.prototype.visitIntervalDayTime=Nt;Mt.prototype.visitIntervalYearMonth=Nt;Mt.prototype.visitDuration=Nt;Mt.prototype.visitDurationSecond=Nt;Mt.prototype.visitDurationMillisecond=Nt;Mt.prototype.visitDurationMicrosecond=Nt;Mt.prototype.visitDurationNanosecond=Nt;Mt.prototype.visitFixedSizeList=Nt;Mt.prototype.visitMap=Nt;const Pk=new Mt;var gq;const mq={},yq={};let $n=class Gf{constructor(e){var n,i,r;const s=e[0]instanceof Gf?e.flatMap(a=>a.data):e;if(s.length===0||s.some(a=>!(a instanceof Ge)))throw new TypeError("Vector constructor expects an Array of Data instances.");const o=(n=s[0])===null||n===void 0?void 0:n.type;switch(s.length){case 0:this._offsets=[0];break;case 1:{const{get:a,set:u,indexOf:c}=mq[o.typeId],l=s[0];this.isValid=f=>Bk(l,f),this.get=f=>a(l,f),this.set=(f,d)=>u(l,f,d),this.indexOf=f=>c(l,f),this._offsets=[0,l.length];break}default:Object.setPrototypeOf(this,yq[o.typeId]),this._offsets=lq(s);break}this.data=s,this.type=o,this.stride=Mu(o),this.numChildren=(r=(i=o.children)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,n)=>e+n.byteLength,0)}get nullable(){return Aft(this.data)}get nullCount(){return cq(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${O[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}set(e,n){}indexOf(e,n){return-1}includes(e,n){return this.indexOf(e,n)>-1}[Symbol.iterator](){return Pk.visit(this)}concat(...e){return new Gf(this.data.concat(e.flatMap(n=>n.data).flat(Number.POSITIVE_INFINITY)))}slice(e,n){return new Gf(aq(this,e,n,({data:i,_offsets:r},s,o)=>fq(i,r,s,o)))}toJSON(){return[...this]}toArray(){const{type:e,data:n,length:i,stride:r,ArrayType:s}=this;switch(e.typeId){case O.Int:case O.Float:case O.Decimal:case O.Time:case O.Timestamp:switch(n.length){case 0:return new s;case 1:return n[0].values.subarray(0,i*r);default:return n.reduce((o,{values:a,length:u})=>(o.array.set(a.subarray(0,u*r),o.offset),o.offset+=u*r,o),{array:new s(i*r),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var n;return this.getChildAt((n=this.type.children)===null||n===void 0?void 0:n.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new Gf(this.data.map(({children:n})=>n[e])):null}get isMemoized(){return bt.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(bt.isDictionary(this.type)){const e=new J4(this.data[0].dictionary),n=this.data.map(i=>{const r=i.clone();return r.dictionary=e,r});return new Gf(n)}return new J4(this)}unmemoize(){if(bt.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),n=this.data.map(i=>{const r=i.clone();return r.dictionary=e,r});return new Gf(n)}return this}};gq=Symbol.toStringTag;$n[gq]=(t=>{t.type=bt.prototype,t.data=[],t.length=0,t.stride=1,t.numChildren=0,t._offsets=new Uint32Array([0]),t[Symbol.isConcatSpreadable]=!0;const e=Object.keys(O).map(n=>O[n]).filter(n=>typeof n=="number"&&n!==O.NONE);for(const n of e){const i=kr.getVisitFnByTypeId(n),r=Os.getVisitFnByTypeId(n),s=Y2.getVisitFnByTypeId(n);mq[n]={get:i,set:r,indexOf:s},yq[n]=Object.create(t,{isValid:{value:G2(Bk)},get:{value:G2(kr.getVisitFnByTypeId(n))},set:{value:dq(Os.getVisitFnByTypeId(n))},indexOf:{value:hq(Y2.getVisitFnByTypeId(n))}})}return"Vector"})($n.prototype);let J4=class bq extends $n{constructor(e){super(e.data);const n=this.get,i=this.set,r=this.slice,s=new Array(this.length);Object.defineProperty(this,"get",{value(o){const a=s[o];if(a!==void 0)return a;const u=n.call(this,o);return s[o]=u,u}}),Object.defineProperty(this,"set",{value(o,a){i.call(this,o,a),s[o]=a}}),Object.defineProperty(this,"slice",{value:(o,a)=>new bq(r.call(this,o,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new $n(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}},yM=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,n,i,r){return e.prep(8,24),e.writeInt64(BigInt(r??0)),e.pad(4),e.writeInt32(i),e.writeInt64(BigInt(n??0)),e.offset()}},Ho=class bM{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFooter(e,n){return(n||new bM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,n){return e.setPosition(e.position()+yt),(n||new bM).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Cn.V1}schema(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new ta).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dictionaries(e,n){const i=this.bb.__offset(this.bb_pos,8);return i?(n||new yM).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,n){const i=this.bb.__offset(this.bb_pos,10);return i?(n||new yM).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,12);return i?(n||new $s).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,Cn.V1)}static addSchema(e,n){e.addFieldOffset(1,n,0)}static addDictionaries(e,n){e.addFieldOffset(2,n,0)}static startDictionariesVector(e,n){e.startVector(24,n,8)}static addRecordBatches(e,n){e.addFieldOffset(3,n,0)}static startRecordBatchesVector(e,n){e.startVector(24,n,8)}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,n){e.finish(n)}static finishSizePrefixedFooterBuffer(e,n){e.finish(n,void 0,!0)}},ln=class Yf{constructor(e=[],n,i,r=Cn.V5){this.fields=e||[],this.metadata=n||new Map,i||(i=wM(e)),this.dictionaries=i,this.metadataVersion=r}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,n)=>`${n}: ${e}`).join(", ")} }>`}select(e){const n=new Set(e),i=this.fields.filter(r=>n.has(r.name));return new Yf(i,this.metadata)}selectAt(e){const n=e.map(i=>this.fields[i]).filter(Boolean);return new Yf(n,this.metadata)}assign(...e){const n=e[0]instanceof Yf?e[0]:Array.isArray(e[0])?new Yf(e[0]):new Yf(e),i=[...this.fields],r=Ev(Ev(new Map,this.metadata),n.metadata),s=n.fields.filter(a=>{const u=i.findIndex(c=>c.name===a.name);return~u?(i[u]=a.clone({metadata:Ev(Ev(new Map,i[u].metadata),a.metadata)}))&&!1:!0}),o=wM(s,new Map);return new Yf([...i,...s],r,new Map([...this.dictionaries,...o]))}};ln.prototype.fields=null;ln.prototype.metadata=null;ln.prototype.dictionaries=null;let xn=class vM{static new(...e){let[n,i,r,s]=e;return e[0]&&typeof e[0]=="object"&&({name:n}=e[0],i===void 0&&(i=e[0].type),r===void 0&&(r=e[0].nullable),s===void 0&&(s=e[0].metadata)),new vM(`${n}`,i,r,s)}constructor(e,n,i=!1,r){this.name=e,this.type=n,this.nullable=i,this.metadata=r||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[n,i,r,s]=e;return!e[0]||typeof e[0]!="object"?[n=this.name,i=this.type,r=this.nullable,s=this.metadata]=e:{name:n=this.name,type:i=this.type,nullable:r=this.nullable,metadata:s=this.metadata}=e[0],vM.new(n,i,r,s)}};xn.prototype.type=null;xn.prototype.name=null;xn.prototype.nullable=null;xn.prototype.metadata=null;function Ev(t,e){return new Map([...t||new Map,...e||new Map])}function wM(t,e=new Map){for(let n=-1,i=t.length;++n<i;){const s=t[n].type;if(bt.isDictionary(s)){if(!e.has(s.id))e.set(s.id,s.dictionary);else if(e.get(s.id)!==s.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}s.children&&s.children.length>0&&wM(s.children,e)}return e}var Tft=zS,Fft=Da;let zk=class{static decode(e){e=new Fft(me(e));const n=Ho.getRootAsFooter(e),i=ln.decode(n.schema(),new Map,n.version());return new kft(i,n)}static encode(e){const n=new Tft,i=ln.encode(n,e.schema);Ho.startRecordBatchesVector(n,e.numRecordBatches);for(const o of[...e.recordBatches()].slice().reverse())H2.encode(n,o);const r=n.endVector();Ho.startDictionariesVector(n,e.numDictionaries);for(const o of[...e.dictionaryBatches()].slice().reverse())H2.encode(n,o);const s=n.endVector();return Ho.startFooter(n),Ho.addSchema(n,i),Ho.addVersion(n,Cn.V5),Ho.addRecordBatches(n,r),Ho.addDictionaries(n,s),Ho.finishFooterBuffer(n,Ho.endFooter(n)),n.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,n=Cn.V5,i,r){this.schema=e,this.version=n,i&&(this._recordBatches=i),r&&(this._dictionaryBatches=r)}*recordBatches(){for(let e,n=-1,i=this.numRecordBatches;++n<i;)(e=this.getRecordBatch(n))&&(yield e)}*dictionaryBatches(){for(let e,n=-1,i=this.numDictionaries;++n<i;)(e=this.getDictionaryBatch(n))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}},kft=class extends zk{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,n){super(e,n.version()),this._footer=n}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const n=this._footer.recordBatches(e);if(n)return H2.decode(n)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const n=this._footer.dictionaries(e);if(n)return H2.decode(n)}return null}},H2=class vq{static decode(e){return new vq(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,n){const{metaDataLength:i}=n,r=BigInt(n.offset),s=BigInt(n.bodyLength);return yM.createBlock(e,r,i,s)}constructor(e,n,i){this.metaDataLength=e,this.offset=ir(i),this.bodyLength=ir(n)}};const fn=Object.freeze({done:!0,value:void 0});let Q4=class{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}},wq=class{tee(){return this._getDOMStream().tee()}pipe(e,n){return this._getNodeStream().pipe(e,n)}pipeTo(e,n){return this._getDOMStream().pipeTo(e,n)}pipeThrough(e,n){return this._getDOMStream().pipeThrough(e,n)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}},Dft=class extends wq{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return Z(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(fn);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return _s.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return _s.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return Z(this,void 0,void 0,function*(){return yield this.abort(e),fn})}return(e){return Z(this,void 0,void 0,function*(){return yield this.close(),fn})}read(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((n,i)=>{this.resolvers.push({resolve:n,reject:i})}):Promise.resolve(fn)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}},Cft=class extends Dft{write(e){if((e=me(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?oM(this.toUint8Array(!0)):this.toUint8Array(!1).then(oM)}toUint8Array(e=!1){return e?Fa(this._values)[0]:Z(this,void 0,void 0,function*(){var n,i,r,s;const o=[];let a=0;try{for(var u=!0,c=ns(this),l;l=yield c.next(),n=l.done,!n;u=!0){s=l.value,u=!1;const f=s;o.push(f),a+=f.byteLength}}catch(f){i={error:f}}finally{try{!u&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}return Fa(o,a)[0]})}},X2=class{constructor(e){e&&(this.source=new Nft(_s.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}},K2=class _q{constructor(e){e instanceof _q?this.source=e.source:e instanceof Cft?this.source=new $f(_s.fromAsyncIterable(e)):BU(e)?this.source=new $f(_s.fromNodeStream(e)):Tk(e)?this.source=new $f(_s.fromDOMStream(e)):RU(e)?this.source=new $f(_s.fromDOMStream(e.body)):PS(e)?this.source=new $f(_s.fromIterable(e)):Hy(e)?this.source=new $f(_s.fromAsyncIterable(e)):Mk(e)&&(this.source=new $f(_s.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}},Nft=class{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,n="read"){return this.source.next({cmd:n,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||fn)}return(e){return Object.create(this.source.return&&this.source.return(e)||fn)}},$f=class{constructor(e){this.source=e,this._closedPromise=new Promise(n=>this._closedPromiseResolve=n)}cancel(e){return Z(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e,n="read"){return Z(this,void 0,void 0,function*(){return yield this.source.next({cmd:n,size:e})})}throw(e){return Z(this,void 0,void 0,function*(){const n=this.source.throw&&(yield this.source.throw(e))||fn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}return(e){return Z(this,void 0,void 0,function*(){const n=this.source.return&&(yield this.source.return(e))||fn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}},Z4=class extends X2{constructor(e,n){super(),this.position=0,this.buffer=me(e),this.size=n===void 0?this.buffer.byteLength:n}readInt32(e){const{buffer:n,byteOffset:i}=this.readAt(e,4);return new DataView(n,i).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:n,size:i,position:r}=this;return n&&r<i?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(i,r+Math.min(i-r,e)),n.subarray(r,this.position)):null}readAt(e,n){const i=this.buffer,r=Math.min(this.size,e+n);return i?i.subarray(e,r):new Uint8Array(n)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}},J2=class extends K2{constructor(e,n){super(),this.position=0,this._handle=e,typeof n=="number"?this.size=n:this._pending=Z(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return Z(this,void 0,void 0,function*(){const{buffer:n,byteOffset:i}=yield this.readAt(e,4);return new DataView(n,i).getInt32(0,!0)})}seek(e){return Z(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return Z(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:i,position:r}=this;if(n&&r<i){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let s=r,o=0,a=0;const u=Math.min(i,s+Math.min(i-s,e)),c=new Uint8Array(Math.max(0,(this.position=u)-s));for(;(s+=a)<u&&(o+=a)<c.byteLength;)({bytesRead:a}=yield n.read(c,o,c.byteLength-o,s));return c}return null})}readAt(e,n){return Z(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:i,size:r}=this;if(i&&e+n<r){const s=Math.min(r,e+n),o=new Uint8Array(s-e);return(yield i.read(o,0,n,e)).buffer}return new Uint8Array(n)})}close(){return Z(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return Z(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return Z(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}};const Oft=65536;function kp(t){return t<0&&(t=4294967295+t+1),`0x${t.toString(16)}`}const vg=8,Uk=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];let xq=class{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const n=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),i=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let r=n[3]*i[3];this.buffer[0]=r&65535;let s=r>>>16;return r=n[2]*i[3],s+=r,r=n[3]*i[2]>>>0,s+=r,this.buffer[0]+=s<<16,this.buffer[1]=s>>>0<r?Oft:0,this.buffer[1]+=s>>>16,this.buffer[1]+=n[1]*i[3]+n[2]*i[2]+n[3]*i[1],this.buffer[1]+=n[0]*i[3]+n[1]*i[2]+n[2]*i[1]+n[3]*i[0]<<16,this}_plus(e){const n=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],n<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=n}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${kp(this.buffer[1])} ${kp(this.buffer[0])}`}},Dn=class _u extends xq{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,n=new Uint32Array(2)){return _u.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return _u.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const i=e.length,r=new _u(n);for(let s=0;s<i;){const o=vg<i-s?vg:i-s,a=new _u(new Uint32Array([Number.parseInt(e.slice(s,s+o),10),0])),u=new _u(new Uint32Array([Uk[o],0]));r.times(u),r.plus(a),s+=o}return r}static convertArray(e){const n=new Uint32Array(e.length*2);for(let i=-1,r=e.length;++i<r;)_u.from(e[i],new Uint32Array(n.buffer,n.byteOffset+2*i*4,2));return n}static multiply(e,n){return new _u(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new _u(new Uint32Array(e.buffer)).plus(n)}},Ay=class xu extends xq{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const n=this.buffer[1]<<0,i=e.buffer[1]<<0;return n<i||n===i&&this.buffer[0]<e.buffer[0]}static from(e,n=new Uint32Array(2)){return xu.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return xu.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const i=e.startsWith("-"),r=e.length,s=new xu(n);for(let o=i?1:0;o<r;){const a=vg<r-o?vg:r-o,u=new xu(new Uint32Array([Number.parseInt(e.slice(o,o+a),10),0])),c=new xu(new Uint32Array([Uk[a],0]));s.times(c),s.plus(u),o+=a}return i?s.negate():s}static convertArray(e){const n=new Uint32Array(e.length*2);for(let i=-1,r=e.length;++i<r;)xu.from(e[i],new Uint32Array(n.buffer,n.byteOffset+2*i*4,2));return n}static multiply(e,n){return new xu(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new xu(new Uint32Array(e.buffer)).plus(n)}},Rft=class Su{constructor(e){this.buffer=e}high(){return new Ay(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new Ay(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const n=new Dn(new Uint32Array([this.buffer[3],0])),i=new Dn(new Uint32Array([this.buffer[2],0])),r=new Dn(new Uint32Array([this.buffer[1],0])),s=new Dn(new Uint32Array([this.buffer[0],0])),o=new Dn(new Uint32Array([e.buffer[3],0])),a=new Dn(new Uint32Array([e.buffer[2],0])),u=new Dn(new Uint32Array([e.buffer[1],0])),c=new Dn(new Uint32Array([e.buffer[0],0]));let l=Dn.multiply(s,c);this.buffer[0]=l.low();const f=new Dn(new Uint32Array([l.high(),0]));return l=Dn.multiply(r,c),f.plus(l),l=Dn.multiply(s,u),f.plus(l),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(l)?1:0,this.buffer[2]=f.high(),new Dn(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(Dn.multiply(i,c)).plus(Dn.multiply(r,u)).plus(Dn.multiply(s,a)),this.buffer[3]+=Dn.multiply(n,c).plus(Dn.multiply(i,u)).plus(Dn.multiply(r,a)).plus(Dn.multiply(s,o)).low(),this}plus(e){const n=new Uint32Array(4);return n[3]=this.buffer[3]+e.buffer[3]>>>0,n[2]=this.buffer[2]+e.buffer[2]>>>0,n[1]=this.buffer[1]+e.buffer[1]>>>0,n[0]=this.buffer[0]+e.buffer[0]>>>0,n[0]<this.buffer[0]>>>0&&++n[1],n[1]<this.buffer[1]>>>0&&++n[2],n[2]<this.buffer[2]>>>0&&++n[3],this.buffer[3]=n[3],this.buffer[2]=n[2],this.buffer[1]=n[1],this.buffer[0]=n[0],this}hex(){return`${kp(this.buffer[3])} ${kp(this.buffer[2])} ${kp(this.buffer[1])} ${kp(this.buffer[0])}`}static multiply(e,n){return new Su(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new Su(new Uint32Array(e.buffer)).plus(n)}static from(e,n=new Uint32Array(4)){return Su.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(4)){return Su.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(4)){const i=e.startsWith("-"),r=e.length,s=new Su(n);for(let o=i?1:0;o<r;){const a=vg<r-o?vg:r-o,u=new Su(new Uint32Array([Number.parseInt(e.slice(o,o+a),10),0,0,0])),c=new Su(new Uint32Array([Uk[a],0,0,0]));s.times(c),s.plus(u),o+=a}return i?s.negate():s}static convertArray(e){const n=new Uint32Array(e.length*4);for(let i=-1,r=e.length;++i<r;)Su.from(e[i],new Uint32Array(n.buffer,n.byteOffset+4*4*i,4));return n}},Sq=class extends se{constructor(e,n,i,r,s=Cn.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=n,this.buffers=i,this.dictionaries=r,this.metadataVersion=s}visit(e){return super.visit(e instanceof xn?e.type:e)}visitNull(e,{length:n}=this.nextFieldNode()){return ie({type:e,length:n})}visitBool(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitInt(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFloat(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitUtf8(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDate(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTimestamp(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTime(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDecimal(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitList(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),children:this.visitMany(e.children)})}visitUnion(e,{length:n,nullCount:i}=this.nextFieldNode()){return this.metadataVersion<Cn.V5&&this.readNullBitmap(e,i),e.mode===Fr.Sparse?this.visitSparseUnion(e,{length:n,nullCount:i}):this.visitDenseUnion(e,{length:n,nullCount:i})}visitDenseUnion(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDuration(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFixedSizeList(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),child:this.visit(e.children[0])})}visitMap(e,{length:n,nullCount:i}=this.nextFieldNode()){return ie({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,n,i=this.nextBufferRange()){return n>0&&this.readData(e,i)||new Uint8Array(0)}readOffsets(e,n){return this.readData(e,n)}readTypeIds(e,n){return this.readData(e,n)}readData(e,{length:n,offset:i}=this.nextBufferRange()){return this.bytes.subarray(i,i+n)}readDictionary(e){return this.dictionaries.get(e.id)}},Lft=class extends Sq{constructor(e,n,i,r,s){super(new Uint8Array(0),n,i,r,s),this.sources=e}readNullBitmap(e,n,{offset:i}=this.nextBufferRange()){return n<=0?new Uint8Array(0):pM(this.sources[i])}readOffsets(e,{offset:n}=this.nextBufferRange()){return Ce(Uint8Array,Ce(e.OffsetArrayType,this.sources[n]))}readTypeIds(e,{offset:n}=this.nextBufferRange()){return Ce(Uint8Array,Ce(e.ArrayType,this.sources[n]))}readData(e,{offset:n}=this.nextBufferRange()){const{sources:i}=this;return bt.isTimestamp(e)||(bt.isInt(e)||bt.isTime(e))&&e.bitWidth===64||bt.isDuration(e)||bt.isDate(e)&&e.unit===Ao.MILLISECOND?Ce(Uint8Array,Ay.convertArray(i[n])):bt.isDecimal(e)?Ce(Uint8Array,Rft.convertArray(i[n])):bt.isBinary(e)||bt.isLargeBinary(e)||bt.isFixedSizeBinary(e)?Bft(i[n]):bt.isBool(e)?pM(i[n]):bt.isUtf8(e)||bt.isLargeUtf8(e)?Ik(i[n].join("")):Ce(Uint8Array,Ce(e.ArrayType,i[n].map(r=>+r)))}};function Bft(t){const e=t.join(""),n=new Uint8Array(e.length/2);for(let i=0;i<e.length;i+=2)n[i>>1]=Number.parseInt(e.slice(i,i+2),16);return n}let Tt=class extends se{compareSchemas(e,n){return e===n||n instanceof e.constructor&&this.compareManyFields(e.fields,n.fields)}compareManyFields(e,n){return e===n||Array.isArray(e)&&Array.isArray(n)&&e.length===n.length&&e.every((i,r)=>this.compareFields(i,n[r]))}compareFields(e,n){return e===n||n instanceof e.constructor&&e.name===n.name&&e.nullable===n.nullable&&this.visit(e.type,n.type)}};function lr(t,e){return e instanceof t.constructor}function yh(t,e){return t===e||lr(t,e)}function pc(t,e){return t===e||lr(t,e)&&t.bitWidth===e.bitWidth&&t.isSigned===e.isSigned}function jS(t,e){return t===e||lr(t,e)&&t.precision===e.precision}function Pft(t,e){return t===e||lr(t,e)&&t.byteWidth===e.byteWidth}function jk(t,e){return t===e||lr(t,e)&&t.unit===e.unit}function ib(t,e){return t===e||lr(t,e)&&t.unit===e.unit&&t.timezone===e.timezone}function rb(t,e){return t===e||lr(t,e)&&t.unit===e.unit&&t.bitWidth===e.bitWidth}function zft(t,e){return t===e||lr(t,e)&&t.children.length===e.children.length&&xl.compareManyFields(t.children,e.children)}function Uft(t,e){return t===e||lr(t,e)&&t.children.length===e.children.length&&xl.compareManyFields(t.children,e.children)}function qk(t,e){return t===e||lr(t,e)&&t.mode===e.mode&&t.typeIds.every((n,i)=>n===e.typeIds[i])&&xl.compareManyFields(t.children,e.children)}function jft(t,e){return t===e||lr(t,e)&&t.id===e.id&&t.isOrdered===e.isOrdered&&xl.visit(t.indices,e.indices)&&xl.visit(t.dictionary,e.dictionary)}function Vk(t,e){return t===e||lr(t,e)&&t.unit===e.unit}function sb(t,e){return t===e||lr(t,e)&&t.unit===e.unit}function qft(t,e){return t===e||lr(t,e)&&t.listSize===e.listSize&&t.children.length===e.children.length&&xl.compareManyFields(t.children,e.children)}function Vft(t,e){return t===e||lr(t,e)&&t.keysSorted===e.keysSorted&&t.children.length===e.children.length&&xl.compareManyFields(t.children,e.children)}Tt.prototype.visitNull=yh;Tt.prototype.visitBool=yh;Tt.prototype.visitInt=pc;Tt.prototype.visitInt8=pc;Tt.prototype.visitInt16=pc;Tt.prototype.visitInt32=pc;Tt.prototype.visitInt64=pc;Tt.prototype.visitUint8=pc;Tt.prototype.visitUint16=pc;Tt.prototype.visitUint32=pc;Tt.prototype.visitUint64=pc;Tt.prototype.visitFloat=jS;Tt.prototype.visitFloat16=jS;Tt.prototype.visitFloat32=jS;Tt.prototype.visitFloat64=jS;Tt.prototype.visitUtf8=yh;Tt.prototype.visitLargeUtf8=yh;Tt.prototype.visitBinary=yh;Tt.prototype.visitLargeBinary=yh;Tt.prototype.visitFixedSizeBinary=Pft;Tt.prototype.visitDate=jk;Tt.prototype.visitDateDay=jk;Tt.prototype.visitDateMillisecond=jk;Tt.prototype.visitTimestamp=ib;Tt.prototype.visitTimestampSecond=ib;Tt.prototype.visitTimestampMillisecond=ib;Tt.prototype.visitTimestampMicrosecond=ib;Tt.prototype.visitTimestampNanosecond=ib;Tt.prototype.visitTime=rb;Tt.prototype.visitTimeSecond=rb;Tt.prototype.visitTimeMillisecond=rb;Tt.prototype.visitTimeMicrosecond=rb;Tt.prototype.visitTimeNanosecond=rb;Tt.prototype.visitDecimal=yh;Tt.prototype.visitList=zft;Tt.prototype.visitStruct=Uft;Tt.prototype.visitUnion=qk;Tt.prototype.visitDenseUnion=qk;Tt.prototype.visitSparseUnion=qk;Tt.prototype.visitDictionary=jft;Tt.prototype.visitInterval=Vk;Tt.prototype.visitIntervalDayTime=Vk;Tt.prototype.visitIntervalYearMonth=Vk;Tt.prototype.visitDuration=sb;Tt.prototype.visitDurationSecond=sb;Tt.prototype.visitDurationMillisecond=sb;Tt.prototype.visitDurationMicrosecond=sb;Tt.prototype.visitDurationNanosecond=sb;Tt.prototype.visitFixedSizeList=qft;Tt.prototype.visitMap=Vft;const xl=new Tt;function Wft(t,e){return xl.compareSchemas(t,e)}function G$(t,e){return Gft(t,e.map(n=>n.data.concat()))}function Gft(t,e){const n=[...t.fields],i=[],r={numBatches:e.reduce((f,d)=>Math.max(f,d.length),0)};let s=0,o=0,a=-1;const u=e.length;let c,l=[];for(;r.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,a=-1;++a<u;)l[a]=c=e[a].shift(),o=Math.min(o,c?c.length:o);Number.isFinite(o)&&(l=Yft(n,o,l,e,r),o>0&&(i[s++]=ie({type:new Hi(n),length:o,nullCount:0,children:l.slice()})))}return[t=t.assign(n),i.map(f=>new co(t,f))]}function Yft(t,e,n,i,r){var s;const o=(e+63&-64)>>3;for(let a=-1,u=i.length;++a<u;){const c=n[a],l=c==null?void 0:c.length;if(l>=e)l===e?n[a]=c:(n[a]=c.slice(0,e),r.numBatches=Math.max(r.numBatches,i[a].unshift(c.slice(e,l-e))));else{const f=t[a];t[a]=f.clone({nullable:!0}),n[a]=(s=c==null?void 0:c._changeLengthAndBackfillNullBitmap(e))!==null&&s!==void 0?s:ie({type:f.type,length:e,nullCount:e,nullBitmap:new Uint8Array(o)})}}return n}var Eq;let e1=class Hf{constructor(...e){var n,i;if(e.length===0)return this.batches=[],this.schema=new ln([]),this._offsets=[0],this;let r,s;e[0]instanceof ln&&(r=e.shift()),e.at(-1)instanceof Uint32Array&&(s=e.pop());const o=u=>{if(u){if(u instanceof co)return[u];if(u instanceof Hf)return u.batches;if(u instanceof Ge){if(u.type instanceof Hi)return[new co(new ln(u.type.children),u)]}else{if(Array.isArray(u))return u.flatMap(c=>o(c));if(typeof u[Symbol.iterator]=="function")return[...u].flatMap(c=>o(c));if(typeof u=="object"){const c=Object.keys(u),l=c.map(h=>new $n([u[h]])),f=r??new ln(c.map((h,p)=>new xn(String(h),l[p].type,l[p].nullable))),[,d]=G$(f,l);return d.length===0?[new co(u)]:d}}}return[]},a=e.flatMap(u=>o(u));if(r=(i=r??((n=a[0])===null||n===void 0?void 0:n.schema))!==null&&i!==void 0?i:new ln([]),!(r instanceof ln))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const u of a){if(!(u instanceof co))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!Wft(r,u.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=r,this.batches=a,this._offsets=s??lq(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,n)=>e+n.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=cq(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}set(e,n){}indexOf(e,n){return-1}[Symbol.iterator](){return this.batches.length>0?Pk.visit(new $n(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const n=this.schema,i=this.data.concat(e.flatMap(({data:r})=>r));return new Hf(n,i.map(r=>new co(n,r)))}slice(e,n){const i=this.schema;[e,n]=aq({length:this.numRows},e,n);const r=fq(this.data,this._offsets,e,n);return new Hf(i,r.map(s=>new co(i,s)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(n=>n.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const n=this.data.map(i=>i.children[e]);if(n.length===0){const{type:i}=this.schema.fields[e],r=ie({type:i,length:0,nullCount:0});n.push(r._changeLengthAndBackfillNullBitmap(this.numRows))}return new $n(n)}return null}setChild(e,n){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(r=>r.name===e),n)}setChildAt(e,n){let i=this.schema,r=[...this.batches];if(e>-1&&e<this.numCols){n||(n=new $n([ie({type:new wl,length:this.numRows})]));const s=i.fields.slice(),o=s[e].clone({type:n.type}),a=this.schema.fields.map((u,c)=>this.getChildAt(c));[s[e],a[e]]=[o,n],[i,r]=G$(i,a)}return new Hf(i,r)}select(e){const n=this.schema.fields.reduce((i,r,s)=>i.set(r.name,s),new Map);return this.selectAt(e.map(i=>n.get(i)).filter(i=>i>-1))}selectAt(e){const n=this.schema.selectAt(e),i=this.batches.map(r=>r.selectAt(e));return new Hf(n,i)}assign(e){const n=this.schema.fields,[i,r]=e.schema.fields.reduce((a,u,c)=>{const[l,f]=a,d=n.findIndex(h=>h.name===u.name);return~d?f[d]=c:l.push(c),a},[[],[]]),s=this.schema.assign(e.schema),o=[...n.map((a,u)=>[u,r[u]]).map(([a,u])=>u===void 0?this.getChildAt(a):e.getChildAt(u)),...i.map(a=>e.getChildAt(a))].filter(Boolean);return new Hf(...G$(s,o))}};Eq=Symbol.toStringTag;e1[Eq]=(t=>(t.schema=null,t.batches=[],t._offsets=new Uint32Array([0]),t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,t.isValid=G2(Bk),t.get=G2(kr.getVisitFn(O.Struct)),t.set=dq(Os.getVisitFn(O.Struct)),t.indexOf=hq(Y2.getVisitFn(O.Struct)),"Table"))(e1.prototype);var Aq;let co=class X0{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof ln))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=ie({nullCount:0,type:new Hi(this.schema.fields),children:this.schema.fields.map(n=>ie({type:n.type,nullCount:0}))})]=e,!(this.data instanceof Ge))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=t5(this.schema,this.data.children);break}case 1:{const[n]=e,{fields:i,children:r,length:s}=Object.keys(n).reduce((u,c,l)=>(u.children[l]=n[c],u.length=Math.max(u.length,n[c].length),u.fields[l]=xn.new({name:c,type:n[c].type,nullable:!0}),u),{length:0,fields:new Array,children:new Array}),o=new ln(i),a=ie({type:new Hi(i),length:s,children:r,nullCount:0});[this.schema,this.data]=t5(o,a.children,s);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=$q(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return kr.visit(this.data,e)}set(e,n){return Os.visit(this.data,e,n)}indexOf(e,n){return Y2.visit(this.data,e,n)}[Symbol.iterator](){return Pk.visit(new $n([this.data]))}toArray(){return[...this]}concat(...e){return new e1(this.schema,[this,...e])}slice(e,n){const[i]=new $n([this.data]).slice(e,n).data;return new X0(this.schema,i)}getChild(e){var n;return this.getChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new $n([this.data.children[e]]):null}setChild(e,n){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(r=>r.name===e),n)}setChildAt(e,n){let i=this.schema,r=this.data;if(e>-1&&e<this.numCols){n||(n=new $n([ie({type:new wl,length:this.numRows})]));const s=i.fields.slice(),o=r.children.slice(),a=s[e].clone({type:n.type});[s[e],o[e]]=[a,n.data[0]],i=new ln(s,new Map(this.schema.metadata)),r=ie({type:new Hi(s),children:o})}return new X0(i,r)}select(e){const n=this.schema.select(e),i=new Hi(n.fields),r=[];for(const s of e){const o=this.schema.fields.findIndex(a=>a.name===s);~o&&(r[o]=this.data.children[o])}return new X0(n,ie({type:i,length:this.numRows,children:r}))}selectAt(e){const n=this.schema.selectAt(e),i=e.map(s=>this.data.children[s]).filter(Boolean),r=ie({type:new Hi(n.fields),length:this.numRows,children:i});return new X0(n,r)}};Aq=Symbol.toStringTag;co[Aq]=(t=>(t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(co.prototype);function t5(t,e,n=e.reduce((i,r)=>Math.max(i,r.length),0)){var i;const r=[...t.fields],s=[...e],o=(n+63&-64)>>3;for(const[a,u]of t.fields.entries()){const c=e[a];(!c||c.length!==n)&&(r[a]=u.clone({nullable:!0}),s[a]=(i=c==null?void 0:c._changeLengthAndBackfillNullBitmap(n))!==null&&i!==void 0?i:ie({type:u.type,length:n,nullCount:n,nullBitmap:new Uint8Array(o)}))}return[t.assign(r),ie({type:new Hi(r),length:n,children:s})]}function $q(t,e,n=new Map){var i,r;if(((i=t==null?void 0:t.length)!==null&&i!==void 0?i:0)>0&&(t==null?void 0:t.length)===(e==null?void 0:e.length))for(let s=-1,o=t.length;++s<o;){const{type:a}=t[s],u=e[s];for(const c of[u,...((r=u==null?void 0:u.dictionary)===null||r===void 0?void 0:r.data)||[]])$q(a.children,c==null?void 0:c.children,n);if(bt.isDictionary(a)){const{id:c}=a;if(!n.has(c))u!=null&&u.dictionary&&n.set(c,u.dictionary);else if(n.get(c)!==u.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return n}let Iq=class extends co{constructor(e){const n=e.fields.map(r=>ie({type:r.type})),i=ie({type:new Hi(e.fields),nullCount:0,children:n});super(e,i)}},Cc=class Ko{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMessage(e,n){return(n||new Ko).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,n){return e.setPosition(e.position()+yt),(n||new Ko).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Cn.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Me.NONE}header(e){const n=this.bb.__offset(this.bb_pos,8);return n?this.bb.__union(e,this.bb_pos+n):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,12);return i?(n||new $s).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,Cn.V1)}static addHeaderType(e,n){e.addFieldInt8(1,n,Me.NONE)}static addHeader(e,n){e.addFieldOffset(2,n,0)}static addBodyLength(e,n){e.addFieldInt64(3,n,BigInt("0"))}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,n){e.finish(n)}static finishSizePrefixedMessageBuffer(e,n){e.finish(n,void 0,!0)}static createMessage(e,n,i,r,s,o){return Ko.startMessage(e),Ko.addVersion(e,n),Ko.addHeaderType(e,i),Ko.addHeader(e,r),Ko.addBodyLength(e,s),Ko.addCustomMetadata(e,o),Ko.endMessage(e)}},Hft=class extends se{visit(e,n){return e==null||n==null?void 0:super.visit(e,n)}visitNull(e,n){return j4.startNull(n),j4.endNull(n)}visitInt(e,n){return Fp.startInt(n),Fp.addBitWidth(n,e.bitWidth),Fp.addIsSigned(n,e.isSigned),Fp.endInt(n)}visitFloat(e,n){return Nw.startFloatingPoint(n),Nw.addPrecision(n,e.precision),Nw.endFloatingPoint(n)}visitBinary(e,n){return L4.startBinary(n),L4.endBinary(n)}visitLargeBinary(e,n){return P4.startLargeBinary(n),P4.endLargeBinary(n)}visitBool(e,n){return B4.startBool(n),B4.endBool(n)}visitUtf8(e,n){return V4.startUtf8(n),V4.endUtf8(n)}visitLargeUtf8(e,n){return z4.startLargeUtf8(n),z4.endLargeUtf8(n)}visitDecimal(e,n){return pp.startDecimal(n),pp.addScale(n,e.scale),pp.addPrecision(n,e.precision),pp.addBitWidth(n,e.bitWidth),pp.endDecimal(n)}visitDate(e,n){return Fw.startDate(n),Fw.addUnit(n,e.unit),Fw.endDate(n)}visitTime(e,n){return G0.startTime(n),G0.addUnit(n,e.unit),G0.addBitWidth(n,e.bitWidth),G0.endTime(n)}visitTimestamp(e,n){const i=e.timezone&&n.createString(e.timezone)||void 0;return Y0.startTimestamp(n),Y0.addUnit(n,e.unit),i!==void 0&&Y0.addTimezone(n,i),Y0.endTimestamp(n)}visitInterval(e,n){return Ow.startInterval(n),Ow.addUnit(n,e.unit),Ow.endInterval(n)}visitDuration(e,n){return kw.startDuration(n),kw.addUnit(n,e.unit),kw.endDuration(n)}visitList(e,n){return U4.startList(n),U4.endList(n)}visitStruct(e,n){return q4.startStruct_(n),q4.endStruct_(n)}visitUnion(e,n){Vf.startTypeIdsVector(n,e.typeIds.length);const i=Vf.createTypeIdsVector(n,e.typeIds);return Vf.startUnion(n),Vf.addMode(n,e.mode),Vf.addTypeIds(n,i),Vf.endUnion(n)}visitDictionary(e,n){const i=this.visit(e.indices,n);return dp.startDictionaryEncoding(n),dp.addId(n,BigInt(e.id)),dp.addIsOrdered(n,e.isOrdered),i!==void 0&&dp.addIndexType(n,i),dp.endDictionaryEncoding(n)}visitFixedSizeBinary(e,n){return Dw.startFixedSizeBinary(n),Dw.addByteWidth(n,e.byteWidth),Dw.endFixedSizeBinary(n)}visitFixedSizeList(e,n){return Cw.startFixedSizeList(n),Cw.addListSize(n,e.listSize),Cw.endFixedSizeList(n)}visitMap(e,n){return Rw.startMap(n),Rw.addKeysSorted(n,e.keysSorted),Rw.endMap(n)}};const Y$=new Hft;function Xft(t,e=new Map){return new ln(Jft(t,e),Pw(t.metadata),e)}function Mq(t){return new $o(t.count,Tq(t.columns),Fq(t.columns))}function Kft(t){return new ic(Mq(t.data),t.id,t.isDelta)}function Jft(t,e){return(t.fields||[]).filter(Boolean).map(n=>xn.fromJSON(n,e))}function e5(t,e){return(t.children||[]).filter(Boolean).map(n=>xn.fromJSON(n,e))}function Tq(t){return(t||[]).reduce((e,n)=>[...e,new pm(n.count,Qft(n.VALIDITY)),...Tq(n.children)],[])}function Fq(t,e=[]){for(let n=-1,i=(t||[]).length;++n<i;){const r=t[n];r.VALIDITY&&e.push(new ju(e.length,r.VALIDITY.length)),r.TYPE_ID&&e.push(new ju(e.length,r.TYPE_ID.length)),r.OFFSET&&e.push(new ju(e.length,r.OFFSET.length)),r.DATA&&e.push(new ju(e.length,r.DATA.length)),e=Fq(r.children,e)}return e}function Qft(t){return(t||[]).reduce((e,n)=>e+ +(n===0),0)}function Zft(t,e){let n,i,r,s,o,a;return!e||!(s=t.dictionary)?(o=i5(t,e5(t,e)),r=new xn(t.name,o,t.nullable,Pw(t.metadata))):e.has(n=s.id)?(i=(i=s.indexType)?n5(i):new Qy,a=new bg(e.get(n),i,n,s.isOrdered),r=new xn(t.name,a,t.nullable,Pw(t.metadata))):(i=(i=s.indexType)?n5(i):new Qy,e.set(n,o=i5(t,e5(t,e))),a=new bg(o,i,n,s.isOrdered),r=new xn(t.name,a,t.nullable,Pw(t.metadata))),r||null}function Pw(t=[]){return new Map(t.map(({key:e,value:n})=>[e,n]))}function n5(t){return new _l(t.isSigned,t.bitWidth)}function i5(t,e){const n=t.type.name;switch(n){case"NONE":return new wl;case"null":return new wl;case"binary":return new k2;case"largebinary":return new D2;case"utf8":return new C2;case"largeutf8":return new N2;case"bool":return new O2;case"list":return new U2((e||[])[0]);case"struct":return new Hi(e||[]);case"struct_":return new Hi(e||[])}switch(n){case"int":{const i=t.type;return new _l(i.isSigned,i.bitWidth)}case"floatingpoint":{const i=t.type;return new Zy(Di[i.precision])}case"decimal":{const i=t.type;return new R2(i.scale,i.precision,i.bitWidth)}case"date":{const i=t.type;return new L2(Ao[i.unit])}case"time":{const i=t.type;return new t1(kt[i.unit],i.bitWidth)}case"timestamp":{const i=t.type;return new B2(kt[i.unit],i.timezone)}case"interval":{const i=t.type;return new P2(ka[i.unit])}case"duration":{const i=t.type;return new z2(kt[i.unit])}case"union":{const i=t.type,[r,...s]=(i.mode+"").toLowerCase(),o=r.toUpperCase()+s.join("");return new j2(Fr[o],i.typeIds||[],e||[])}case"fixedsizebinary":{const i=t.type;return new q2(i.byteWidth)}case"fixedsizelist":{const i=t.type;return new V2(i.listSize,(e||[])[0])}case"map":{const i=t.type;return new W2((e||[])[0],i.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var tdt=zS,edt=Da;let $y=class xp{static fromJSON(e,n){const i=new xp(0,Cn.V5,n);return i._createHeader=ndt(e,n),i}static decode(e){e=new edt(me(e));const n=Cc.getRootAsMessage(e),i=n.bodyLength(),r=n.version(),s=n.headerType(),o=new xp(i,r,s);return o._createHeader=idt(n,s),o}static encode(e){const n=new tdt;let i=-1;return e.isSchema()?i=ln.encode(n,e.header()):e.isRecordBatch()?i=$o.encode(n,e.header()):e.isDictionaryBatch()&&(i=ic.encode(n,e.header())),Cc.startMessage(n),Cc.addVersion(n,Cn.V5),Cc.addHeader(n,i),Cc.addHeaderType(n,e.headerType),Cc.addBodyLength(n,BigInt(e.bodyLength)),Cc.finishMessageBuffer(n,Cc.endMessage(n)),n.asUint8Array()}static from(e,n=0){if(e instanceof ln)return new xp(0,Cn.V5,Me.Schema,e);if(e instanceof $o)return new xp(n,Cn.V5,Me.RecordBatch,e);if(e instanceof ic)return new xp(n,Cn.V5,Me.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Me.Schema}isRecordBatch(){return this.headerType===Me.RecordBatch}isDictionaryBatch(){return this.headerType===Me.DictionaryBatch}constructor(e,n,i,r){this._version=n,this._headerType=i,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength=ir(e)}},$o=class{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,n,i){this._nodes=n,this._buffers=i,this._length=ir(e)}},ic=class{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,n,i=!1){this._data=e,this._isDelta=i,this._id=ir(n)}},ju=class{constructor(e,n){this.offset=ir(e),this.length=ir(n)}},pm=class{constructor(e,n){this.length=ir(e),this.nullCount=ir(n)}};function ndt(t,e){return()=>{switch(e){case Me.Schema:return ln.fromJSON(t);case Me.RecordBatch:return $o.fromJSON(t);case Me.DictionaryBatch:return ic.fromJSON(t)}throw new Error(`Unrecognized Message type: { name: ${Me[e]}, type: ${e} }`)}}function idt(t,e){return()=>{switch(e){case Me.Schema:return ln.decode(t.header(new ta),new Map,t.version());case Me.RecordBatch:return $o.decode(t.header(new $u),t.version());case Me.DictionaryBatch:return ic.decode(t.header(new fp),t.version())}throw new Error(`Unrecognized Message type: { name: ${Me[e]}, type: ${e} }`)}}xn.encode=pdt;xn.decode=ddt;xn.fromJSON=Zft;ln.encode=hdt;ln.decode=rdt;ln.fromJSON=Xft;$o.encode=gdt;$o.decode=sdt;$o.fromJSON=Mq;ic.encode=mdt;ic.decode=odt;ic.fromJSON=Kft;pm.encode=ydt;pm.decode=udt;ju.encode=bdt;ju.decode=adt;function rdt(t,e=new Map,n=Cn.V5){const i=fdt(t,e);return new ln(i,zw(t),e,n)}function sdt(t,e=Cn.V5){if(t.compression()!==null)throw new Error("Record batch compression not implemented");return new $o(t.length(),cdt(t),ldt(t,e))}function odt(t,e=Cn.V5){return new ic($o.decode(t.data(),e),t.id(),t.isDelta())}function adt(t){return new ju(t.offset(),t.length())}function udt(t){return new pm(t.length(),t.nullCount())}function cdt(t){const e=[];for(let n,i=-1,r=-1,s=t.nodesLength();++i<s;)(n=t.nodes(i))&&(e[++r]=pm.decode(n));return e}function ldt(t,e){const n=[];for(let i,r=-1,s=-1,o=t.buffersLength();++r<o;)(i=t.buffers(r))&&(e<Cn.V4&&(i.bb_pos+=8*(r+1)),n[++s]=ju.decode(i));return n}function fdt(t,e){const n=[];for(let i,r=-1,s=-1,o=t.fieldsLength();++r<o;)(i=t.fields(r))&&(n[++s]=xn.decode(i,e));return n}function r5(t,e){const n=[];for(let i,r=-1,s=-1,o=t.childrenLength();++r<o;)(i=t.children(r))&&(n[++s]=xn.decode(i,e));return n}function ddt(t,e){let n,i,r,s,o,a;return!e||!(a=t.dictionary())?(r=o5(t,r5(t,e)),i=new xn(t.name(),r,t.nullable(),zw(t))):e.has(n=ir(a.id()))?(s=(s=a.indexType())?s5(s):new Qy,o=new bg(e.get(n),s,n,a.isOrdered()),i=new xn(t.name(),o,t.nullable(),zw(t))):(s=(s=a.indexType())?s5(s):new Qy,e.set(n,r=o5(t,r5(t,e))),o=new bg(r,s,n,a.isOrdered()),i=new xn(t.name(),o,t.nullable(),zw(t))),i||null}function zw(t){const e=new Map;if(t)for(let n,i,r=-1,s=Math.trunc(t.customMetadataLength());++r<s;)(n=t.customMetadata(r))&&(i=n.key())!=null&&e.set(i,n.value());return e}function s5(t){return new _l(t.isSigned(),t.bitWidth())}function o5(t,e){const n=t.typeType();switch(n){case We.NONE:return new wl;case We.Null:return new wl;case We.Binary:return new k2;case We.LargeBinary:return new D2;case We.Utf8:return new C2;case We.LargeUtf8:return new N2;case We.Bool:return new O2;case We.List:return new U2((e||[])[0]);case We.Struct_:return new Hi(e||[])}switch(n){case We.Int:{const i=t.type(new Fp);return new _l(i.isSigned(),i.bitWidth())}case We.FloatingPoint:{const i=t.type(new Nw);return new Zy(i.precision())}case We.Decimal:{const i=t.type(new pp);return new R2(i.scale(),i.precision(),i.bitWidth())}case We.Date:{const i=t.type(new Fw);return new L2(i.unit())}case We.Time:{const i=t.type(new G0);return new t1(i.unit(),i.bitWidth())}case We.Timestamp:{const i=t.type(new Y0);return new B2(i.unit(),i.timezone())}case We.Interval:{const i=t.type(new Ow);return new P2(i.unit())}case We.Duration:{const i=t.type(new kw);return new z2(i.unit())}case We.Union:{const i=t.type(new Vf);return new j2(i.mode(),i.typeIdsArray()||[],e||[])}case We.FixedSizeBinary:{const i=t.type(new Dw);return new q2(i.byteWidth())}case We.FixedSizeList:{const i=t.type(new Cw);return new V2(i.listSize(),(e||[])[0])}case We.Map:{const i=t.type(new Rw);return new W2((e||[])[0],i.keysSorted())}}throw new Error(`Unrecognized type: "${We[n]}" (${n})`)}function hdt(t,e){const n=e.fields.map(s=>xn.encode(t,s));ta.startFieldsVector(t,n.length);const i=ta.createFieldsVector(t,n),r=e.metadata&&e.metadata.size>0?ta.createCustomMetadataVector(t,[...e.metadata].map(([s,o])=>{const a=t.createString(`${s}`),u=t.createString(`${o}`);return $s.startKeyValue(t),$s.addKey(t,a),$s.addValue(t,u),$s.endKeyValue(t)})):-1;return ta.startSchema(t),ta.addFields(t,i),ta.addEndianness(t,vdt?yg.Little:yg.Big),r!==-1&&ta.addCustomMetadata(t,r),ta.endSchema(t)}function pdt(t,e){let n=-1,i=-1,r=-1;const s=e.type;let o=e.typeId;bt.isDictionary(s)?(o=s.dictionary.typeId,r=Y$.visit(s,t),i=Y$.visit(s.dictionary,t)):i=Y$.visit(s,t);const a=(s.children||[]).map(l=>xn.encode(t,l)),u=vs.createChildrenVector(t,a),c=e.metadata&&e.metadata.size>0?vs.createCustomMetadataVector(t,[...e.metadata].map(([l,f])=>{const d=t.createString(`${l}`),h=t.createString(`${f}`);return $s.startKeyValue(t),$s.addKey(t,d),$s.addValue(t,h),$s.endKeyValue(t)})):-1;return e.name&&(n=t.createString(e.name)),vs.startField(t),vs.addType(t,i),vs.addTypeType(t,o),vs.addChildren(t,u),vs.addNullable(t,!!e.nullable),n!==-1&&vs.addName(t,n),r!==-1&&vs.addDictionary(t,r),c!==-1&&vs.addCustomMetadata(t,c),vs.endField(t)}function gdt(t,e){const n=e.nodes||[],i=e.buffers||[];$u.startNodesVector(t,n.length);for(const o of n.slice().reverse())pm.encode(t,o);const r=t.endVector();$u.startBuffersVector(t,i.length);for(const o of i.slice().reverse())ju.encode(t,o);const s=t.endVector();return $u.startRecordBatch(t),$u.addLength(t,BigInt(e.length)),$u.addNodes(t,r),$u.addBuffers(t,s),$u.endRecordBatch(t)}function mdt(t,e){const n=$o.encode(t,e.data);return fp.startDictionaryBatch(t),fp.addId(t,BigInt(e.id)),fp.addIsDelta(t,e.isDelta),fp.addData(t,n),fp.endDictionaryBatch(t)}function ydt(t,e){return qU.createFieldNode(t,BigInt(e.length),BigInt(e.nullCount))}function bdt(t,e){return jU.createBuffer(t,BigInt(e.offset),BigInt(e.length))}const vdt=(()=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),new Int16Array(t)[0]===256})(),Wk=t=>`Expected ${Me[t]} Message in stream, but was null or length 0.`,Gk=t=>`Header pointer of flatbuffer-encoded ${Me[t]} Message is null or length 0.`,kq=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,Dq=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`;let Cq=class{constructor(e){this.source=e instanceof X2?e:new X2(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?fn:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(Wk(e));return n.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const n=me(this.source.read(e));if(n.byteLength<e)throw new Error(Dq(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()}readSchema(e=!1){const n=Me.Schema,i=this.readMessage(n),r=i==null?void 0:i.header();if(e&&!r)throw new Error(Gk(n));return r}readMetadataLength(){const e=this.source.read(qS),n=e&&new Da(e),i=(n==null?void 0:n.readInt32(0))||0;return{done:i===0,value:i}}readMetadata(e){const n=this.source.read(e);if(!n)return fn;if(n.byteLength<e)throw new Error(kq(e,n.byteLength));return{done:!1,value:$y.decode(n)}}},wdt=class{constructor(e,n){this.source=e instanceof K2?e:OU(e)?new J2(e,n):new K2(e)}[Symbol.asyncIterator](){return this}next(){return Z(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?fn:e})}throw(e){return Z(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return Z(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return Z(this,void 0,void 0,function*(){let n;if((n=yield this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(Wk(e));return n.value})}readMessageBody(e){return Z(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const n=me(yield this.source.read(e));if(n.byteLength<e)throw new Error(Dq(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()})}readSchema(e=!1){return Z(this,void 0,void 0,function*(){const n=Me.Schema,i=yield this.readMessage(n),r=i==null?void 0:i.header();if(e&&!r)throw new Error(Gk(n));return r})}readMetadataLength(){return Z(this,void 0,void 0,function*(){const e=yield this.source.read(qS),n=e&&new Da(e),i=(n==null?void 0:n.readInt32(0))||0;return{done:i===0,value:i}})}readMetadata(e){return Z(this,void 0,void 0,function*(){const n=yield this.source.read(e);if(!n)return fn;if(n.byteLength<e)throw new Error(kq(e,n.byteLength));return{done:!1,value:$y.decode(n)}})}},_dt=class extends Cq{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof Q4?e:new Q4(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:$y.fromJSON(e.schema,Me.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const n=e.dictionaries[this._dictionaryIndex++];return this._body=n.data.columns,{done:!1,value:$y.fromJSON(n,Me.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const n=e.batches[this._batchIndex++];return this._body=n.columns,{done:!1,value:$y.fromJSON(n,Me.RecordBatch)}}return this._body=[],fn}readMessageBody(e){return n(this._body);function n(i){return(i||[]).reduce((r,s)=>[...r,...s.VALIDITY&&[s.VALIDITY]||[],...s.TYPE_ID&&[s.TYPE_ID]||[],...s.OFFSET&&[s.OFFSET]||[],...s.DATA&&[s.DATA]||[],...n(s.children)],[])}}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(Wk(e));return n.value}readSchema(){const e=Me.Schema,n=this.readMessage(e),i=n==null?void 0:n.header();if(!n||!i)throw new Error(Gk(e));return i}};const qS=4,_M="ARROW1",Q2=new Uint8Array(_M.length);for(let t=0;t<_M.length;t+=1)Q2[t]=_M.codePointAt(t);function Yk(t,e=0){for(let n=-1,i=Q2.length;++n<i;)if(Q2[n]!==t[e+n])return!1;return!0}const ob=Q2.length,Nq=ob+qS,xdt=ob*2+qS;let ab=class Uw extends wq{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const n=this._impl.open(e);return Hy(n)?n.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return _s.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return _s.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof Uw?e:aM(e)?$dt(e):OU(e)?Tdt(e):Hy(e)?Z(this,void 0,void 0,function*(){return yield Uw.from(yield e)}):RU(e)||Tk(e)||BU(e)||Mk(e)?Mdt(new K2(e)):Idt(new X2(e))}static readAll(e){return e instanceof Uw?e.isSync()?a5(e):u5(e):aM(e)||ArrayBuffer.isView(e)||PS(e)||NU(e)?a5(e):u5(e)}},Z2=class extends ab{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Nn(this,arguments,function*(){yield rt(yield*hl(ns(this[Symbol.iterator]())))})}},t_=class extends ab{constructor(e){super(e),this._impl=e}readAll(){var e,n,i,r;return Z(this,void 0,void 0,function*(){const s=new Array;try{for(var o=!0,a=ns(this),u;u=yield a.next(),e=u.done,!e;o=!0){r=u.value,o=!1;const c=r;s.push(c)}}catch(c){n={error:c}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return s})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}},Oq=class extends Z2{constructor(e){super(e),this._impl=e}},Sdt=class extends t_{constructor(e){super(e),this._impl=e}},Rq=class{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,n){const i=this._loadVectors(e,n,this.schema.fields),r=ie({type:new Hi(this.schema.fields),length:e.length,children:i});return new co(this.schema,r)}_loadDictionaryBatch(e,n){const{id:i,isDelta:r}=e,{dictionaries:s,schema:o}=this,a=s.get(i);if(r||!a){const u=o.dictionaries.get(i),c=this._loadVectors(e.data,n,[u]);return(a&&r?a.concat(new $n(c)):new $n(c)).memoize()}return a.memoize()}_loadVectors(e,n,i){return new Sq(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}},e_=class extends Rq{constructor(e,n){super(n),this._reader=aM(e)?new _dt(this._handle=e):new Cq(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=Bq(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):fn}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):fn}next(){if(this.closed)return fn;let e;const{_reader:n}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),r=n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),r=n.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(i,r);this.dictionaries.set(i.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Iq(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}},n_=class extends Rq{constructor(e,n){super(n),this._reader=new wdt(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Z(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return Z(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Bq(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return Z(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):fn})}return(e){return Z(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):fn})}next(){return Z(this,void 0,void 0,function*(){if(this.closed)return fn;let e;const{_reader:n}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),r=yield n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),r=yield n.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(i,r);this.dictionaries.set(i.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Iq(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return Z(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}},Lq=class extends e_{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,n){super(e instanceof Z4?e:new Z4(e),n)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var n;if(this.closed)return null;this._footer||this.open();const i=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(i&&this._handle.seek(i.offset)){const r=this._reader.readMessage(Me.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),o=this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,o)}}return null}_readDictionaryBatch(e){var n;const i=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(i&&this._handle.seek(i.offset)){const r=this._reader.readMessage(Me.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),o=this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}}_readFooter(){const{_handle:e}=this,n=e.size-Nq,i=e.readInt32(n),r=e.readAt(n-i,i);return zk.decode(r)}_readNextMessageAndValidate(e){var n;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const i=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(this._recordBatchIndex);if(i&&this._handle.seek(i.offset))return this._reader.readMessage(e)}return null}},Edt=class extends n_{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...n){const i=typeof n[0]!="number"?n.shift():void 0,r=n[0]instanceof Map?n.shift():void 0;super(e instanceof J2?e:new J2(e,i),r)}isFile(){return!0}isAsync(){return!0}open(e){const n=Object.create(null,{open:{get:()=>super.open}});return Z(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const i of this._footer.dictionaryBatches())i&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield n.open.call(this,e)})}readRecordBatch(e){var n;return Z(this,void 0,void 0,function*(){if(this.closed)return null;this._footer||(yield this.open());const i=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(i&&(yield this._handle.seek(i.offset))){const r=yield this._reader.readMessage(Me.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),o=yield this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,o)}}return null})}_readDictionaryBatch(e){var n;return Z(this,void 0,void 0,function*(){const i=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(i&&(yield this._handle.seek(i.offset))){const r=yield this._reader.readMessage(Me.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),o=yield this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}})}_readFooter(){return Z(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const n=e.size-Nq,i=yield e.readInt32(n),r=yield e.readAt(n-i,i);return zk.decode(r)})}_readNextMessageAndValidate(e){return Z(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=this._footer.getRecordBatch(this._recordBatchIndex);if(n&&(yield this._handle.seek(n.offset)))return yield this._reader.readMessage(e)}return null})}},Adt=class extends e_{constructor(e,n){super(e,n)}_loadVectors(e,n,i){return new Lft(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}};function Bq(t,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:t.autoDestroy}function*a5(t){const e=ab.from(t);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function u5(t){return Nn(this,arguments,function*(){const n=yield rt(ab.from(t));try{if(!(yield rt(n.open({autoDestroy:!1}))).closed)do yield yield rt(n);while(!(yield rt(n.reset().open())).closed)}finally{yield rt(n.cancel())}})}function $dt(t){return new Z2(new Adt(t))}function Idt(t){const e=t.peek(ob+7&-8);return e&&e.byteLength>=4?Yk(e)?new Oq(new Lq(t.read())):new Z2(new e_(t)):new Z2(new e_(function*(){}()))}function Mdt(t){return Z(this,void 0,void 0,function*(){const e=yield t.peek(ob+7&-8);return e&&e.byteLength>=4?Yk(e)?new Oq(new Lq(yield t.read())):new t_(new n_(t)):new t_(new n_(function(){return Nn(this,arguments,function*(){})}()))})}function Tdt(t){return Z(this,void 0,void 0,function*(){const{size:e}=yield t.stat(),n=new J2(t,e);return e>=xdt&&Yk(yield n.readAt(0,ob+7&-8))?new Sdt(new Edt(n)):new t_(new n_(n))})}function Pq(t){const e=ab.from(t);return Hy(e)?e.then(n=>Pq(n)):e.isAsync()?e.readAll().then(n=>new e1(n)):new e1(e.readAll())}function Fdt(t="ws://localhost:3000/"){const e=[];let n=!1,i=null,r;const s={open(){n=!0,u()},close(){for(n=!1,i=null,r=null;e.length;)e.shift().reject("Socket closed")},error(c){if(i){const{reject:l}=i;i=null,u(),l(c)}else console.error("WebSocket error: ",c)},message({data:c}){if(i){const{query:l,resolve:f,reject:d}=i;if(i=null,u(),typeof c=="string"){const h=JSON.parse(c);h.error?d(h.error):f(h)}else if(l.type==="exec")f();else if(l.type==="arrow")f(Pq(c.arrayBuffer()));else throw new Error(`Unexpected socket data: ${c}`)}else console.log("WebSocket message: ",c)}};function o(){r=new WebSocket(t);for(const c in s)r.addEventListener(c,s[c])}function a(c,l,f){r==null&&o(),e.push({query:c,resolve:l,reject:f}),n&&!i&&u()}function u(){e.length&&(i=e.shift(),r.send(JSON.stringify(i.query)))}return{get connected(){return n},query(c){return new Promise((l,f)=>a(c,l,f))}}}class Sl{constructor(e,n){e&&(this.table=String(e)),n&&(this.column=n)}get columns(){return this.column?[this.column]:[]}toString(){const{table:e,column:n}=this;if(n){const i=n.startsWith("*")?n:`"${n}"`;return`${e?`${c5(e)}.`:""}${i}`}else return e?c5(e):"NULL"}}function c5(t){return t.split(".").map(n=>`"${n}"`).join(".")}function kdt(t,e){return t instanceof Sl&&t.column===e}function dn(t){return typeof t=="string"?zq(t):t}function jw(t){return typeof t=="string"?Ddt(t):t}function Ddt(t){return new Sl(t)}function zq(t,e=null){return arguments.length===1&&(e=t,t=null),new Sl(t,e)}function VS(t){switch(typeof t){case"boolean":return t?"TRUE":"FALSE";case"string":return`'${t}'`;case"number":return Number.isFinite(t)?String(t):"NULL";default:if(t==null)return"NULL";if(t instanceof Date){const e=+t;if(Number.isNaN(e))return"NULL";const n=t.getUTCFullYear(),i=t.getUTCMonth(),r=t.getUTCDate();return e===Date.UTC(n,i,r)?`MAKE_DATE(${n}, ${i+1}, ${r})`:`EPOCH_MS(${e})`}else return t instanceof RegExp?`'${t.source}'`:String(t)}}const wg=t=>typeof(t==null?void 0:t.addEventListener)=="function";function Uq(t){return t instanceof WS}class WS{constructor(e,n,i){this._expr=Array.isArray(e)?e:[e],this._deps=n||[],this.annotate(i);const r=this._expr.filter(s=>wg(s));r.length>0?(this._params=Array.from(new Set(r)),this._params.forEach(s=>{s.addEventListener("value",()=>{var o;return Cdt(this,(o=this.map)==null?void 0:o.get("value"))})})):this.addEventListener=void 0}get value(){return this}get columns(){const{_params:e,_deps:n}=this;if(e){const i=new Set(e.flatMap(r=>{var o;const s=(o=r.value)==null?void 0:o.columns;return Array.isArray(s)?s:[]}));if(i.size){const r=new Set(n);return i.forEach(s=>r.add(s)),Array.from(r)}}return n}get column(){return this._deps.length?this._deps[0]:this.columns[0]}annotate(...e){return Object.assign(this,...e)}toString(){return this._expr.map(e=>wg(e)&&!Uq(e)?VS(e.value):e).join("")}addEventListener(e,n){const i=this.map||(this.map=new Map);(i.get(e)||(i.set(e,new Set),i.get(e))).add(n)}}function Cdt(t,e){if(e!=null&&e.size)return Promise.allSettled(Array.from(e,n=>n(t)))}function jq(t,e){const n=[t[0]],i=new Set,r=e.length;for(let s=0,o=0;s<r;){const a=e[s];wg(a)?n[++o]=a:(Array.isArray(a==null?void 0:a.columns)&&a.columns.forEach(c=>i.add(c)),n[o]+=typeof a=="string"?a:VS(a));const u=t[++s];wg(n[o])?n[++o]=u:n[o]+=u}return{spans:n,cols:Array.from(i)}}function ae(t,...e){const{spans:n,cols:i}=jq(t,e);return new WS(n,i)}const xM=t=>({value:t,toString:()=>VS(t)});function GS(t){var e;t(this.op,this),(e=this.children)==null||e.forEach(n=>n.visit(t))}function qq(t,e){const n=e.filter(r=>r!=null).map(dn),i=n.map((r,s)=>s?` ${t} `:"");return n.length===1?i.push(""):n.length>1&&(i[0]="(",i.push(")")),ae(i,...n).annotate({op:t,children:n,visit:GS})}const Ndt=(...t)=>qq("AND",t.flat()),Odt=(...t)=>qq("OR",t.flat()),Rdt=t=>e=>ae`(${dn(e)} ${t})`.annotate({op:t,a:e,visit:GS}),Ldt=Rdt("IS NULL"),Bdt=t=>(e,n)=>ae`(${dn(e)} ${t} ${dn(n)})`.annotate({op:t,a:e,b:n,visit:GS}),Pdt=Bdt("=");function zdt(t,e,n,i){e=dn(e);const r=t.startsWith("NOT ")?"NOT ":"";return(n?i?ae`${r}(${n[0]} <= ${e} AND ${e} < ${n[1]})`:ae`(${e} ${t} ${n[0]} AND ${n[1]})`:ae``).annotate({op:t,visit:GS,field:e,range:n})}const i_=(t,e,n)=>zdt("BETWEEN",t,e,n);function SM(t,e){return Array.from({length:t},()=>e)}class id extends WS{constructor(e,n,i,r,s="",o="",a=""){let u;if(r&&!(s||o||a))u=r?ae`${n} OVER "${r}"`:ae`${n} OVER ()`;else{const d=s&&o?" ":"",h=(s||o)&&a?" ":"";u=ae`${n} OVER (${r?`"${r}" `:""}${s}${d}${o}${h}${a})`}i&&(u=ae`(${u})::${i}`);const{_expr:l,_deps:f}=u;super(l,f),this.window=e,this.func=n,this.type=i,this.name=r,this.group=s,this.order=o,this.frame=a}get basis(){return this.column}get label(){const{func:e}=this;return e.label??e.toString()}over(e){const{window:n,func:i,type:r,group:s,order:o,frame:a}=this;return new id(n,i,r,e,s,o,a)}partitionby(...e){const n=e.flat().filter(l=>l).map(dn),i=ae(["PARTITION BY ",SM(n.length-1,", "),""],...n),{window:r,func:s,type:o,name:a,order:u,frame:c}=this;return new id(r,s,o,a,i,u,c)}orderby(...e){const n=e.flat().filter(l=>l).map(dn),i=ae(["ORDER BY ",SM(n.length-1,", "),""],...n),{window:r,func:s,type:o,name:a,group:u,frame:c}=this;return new id(r,s,o,a,u,i,c)}rows(e){const n=l5("ROWS",e),{window:i,func:r,type:s,name:o,group:a,order:u}=this;return new id(i,r,s,o,a,u,n)}range(e){const n=l5("RANGE",e),{window:i,func:r,type:s,name:o,group:a,order:u}=this;return new id(i,r,s,o,a,u,n)}}function l5(t,e){if(wg(e)){const n=ae`${e}`;return n.toString=()=>`${t} ${f5(e.value)}`,n}return`${t} ${f5(e)}`}function f5(t){const[e,n]=t,i=e===0?"CURRENT ROW":Number.isFinite(e)?`${Math.abs(e)} PRECEDING`:"UNBOUNDED PRECEDING",r=n===0?"CURRENT ROW":Number.isFinite(n)?`${Math.abs(n)} FOLLOWING`:"UNBOUNDED FOLLOWING";return`BETWEEN ${i} AND ${r}`}class Iy extends WS{constructor(e,n,i,r,s){n=(n||[]).map(dn);const{strings:o,exprs:a}=Udt(e,n,i,r,s),{spans:u,cols:c}=jq(o,a);super(u,c),this.aggregate=e,this.args=n,this.type=i,this.isDistinct=r,this.filter=s}get basis(){return this.column}get label(){const{aggregate:e,args:n,isDistinct:i}=this,r=i?"DISTINCT"+(n.length?" ":""):"",s=n.length?`(${r}${n.map(jdt).join(", ")})`:"";return`${e.toLowerCase()}${s}`}distinct(){const{aggregate:e,args:n,type:i,filter:r}=this;return new Iy(e,n,i,!0,r)}where(e){const{aggregate:n,args:i,type:r,isDistinct:s}=this;return new Iy(n,i,r,s,e)}window(){const{aggregate:e,args:n,type:i,isDistinct:r}=this,s=new Iy(e,n,null,r);return new id(e,s,i)}partitionby(...e){return this.window().partitionby(...e)}orderby(...e){return this.window().orderby(...e)}rows(e){return this.window().rows(e)}range(e){return this.window().range(e)}}function Udt(t,e,n,i,r){const s=`)${n?`::${n}`:""}`;let o=[`${t}(${i?"DISTINCT ":""}`],a=[];return e.length?(o=o.concat([...SM(e.length-1,", "),`${s}${r?" FILTER (WHERE ":""}`,...r?[")"]:[]]),a=[...e,...r?[r]:[]]):o[0]+="*"+s,{exprs:a,strings:o}}function jdt(t){const e=VS(t);return e&&e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function gm(t,e){return(...n)=>new Iy(t,n,e)}const H$=gm("COUNT","INTEGER"),Vq=gm("AVG"),EM=gm("MAX"),AM=gm("MIN"),d5=gm("ARG_MIN"),h5=gm("ARG_MAX"),qdt=t=>ae`epoch_ms(${dn(t)})`,s0=t=>{const e=dn(t);return ae`MAKE_DATE(2012, MONTH(${e}), 1)`.annotate({label:"month"})};class Jn{static select(...e){return new Jn().select(...e)}static from(...e){return new Jn().from(...e)}static with(...e){return new Jn().with(...e)}static union(...e){return new fd("UNION",e.flat())}static unionAll(...e){return new fd("UNION ALL",e.flat())}static intersect(...e){return new fd("INTERSECT",e.flat())}static except(...e){return new fd("EXCEPT",e.flat())}static describe(e){const n=e.clone(),{clone:i,toString:r}=n;return Object.assign(n,{describe:!0,clone:()=>Jn.describe(i.call(n)),toString:()=>`DESCRIBE ${r.call(n)}`})}constructor(){this.query={with:[],select:[],from:[],where:[],groupby:[],having:[],window:[],qualify:[],orderby:[]},this.cteFor=null}clone(){const e=new Jn;return e.query={...this.query},e}with(...e){const{query:n}=this;if(e.length===0)return n.with;{const i=[],r=(s,o)=>{const a=o.clone();a.cteFor=this,i.push({as:s,query:a})};return e.flat().forEach(s=>{if(s!=null)if(s.as&&s.query)r(s.as,s.query);else for(const o in s)r(o,s[o])}),n.with=n.with.concat(i),this}}select(...e){const{query:n}=this;if(e.length===0)return n.select;{const i=[];for(const r of e.flat())if(r!=null)if(typeof r=="string")i.push({as:r,expr:dn(r)});else if(r instanceof Sl)i.push({as:r.column,expr:r});else if(Array.isArray(r))i.push({as:r[0],expr:r[1]});else for(const s in r)i.push({as:Av(s),expr:dn(r[s])});return n.select=n.select.concat(i),this}}$select(...e){return this.query.select=[],this.select(...e)}distinct(e=!0){return this.query.distinct=!!e,this}from(...e){const{query:n}=this;if(e.length===0)return n.from;{const i=[];return e.flat().forEach(r=>{if(r!=null)if(typeof r=="string")i.push({as:r,from:jw(r)});else if(r instanceof Sl)i.push({as:r.table,from:r});else if(qw(r)||Uq(r))i.push({from:r});else if(Array.isArray(r))i.push({as:Av(r[0]),from:jw(r[1])});else for(const s in r)i.push({as:Av(s),from:jw(r[s])})}),n.from=n.from.concat(i),this}}$from(...e){return this.query.from=[],this.from(...e)}sample(e,n){const{query:i}=this;if(arguments.length===0)return i.sample;{let r=e;return typeof e=="number"&&(r=e>0&&e<1?{perc:100*e,method:n}:{rows:Math.round(e),method:n}),i.sample=r,this}}where(...e){const{query:n}=this;return e.length===0?n.where:(n.where=n.where.concat(e.flat().filter(i=>i)),this)}$where(...e){return this.query.where=[],this.where(...e)}groupby(...e){const{query:n}=this;return e.length===0?n.groupby:(n.groupby=n.groupby.concat(e.flat().filter(i=>i).map(dn)),this)}$groupby(...e){return this.query.groupby=[],this.groupby(...e)}having(...e){const{query:n}=this;return e.length===0?n.having:(n.having=n.having.concat(e.flat().filter(i=>i)),this)}window(...e){const{query:n}=this;if(e.length===0)return n.window;{const i=[];return e.flat().forEach(r=>{if(r!=null)for(const s in r)i.push({as:Av(s),expr:r[s]})}),n.window=n.window.concat(i),this}}qualify(...e){const{query:n}=this;return e.length===0?n.qualify:(n.qualify=n.qualify.concat(e.flat().filter(i=>i)),this)}orderby(...e){const{query:n}=this;return e.length===0?n.orderby:(n.orderby=n.orderby.concat(e.flat().filter(i=>i).map(dn)),this)}limit(e){const{query:n}=this;return arguments.length===0?n.limit:(n.limit=Number.isFinite(e)?e:void 0,this)}offset(e){const{query:n}=this;return arguments.length===0?n.offset:(n.offset=Number.isFinite(e)?e:void 0,this)}get subqueries(){const{query:e,cteFor:n}=this,i=((n==null?void 0:n.query)||e).with,r=i==null?void 0:i.reduce((o,{as:a,query:u})=>(o[a]=u,o),{}),s=[];return e.from.forEach(({from:o})=>{if(qw(o))s.push(o);else if(r[o.table]){const a=r[o.table];s.push(a)}}),s}toString(){const{with:e,select:n,distinct:i,from:r,sample:s,where:o,groupby:a,having:u,window:c,qualify:l,orderby:f,limit:d,offset:h}=this.query,p=[];if(e.length){const m=e.map(({as:y,query:b})=>`"${y}" AS (${b})`);p.push(`WITH ${m.join(", ")}`)}const g=n.map(({as:m,expr:y})=>kdt(y,m)&&!y.table?`${y}`:`${y} AS "${m}"`);if(p.push(`SELECT${i?" DISTINCT":""} ${g.join(", ")}`),r.length){const m=r.map(({as:y,from:b})=>{const v=qw(b)?`(${b})`:`${b}`;return!y||y===b.table?v:`${v} AS "${y}"`});p.push(`FROM ${m.join(", ")}`)}if(o.length){const m=o.map(String).filter(y=>y).join(" AND ");m&&p.push(`WHERE ${m}`)}if(s){const{rows:m,perc:y,method:b,seed:v}=s,w=m?`${m} ROWS`:`${y} PERCENT`,_=b?` (${b}${v!=null?`, ${v}`:""})`:"";p.push(`USING SAMPLE ${w}${_}`)}if(a.length&&p.push(`GROUP BY ${a.join(", ")}`),u.length){const m=u.map(String).filter(y=>y).join(" AND ");m&&p.push(`HAVING ${m}`)}if(c.length){const m=c.map(({as:y,expr:b})=>`"${y}" AS (${b})`);p.push(`WINDOW ${m.join(", ")}`)}if(l.length){const m=l.map(String).filter(y=>y).join(" AND ");m&&p.push(`QUALIFY ${m}`)}return f.length&&p.push(`ORDER BY ${f.join(", ")}`),Number.isFinite(d)&&p.push(`LIMIT ${d}`),Number.isFinite(h)&&p.push(`OFFSET ${h}`),p.join(" ")}}class fd{constructor(e,n){this.op=e,this.queries=n.map(i=>i.clone()),this.query={orderby:[]},this.cteFor=null}clone(){const e=new fd(this.op,this.queries);return e.query={...this.query},e}orderby(...e){const{query:n}=this;return e.length===0?n.orderby:(n.orderby=n.orderby.concat(e.flat().filter(i=>i).map(dn)),this)}limit(e){const{query:n}=this;return arguments.length===0?n.limit:(n.limit=Number.isFinite(e)?e:void 0,this)}offset(e){const{query:n}=this;return arguments.length===0?n.offset:(n.offset=Number.isFinite(e)?e:void 0,this)}get subqueries(){const{queries:e,cteFor:n}=this;return n&&e.forEach(i=>i.cteFor=n),e}toString(){const{op:e,queries:n,query:{orderby:i,limit:r,offset:s}}=this,o=[n.join(` ${e} `)];return i.length&&o.push(`ORDER BY ${i.join(", ")}`),Number.isFinite(r)&&o.push(`LIMIT ${r}`),Number.isFinite(s)&&o.push(`OFFSET ${s}`),o.join(" ")}}function qw(t){return t instanceof Jn||t instanceof fd}function Vdt(t){return qw(t)&&t.describe}function Av(t){return Wdt(t)?t.slice(1,-1):t}function Wdt(t){return t[0]==='"'&&t[t.length-1]==='"'}const Vw=t=>t;function Gdt(){return{apply:Vw,invert:Vw,sqlApply:dn,sqlInvert:Vw}}function Ydt({base:t=null}={}){if(t==null||t===Math.E)return{apply:Math.log,invert:Math.exp,sqlApply:e=>ae`LN(${dn(e)})`,sqlInvert:e=>ae`EXP(${e})`};if(t===10)return{apply:Math.log10,invert:e=>Math.pow(10,e),sqlApply:e=>ae`LOG(${dn(e)})`,sqlInvert:e=>ae`POW(10, ${e})`};{const e=+t;return{apply:n=>Math.log(n)/Math.log(e),invert:n=>Math.pow(e,n),sqlApply:n=>ae`LN(${dn(n)}) / LN(${e})`,sqlInvert:n=>ae`POW(${e}, ${n})`}}}function Hdt({constant:t=1}={}){const e=+t;return{apply:n=>Math.sign(n)*Math.log1p(Math.abs(n)),invert:n=>Math.sign(n)*Math.exp(Math.abs(n)-e),sqlApply:n=>(n=dn(n),ae`SIGN(${n}) * LN(${e} + ABS(${n}))`),sqlInvert:n=>ae`SIGN(${n}) * (EXP(ABS(${n})) - ${e})`}}function Xdt(){return{apply:t=>Math.sign(t)*Math.sqrt(Math.abs(t)),invert:t=>Math.sign(t)*t*t,sqlApply:t=>(t=dn(t),ae`SIGN(${t}) * SQRT(ABS(${t}))`),sqlInvert:t=>ae`SIGN(${t}) * (${t}) ** 2`}}function Kdt({exponent:t=1}={}){const e=+t;return{apply:n=>Math.sign(n)*Math.pow(Math.abs(n),e),invert:n=>Math.sign(n)*Math.pow(Math.abs(n),1/e),sqlApply:n=>(n=dn(n),ae`SIGN(${n}) * POW(ABS(${n}), ${e})`),sqlInvert:n=>ae`SIGN(${n}) * POW(ABS(${n}), 1/${e})`}}function p5(){return{apply:t=>+t,invert:t=>new Date(t),sqlApply:t=>t instanceof Date?+t:qdt(dn(t)),sqlInvert:Vw}}const Jdt={linear:Gdt,log:Ydt,symlog:Hdt,sqrt:Xdt,pow:Kdt,time:p5,utc:p5};function Wq(t){const e=Jdt[t.type];return e?{...t,...e(t)}:null}function Gq(t,e,{replace:n=!1,temp:i=!0,view:r=!1}={}){return"CREATE"+(n?" OR REPLACE ":" ")+(i?"TEMP ":"")+(r?"VIEW":"TABLE")+(n?" ":" IF NOT EXISTS ")+t+" AS "+e}function Qdt(t,e,n,i={},r={}){const{select:s=["*"],where:o,view:a,temp:u,replace:c,...l}=i,f=tht({...r,...l}),d=`${t}('${n}'${f?", "+f:""})`,h=o?` WHERE ${o}`:"",p=`SELECT ${s.join(", ")} FROM ${d}${h}`;return Gq(e,p,{view:a,temp:u,replace:c})}function Zdt(t,e,n){return Qdt("read_csv",t,e,n,{auto_detect:!0,sample_size:-1})}function tht(t){return Object.entries(t).map(([e,n])=>`${e}=${$M(n)}`).join(", ")}function $M(t){switch(typeof t){case"boolean":return String(t);case"string":return`'${t}'`;case"undefined":case"object":return t==null?"NULL":Array.isArray(t)?"["+t.map(e=>$M(e)).join(", ")+"]":"{"+Object.entries(t).map(([e,n])=>`'${e}': ${$M(n)}`).join(", ")+"}";default:return t}}function eht(t){let e=2166136261;for(let n=0,i=t.length;n<i;++n){const r=t.charCodeAt(n),s=r&65280;s&&(e=g5(e^s>>8)),e=g5(e^r&255)}return nht(e)}function g5(t){return t+(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}function nht(t){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,t+=t<<5,t&4294967295}class iht{constructor(e,{selection:n,temp:i=!0}){this.mc=e,this.selection=n,this.temp=i,this.reset()}reset(){this.enabled=!1,this.clients=null,this.indices=null,this.activeView=null}clear(){this.indices&&(this.mc.cancel(Array.from(this.indices.values(),e=>e.result)),this.indices=null)}index(e,n){var c,l;if(this.clients!==e){const f=Array.from(e,y5),d=(c=f[0])==null?void 0:c.from;this.enabled=f.every(h=>h&&h.from===d),this.clients=e,this.activeView=null,this.clear()}if(!this.enabled)return!1;n=n||this.selection.active;const{source:i}=n;if(i&&i===((l=this.activeView)==null?void 0:l.source))return!0;if(this.clear(),!i)return!1;const r=this.activeView=rht(n);if(!r)return!1;this.mc.logger().warn("DATA CUBE INDEX CONSTRUCTION");const s=this.selection.remove(i),o=this.indices=new Map,{mc:a,temp:u}=this;for(const f of e){if(s.skip(f,n))continue;const d=y5(f),h=f.query(s.predicate(f)).select({...r.columns,...d.count}).groupby(Object.keys(r.columns)),[p]=h.subqueries;if(p){const w=Object.values(r.columns).map(_=>_.columns[0]);oht(p,w)}const g=h.orderby();h.query.orderby=[];const m=h.toString(),b=`cube_index_${(eht(m)>>>0).toString(16)}`,v=a.exec(Gq(b,m,{temp:u}));o.set(f,{table:b,result:v,order:g,...d})}}async update(){const{clients:e,selection:n,activeView:i}=this,r=i.predicate(n.active.predicate);return Promise.all(Array.from(e).map(s=>this.updateClient(s,r)))}async updateClient(e,n){const i=this.indices.get(e);if(!i)return;n||(n=this.activeView.predicate(this.selection.active.predicate));const{table:r,dims:s,aggr:o,order:a=[]}=i,u=Jn.select(s,o).from(r).groupby(s).where(n).orderby(a);return this.mc.updateClient(e,u)}}function rht(t){var u;const{source:e,schema:n}=t;let i=(u=t.predicate)==null?void 0:u.columns;if(!n||!i)return null;const{type:r,scales:s,pixelSize:o=1}=n;let a;if(r==="interval"&&s){const c=s.map(l=>sht(l,o));if(c.some(l=>l==null))return null;c.length===1?(a=l=>l?i_("active0",l.range.map(c[0])):[],i={active0:c[0](t.predicate.field)}):(a=l=>l?Ndt(l.children.map(({range:f},d)=>i_(`active${d}`,f.map(c[d])))):[],i=Object.fromEntries(t.predicate.children.map((l,f)=>[`active${f}`,c[f](l.field)])))}else if(r==="point")a=c=>c,i=Object.fromEntries(i.map(c=>[c.toString(),c]));else return null;return{source:e,columns:i,predicate:a}}function sht(t,e){const{apply:n,sqlApply:i}=Wq(t);if(n){const{domain:r,range:s}=t,o=n(Math.min(...r)),a=n(Math.max(...r)),u=Math.abs(s[1]-s[0])/(a-o)/e,c=e===1?"":`${e}::INTEGER * `;return l=>ae`${c}FLOOR(${u}::DOUBLE * (${i(l)} - ${o}::DOUBLE))::INTEGER`}}const m5={from:NaN};function y5(t){var a;if(!t.filterIndexable)return m5;const e=t.query(),n=IM(e);if(!n||!e.groupby)return m5;const i=new Set(e.groupby().map(u=>u.column)),r=[],s=[];let o;for(const{as:u,expr:{aggregate:c}}of e.select())switch((a=c==null?void 0:c.toUpperCase)==null?void 0:a.call(c)){case"COUNT":case"SUM":r.push({[u]:ae`SUM("${u}")::DOUBLE`});break;case"AVG":o="_count_",r.push({[u]:ae`(SUM("${u}" * ${o}) / SUM(${o}))::DOUBLE`});break;case"MAX":r.push({[u]:ae`MAX("${u}")`});break;case"MIN":r.push({[u]:ae`MIN("${u}")`});break;default:if(i.has(u))s.push(u);else return null}return{aggr:r,dims:s,count:o?{[o]:ae`COUNT(*)`}:{},from:n}}function IM(t){const e=t.subqueries;if(t.select){const i=t.from();if(!i.length)return;if(e.length===0)return i[0].from.table}const n=IM(e[0]);for(let i=1;i<e.length;++i){const r=IM(e[i]);if(r!==void 0&&r!==n)return NaN}return n}function oht(t,e){const n=new Set,i=r=>{n.has(r)||(n.add(r),r.select&&r.from().length&&r.select(e),r.subqueries.forEach(i))};i(t)}class aht{constructor(e,n,i=!0){this.mc=e,this.selection=n,this.clients=new Set,this.indexer=i?new iht(this.mc,{...i,selection:n}):null;const{value:r,activate:s}=this.handlers={value:()=>this.update(),activate:o=>{var a;return(a=this.indexer)==null?void 0:a.index(this.clients,o)}};n.addEventListener("value",r),n.addEventListener("activate",s)}finalize(){const{value:e,activate:n}=this.handlers;this.selection.removeEventListener("value",e),this.selection.removeEventListener("activate",n)}reset(){var e;(e=this.indexer)==null||e.reset()}add(e){return(this.clients=new Set(this.clients)).add(e),this}remove(e){return this.clients.has(e)&&(this.clients=new Set(this.clients)).delete(e),this}update(){const{mc:e,indexer:n,clients:i,selection:r}=this;return n!=null&&n.index(i)?n.update():uht(e,i,r)}}function uht(t,e,n){return Promise.all(Array.from(e).map(i=>{const r=n.predicate(i);if(r!=null)return t.updateClient(i,i.query(r))}))}function Yq(){let t,e;const n=new Promise((i,r)=>{t=i,e=r});return Object.assign(n,{fulfill:i=>(t(i),n),reject:i=>(e(i),n)})}function cht(t){return(typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:setTimeout)(t)}function lht(t,e,n){let i=[],r=0;function s(){const o=fht(i,e);i=[],r=0;for(const a of o)hht(a,t,n),mht(a,e)}return{add(o,a){o.request.type==="arrow"?(r=r||cht(()=>s()),i.push({entry:o,priority:a,index:i.length})):t(o,a)}}}function fht(t,e){const n=[],i=new Map;for(const r of t){const{entry:{request:s}}=r,o=dht(s.query,e);if(!i.has(o)){const a=[];n.push(a),i.set(o,a)}i.get(o).push(r)}return n}function dht(t,e){const n=`${t}`;if(t instanceof Jn&&!e.get(n)){if(t.orderby().length||t.where().length||t.qualify().length||t.having().length)return n;const i=t.clone().$select("*"),r=t.groupby();if(r.length){const s={};t.select().forEach(({as:o,expr:a})=>s[o]=a),i.$groupby(r.map(o=>o instanceof Sl&&s[o.column]||o))}return`${i}`}else return n}function hht(t,e,n){if(pht(t))e({request:{type:"arrow",cache:!1,record:!1,query:t.query=ght(t,n)},result:t.result=Yq()});else for(const{entry:i,priority:r}of t)e(i,r)}function pht(t){if(t.length>1){const e=`${t[0].entry.request.query}`;for(let n=1;n<t.length;++n)if(e!==`${t[n].entry.request.query}`)return!0}return!1}function ght(t,e){const n=t.maps=[],i=new Map;for(const o of t){const{query:a}=o.entry.request,u=[];n.push(u);for(const{as:c,expr:l}of a.select()){const f=`${l}`;i.has(f)||i.set(f,[`col${i.size}`,l]);const[d]=i.get(f);u.push([d,c])}e(`${a}`)}const r=t[0].entry.request.query.clone(),s=r.groupby();if(s.length){const o={};t.maps[0].forEach(([a,u])=>o[u]=a),r.$groupby(s.map(a=>a instanceof Sl&&o[a.column]||a))}return r.$select(Array.from(i.values()))}async function mht(t,e){const{maps:n,query:i,result:r}=t;if(!n)return;let s;try{s=await r}catch(a){for(const{entry:u}of t)u.result.reject(a);return}const o=Vdt(i);t.forEach(({entry:a},u)=>{const{request:c,result:l}=a,f=n[u],d=o&&f?bht(s,f):f?yht(s,f):s;c.cache&&e.set(String(c.query),d),l.fulfill(d)})}function yht(t,e){const n={};for(const[i,r]of e)n[r]=t.getChild(i);return new t.constructor(n)}function bht(t,e){const n=new Map(e),i=[];for(const r of t)n.has(r.column_name)&&i.push({...r,column_name:n.get(r.column_name)});return i}const vht=typeof requestIdleCallback<"u"?requestIdleCallback:setTimeout,wht=()=>({get:()=>{},set:(t,e)=>e,clear:()=>{}});function _ht({max:t=1e3,ttl:e=3*60*60*1e3}={}){let n=new Map;function i(){const r=performance.now()-e;let s=null,o=1/0;for(const[a,u]of n){const{last:c}=u;c<o&&(s=a,o=c),r>c&&n.delete(a)}s&&n.delete(s)}return{get(r){const s=n.get(r);if(s)return s.last=performance.now(),s.value},set(r,s){return n.set(r,{last:performance.now(),value:s}),n.size>t&&vht(i),s},clear(){n=new Map}}}function xht(t){const e=Array.from({length:t},()=>({head:null,tail:null}));return{isEmpty(){return e.every(n=>!n.head)},insert(n,i){const r=e[i];if(!r)throw new Error(`Invalid queue priority rank: ${i}`);const s={item:n,next:null};r.head===null?r.head=r.tail=s:r.tail=r.tail.next=s},remove(n){for(const i of e){let{head:r,tail:s}=i;for(let o=null,a=r;a;o=a,a=a.next)n(a.item)&&(a===r?r=a.next:o.next=a.next,a===s&&(s=o||r));i.head=r,i.tail=s}},next(){for(const n of e){const{head:i}=n;if(i!==null)return n.head=i.next,n.tail===i&&(n.tail=null),i.item}}}}const Vc={High:0,Normal:1,Low:2};function Sht(){const t=xht(3);let e,n,i,r=[],s=null,o;function a(){if(s||t.isEmpty())return;const{request:f,result:d}=t.next();s=l(f,d),s.finally(()=>{s=null,a()})}function u(f,d=Vc.Normal){t.insert(f,d),a()}function c(f){r.length&&f&&r.forEach(d=>d.add(f))}async function l(f,d){try{const{query:h,type:p,cache:g=!1,record:m=!0,options:y}=f,b=h?`${h}`:null;if(m&&c(b),g){const _=n.get(b);if(_){i.debug("Cache"),d.fulfill(_);return}}const v=performance.now(),w=await e.query({type:p,sql:b,...y});g&&n.set(b,w),i.debug(`Request: ${(performance.now()-v).toFixed(1)}`),d.fulfill(w)}catch(h){d.reject(h)}}return{cache(f){return f!==void 0?n=f===!0?_ht():f||wht():n},logger(f){return f?i=f:i},connector(f){return f?e=f:e},consolidate(f){f&&!o?o=lht(u,n,c):!f&&o&&(o=null)},request(f,d=Vc.Normal){const h=Yq(),p={request:f,result:h};return o?o.add(p,d):u(p,d),h},cancel(f){const d=new Set(f);t.remove(({result:h})=>d.has(h))},clear(){t.remove(({result:f})=>(f.reject("Cleared"),!0))},record(){let f=[];const d={add(h){f.push(h)},reset(){f=[]},snapshot(){return f.slice()},stop(){return r=r.filter(h=>h!==d),f}};return r.push(d),d}}}function Hq(t){switch(t){case"BIGINT":case"HUGEINT":case"INTEGER":case"SMALLINT":case"TINYINT":case"UBIGINT":case"UINTEGER":case"USMALLINT":case"UTINYINT":case"DOUBLE":case"FLOAT":case"REAL":return"number";case"DATE":case"TIMESTAMP":case"TIMESTAMPTZ":case"TIMESTAMP WITH TIME ZONE":case"TIME":case"TIMESTAMP_NS":return"date";case"BOOLEAN":return"boolean";case"VARCHAR":case"UUID":return"string";case"ARRAY":case"LIST":return"array";case"BLOB":case"STRUCT":case"MAP":case"GEOMETRY":return"object";default:if(t.startsWith("DECIMAL"))return"number";if(t.startsWith("STRUCT")||t.startsWith("MAP"))return"object";if(t.endsWith("]"))return"array";throw new Error(`Unsupported type: ${t}`)}}function Xq(t){return typeof(t==null?void 0:t.getChild)=="function"}function Eht(t){if(bt.isTimestamp(t))return e=>e==null?e:new Date(e);if(bt.isInt(t)&&t.bitWidth>=64)return e=>e==null?e:Number(e);if(bt.isDecimal(t)){const e=1/Math.pow(10,t.scale);return n=>n==null?n:Kq(n,e)}return e=>e}function Aht(t){const{type:e}=t;if(bt.isTimestamp(e)){const n=t.length,i=new Array(n);for(let r=0;r<n;++r){const s=t.get(r);i[r]=s==null?null:new Date(s)}return i}if(bt.isInt(e)&&e.bitWidth>=64){const n=t.length,i=new Float64Array(n);for(let r=0;r<n;++r){const s=t.get(r);i[r]=s==null?NaN:Number(s)}return i}if(bt.isDecimal(e)){const n=1/Math.pow(10,e.scale),i=t.length,r=new Float64Array(i);for(let s=0;s<i;++s){const o=t.get(s);r[s]=o==null?NaN:Kq(o,n)}return r}return t.toArray()}const b5=Array.from({length:8},(t,e)=>Math.pow(2,e*32));function Kq(t,e){const n=t.length;let i=0;if(t.signed&&(t[n-1]|0)<0){for(let r=0;r<n;++r)i+=~t[r]*b5[r];i=-(i+1)}else for(let r=0;r<n;++r)i+=t[r]*b5[r];return i*e}const $ht="count",Iht="nulls",Mht="max",Tht="min",Fht="distinct",kht={[$ht]:H$,[Fht]:t=>H$(t).distinct(),[Mht]:EM,[Tht]:AM,[Iht]:t=>H$().where(Ldt(t))};function Dht(t,e,n){return Jn.from(t).select(Array.from(n,i=>[i,kht[i](e)]))}async function Cht(t,e){return e.length===1&&`${e[0].column}`=="*"?Oht(t,e[0].table):(await Promise.all(e.map(n=>Nht(t,n)))).filter(n=>n)}async function Nht(t,{table:e,column:n,stats:i}){const r=Jn.from({source:e}).select({column:n}).groupby(n.aggregate?ae`ALL`:[]),[s]=Array.from(await t.query(Jn.describe(r))),o={table:e,column:`${n}`,sqlType:s.column_type,type:Hq(s.column_type),nullable:s.null==="YES"};if(!(i!=null&&i.length||i!=null&&i.size))return o;const a=await t.query(Dht(e,n,i),{persist:!0});for(let u=0;u<a.numCols;++u){const{name:c}=a.schema.fields[u],l=a.getChildAt(u),f=Eht(l.type);o[c]=f(l.get(0))}return o}async function Oht(t,e){const n=await t.query(`DESCRIBE ${jw(e)}`);return Array.from(n).map(i=>({table:e,column:i.column_name,sqlType:i.column_type,type:Hq(i.column_type),nullable:i.null==="YES"}))}function Rht(){return{debug(){},info(){},log(){},warn(){},error(){}}}let $v;function K0(t){return t?$v=t:$v==null&&($v=new Lht),$v}class Lht{constructor(e=Fdt(),n={}){const{logger:i=console,manager:r=Sht()}=n;this.manager=r,this.logger(i),this.configure(n),this.databaseConnector(e),this.clear()}logger(e){return arguments.length&&(this._logger=e||Rht(),this.manager.logger(this._logger)),this._logger}configure({cache:e=!0,consolidate:n=!0,indexes:i=!0}={}){this.manager.cache(e),this.manager.consolidate(n),this.indexes=i}clear({clients:e=!0,cache:n=!0}={}){var i,r;this.manager.clear(),e&&((i=this.clients)==null||i.forEach(s=>this.disconnect(s)),(r=this.filterGroups)==null||r.forEach(s=>s.finalize()),this.clients=new Set,this.filterGroups=new Map),n&&this.manager.cache().clear()}databaseConnector(e){return this.manager.connector(e)}cancel(e){this.manager.cancel(e)}exec(e,{priority:n=Vc.Normal}={}){return e=Array.isArray(e)?e.join(`;
`):e,this.manager.request({type:"exec",query:e},n)}query(e,{type:n="arrow",cache:i=!0,priority:r=Vc.Normal,...s}={}){return this.manager.request({type:n,query:e,cache:i,options:s},r)}prefetch(e,n={}){return this.query(e,{...n,cache:!0,priority:Vc.Low})}createBundle(e,n,i=Vc.Low){const r={name:e,queries:n};return this.manager.request({type:"create-bundle",options:r},i)}loadBundle(e,n=Vc.High){const i={name:e};return this.manager.request({type:"load-bundle",options:i},n)}updateClient(e,n,i=Vc.Normal){return e.queryPending(),this.query(n,{priority:i}).then(r=>e.queryResult(r).update(),r=>{e.queryError(r),this._logger.error(r)})}requestQuery(e,n){var i;return(i=this.filterGroups.get(e.filterBy))==null||i.reset(),n?this.updateClient(e,n):e.update()}async connect(e){const{clients:n,filterGroups:i,indexes:r}=this;if(n.has(e))throw new Error("Client already connected.");n.add(e),e.coordinator=this;const s=e.fields();s!=null&&s.length&&e.fieldInfo(await Cht(this,s));const o=e.filterBy;if(o)if(i.has(o))i.get(o).add(e);else{const a=new aht(this,o,r);i.set(o,a.add(e))}e.requestQuery()}disconnect(e){var r;const{clients:n,filterGroups:i}=this;n.has(e)&&(n.delete(e),(r=i.get(e.filterBy))==null||r.remove(e),e.coordinator=null)}}class Bht{constructor(){this._callbacks=new Map}addEventListener(e,n){this._callbacks.has(e)||this._callbacks.set(e,{callbacks:new Set,pending:null,queue:new Pht}),this._callbacks.get(e).callbacks.add(n)}removeEventListener(e,n){const i=this._callbacks.get(e);i&&i.callbacks.delete(n)}willEmit(e,n){return n}emitQueueFilter(e,n){return null}cancel(e){const n=this._callbacks.get(e);n==null||n.queue.clear()}emit(e,n){const i=this._callbacks.get(e)||{};if(i.pending)i.queue.enqueue(n,this.emitQueueFilter(e,n));else{const r=this.willEmit(e,n),{callbacks:s,queue:o}=i;if(s!=null&&s.size){const a=Promise.allSettled(Array.from(s,u=>u(r))).then(()=>{i.pending=null,o.isEmpty()||this.emit(e,o.dequeue())});i.pending=a}}}}class Pht{constructor(){this.clear()}clear(){this.next=null}isEmpty(){return!this.next}enqueue(e,n){const i={value:e};if(n&&this.next){let r=this;for(;r.next;)n(r.next.value)?r=r.next:r.next=r.next.next;r.next=i}else this.next=i}dequeue(){const{next:e}=this;return this.next=e==null?void 0:e.next,e==null?void 0:e.value}}function Jq(t,e){return t===e?!1:t instanceof Date&&e instanceof Date?+t!=+e:Array.isArray(t)&&Array.isArray(e)?zht(t,e):!0}function zht(t,e){if(t.length!==e.length)return!0;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!0;return!1}function My(t){return t instanceof Xp}class Xp extends Bht{constructor(e){super(),this._value=e}static value(e){return new Xp(e)}static array(e){if(e.some(n=>My(n))){const n=new Xp,i=()=>{n.update(e.map(r=>My(r)?r.value:r))};return i(),e.forEach(r=>My(r)?r.addEventListener("value",i):0),n}return new Xp(e)}get value(){return this._value}update(e,{force:n}={}){return Jq(this._value,e)||n?this.emit("value",e):this.cancel("value"),this}willEmit(e,n){return e==="value"&&(this._value=n),n}}function v5(t){return t instanceof Qq}let Qq=class Sp extends Xp{static intersect({cross:e=!1}={}){return new Sp(new o0({cross:e}))}static union({cross:e=!1}={}){return new Sp(new o0({cross:e,union:!0}))}static single({cross:e=!1}={}){return new Sp(new o0({cross:e,single:!0}))}static crossfilter(){return new Sp(new o0({cross:!0}))}constructor(e=new o0){super([]),this._resolved=this._value,this._resolver=e}clone(){const e=new Sp(this._resolver);return e._value=e._resolved=this._value,e}remove(e){const n=this.clone();return n._value=n._resolved=n._resolver.resolve(this._resolved,{source:e}),n._value.active={source:e},n}get active(){return this.clauses.active}get value(){var e;return(e=this.active)==null?void 0:e.value}get clauses(){return super.value}get single(){return this._resolver.single}activate(e){this.emit("activate",e)}update(e){return this._resolved=this._resolver.resolve(this._resolved,e,!0),this._resolved.active=e,super.update(this._resolved)}willEmit(e,n){return e==="value"?(this._value=n,this.value):n}emitQueueFilter(e,n){return e==="value"?this._resolver.queueFilter(n):null}skip(e,n){return this._resolver.skip(e,n)}predicate(e,n=!1){const{clauses:i}=this,r=n?null:i.active;return this._resolver.predicate(i,r,e)}};class o0{constructor({union:e,cross:n,single:i}={}){this.union=!!e,this.cross=!!n,this.single=!!i}resolve(e,n,i=!1){const{source:r,predicate:s}=n,o=e.filter(u=>r!==u.source),a=this.single?[]:o;return this.single&&i&&o.forEach(u=>{var c,l;return(l=(c=u.source)==null?void 0:c.reset)==null?void 0:l.call(c)}),s&&a.push(n),a}skip(e,n){var i;return this.cross&&((i=n==null?void 0:n.clients)==null?void 0:i.has(e))}predicate(e,n,i){const{union:r}=this;if(this.skip(i,n))return;const s=e.filter(o=>!this.skip(i,o)).map(o=>o.predicate);return r&&s.length>1?Odt(s):s}queueFilter(e){var n;if(this.cross){const i=(n=e.active)==null?void 0:n.source;return r=>{var s;return((s=r.active)==null?void 0:s.source)!==i}}return null}}const Uht=new TextDecoder("utf-8"),MM=t=>Uht.decode(t),jht=new TextEncoder,Hk=t=>jht.encode(t),qht=t=>typeof t=="number",Zq=t=>typeof t=="boolean",Rn=t=>typeof t=="function",Dr=t=>t!=null&&Object(t)===t,Bd=t=>Dr(t)&&Rn(t.then),ub=t=>Dr(t)&&Rn(t[Symbol.iterator]),mm=t=>Dr(t)&&Rn(t[Symbol.asyncIterator]),TM=t=>Dr(t)&&Dr(t.schema),tV=t=>Dr(t)&&"done"in t&&"value"in t,eV=t=>Dr(t)&&Rn(t.stat)&&qht(t.fd),nV=t=>Dr(t)&&Xk(t.body),YS=t=>"_getDOMStream"in t&&"_getNodeStream"in t,Vht=t=>Dr(t)&&Rn(t.abort)&&Rn(t.getWriter)&&!YS(t),Xk=t=>Dr(t)&&Rn(t.cancel)&&Rn(t.getReader)&&!YS(t),Wht=t=>Dr(t)&&Rn(t.end)&&Rn(t.write)&&Zq(t.writable)&&!YS(t),iV=t=>Dr(t)&&Rn(t.read)&&Rn(t.pipe)&&Zq(t.readable)&&!YS(t),Ght=t=>Dr(t)&&Rn(t.clear)&&Rn(t.bytes)&&Rn(t.position)&&Rn(t.setPosition)&&Rn(t.capacity)&&Rn(t.getBufferIdentifier)&&Rn(t.createLong),Kk=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function Yht(t){const e=t[0]?[t[0]]:[];let n,i,r,s;for(let o,a,u=0,c=0,l=t.length;++u<l;){if(o=e[c],a=t[u],!o||!a||o.buffer!==a.buffer||a.byteOffset<o.byteOffset){a&&(e[++c]=a);continue}if({byteOffset:n,byteLength:r}=o,{byteOffset:i,byteLength:s}=a,n+r<i||i+s<n){a&&(e[++c]=a);continue}e[c]=new Uint8Array(o.buffer,n,i-n+s)}return e}function w5(t,e,n=0,i=e.byteLength){const r=t.byteLength,s=new Uint8Array(t.buffer,t.byteOffset,r),o=new Uint8Array(e.buffer,e.byteOffset,Math.min(i,r));return s.set(o,n),t}function Ca(t,e){const n=Yht(t),i=n.reduce((l,f)=>l+f.byteLength,0);let r,s,o,a=0,u=-1;const c=Math.min(e||Number.POSITIVE_INFINITY,i);for(const l=n.length;++u<l;){if(r=n[u],s=r.subarray(0,Math.min(r.length,c-a)),c<=a+s.length){s.length<r.length?n[u]=r.subarray(s.length):s.length===r.length&&u++,o?w5(o,s,a):o=s;break}w5(o||(o=new Uint8Array(c)),s,a),a+=s.length}return[o||new Uint8Array(0),n.slice(u),i-(o?o.byteLength:0)]}function Re(t,e){let n=tV(e)?e.value:e;return n instanceof t?t===Uint8Array?new t(n.buffer,n.byteOffset,n.byteLength):n:n?(typeof n=="string"&&(n=Hk(n)),n instanceof ArrayBuffer?new t(n):n instanceof Kk?new t(n):Ght(n)?Re(t,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new t(0):new t(n.buffer,n.byteOffset,n.byteLength/t.BYTES_PER_ELEMENT):t.from(n)):new t(0)}const a0=t=>Re(Int32Array,t),Ee=t=>Re(Uint8Array,t),FM=t=>(t.next(),t);function*Hht(t,e){const n=function*(r){yield r},i=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Kk?n(e):ub(e)?e:n(e);return yield*FM(function*(r){let s=null;do s=r.next(yield Re(t,s));while(!s.done)}(i[Symbol.iterator]())),new t}const Xht=t=>Hht(Uint8Array,t);function rV(t,e){return Nn(this,arguments,function*(){if(Bd(e))return yield rt(yield rt(yield*hl(ns(rV(t,yield rt(e))))));const i=function(o){return Nn(this,arguments,function*(){yield yield rt(yield rt(o))})},r=function(o){return Nn(this,arguments,function*(){yield rt(yield*hl(ns(FM(function*(a){let u=null;do u=a.next(yield u==null?void 0:u.value);while(!u.done)}(o[Symbol.iterator]())))))})},s=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Kk?i(e):ub(e)?r(e):mm(e)?e:i(e);return yield rt(yield*hl(ns(FM(function(o){return Nn(this,arguments,function*(){let a=null;do a=yield rt(o.next(yield yield rt(Re(t,a))));while(!a.done)})}(s[Symbol.asyncIterator]()))))),yield rt(new t)})}const Kht=t=>rV(Uint8Array,t);function sV(t,e,n){if(t!==0){n=n.slice(0,e);for(let i=-1,r=n.length;++i<r;)n[i]+=t}return n.subarray(0,e)}function Jht(t,e){let n=0;const i=t.length;if(i!==e.length)return!1;if(i>0)do if(t[n]!==e[n])return!1;while(++n<i);return!0}const xs={fromIterable(t){return Iv(Qht(t))},fromAsyncIterable(t){return Iv(Zht(t))},fromDOMStream(t){return Iv(tpt(t))},fromNodeStream(t){return Iv(npt(t))},toDOMStream(t,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(t,e){throw new Error('"toNodeStream" not available in this environment')}},Iv=t=>(t.next(),t);function*Qht(t){let e,n=!1,i=[],r,s,o,a=0;function u(){return s==="peek"?Ca(i,o)[0]:([r,i,a]=Ca(i,o),r)}({cmd:s,size:o}=yield null);const c=Xht(t)[Symbol.iterator]();try{do if({done:e,value:r}=Number.isNaN(o-a)?c.next():c.next(o-a),!e&&r.byteLength>0&&(i.push(r),a+=r.byteLength),e||o<=a)do({cmd:s,size:o}=yield u());while(o<a);while(!e)}catch(l){(n=!0)&&typeof c.throw=="function"&&c.throw(l)}finally{n===!1&&typeof c.return=="function"&&c.return(null)}return null}function Zht(t){return Nn(this,arguments,function*(){let n,i=!1,r=[],s,o,a,u=0;function c(){return o==="peek"?Ca(r,a)[0]:([s,r,u]=Ca(r,a),s)}({cmd:o,size:a}=yield yield rt(null));const l=Kht(t)[Symbol.asyncIterator]();try{do if({done:n,value:s}=Number.isNaN(a-u)?yield rt(l.next()):yield rt(l.next(a-u)),!n&&s.byteLength>0&&(r.push(s),u+=s.byteLength),n||a<=u)do({cmd:o,size:a}=yield yield rt(c()));while(a<u);while(!n)}catch(f){(i=!0)&&typeof l.throw=="function"&&(yield rt(l.throw(f)))}finally{i===!1&&typeof l.return=="function"&&(yield rt(l.return(new Uint8Array(0))))}return yield rt(null)})}function tpt(t){return Nn(this,arguments,function*(){let n=!1,i=!1,r=[],s,o,a,u=0;function c(){return o==="peek"?Ca(r,a)[0]:([s,r,u]=Ca(r,a),s)}({cmd:o,size:a}=yield yield rt(null));const l=new ept(t);try{do if({done:n,value:s}=Number.isNaN(a-u)?yield rt(l.read()):yield rt(l.read(a-u)),!n&&s.byteLength>0&&(r.push(Ee(s)),u+=s.byteLength),n||a<=u)do({cmd:o,size:a}=yield yield rt(c()));while(a<u);while(!n)}catch(f){(i=!0)&&(yield rt(l.cancel(f)))}finally{i===!1?yield rt(l.cancel()):t.locked&&l.releaseLock()}return yield rt(null)})}class ept{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return Z(this,void 0,void 0,function*(){const{reader:n,source:i}=this;n&&(yield n.cancel(e).catch(()=>{})),i&&i.locked&&this.releaseLock()})}read(e){return Z(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const n=yield this.reader.read();return!n.done&&(n.value=Ee(n)),n})}}const X$=(t,e)=>{const n=r=>i([e,r]);let i;return[e,n,new Promise(r=>(i=r)&&t.once(e,n))]};function npt(t){return Nn(this,arguments,function*(){const n=[];let i="error",r=!1,s=null,o,a,u=0,c=[],l;function f(){return o==="peek"?Ca(c,a)[0]:([l,c,u]=Ca(c,a),l)}if({cmd:o,size:a}=yield yield rt(null),t.isTTY)return yield yield rt(new Uint8Array(0)),yield rt(null);try{n[0]=X$(t,"end"),n[1]=X$(t,"error");do{if(n[2]=X$(t,"readable"),[i,s]=yield rt(Promise.race(n.map(h=>h[2]))),i==="error")break;if((r=i==="end")||(Number.isFinite(a-u)?(l=Ee(t.read(a-u)),l.byteLength<a-u&&(l=Ee(t.read()))):l=Ee(t.read()),l.byteLength>0&&(c.push(l),u+=l.byteLength)),r||a<=u)do({cmd:o,size:a}=yield yield rt(f()));while(a<u)}while(!r)}finally{yield rt(d(n,i==="error"?s:null))}return yield rt(null);function d(h,p){return l=c=null,new Promise((g,m)=>{for(const[y,b]of h)t.off(y,b);try{const y=t.destroy;y&&y.call(t,p),p=void 0}catch(y){p=y||p}finally{p!=null?m(p):g()}})}})}var li;(function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"})(li||(li={}));var rr;(function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"})(rr||(rr={}));var Ir;(function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"})(Ir||(Ir={}));var rc;(function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"})(rc||(rc={}));var Ht;(function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"})(Ht||(Ht={}));var El;(function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(El||(El={}));var Te;(function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"})(Te||(Te={}));var C;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t[t.DurationSecond=-27]="DurationSecond",t[t.DurationMillisecond=-28]="DurationMillisecond",t[t.DurationMicrosecond=-29]="DurationMicrosecond",t[t.DurationNanosecond=-30]="DurationNanosecond"})(C||(C={}));var Tu;(function(t){t[t.OFFSET=0]="OFFSET",t[t.DATA=1]="DATA",t[t.VALIDITY=2]="VALIDITY",t[t.TYPE=3]="TYPE"})(Tu||(Tu={}));const ipt=void 0;function n1(t){if(t===null)return"null";if(t===ipt)return"undefined";switch(typeof t){case"number":return`${t}`;case"bigint":return`${t}`;case"string":return`"${t}"`}return typeof t[Symbol.toPrimitive]=="function"?t[Symbol.toPrimitive]("string"):ArrayBuffer.isView(t)?t instanceof BigInt64Array||t instanceof BigUint64Array?`[${[...t].map(e=>n1(e))}]`:`[${t}]`:ArrayBuffer.isView(t)?`[${t}]`:JSON.stringify(t,(e,n)=>typeof n=="bigint"?`${n}`:n)}const rpt=Symbol.for("isArrowBigNum");function No(t,...e){return e.length===0?Object.setPrototypeOf(Re(this.TypedArray,t),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(t,...e),this.constructor.prototype)}No.prototype[rpt]=!0;No.prototype.toJSON=function(){return`"${r1(this)}"`};No.prototype.valueOf=function(){return oV(this)};No.prototype.toString=function(){return r1(this)};No.prototype[Symbol.toPrimitive]=function(t="default"){switch(t){case"number":return oV(this);case"string":return r1(this);case"default":return spt(this)}return r1(this)};function Kp(...t){return No.apply(this,t)}function Jp(...t){return No.apply(this,t)}function i1(...t){return No.apply(this,t)}Object.setPrototypeOf(Kp.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Jp.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(i1.prototype,Object.create(Uint32Array.prototype));Object.assign(Kp.prototype,No.prototype,{constructor:Kp,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(Jp.prototype,No.prototype,{constructor:Jp,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(i1.prototype,No.prototype,{constructor:i1,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});function oV(t){const{buffer:e,byteOffset:n,length:i,signed:r}=t,s=new BigUint64Array(e,n,i),o=r&&s.at(-1)&BigInt(1)<<BigInt(63);let a=BigInt(o?1:0),u=BigInt(0);if(o){for(const c of s)a+=~c*(BigInt(1)<<BigInt(32)*u++);a*=BigInt(-1)}else for(const c of s)a+=c*(BigInt(1)<<BigInt(32)*u++);return a}const r1=t=>{if(t.byteLength===8)return`${new t.BigIntArray(t.buffer,t.byteOffset,1)[0]}`;if(!t.signed)return K$(t);let e=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return K$(t);e=e.slice();let i=1;for(let s=0;s<e.length;s++){const o=e[s],a=~o+i;e[s]=a,i&=o===0?1:0}return`-${K$(e)}`},spt=t=>t.byteLength===8?new t.BigIntArray(t.buffer,t.byteOffset,1)[0]:r1(t);function K$(t){let e="";const n=new Uint32Array(2);let i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);const r=new Uint32Array((i=new Uint16Array(i).reverse()).buffer);let s=-1;const o=i.length-1;do{for(n[0]=i[s=0];s<o;)i[s++]=n[1]=n[0]/10,n[0]=(n[0]-n[1]*10<<16)+i[s];i[s]=n[1]=n[0]/10,n[0]=n[0]-n[1]*10,e=`${n[0]}${e}`}while(r[0]||r[1]||r[2]||r[3]);return e??"0"}class Jk{static new(e,n){switch(n){case!0:return new Kp(e);case!1:return new Jp(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Kp(e)}return e.byteLength===16?new i1(e):new Jp(e)}static signed(e){return new Kp(e)}static unsigned(e){return new Jp(e)}static decimal(e){return new i1(e)}constructor(e,n){return Jk.new(e,n)}}function Io(t){if(typeof t=="bigint"&&(t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER))throw new TypeError(`${t} is not safe to convert to a number.`);return Number(t)}var aV,uV,cV,lV,fV,dV,hV,pV,gV,mV,yV,bV,vV,wV,_V,xV,SV,EV,AV,$V;class At{static isNull(e){return(e==null?void 0:e.typeId)===C.Null}static isInt(e){return(e==null?void 0:e.typeId)===C.Int}static isFloat(e){return(e==null?void 0:e.typeId)===C.Float}static isBinary(e){return(e==null?void 0:e.typeId)===C.Binary}static isUtf8(e){return(e==null?void 0:e.typeId)===C.Utf8}static isBool(e){return(e==null?void 0:e.typeId)===C.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===C.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===C.Date}static isTime(e){return(e==null?void 0:e.typeId)===C.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===C.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===C.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===C.Duration}static isList(e){return(e==null?void 0:e.typeId)===C.List}static isStruct(e){return(e==null?void 0:e.typeId)===C.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===C.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===C.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===C.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===C.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===C.Dictionary}static isDenseUnion(e){return At.isUnion(e)&&e.mode===rr.Dense}static isSparseUnion(e){return At.isUnion(e)&&e.mode===rr.Sparse}get typeId(){return C.NONE}}aV=Symbol.toStringTag;At[aV]=(t=>(t.children=null,t.ArrayType=Array,t[Symbol.toStringTag]="DataType"))(At.prototype);let Al=class extends At{toString(){return"Null"}get typeId(){return C.Null}};uV=Symbol.toStringTag;Al[uV]=(t=>t[Symbol.toStringTag]="Null")(Al.prototype);class $l extends At{constructor(e,n){super(),this.isSigned=e,this.bitWidth=n}get typeId(){return C.Int}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}cV=Symbol.toStringTag;$l[cV]=(t=>(t.isSigned=null,t.bitWidth=null,t[Symbol.toStringTag]="Int"))($l.prototype);class s1 extends $l{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(s1.prototype,"ArrayType",{value:Int32Array});class o1 extends At{constructor(e){super(),this.precision=e}get typeId(){return C.Float}get ArrayType(){switch(this.precision){case Ir.HALF:return Uint16Array;case Ir.SINGLE:return Float32Array;case Ir.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}lV=Symbol.toStringTag;o1[lV]=(t=>(t.precision=null,t[Symbol.toStringTag]="Float"))(o1.prototype);let r_=class extends At{constructor(){super()}get typeId(){return C.Binary}toString(){return"Binary"}};fV=Symbol.toStringTag;r_[fV]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Binary"))(r_.prototype);let s_=class extends At{constructor(){super()}get typeId(){return C.Utf8}toString(){return"Utf8"}};dV=Symbol.toStringTag;s_[dV]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Utf8"))(s_.prototype);let o_=class extends At{constructor(){super()}get typeId(){return C.Bool}toString(){return"Bool"}};hV=Symbol.toStringTag;o_[hV]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Bool"))(o_.prototype);let a_=class extends At{constructor(e,n,i=128){super(),this.scale=e,this.precision=n,this.bitWidth=i}get typeId(){return C.Decimal}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};pV=Symbol.toStringTag;a_[pV]=(t=>(t.scale=null,t.precision=null,t.ArrayType=Uint32Array,t[Symbol.toStringTag]="Decimal"))(a_.prototype);class u_ extends At{constructor(e){super(),this.unit=e}get typeId(){return C.Date}toString(){return`Date${(this.unit+1)*32}<${rc[this.unit]}>`}}gV=Symbol.toStringTag;u_[gV]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Date"))(u_.prototype);class a1 extends At{constructor(e,n){super(),this.unit=e,this.bitWidth=n}get typeId(){return C.Time}toString(){return`Time${this.bitWidth}<${Ht[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}mV=Symbol.toStringTag;a1[mV]=(t=>(t.unit=null,t.bitWidth=null,t[Symbol.toStringTag]="Time"))(a1.prototype);class c_ extends At{constructor(e,n){super(),this.unit=e,this.timezone=n}get typeId(){return C.Timestamp}toString(){return`Timestamp<${Ht[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}yV=Symbol.toStringTag;c_[yV]=(t=>(t.unit=null,t.timezone=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Timestamp"))(c_.prototype);class l_ extends At{constructor(e){super(),this.unit=e}get typeId(){return C.Interval}toString(){return`Interval<${El[this.unit]}>`}}bV=Symbol.toStringTag;l_[bV]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Interval"))(l_.prototype);let f_=class extends At{constructor(e){super(),this.unit=e}get typeId(){return C.Duration}toString(){return`Duration<${Ht[this.unit]}>`}};vV=Symbol.toStringTag;f_[vV]=(t=>(t.unit=null,t.ArrayType=BigInt64Array,t[Symbol.toStringTag]="Duration"))(f_.prototype);let d_=class extends At{constructor(e){super(),this.children=[e]}get typeId(){return C.List}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};wV=Symbol.toStringTag;d_[wV]=(t=>(t.children=null,t[Symbol.toStringTag]="List"))(d_.prototype);class Xi extends At{constructor(e){super(),this.children=e}get typeId(){return C.Struct}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}_V=Symbol.toStringTag;Xi[_V]=(t=>(t.children=null,t[Symbol.toStringTag]="Struct"))(Xi.prototype);class h_ extends At{constructor(e,n,i){super(),this.mode=e,this.children=i,this.typeIds=n=Int32Array.from(n),this.typeIdToChildIndex=n.reduce((r,s,o)=>(r[s]=o)&&r||r,Object.create(null))}get typeId(){return C.Union}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}xV=Symbol.toStringTag;h_[xV]=(t=>(t.mode=null,t.typeIds=null,t.children=null,t.typeIdToChildIndex=null,t.ArrayType=Int8Array,t[Symbol.toStringTag]="Union"))(h_.prototype);let p_=class extends At{constructor(e){super(),this.byteWidth=e}get typeId(){return C.FixedSizeBinary}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};SV=Symbol.toStringTag;p_[SV]=(t=>(t.byteWidth=null,t.ArrayType=Uint8Array,t[Symbol.toStringTag]="FixedSizeBinary"))(p_.prototype);let g_=class extends At{constructor(e,n){super(),this.listSize=e,this.children=[n]}get typeId(){return C.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};EV=Symbol.toStringTag;g_[EV]=(t=>(t.children=null,t.listSize=null,t[Symbol.toStringTag]="FixedSizeList"))(g_.prototype);class m_ extends At{constructor(e,n=!1){var i,r,s;if(super(),this.children=[e],this.keysSorted=n,e&&(e.name="entries",!((i=e==null?void 0:e.type)===null||i===void 0)&&i.children)){const o=(r=e==null?void 0:e.type)===null||r===void 0?void 0:r.children[0];o&&(o.name="key");const a=(s=e==null?void 0:e.type)===null||s===void 0?void 0:s.children[1];a&&(a.name="value")}}get typeId(){return C.Map}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}AV=Symbol.toStringTag;m_[AV]=(t=>(t.children=null,t.keysSorted=null,t[Symbol.toStringTag]="Map_"))(m_.prototype);const opt=(t=>()=>++t)(-1);class _g extends At{constructor(e,n,i,r){super(),this.indices=n,this.dictionary=e,this.isOrdered=r||!1,this.id=i==null?opt():Io(i)}get typeId(){return C.Dictionary}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}$V=Symbol.toStringTag;_g[$V]=(t=>(t.id=null,t.indices=null,t.isOrdered=null,t.dictionary=null,t[Symbol.toStringTag]="Dictionary"))(_g.prototype);function Fu(t){const e=t;switch(t.typeId){case C.Decimal:return t.bitWidth/32;case C.Timestamp:return 2;case C.Date:return 1+e.unit;case C.Interval:return 1+e.unit;case C.FixedSizeList:return e.listSize;case C.FixedSizeBinary:return e.byteWidth;default:return 1}}class te{visitMany(e,...n){return e.map((i,r)=>this.visit(i,...n.map(s=>s[r])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,n=!0){return apt(this,e,n)}getVisitFnByTypeId(e,n=!0){return Ep(this,e,n)}visitNull(e,...n){return null}visitBool(e,...n){return null}visitInt(e,...n){return null}visitFloat(e,...n){return null}visitUtf8(e,...n){return null}visitBinary(e,...n){return null}visitFixedSizeBinary(e,...n){return null}visitDate(e,...n){return null}visitTimestamp(e,...n){return null}visitTime(e,...n){return null}visitDecimal(e,...n){return null}visitList(e,...n){return null}visitStruct(e,...n){return null}visitUnion(e,...n){return null}visitDictionary(e,...n){return null}visitInterval(e,...n){return null}visitDuration(e,...n){return null}visitFixedSizeList(e,...n){return null}visitMap(e,...n){return null}}function apt(t,e,n=!0){return typeof e=="number"?Ep(t,e,n):typeof e=="string"&&e in C?Ep(t,C[e],n):e&&e instanceof At?Ep(t,_5(e),n):e!=null&&e.type&&e.type instanceof At?Ep(t,_5(e.type),n):Ep(t,C.NONE,n)}function Ep(t,e,n=!0){let i=null;switch(e){case C.Null:i=t.visitNull;break;case C.Bool:i=t.visitBool;break;case C.Int:i=t.visitInt;break;case C.Int8:i=t.visitInt8||t.visitInt;break;case C.Int16:i=t.visitInt16||t.visitInt;break;case C.Int32:i=t.visitInt32||t.visitInt;break;case C.Int64:i=t.visitInt64||t.visitInt;break;case C.Uint8:i=t.visitUint8||t.visitInt;break;case C.Uint16:i=t.visitUint16||t.visitInt;break;case C.Uint32:i=t.visitUint32||t.visitInt;break;case C.Uint64:i=t.visitUint64||t.visitInt;break;case C.Float:i=t.visitFloat;break;case C.Float16:i=t.visitFloat16||t.visitFloat;break;case C.Float32:i=t.visitFloat32||t.visitFloat;break;case C.Float64:i=t.visitFloat64||t.visitFloat;break;case C.Utf8:i=t.visitUtf8;break;case C.Binary:i=t.visitBinary;break;case C.FixedSizeBinary:i=t.visitFixedSizeBinary;break;case C.Date:i=t.visitDate;break;case C.DateDay:i=t.visitDateDay||t.visitDate;break;case C.DateMillisecond:i=t.visitDateMillisecond||t.visitDate;break;case C.Timestamp:i=t.visitTimestamp;break;case C.TimestampSecond:i=t.visitTimestampSecond||t.visitTimestamp;break;case C.TimestampMillisecond:i=t.visitTimestampMillisecond||t.visitTimestamp;break;case C.TimestampMicrosecond:i=t.visitTimestampMicrosecond||t.visitTimestamp;break;case C.TimestampNanosecond:i=t.visitTimestampNanosecond||t.visitTimestamp;break;case C.Time:i=t.visitTime;break;case C.TimeSecond:i=t.visitTimeSecond||t.visitTime;break;case C.TimeMillisecond:i=t.visitTimeMillisecond||t.visitTime;break;case C.TimeMicrosecond:i=t.visitTimeMicrosecond||t.visitTime;break;case C.TimeNanosecond:i=t.visitTimeNanosecond||t.visitTime;break;case C.Decimal:i=t.visitDecimal;break;case C.List:i=t.visitList;break;case C.Struct:i=t.visitStruct;break;case C.Union:i=t.visitUnion;break;case C.DenseUnion:i=t.visitDenseUnion||t.visitUnion;break;case C.SparseUnion:i=t.visitSparseUnion||t.visitUnion;break;case C.Dictionary:i=t.visitDictionary;break;case C.Interval:i=t.visitInterval;break;case C.IntervalDayTime:i=t.visitIntervalDayTime||t.visitInterval;break;case C.IntervalYearMonth:i=t.visitIntervalYearMonth||t.visitInterval;break;case C.Duration:i=t.visitDuration;break;case C.DurationSecond:i=t.visitDurationSecond||t.visitDuration;break;case C.DurationMillisecond:i=t.visitDurationMillisecond||t.visitDuration;break;case C.DurationMicrosecond:i=t.visitDurationMicrosecond||t.visitDuration;break;case C.DurationNanosecond:i=t.visitDurationNanosecond||t.visitDuration;break;case C.FixedSizeList:i=t.visitFixedSizeList;break;case C.Map:i=t.visitMap;break}if(typeof i=="function")return i;if(!n)return()=>null;throw new Error(`Unrecognized type '${C[e]}'`)}function _5(t){switch(t.typeId){case C.Null:return C.Null;case C.Int:{const{bitWidth:e,isSigned:n}=t;switch(e){case 8:return n?C.Int8:C.Uint8;case 16:return n?C.Int16:C.Uint16;case 32:return n?C.Int32:C.Uint32;case 64:return n?C.Int64:C.Uint64}return C.Int}case C.Float:switch(t.precision){case Ir.HALF:return C.Float16;case Ir.SINGLE:return C.Float32;case Ir.DOUBLE:return C.Float64}return C.Float;case C.Binary:return C.Binary;case C.Utf8:return C.Utf8;case C.Bool:return C.Bool;case C.Decimal:return C.Decimal;case C.Time:switch(t.unit){case Ht.SECOND:return C.TimeSecond;case Ht.MILLISECOND:return C.TimeMillisecond;case Ht.MICROSECOND:return C.TimeMicrosecond;case Ht.NANOSECOND:return C.TimeNanosecond}return C.Time;case C.Timestamp:switch(t.unit){case Ht.SECOND:return C.TimestampSecond;case Ht.MILLISECOND:return C.TimestampMillisecond;case Ht.MICROSECOND:return C.TimestampMicrosecond;case Ht.NANOSECOND:return C.TimestampNanosecond}return C.Timestamp;case C.Date:switch(t.unit){case rc.DAY:return C.DateDay;case rc.MILLISECOND:return C.DateMillisecond}return C.Date;case C.Interval:switch(t.unit){case El.DAY_TIME:return C.IntervalDayTime;case El.YEAR_MONTH:return C.IntervalYearMonth}return C.Interval;case C.Duration:switch(t.unit){case Ht.SECOND:return C.DurationSecond;case Ht.MILLISECOND:return C.DurationMillisecond;case Ht.MICROSECOND:return C.DurationMicrosecond;case Ht.NANOSECOND:return C.DurationNanosecond}return C.Duration;case C.Map:return C.Map;case C.List:return C.List;case C.Struct:return C.Struct;case C.Union:switch(t.mode){case rr.Dense:return C.DenseUnion;case rr.Sparse:return C.SparseUnion}return C.Union;case C.FixedSizeBinary:return C.FixedSizeBinary;case C.FixedSizeList:return C.FixedSizeList;case C.Dictionary:return C.Dictionary}throw new Error(`Unrecognized type '${C[t.typeId]}'`)}te.prototype.visitInt8=null;te.prototype.visitInt16=null;te.prototype.visitInt32=null;te.prototype.visitInt64=null;te.prototype.visitUint8=null;te.prototype.visitUint16=null;te.prototype.visitUint32=null;te.prototype.visitUint64=null;te.prototype.visitFloat16=null;te.prototype.visitFloat32=null;te.prototype.visitFloat64=null;te.prototype.visitDateDay=null;te.prototype.visitDateMillisecond=null;te.prototype.visitTimestampSecond=null;te.prototype.visitTimestampMillisecond=null;te.prototype.visitTimestampMicrosecond=null;te.prototype.visitTimestampNanosecond=null;te.prototype.visitTimeSecond=null;te.prototype.visitTimeMillisecond=null;te.prototype.visitTimeMicrosecond=null;te.prototype.visitTimeNanosecond=null;te.prototype.visitDenseUnion=null;te.prototype.visitSparseUnion=null;te.prototype.visitIntervalDayTime=null;te.prototype.visitIntervalYearMonth=null;te.prototype.visitDuration=null;te.prototype.visitDurationSecond=null;te.prototype.visitDurationMillisecond=null;te.prototype.visitDurationMicrosecond=null;te.prototype.visitDurationNanosecond=null;const IV=new Float64Array(1),jh=new Uint32Array(IV.buffer);function MV(t){const e=(t&31744)>>10,n=(t&1023)/1024,i=Math.pow(-1,(t&32768)>>15);switch(e){case 31:return i*(n?Number.NaN:1/0);case 0:return i*(n?6103515625e-14*n:0)}return i*Math.pow(2,e-15)*(1+n)}function upt(t){if(t!==t)return 32256;IV[0]=t;const e=(jh[1]&2147483648)>>16&65535;let n=jh[1]&2146435072,i=0;return n>=1089470464?jh[0]>0?n=31744:(n=(n&2080374784)>>16,i=(jh[1]&1048575)>>10):n<=1056964608?(i=1048576+(jh[1]&1048575),i=1048576+(i<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,i=(jh[1]&1048575)+512>>10),e|n|i&65535}class Ut extends te{}function Yt(t){return(e,n,i)=>{if(e.setValid(n,i!=null))return t(e,n,i)}}const cpt=(t,e,n)=>{t[e]=Math.trunc(n/864e5)},Qk=(t,e,n)=>{t[e]=Math.trunc(n%4294967296),t[e+1]=Math.trunc(n/4294967296)},lpt=(t,e,n)=>{t[e]=Math.trunc(n*1e3%4294967296),t[e+1]=Math.trunc(n*1e3/4294967296)},fpt=(t,e,n)=>{t[e]=Math.trunc(n*1e6%4294967296),t[e+1]=Math.trunc(n*1e6/4294967296)},TV=(t,e,n,i)=>{if(n+1<e.length){const{[n]:r,[n+1]:s}=e;t.set(i.subarray(0,s-r),r)}},dpt=({offset:t,values:e},n,i)=>{const r=t+n;i?e[r>>3]|=1<<r%8:e[r>>3]&=~(1<<r%8)},gc=({values:t},e,n)=>{t[e]=n},Zk=({values:t},e,n)=>{t[e]=n},FV=({values:t},e,n)=>{t[e]=upt(n)},hpt=(t,e,n)=>{switch(t.type.precision){case Ir.HALF:return FV(t,e,n);case Ir.SINGLE:case Ir.DOUBLE:return Zk(t,e,n)}},kV=({values:t},e,n)=>{cpt(t,e,n.valueOf())},DV=({values:t},e,n)=>{Qk(t,e*2,n.valueOf())},ppt=({stride:t,values:e},n,i)=>{e.set(i.subarray(0,t),t*n)},gpt=({values:t,valueOffsets:e},n,i)=>TV(t,e,n,i),mpt=({values:t,valueOffsets:e},n,i)=>{TV(t,e,n,Hk(i))},ypt=(t,e,n)=>{t.type.unit===rc.DAY?kV(t,e,n):DV(t,e,n)},CV=({values:t},e,n)=>Qk(t,e*2,n/1e3),NV=({values:t},e,n)=>Qk(t,e*2,n),OV=({values:t},e,n)=>lpt(t,e*2,n),RV=({values:t},e,n)=>fpt(t,e*2,n),bpt=(t,e,n)=>{switch(t.type.unit){case Ht.SECOND:return CV(t,e,n);case Ht.MILLISECOND:return NV(t,e,n);case Ht.MICROSECOND:return OV(t,e,n);case Ht.NANOSECOND:return RV(t,e,n)}},LV=({values:t},e,n)=>{t[e]=n},BV=({values:t},e,n)=>{t[e]=n},PV=({values:t},e,n)=>{t[e]=n},zV=({values:t},e,n)=>{t[e]=n},vpt=(t,e,n)=>{switch(t.type.unit){case Ht.SECOND:return LV(t,e,n);case Ht.MILLISECOND:return BV(t,e,n);case Ht.MICROSECOND:return PV(t,e,n);case Ht.NANOSECOND:return zV(t,e,n)}},wpt=({values:t,stride:e},n,i)=>{t.set(i.subarray(0,e),e*n)},_pt=(t,e,n)=>{const i=t.children[0],r=t.valueOffsets,s=Rs.getVisitFn(i);if(Array.isArray(n))for(let o=-1,a=r[e],u=r[e+1];a<u;)s(i,a++,n[++o]);else for(let o=-1,a=r[e],u=r[e+1];a<u;)s(i,a++,n.get(++o))},xpt=(t,e,n)=>{const i=t.children[0],{valueOffsets:r}=t,s=Rs.getVisitFn(i);let{[e]:o,[e+1]:a}=r;const u=n instanceof Map?n.entries():Object.entries(n);for(const c of u)if(s(i,o,c),++o>=a)break},Spt=(t,e)=>(n,i,r,s)=>i&&n(i,t,e[s]),Ept=(t,e)=>(n,i,r,s)=>i&&n(i,t,e.get(s)),Apt=(t,e)=>(n,i,r,s)=>i&&n(i,t,e.get(r.name)),$pt=(t,e)=>(n,i,r,s)=>i&&n(i,t,e[r.name]),Ipt=(t,e,n)=>{const i=t.type.children.map(s=>Rs.getVisitFn(s.type)),r=n instanceof Map?Apt(e,n):n instanceof hn?Ept(e,n):Array.isArray(n)?Spt(e,n):$pt(e,n);t.type.children.forEach((s,o)=>r(i[o],t.children[o],s,o))},Mpt=(t,e,n)=>{t.type.mode===rr.Dense?UV(t,e,n):jV(t,e,n)},UV=(t,e,n)=>{const i=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[i];Rs.visit(r,t.valueOffsets[e],n)},jV=(t,e,n)=>{const i=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[i];Rs.visit(r,e,n)},Tpt=(t,e,n)=>{var i;(i=t.dictionary)===null||i===void 0||i.set(t.values[e],n)},Fpt=(t,e,n)=>{t.type.unit===El.DAY_TIME?qV(t,e,n):VV(t,e,n)},qV=({values:t},e,n)=>{t.set(n.subarray(0,2),2*e)},VV=({values:t},e,n)=>{t[e]=n[0]*12+n[1]%12},WV=({values:t},e,n)=>{t[e]=n},GV=({values:t},e,n)=>{t[e]=n},YV=({values:t},e,n)=>{t[e]=n},HV=({values:t},e,n)=>{t[e]=n},kpt=(t,e,n)=>{switch(t.type.unit){case Ht.SECOND:return WV(t,e,n);case Ht.MILLISECOND:return GV(t,e,n);case Ht.MICROSECOND:return YV(t,e,n);case Ht.NANOSECOND:return HV(t,e,n)}},Dpt=(t,e,n)=>{const{stride:i}=t,r=t.children[0],s=Rs.getVisitFn(r);if(Array.isArray(n))for(let o=-1,a=e*i;++o<i;)s(r,a+o,n[o]);else for(let o=-1,a=e*i;++o<i;)s(r,a+o,n.get(o))};Ut.prototype.visitBool=Yt(dpt);Ut.prototype.visitInt=Yt(gc);Ut.prototype.visitInt8=Yt(gc);Ut.prototype.visitInt16=Yt(gc);Ut.prototype.visitInt32=Yt(gc);Ut.prototype.visitInt64=Yt(gc);Ut.prototype.visitUint8=Yt(gc);Ut.prototype.visitUint16=Yt(gc);Ut.prototype.visitUint32=Yt(gc);Ut.prototype.visitUint64=Yt(gc);Ut.prototype.visitFloat=Yt(hpt);Ut.prototype.visitFloat16=Yt(FV);Ut.prototype.visitFloat32=Yt(Zk);Ut.prototype.visitFloat64=Yt(Zk);Ut.prototype.visitUtf8=Yt(mpt);Ut.prototype.visitBinary=Yt(gpt);Ut.prototype.visitFixedSizeBinary=Yt(ppt);Ut.prototype.visitDate=Yt(ypt);Ut.prototype.visitDateDay=Yt(kV);Ut.prototype.visitDateMillisecond=Yt(DV);Ut.prototype.visitTimestamp=Yt(bpt);Ut.prototype.visitTimestampSecond=Yt(CV);Ut.prototype.visitTimestampMillisecond=Yt(NV);Ut.prototype.visitTimestampMicrosecond=Yt(OV);Ut.prototype.visitTimestampNanosecond=Yt(RV);Ut.prototype.visitTime=Yt(vpt);Ut.prototype.visitTimeSecond=Yt(LV);Ut.prototype.visitTimeMillisecond=Yt(BV);Ut.prototype.visitTimeMicrosecond=Yt(PV);Ut.prototype.visitTimeNanosecond=Yt(zV);Ut.prototype.visitDecimal=Yt(wpt);Ut.prototype.visitList=Yt(_pt);Ut.prototype.visitStruct=Yt(Ipt);Ut.prototype.visitUnion=Yt(Mpt);Ut.prototype.visitDenseUnion=Yt(UV);Ut.prototype.visitSparseUnion=Yt(jV);Ut.prototype.visitDictionary=Yt(Tpt);Ut.prototype.visitInterval=Yt(Fpt);Ut.prototype.visitIntervalDayTime=Yt(qV);Ut.prototype.visitIntervalYearMonth=Yt(VV);Ut.prototype.visitDuration=Yt(kpt);Ut.prototype.visitDurationSecond=Yt(WV);Ut.prototype.visitDurationMillisecond=Yt(GV);Ut.prototype.visitDurationMicrosecond=Yt(YV);Ut.prototype.visitDurationNanosecond=Yt(HV);Ut.prototype.visitFixedSizeList=Yt(Dpt);Ut.prototype.visitMap=Yt(xpt);const Rs=new Ut,oo=Symbol.for("parent"),Qp=Symbol.for("rowIndex");class tD{constructor(e,n){return this[oo]=e,this[Qp]=n,new Proxy(this,new Npt)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[Qp],n=this[oo],i=n.type.children,r={};for(let s=-1,o=i.length;++s<o;)r[i[s].name]=Cr.visit(n.children[s],e);return r}toString(){return`{${[...this].map(([e,n])=>`${n1(e)}: ${n1(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Cpt(this[oo],this[Qp])}}class Cpt{constructor(e,n){this.childIndex=0,this.children=e.children,this.rowIndex=n,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,Cr.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(tD.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[oo]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Qp]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class Npt{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[oo].type.children.map(n=>n.name)}has(e,n){return e[oo].type.children.findIndex(i=>i.name===n)!==-1}getOwnPropertyDescriptor(e,n){if(e[oo].type.children.findIndex(i=>i.name===n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const i=e[oo].type.children.findIndex(r=>r.name===n);if(i!==-1){const r=Cr.visit(e[oo].children[i],e[Qp]);return Reflect.set(e,n,r),r}}set(e,n,i){const r=e[oo].type.children.findIndex(s=>s.name===n);return r!==-1?(Rs.visit(e[oo].children[r],e[Qp],i),Reflect.set(e,n,i)):Reflect.has(e,n)||typeof n=="symbol"?Reflect.set(e,n,i):!1}}class Lt extends te{}function jt(t){return(e,n)=>e.getValid(n)?t(e,n):null}const Opt=(t,e)=>864e5*t[e],eD=(t,e)=>4294967296*t[e+1]+(t[e]>>>0),Rpt=(t,e)=>4294967296*(t[e+1]/1e3)+(t[e]>>>0)/1e3,Lpt=(t,e)=>4294967296*(t[e+1]/1e6)+(t[e]>>>0)/1e6,XV=t=>new Date(t),Bpt=(t,e)=>XV(Opt(t,e)),Ppt=(t,e)=>XV(eD(t,e)),zpt=(t,e)=>null,KV=(t,e,n)=>{if(n+1>=e.length)return null;const i=e[n],r=e[n+1];return t.subarray(i,r)},Upt=({offset:t,values:e},n)=>{const i=t+n;return(e[i>>3]&1<<i%8)!==0},JV=({values:t},e)=>Bpt(t,e),QV=({values:t},e)=>Ppt(t,e*2),of=({stride:t,values:e},n)=>e[t*n],jpt=({stride:t,values:e},n)=>MV(e[t*n]),ZV=({values:t},e)=>t[e],qpt=({stride:t,values:e},n)=>e.subarray(t*n,t*(n+1)),Vpt=({values:t,valueOffsets:e},n)=>KV(t,e,n),Wpt=({values:t,valueOffsets:e},n)=>{const i=KV(t,e,n);return i!==null?MM(i):null},Gpt=({values:t},e)=>t[e],Ypt=({type:t,values:e},n)=>t.precision!==Ir.HALF?e[n]:MV(e[n]),Hpt=(t,e)=>t.type.unit===rc.DAY?JV(t,e):QV(t,e),tW=({values:t},e)=>1e3*eD(t,e*2),eW=({values:t},e)=>eD(t,e*2),nW=({values:t},e)=>Rpt(t,e*2),iW=({values:t},e)=>Lpt(t,e*2),Xpt=(t,e)=>{switch(t.type.unit){case Ht.SECOND:return tW(t,e);case Ht.MILLISECOND:return eW(t,e);case Ht.MICROSECOND:return nW(t,e);case Ht.NANOSECOND:return iW(t,e)}},rW=({values:t},e)=>t[e],sW=({values:t},e)=>t[e],oW=({values:t},e)=>t[e],aW=({values:t},e)=>t[e],Kpt=(t,e)=>{switch(t.type.unit){case Ht.SECOND:return rW(t,e);case Ht.MILLISECOND:return sW(t,e);case Ht.MICROSECOND:return oW(t,e);case Ht.NANOSECOND:return aW(t,e)}},Jpt=({values:t,stride:e},n)=>Jk.decimal(t.subarray(e*n,e*(n+1))),Qpt=(t,e)=>{const{valueOffsets:n,stride:i,children:r}=t,{[e*i]:s,[e*i+1]:o}=n,u=r[0].slice(s,o-s);return new hn([u])},Zpt=(t,e)=>{const{valueOffsets:n,children:i}=t,{[e]:r,[e+1]:s}=n,o=i[0];return new nD(o.slice(r,s-r))},tgt=(t,e)=>new tD(t,e),egt=(t,e)=>t.type.mode===rr.Dense?uW(t,e):cW(t,e),uW=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[n];return Cr.visit(i,t.valueOffsets[e])},cW=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[n];return Cr.visit(i,e)},ngt=(t,e)=>{var n;return(n=t.dictionary)===null||n===void 0?void 0:n.get(t.values[e])},igt=(t,e)=>t.type.unit===El.DAY_TIME?lW(t,e):fW(t,e),lW=({values:t},e)=>t.subarray(2*e,2*(e+1)),fW=({values:t},e)=>{const n=t[e],i=new Int32Array(2);return i[0]=Math.trunc(n/12),i[1]=Math.trunc(n%12),i},dW=({values:t},e)=>t[e],hW=({values:t},e)=>t[e],pW=({values:t},e)=>t[e],gW=({values:t},e)=>t[e],rgt=(t,e)=>{switch(t.type.unit){case Ht.SECOND:return dW(t,e);case Ht.MILLISECOND:return hW(t,e);case Ht.MICROSECOND:return pW(t,e);case Ht.NANOSECOND:return gW(t,e)}},sgt=(t,e)=>{const{stride:n,children:i}=t,s=i[0].slice(e*n,n);return new hn([s])};Lt.prototype.visitNull=jt(zpt);Lt.prototype.visitBool=jt(Upt);Lt.prototype.visitInt=jt(Gpt);Lt.prototype.visitInt8=jt(of);Lt.prototype.visitInt16=jt(of);Lt.prototype.visitInt32=jt(of);Lt.prototype.visitInt64=jt(ZV);Lt.prototype.visitUint8=jt(of);Lt.prototype.visitUint16=jt(of);Lt.prototype.visitUint32=jt(of);Lt.prototype.visitUint64=jt(ZV);Lt.prototype.visitFloat=jt(Ypt);Lt.prototype.visitFloat16=jt(jpt);Lt.prototype.visitFloat32=jt(of);Lt.prototype.visitFloat64=jt(of);Lt.prototype.visitUtf8=jt(Wpt);Lt.prototype.visitBinary=jt(Vpt);Lt.prototype.visitFixedSizeBinary=jt(qpt);Lt.prototype.visitDate=jt(Hpt);Lt.prototype.visitDateDay=jt(JV);Lt.prototype.visitDateMillisecond=jt(QV);Lt.prototype.visitTimestamp=jt(Xpt);Lt.prototype.visitTimestampSecond=jt(tW);Lt.prototype.visitTimestampMillisecond=jt(eW);Lt.prototype.visitTimestampMicrosecond=jt(nW);Lt.prototype.visitTimestampNanosecond=jt(iW);Lt.prototype.visitTime=jt(Kpt);Lt.prototype.visitTimeSecond=jt(rW);Lt.prototype.visitTimeMillisecond=jt(sW);Lt.prototype.visitTimeMicrosecond=jt(oW);Lt.prototype.visitTimeNanosecond=jt(aW);Lt.prototype.visitDecimal=jt(Jpt);Lt.prototype.visitList=jt(Qpt);Lt.prototype.visitStruct=jt(tgt);Lt.prototype.visitUnion=jt(egt);Lt.prototype.visitDenseUnion=jt(uW);Lt.prototype.visitSparseUnion=jt(cW);Lt.prototype.visitDictionary=jt(ngt);Lt.prototype.visitInterval=jt(igt);Lt.prototype.visitIntervalDayTime=jt(lW);Lt.prototype.visitIntervalYearMonth=jt(fW);Lt.prototype.visitDuration=jt(rgt);Lt.prototype.visitDurationSecond=jt(dW);Lt.prototype.visitDurationMillisecond=jt(hW);Lt.prototype.visitDurationMicrosecond=jt(pW);Lt.prototype.visitDurationNanosecond=jt(gW);Lt.prototype.visitFixedSizeList=jt(sgt);Lt.prototype.visitMap=jt(Zpt);const Cr=new Lt,fa=Symbol.for("keys"),Zp=Symbol.for("vals");class nD{constructor(e){return this[fa]=new hn([e.children[0]]).memoize(),this[Zp]=e.children[1],new Proxy(this,new agt)}[Symbol.iterator](){return new ogt(this[fa],this[Zp])}get size(){return this[fa].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[fa],n=this[Zp],i={};for(let r=-1,s=e.length;++r<s;)i[e.get(r)]=Cr.visit(n,r);return i}toString(){return`{${[...this].map(([e,n])=>`${n1(e)}: ${n1(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class ogt{constructor(e,n){this.keys=e,this.vals=n,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),Cr.visit(this.vals,e)]})}}class agt{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[fa].toArray().map(String)}has(e,n){return e[fa].includes(n)}getOwnPropertyDescriptor(e,n){if(e[fa].indexOf(n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const i=e[fa].indexOf(n);if(i!==-1){const r=Cr.visit(Reflect.get(e,Zp),i);return Reflect.set(e,n,r),r}}set(e,n,i){const r=e[fa].indexOf(n);return r!==-1?(Rs.visit(Reflect.get(e,Zp),r,i),Reflect.set(e,n,i)):Reflect.has(e,n)?Reflect.set(e,n,i):!1}}Object.defineProperties(nD.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[fa]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Zp]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let x5;function mW(t,e,n,i){const{length:r=0}=t;let s=typeof e!="number"?0:e,o=typeof n!="number"?r:n;return s<0&&(s=(s%r+r)%r),o<0&&(o=(o%r+r)%r),o<s&&(x5=s,s=o,o=x5),o>r&&(o=r),i?i(t,s,o):[s,o]}const S5=t=>t!==t;function ym(t){if(typeof t!=="object"||t===null)return S5(t)?S5:n=>n===t;if(t instanceof Date){const n=t.valueOf();return i=>i instanceof Date?i.valueOf()===n:!1}return ArrayBuffer.isView(t)?n=>n?Jht(t,n):!1:t instanceof Map?cgt(t):Array.isArray(t)?ugt(t):t instanceof hn?lgt(t):fgt(t,!0)}function ugt(t){const e=[];for(let n=-1,i=t.length;++n<i;)e[n]=ym(t[n]);return HS(e)}function cgt(t){let e=-1;const n=[];for(const i of t.values())n[++e]=ym(i);return HS(n)}function lgt(t){const e=[];for(let n=-1,i=t.length;++n<i;)e[n]=ym(t.get(n));return HS(e)}function fgt(t,e=!1){const n=Object.keys(t);if(!e&&n.length===0)return()=>!1;const i=[];for(let r=-1,s=n.length;++r<s;)i[r]=ym(t[n[r]]);return HS(i,n)}function HS(t,e){return n=>{if(!n||typeof n!="object")return!1;switch(n.constructor){case Array:return dgt(t,n);case Map:return E5(t,n,n.keys());case nD:case tD:case Object:case void 0:return E5(t,n,e||Object.keys(n))}return n instanceof hn?hgt(t,n):!1}}function dgt(t,e){const n=t.length;if(e.length!==n)return!1;for(let i=-1;++i<n;)if(!t[i](e[i]))return!1;return!0}function hgt(t,e){const n=t.length;if(e.length!==n)return!1;for(let i=-1;++i<n;)if(!t[i](e.get(i)))return!1;return!0}function E5(t,e,n){const i=n[Symbol.iterator](),r=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),s=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let o=0;const a=t.length;let u=s.next(),c=i.next(),l=r.next();for(;o<a&&!c.done&&!l.done&&!u.done&&!(c.value!==l.value||!t[o](u.value));++o,c=i.next(),l=r.next(),u=s.next());return o===a&&c.done&&l.done&&u.done?!0:(i.return&&i.return(),r.return&&r.return(),s.return&&s.return(),!1)}function yW(t,e,n,i){return(n&1<<i)!==0}function pgt(t,e,n,i){return(n&1<<i)>>i}function y_(t,e,n){const i=n.byteLength+7&-8;if(t>0||n.byteLength<i){const r=new Uint8Array(i);return r.set(t%8===0?n.subarray(t>>3):b_(new iD(n,t,e,null,yW)).subarray(0,i)),r}return n}function b_(t){const e=[];let n=0,i=0,r=0;for(const o of t)o&&(r|=1<<i),++i===8&&(e[n++]=r,r=i=0);(n===0||i>0)&&(e[n++]=r);const s=new Uint8Array(e.length+7&-8);return s.set(e),s}class iD{constructor(e,n,i,r,s){this.bytes=e,this.length=i,this.context=r,this.get=s,this.bit=n%8,this.byteIndex=n>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function kM(t,e,n){if(n-e<=0)return 0;if(n-e<8){let s=0;for(const o of new iD(t,e,n-e,t,pgt))s+=o;return s}const i=n>>3<<3,r=e+(e%8===0?0:8-e%8);return kM(t,e,r)+kM(t,i,n)+ggt(t,r>>3,i-r>>3)}function ggt(t,e,n){let i=0,r=Math.trunc(e);const s=new DataView(t.buffer,t.byteOffset,t.byteLength),o=n===void 0?t.byteLength:r+n;for(;o-r>=4;)i+=J$(s.getUint32(r)),r+=4;for(;o-r>=2;)i+=J$(s.getUint16(r)),r+=2;for(;o-r>=1;)i+=J$(s.getUint8(r)),r+=1;return i}function J$(t){let e=Math.trunc(t);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const mgt=-1;class ze{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return At.isSparseUnion(e)?this.children.some(n=>n.nullable):At.isDenseUnion(e)?this.children.some(n=>n.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:n,values:i,nullBitmap:r,typeIds:s}=this;return n&&(e+=n.byteLength),i&&(e+=i.byteLength),r&&(e+=r.byteLength),s&&(e+=s.byteLength),this.children.reduce((o,a)=>o+a.byteLength,e)}get nullCount(){if(At.isUnion(this.type))return this.children.reduce((i,r)=>i+r.nullCount,0);let e=this._nullCount,n;return e<=mgt&&(n=this.nullBitmap)&&(this._nullCount=e=this.length-kM(n,this.offset,this.offset+this.length)),e}constructor(e,n,i,r,s,o=[],a){this.type=e,this.children=o,this.dictionary=a,this.offset=Math.floor(Math.max(n||0,0)),this.length=Math.floor(Math.max(i||0,0)),this._nullCount=Math.floor(Math.max(r||0,-1));let u;s instanceof ze?(this.stride=s.stride,this.values=s.values,this.typeIds=s.typeIds,this.nullBitmap=s.nullBitmap,this.valueOffsets=s.valueOffsets):(this.stride=Fu(e),s&&((u=s[0])&&(this.valueOffsets=u),(u=s[1])&&(this.values=u),(u=s[2])&&(this.nullBitmap=u),(u=s[3])&&(this.typeIds=u)))}getValid(e){const{type:n}=this;if(At.isUnion(n)){const i=n,r=this.children[i.typeIdToChildIndex[this.typeIds[e]]],s=i.mode===rr.Dense?this.valueOffsets[e]:e;return r.getValid(s)}if(this.nullable&&this.nullCount>0){const i=this.offset+e;return(this.nullBitmap[i>>3]&1<<i%8)!==0}return!0}setValid(e,n){let i;const{type:r}=this;if(At.isUnion(r)){const s=r,o=this.children[s.typeIdToChildIndex[this.typeIds[e]]],a=s.mode===rr.Dense?this.valueOffsets[e]:e;i=o.getValid(a),o.setValid(a,n)}else{let{nullBitmap:s}=this;const{offset:o,length:a}=this,u=o+e,c=1<<u%8,l=u>>3;(!s||s.byteLength<=l)&&(s=new Uint8Array((o+a+63&-64)>>3).fill(255),this.nullCount>0&&s.set(y_(o,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:s,_nullCount:-1}));const f=s[l];i=(f&c)!==0,n?s[l]=f|c:s[l]=f&~c}return i!==!!n&&(this._nullCount=this.nullCount+(n?-1:1)),n}clone(e=this.type,n=this.offset,i=this.length,r=this._nullCount,s=this,o=this.children){return new ze(e,n,i,r,s,o,this.dictionary)}slice(e,n){const{stride:i,typeId:r,children:s}=this,o=+(this._nullCount===0)-1,a=r===16?i:1,u=this._sliceBuffers(e,n,i,r);return this.clone(this.type,this.offset+e,n,o,u,s.length===0||this.valueOffsets?s:this._sliceChildren(s,a*e,a*n))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===C.Null)return this.clone(this.type,0,e,0);const{length:n,nullCount:i}=this,r=new Uint8Array((e+63&-64)>>3).fill(255,0,n>>3);r[n>>3]=(1<<n-(n&-8))-1,i>0&&r.set(y_(this.offset,n,this.nullBitmap),0);const s=this.buffers;return s[Tu.VALIDITY]=r,this.clone(this.type,0,e,i+(e-n),s)}_sliceBuffers(e,n,i,r){let s;const{buffers:o}=this;return(s=o[Tu.TYPE])&&(o[Tu.TYPE]=s.subarray(e,e+n)),(s=o[Tu.OFFSET])&&(o[Tu.OFFSET]=s.subarray(e,e+n+1))||(s=o[Tu.DATA])&&(o[Tu.DATA]=r===6?s:s.subarray(i*e,i*(e+n))),o}_sliceChildren(e,n,i){return e.map(r=>r.slice(n,i))}}ze.prototype.children=Object.freeze([]);class Ty extends te{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:n,["offset"]:i=0,["length"]:r=0}=e;return new ze(n,i,r,r)}visitBool(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length>>3,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitInt(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitFloat(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitUtf8(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.data),s=Ee(e.nullBitmap),o=a0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new ze(n,i,a,u,[o,r,s])}visitBinary(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.data),s=Ee(e.nullBitmap),o=a0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new ze(n,i,a,u,[o,r,s])}visitFixedSizeBinary(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length/Fu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitDate(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length/Fu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitTimestamp(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length/Fu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitTime(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length/Fu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitDecimal(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length/Fu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitList(e){const{["type"]:n,["offset"]:i=0,["child"]:r}=e,s=Ee(e.nullBitmap),o=a0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new ze(n,i,a,u,[o,void 0,s],[r])}visitStruct(e){const{["type"]:n,["offset"]:i=0,["children"]:r=[]}=e,s=Ee(e.nullBitmap),{length:o=r.reduce((u,{length:c})=>Math.max(u,c),0),nullCount:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,void 0,s],r)}visitUnion(e){const{["type"]:n,["offset"]:i=0,["children"]:r=[]}=e,s=Re(n.ArrayType,e.typeIds),{["length"]:o=s.length,["nullCount"]:a=-1}=e;if(At.isSparseUnion(n))return new ze(n,i,o,a,[void 0,void 0,void 0,s],r);const u=a0(e.valueOffsets);return new ze(n,i,o,a,[u,void 0,void 0,s],r)}visitDictionary(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.indices.ArrayType,e.data),{["dictionary"]:o=new hn([new Ty().visit({type:n.dictionary})])}=e,{["length"]:a=s.length,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new ze(n,i,a,u,[void 0,s,r],[],o)}visitInterval(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length/Fu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitDuration(e){const{["type"]:n,["offset"]:i=0}=e,r=Ee(e.nullBitmap),s=Re(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,s,r])}visitFixedSizeList(e){const{["type"]:n,["offset"]:i=0,["child"]:r=new Ty().visit({type:n.valueType})}=e,s=Ee(e.nullBitmap),{["length"]:o=r.length/Fu(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new ze(n,i,o,a,[void 0,void 0,s],[r])}visitMap(e){const{["type"]:n,["offset"]:i=0,["child"]:r=new Ty().visit({type:n.childType})}=e,s=Ee(e.nullBitmap),o=a0(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new ze(n,i,a,u,[o,void 0,s],[r])}}const ygt=new Ty;function ce(t){return ygt.visit(t)}class A5{constructor(e=0,n){this.numChunks=e,this.getChunkIterator=n,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function bW(t){return t.reduce((e,n)=>e+n.nullCount,0)}function vW(t){return t.reduce((e,n,i)=>(e[i+1]=e[i]+n.length,e),new Uint32Array(t.length+1))}function wW(t,e,n,i){const r=[];for(let s=-1,o=t.length;++s<o;){const a=t[s],u=e[s],{length:c}=a;if(u>=i)break;if(n>=u+c)continue;if(u>=n&&u+c<=i){r.push(a);continue}const l=Math.max(0,n-u),f=Math.min(i-u,c);r.push(a.slice(l,f-l))}return r.length===0&&r.push(t[0].slice(0,0)),r}function rD(t,e,n,i){let r=0,s=0,o=e.length-1;do{if(r>=o-1)return n<e[o]?i(t,r,n-e[r]):null;s=r+Math.trunc((o-r)*.5),n<e[s]?o=s:r=s}while(r<o)}function sD(t,e){return t.getValid(e)}function tg(t){function e(n,i,r){return t(n[i],r)}return function(n){const i=this.data;return rD(i,this._offsets,n,e)}}function _W(t){let e;function n(i,r,s){return t(i[r],s,e)}return function(i,r){const s=this.data;e=r;const o=rD(s,this._offsets,i,n);return e=void 0,o}}function xW(t){let e;function n(i,r,s){let o=s,a=0,u=0;for(let c=r-1,l=i.length;++c<l;){const f=i[c];if(~(a=t(f,e,o)))return u+a;o=0,u+=f.length}return-1}return function(i,r){e=i;const s=this.data,o=typeof r!="number"?n(s,0,0):rD(s,this._offsets,r,n);return e=void 0,o}}class Bt extends te{}function bgt(t,e){return e===null&&t.length>0?0:-1}function vgt(t,e){const{nullBitmap:n}=t;if(!n||t.nullCount<=0)return-1;let i=0;for(const r of new iD(n,t.offset+(e||0),t.length,n,yW)){if(!r)return i;++i}return-1}function Kt(t,e,n){if(e===void 0)return-1;if(e===null)switch(t.typeId){case C.Union:break;case C.Dictionary:break;default:return vgt(t,n)}const i=Cr.getVisitFn(t),r=ym(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(r(i(t,s)))return s;return-1}function SW(t,e,n){const i=Cr.getVisitFn(t),r=ym(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(r(i(t,s)))return s;return-1}Bt.prototype.visitNull=bgt;Bt.prototype.visitBool=Kt;Bt.prototype.visitInt=Kt;Bt.prototype.visitInt8=Kt;Bt.prototype.visitInt16=Kt;Bt.prototype.visitInt32=Kt;Bt.prototype.visitInt64=Kt;Bt.prototype.visitUint8=Kt;Bt.prototype.visitUint16=Kt;Bt.prototype.visitUint32=Kt;Bt.prototype.visitUint64=Kt;Bt.prototype.visitFloat=Kt;Bt.prototype.visitFloat16=Kt;Bt.prototype.visitFloat32=Kt;Bt.prototype.visitFloat64=Kt;Bt.prototype.visitUtf8=Kt;Bt.prototype.visitBinary=Kt;Bt.prototype.visitFixedSizeBinary=Kt;Bt.prototype.visitDate=Kt;Bt.prototype.visitDateDay=Kt;Bt.prototype.visitDateMillisecond=Kt;Bt.prototype.visitTimestamp=Kt;Bt.prototype.visitTimestampSecond=Kt;Bt.prototype.visitTimestampMillisecond=Kt;Bt.prototype.visitTimestampMicrosecond=Kt;Bt.prototype.visitTimestampNanosecond=Kt;Bt.prototype.visitTime=Kt;Bt.prototype.visitTimeSecond=Kt;Bt.prototype.visitTimeMillisecond=Kt;Bt.prototype.visitTimeMicrosecond=Kt;Bt.prototype.visitTimeNanosecond=Kt;Bt.prototype.visitDecimal=Kt;Bt.prototype.visitList=Kt;Bt.prototype.visitStruct=Kt;Bt.prototype.visitUnion=Kt;Bt.prototype.visitDenseUnion=SW;Bt.prototype.visitSparseUnion=SW;Bt.prototype.visitDictionary=Kt;Bt.prototype.visitInterval=Kt;Bt.prototype.visitIntervalDayTime=Kt;Bt.prototype.visitIntervalYearMonth=Kt;Bt.prototype.visitDuration=Kt;Bt.prototype.visitDurationSecond=Kt;Bt.prototype.visitDurationMillisecond=Kt;Bt.prototype.visitDurationMicrosecond=Kt;Bt.prototype.visitDurationNanosecond=Kt;Bt.prototype.visitFixedSizeList=Kt;Bt.prototype.visitMap=Kt;const v_=new Bt;class Pt extends te{}function qt(t){const{type:e}=t;if(t.nullCount===0&&t.stride===1&&(e.typeId===C.Timestamp||e instanceof $l&&e.bitWidth!==64||e instanceof a1&&e.bitWidth!==64||e instanceof o1&&e.precision!==Ir.HALF))return new A5(t.data.length,i=>{const r=t.data[i];return r.values.subarray(0,r.length)[Symbol.iterator]()});let n=0;return new A5(t.data.length,i=>{const s=t.data[i].length,o=t.slice(n,n+s);return n+=s,new wgt(o)})}class wgt{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}Pt.prototype.visitNull=qt;Pt.prototype.visitBool=qt;Pt.prototype.visitInt=qt;Pt.prototype.visitInt8=qt;Pt.prototype.visitInt16=qt;Pt.prototype.visitInt32=qt;Pt.prototype.visitInt64=qt;Pt.prototype.visitUint8=qt;Pt.prototype.visitUint16=qt;Pt.prototype.visitUint32=qt;Pt.prototype.visitUint64=qt;Pt.prototype.visitFloat=qt;Pt.prototype.visitFloat16=qt;Pt.prototype.visitFloat32=qt;Pt.prototype.visitFloat64=qt;Pt.prototype.visitUtf8=qt;Pt.prototype.visitBinary=qt;Pt.prototype.visitFixedSizeBinary=qt;Pt.prototype.visitDate=qt;Pt.prototype.visitDateDay=qt;Pt.prototype.visitDateMillisecond=qt;Pt.prototype.visitTimestamp=qt;Pt.prototype.visitTimestampSecond=qt;Pt.prototype.visitTimestampMillisecond=qt;Pt.prototype.visitTimestampMicrosecond=qt;Pt.prototype.visitTimestampNanosecond=qt;Pt.prototype.visitTime=qt;Pt.prototype.visitTimeSecond=qt;Pt.prototype.visitTimeMillisecond=qt;Pt.prototype.visitTimeMicrosecond=qt;Pt.prototype.visitTimeNanosecond=qt;Pt.prototype.visitDecimal=qt;Pt.prototype.visitList=qt;Pt.prototype.visitStruct=qt;Pt.prototype.visitUnion=qt;Pt.prototype.visitDenseUnion=qt;Pt.prototype.visitSparseUnion=qt;Pt.prototype.visitDictionary=qt;Pt.prototype.visitInterval=qt;Pt.prototype.visitIntervalDayTime=qt;Pt.prototype.visitIntervalYearMonth=qt;Pt.prototype.visitDuration=qt;Pt.prototype.visitDurationSecond=qt;Pt.prototype.visitDurationMillisecond=qt;Pt.prototype.visitDurationMicrosecond=qt;Pt.prototype.visitDurationNanosecond=qt;Pt.prototype.visitFixedSizeList=qt;Pt.prototype.visitMap=qt;const oD=new Pt,_gt=(t,e)=>t+e;class af extends te{visitNull(e,n){return 0}visitInt(e,n){return e.type.bitWidth/8}visitFloat(e,n){return e.type.ArrayType.BYTES_PER_ELEMENT}visitBool(e,n){return 1/8}visitDecimal(e,n){return e.type.bitWidth/8}visitDate(e,n){return(e.type.unit+1)*4}visitTime(e,n){return e.type.bitWidth/8}visitTimestamp(e,n){return e.type.unit===Ht.SECOND?4:8}visitInterval(e,n){return(e.type.unit+1)*4}visitDuration(e,n){return 8}visitStruct(e,n){return e.children.reduce((i,r)=>i+Na.visit(r,n),0)}visitFixedSizeBinary(e,n){return e.type.byteWidth}visitMap(e,n){return 8+e.children.reduce((i,r)=>i+Na.visit(r,n),0)}visitDictionary(e,n){var i;return e.type.indices.bitWidth/8+(((i=e.dictionary)===null||i===void 0?void 0:i.getByteLength(e.values[n]))||0)}}const xgt=({valueOffsets:t},e)=>8+(t[e+1]-t[e]),Sgt=({valueOffsets:t},e)=>8+(t[e+1]-t[e]),Egt=({valueOffsets:t,stride:e,children:n},i)=>{const r=n[0],{[i*e]:s}=t,{[i*e+1]:o}=t,a=Na.getVisitFn(r.type),u=r.slice(s,o-s);let c=8;for(let l=-1,f=o-s;++l<f;)c+=a(u,l);return c},Agt=({stride:t,children:e},n)=>{const i=e[0],r=i.slice(n*t,t),s=Na.getVisitFn(i.type);let o=0;for(let a=-1,u=r.length;++a<u;)o+=s(r,a);return o},$gt=(t,e)=>t.type.mode===rr.Dense?EW(t,e):AW(t,e),EW=({type:t,children:e,typeIds:n,valueOffsets:i},r)=>{const s=t.typeIdToChildIndex[n[r]];return 8+Na.visit(e[s],i[r])},AW=({children:t},e)=>4+Na.visitMany(t,t.map(()=>e)).reduce(_gt,0);af.prototype.visitUtf8=xgt;af.prototype.visitBinary=Sgt;af.prototype.visitList=Egt;af.prototype.visitFixedSizeList=Agt;af.prototype.visitUnion=$gt;af.prototype.visitDenseUnion=EW;af.prototype.visitSparseUnion=AW;const Na=new af;var $W;const IW={},MW={};let hn=class Xf{constructor(e){var n,i,r;const s=e[0]instanceof Xf?e.flatMap(a=>a.data):e;if(s.length===0||s.some(a=>!(a instanceof ze)))throw new TypeError("Vector constructor expects an Array of Data instances.");const o=(n=s[0])===null||n===void 0?void 0:n.type;switch(s.length){case 0:this._offsets=[0];break;case 1:{const{get:a,set:u,indexOf:c,byteLength:l}=IW[o.typeId],f=s[0];this.isValid=d=>sD(f,d),this.get=d=>a(f,d),this.set=(d,h)=>u(f,d,h),this.indexOf=d=>c(f,d),this.getByteLength=d=>l(f,d),this._offsets=[0,f.length];break}default:Object.setPrototypeOf(this,MW[o.typeId]),this._offsets=vW(s);break}this.data=s,this.type=o,this.stride=Fu(o),this.numChildren=(r=(i=o.children)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,n)=>e+n.byteLength,0)}get nullCount(){return bW(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${C[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}set(e,n){}indexOf(e,n){return-1}includes(e,n){return this.indexOf(e,n)>-1}getByteLength(e){return 0}[Symbol.iterator](){return oD.visit(this)}concat(...e){return new Xf(this.data.concat(e.flatMap(n=>n.data).flat(Number.POSITIVE_INFINITY)))}slice(e,n){return new Xf(mW(this,e,n,({data:i,_offsets:r},s,o)=>wW(i,r,s,o)))}toJSON(){return[...this]}toArray(){const{type:e,data:n,length:i,stride:r,ArrayType:s}=this;switch(e.typeId){case C.Int:case C.Float:case C.Decimal:case C.Time:case C.Timestamp:switch(n.length){case 0:return new s;case 1:return n[0].values.subarray(0,i*r);default:return n.reduce((o,{values:a,length:u})=>(o.array.set(a.subarray(0,u*r),o.offset),o.offset+=u*r,o),{array:new s(i*r),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var n;return this.getChildAt((n=this.type.children)===null||n===void 0?void 0:n.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new Xf(this.data.map(({children:n})=>n[e])):null}get isMemoized(){return At.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(At.isDictionary(this.type)){const e=new w_(this.data[0].dictionary),n=this.data.map(i=>{const r=i.clone();return r.dictionary=e,r});return new Xf(n)}return new w_(this)}unmemoize(){if(At.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),n=this.data.map(i=>{const r=i.clone();return r.dictionary=e,r});return new Xf(n)}return this}};$W=Symbol.toStringTag;hn[$W]=(t=>{t.type=At.prototype,t.data=[],t.length=0,t.stride=1,t.numChildren=0,t._offsets=new Uint32Array([0]),t[Symbol.isConcatSpreadable]=!0;const e=Object.keys(C).map(n=>C[n]).filter(n=>typeof n=="number"&&n!==C.NONE);for(const n of e){const i=Cr.getVisitFnByTypeId(n),r=Rs.getVisitFnByTypeId(n),s=v_.getVisitFnByTypeId(n),o=Na.getVisitFnByTypeId(n);IW[n]={get:i,set:r,indexOf:s,byteLength:o},MW[n]=Object.create(t,{isValid:{value:tg(sD)},get:{value:tg(Cr.getVisitFnByTypeId(n))},set:{value:_W(Rs.getVisitFnByTypeId(n))},indexOf:{value:xW(v_.getVisitFnByTypeId(n))},getByteLength:{value:tg(Na.getVisitFnByTypeId(n))}})}return"Vector"})(hn.prototype);class w_ extends hn{constructor(e){super(e.data);const n=this.get,i=this.set,r=this.slice,s=new Array(this.length);Object.defineProperty(this,"get",{value(o){const a=s[o];if(a!==void 0)return a;const u=n.call(this,o);return s[o]=u,u}}),Object.defineProperty(this,"set",{value(o,a){i.call(this,o,a),s[o]=a}}),Object.defineProperty(this,"slice",{value:(o,a)=>new w_(r.call(this,o,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new hn(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class DM{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,n,i,r){return e.prep(8,24),e.writeInt64(BigInt(r??0)),e.pad(4),e.writeInt32(i),e.writeInt64(BigInt(n??0)),e.offset()}}class Ln{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsKeyValue(e,n){return(n||new Ln).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,n){return e.setPosition(e.position()+yt),(n||new Ln).__init(e.readInt32(e.position())+e.position(),e)}key(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}value(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,n){e.addFieldOffset(0,n,0)}static addValue(e,n){e.addFieldOffset(1,n,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,n,i){return Ln.startKeyValue(e),Ln.addKey(e,n),Ln.addValue(e,i),Ln.endKeyValue(e)}}var xg;(function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"})(xg||(xg={}));var Sg;(function(t){t[t.Little=0]="Little",t[t.Big=1]="Big"})(Sg||(Sg={}));var __;(function(t){t[t.DenseArray=0]="DenseArray"})(__||(__={}));class Xr{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInt(e,n){return(n||new Xr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,n){return e.setPosition(e.position()+yt),(n||new Xr).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,n){e.addFieldInt32(0,n,0)}static addIsSigned(e,n){e.addFieldInt8(1,+n,0)}static endInt(e){return e.endObject()}static createInt(e,n,i){return Xr.startInt(e),Xr.addBitWidth(e,n),Xr.addIsSigned(e,i),Xr.endInt(e)}}class zu{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryEncoding(e,n){return(n||new zu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,n){return e.setPosition(e.position()+yt),(n||new zu).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Xr).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):__.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addIndexType(e,n){e.addFieldOffset(1,n,0)}static addIsOrdered(e,n){e.addFieldInt8(2,+n,0)}static addDictionaryKind(e,n){e.addFieldInt16(3,n,__.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class dd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBinary(e,n){return(n||new dd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,n){return e.setPosition(e.position()+yt),(n||new dd).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return dd.startBinary(e),dd.endBinary(e)}}class hd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBool(e,n){return(n||new hd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,n){return e.setPosition(e.position()+yt),(n||new hd).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return hd.startBool(e),hd.endBool(e)}}var x_;(function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"})(x_||(x_={}));let Ww=class Ap{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDate(e,n){return(n||new Ap).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,n){return e.setPosition(e.position()+yt),(n||new Ap).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):x_.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,x_.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,n){return Ap.startDate(e),Ap.addUnit(e,n),Ap.endDate(e)}};class vr{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDecimal(e,n){return(n||new vr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,n){return e.setPosition(e.position()+yt),(n||new vr).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,n){e.addFieldInt32(0,n,0)}static addScale(e,n){e.addFieldInt32(1,n,0)}static addBitWidth(e,n){e.addFieldInt32(2,n,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,n,i,r){return vr.startDecimal(e),vr.addPrecision(e,n),vr.addScale(e,i),vr.addBitWidth(e,r),vr.endDecimal(e)}}var Il;(function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"})(Il||(Il={}));class da{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDuration(e,n){return(n||new da).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,n){return e.setPosition(e.position()+yt),(n||new da).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Il.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,Il.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,n){return da.startDuration(e),da.addUnit(e,n),da.endDuration(e)}}class ha{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeBinary(e,n){return(n||new ha).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,n){return e.setPosition(e.position()+yt),(n||new ha).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,n){return ha.startFixedSizeBinary(e),ha.addByteWidth(e,n),ha.endFixedSizeBinary(e)}}class pa{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeList(e,n){return(n||new pa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,n){return e.setPosition(e.position()+yt),(n||new pa).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,n){return pa.startFixedSizeList(e),pa.addListSize(e,n),pa.endFixedSizeList(e)}}var S_;(function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"})(S_||(S_={}));class ga{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFloatingPoint(e,n){return(n||new ga).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,n){return e.setPosition(e.position()+yt),(n||new ga).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):S_.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,n){e.addFieldInt16(0,n,S_.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,n){return ga.startFloatingPoint(e),ga.addPrecision(e,n),ga.endFloatingPoint(e)}}var E_;(function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(E_||(E_={}));class ma{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInterval(e,n){return(n||new ma).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,n){return e.setPosition(e.position()+yt),(n||new ma).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):E_.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,E_.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,n){return ma.startInterval(e),ma.addUnit(e,n),ma.endInterval(e)}}class pd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsList(e,n){return(n||new pd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,n){return e.setPosition(e.position()+yt),(n||new pd).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return pd.startList(e),pd.endList(e)}}let Gw=class $p{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMap(e,n){return(n||new $p).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,n){return e.setPosition(e.position()+yt),(n||new $p).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,n){e.addFieldInt8(0,+n,0)}static endMap(e){return e.endObject()}static createMap(e,n){return $p.startMap(e),$p.addKeysSorted(e,n),$p.endMap(e)}};class gd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsNull(e,n){return(n||new gd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,n){return e.setPosition(e.position()+yt),(n||new gd).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return gd.startNull(e),gd.endNull(e)}}class md{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsStruct_(e,n){return(n||new md).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,n){return e.setPosition(e.position()+yt),(n||new md).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return md.startStruct_(e),md.endStruct_(e)}}let J0=class Kf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTime(e,n){return(n||new Kf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,n){return e.setPosition(e.position()+yt),(n||new Kf).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Il.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,Il.MILLISECOND)}static addBitWidth(e,n){e.addFieldInt32(1,n,32)}static endTime(e){return e.endObject()}static createTime(e,n,i){return Kf.startTime(e),Kf.addUnit(e,n),Kf.addBitWidth(e,i),Kf.endTime(e)}};class Ss{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTimestamp(e,n){return(n||new Ss).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,n){return e.setPosition(e.position()+yt),(n||new Ss).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Il.SECOND}timezone(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,Il.SECOND)}static addTimezone(e,n){e.addFieldOffset(1,n,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,n,i){return Ss.startTimestamp(e),Ss.addUnit(e,n),Ss.addTimezone(e,i),Ss.endTimestamp(e)}}var A_;(function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"})(A_||(A_={}));let Jf=class Qf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUnion(e,n){return(n||new Qf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,n){return e.setPosition(e.position()+yt),(n||new Qf).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):A_.Sparse}typeIds(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.readInt32(this.bb.__vector(this.bb_pos+n)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,n){e.addFieldInt16(0,n,A_.Sparse)}static addTypeIds(e,n){e.addFieldOffset(1,n,0)}static createTypeIdsVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addInt32(n[i]);return e.endVector()}static startTypeIdsVector(e,n){e.startVector(4,n,4)}static endUnion(e){return e.endObject()}static createUnion(e,n,i){return Qf.startUnion(e),Qf.addMode(e,n),Qf.addTypeIds(e,i),Qf.endUnion(e)}};class yd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUtf8(e,n){return(n||new yd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,n){return e.setPosition(e.position()+yt),(n||new yd).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return yd.startUtf8(e),yd.endUtf8(e)}}var nn;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.FloatingPoint=3]="FloatingPoint",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct_=13]="Struct_",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.LargeList=21]="LargeList",t[t.RunEndEncoded=22]="RunEndEncoded"})(nn||(nn={}));let ws=class Yw{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsField(e,n){return(n||new Yw).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,n){return e.setPosition(e.position()+yt),(n||new Yw).__init(e.readInt32(e.position())+e.position(),e)}name(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):nn.NONE}type(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.__union(e,this.bb_pos+n):null}dictionary(e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new zu).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}children(e,n){const i=this.bb.__offset(this.bb_pos,14);return i?(n||new Yw).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,16);return i?(n||new Ln).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,n){e.addFieldOffset(0,n,0)}static addNullable(e,n){e.addFieldInt8(1,+n,0)}static addTypeType(e,n){e.addFieldInt8(2,n,nn.NONE)}static addType(e,n){e.addFieldOffset(3,n,0)}static addDictionary(e,n){e.addFieldOffset(4,n,0)}static addChildren(e,n){e.addFieldOffset(5,n,0)}static createChildrenVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startChildrenVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(6,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endField(e){return e.endObject()}},ea=class Eu{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsSchema(e,n){return(n||new Eu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,n){return e.setPosition(e.position()+yt),(n||new Eu).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Sg.Little}fields(e,n){const i=this.bb.__offset(this.bb_pos,6);return i?(n||new ws).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,8);return i?(n||new Ln).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.readInt64(this.bb.__vector(this.bb_pos+n)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,n){e.addFieldInt16(0,n,Sg.Little)}static addFields(e,n){e.addFieldOffset(1,n,0)}static createFieldsVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startFieldsVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(2,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static addFeatures(e,n){e.addFieldOffset(3,n,0)}static createFeaturesVector(e,n){e.startVector(8,n.length,8);for(let i=n.length-1;i>=0;i--)e.addInt64(n[i]);return e.endVector()}static startFeaturesVector(e,n){e.startVector(8,n,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,n){e.finish(n)}static finishSizePrefixedSchemaBuffer(e,n){e.finish(n,void 0,!0)}static createSchema(e,n,i,r,s){return Eu.startSchema(e),Eu.addEndianness(e,n),Eu.addFields(e,i),Eu.addCustomMetadata(e,r),Eu.addFeatures(e,s),Eu.endSchema(e)}};class Yr{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFooter(e,n){return(n||new Yr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,n){return e.setPosition(e.position()+yt),(n||new Yr).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xg.V1}schema(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new ea).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dictionaries(e,n){const i=this.bb.__offset(this.bb_pos,8);return i?(n||new DM).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,n){const i=this.bb.__offset(this.bb_pos,10);return i?(n||new DM).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,12);return i?(n||new Ln).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,xg.V1)}static addSchema(e,n){e.addFieldOffset(1,n,0)}static addDictionaries(e,n){e.addFieldOffset(2,n,0)}static startDictionariesVector(e,n){e.startVector(24,n,8)}static addRecordBatches(e,n){e.addFieldOffset(3,n,0)}static startRecordBatchesVector(e,n){e.startVector(24,n,8)}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,n){e.finish(n)}static finishSizePrefixedFooterBuffer(e,n){e.finish(n,void 0,!0)}}class Fe{constructor(e=[],n,i,r=li.V5){this.fields=e||[],this.metadata=n||new Map,i||(i=NM(e)),this.dictionaries=i,this.metadataVersion=r}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,n)=>`${n}: ${e}`).join(", ")} }>`}select(e){const n=new Set(e),i=this.fields.filter(r=>n.has(r.name));return new Fe(i,this.metadata)}selectAt(e){const n=e.map(i=>this.fields[i]).filter(Boolean);return new Fe(n,this.metadata)}assign(...e){const n=e[0]instanceof Fe?e[0]:Array.isArray(e[0])?new Fe(e[0]):new Fe(e),i=[...this.fields],r=Mv(Mv(new Map,this.metadata),n.metadata),s=n.fields.filter(a=>{const u=i.findIndex(c=>c.name===a.name);return~u?(i[u]=a.clone({metadata:Mv(Mv(new Map,i[u].metadata),a.metadata)}))&&!1:!0}),o=NM(s,new Map);return new Fe([...i,...s],r,new Map([...this.dictionaries,...o]))}}Fe.prototype.fields=null;Fe.prototype.metadata=null;Fe.prototype.dictionaries=null;let Sn=class CM{static new(...e){let[n,i,r,s]=e;return e[0]&&typeof e[0]=="object"&&({name:n}=e[0],i===void 0&&(i=e[0].type),r===void 0&&(r=e[0].nullable),s===void 0&&(s=e[0].metadata)),new CM(`${n}`,i,r,s)}constructor(e,n,i=!1,r){this.name=e,this.type=n,this.nullable=i,this.metadata=r||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[n,i,r,s]=e;return!e[0]||typeof e[0]!="object"?[n=this.name,i=this.type,r=this.nullable,s=this.metadata]=e:{name:n=this.name,type:i=this.type,nullable:r=this.nullable,metadata:s=this.metadata}=e[0],CM.new(n,i,r,s)}};Sn.prototype.type=null;Sn.prototype.name=null;Sn.prototype.nullable=null;Sn.prototype.metadata=null;function Mv(t,e){return new Map([...t||new Map,...e||new Map])}function NM(t,e=new Map){for(let n=-1,i=t.length;++n<i;){const s=t[n].type;if(At.isDictionary(s)){if(!e.has(s.id))e.set(s.id,s.dictionary);else if(e.get(s.id)!==s.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}s.children&&s.children.length>0&&NM(s.children,e)}return e}var Igt=zS,Mgt=Da;class u1{static decode(e){e=new Mgt(Ee(e));const n=Yr.getRootAsFooter(e),i=Fe.decode(n.schema(),new Map,n.version());return new Tgt(i,n)}static encode(e){const n=new Igt,i=Fe.encode(n,e.schema);Yr.startRecordBatchesVector(n,e.numRecordBatches);for(const o of[...e.recordBatches()].slice().reverse())Ml.encode(n,o);const r=n.endVector();Yr.startDictionariesVector(n,e.numDictionaries);for(const o of[...e.dictionaryBatches()].slice().reverse())Ml.encode(n,o);const s=n.endVector();return Yr.startFooter(n),Yr.addSchema(n,i),Yr.addVersion(n,li.V5),Yr.addRecordBatches(n,r),Yr.addDictionaries(n,s),Yr.finishFooterBuffer(n,Yr.endFooter(n)),n.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,n=li.V5,i,r){this.schema=e,this.version=n,i&&(this._recordBatches=i),r&&(this._dictionaryBatches=r)}*recordBatches(){for(let e,n=-1,i=this.numRecordBatches;++n<i;)(e=this.getRecordBatch(n))&&(yield e)}*dictionaryBatches(){for(let e,n=-1,i=this.numDictionaries;++n<i;)(e=this.getDictionaryBatch(n))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class Tgt extends u1{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,n){super(e,n.version()),this._footer=n}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const n=this._footer.recordBatches(e);if(n)return Ml.decode(n)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const n=this._footer.dictionaries(e);if(n)return Ml.decode(n)}return null}}class Ml{static decode(e){return new Ml(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,n){const{metaDataLength:i}=n,r=BigInt(n.offset),s=BigInt(n.bodyLength);return DM.createBlock(e,r,i,s)}constructor(e,n,i){this.metaDataLength=e,this.offset=Io(i),this.bodyLength=Io(n)}}const pn=Object.freeze({done:!0,value:void 0});class $5{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class aD{tee(){return this._getDOMStream().tee()}pipe(e,n){return this._getNodeStream().pipe(e,n)}pipeTo(e,n){return this._getDOMStream().pipeTo(e,n)}pipeThrough(e,n){return this._getDOMStream().pipeThrough(e,n)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class Fgt extends aD{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return Z(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(pn);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return xs.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return xs.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return Z(this,void 0,void 0,function*(){return yield this.abort(e),pn})}return(e){return Z(this,void 0,void 0,function*(){return yield this.close(),pn})}read(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((n,i)=>{this.resolvers.push({resolve:n,reject:i})}):Promise.resolve(pn)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class Hw extends Fgt{write(e){if((e=Ee(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?MM(this.toUint8Array(!0)):this.toUint8Array(!1).then(MM)}toUint8Array(e=!1){return e?Ca(this._values)[0]:Z(this,void 0,void 0,function*(){var n,i,r,s;const o=[];let a=0;try{for(var u=!0,c=ns(this),l;l=yield c.next(),n=l.done,!n;u=!0){s=l.value,u=!1;const f=s;o.push(f),a+=f.byteLength}}catch(f){i={error:f}}finally{try{!u&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}return Ca(o,a)[0]})}}class $_{constructor(e){e&&(this.source=new kgt(xs.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class Eg{constructor(e){e instanceof Eg?this.source=e.source:e instanceof Hw?this.source=new If(xs.fromAsyncIterable(e)):iV(e)?this.source=new If(xs.fromNodeStream(e)):Xk(e)?this.source=new If(xs.fromDOMStream(e)):nV(e)?this.source=new If(xs.fromDOMStream(e.body)):ub(e)?this.source=new If(xs.fromIterable(e)):Bd(e)?this.source=new If(xs.fromAsyncIterable(e)):mm(e)&&(this.source=new If(xs.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class kgt{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,n="read"){return this.source.next({cmd:n,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||pn)}return(e){return Object.create(this.source.return&&this.source.return(e)||pn)}}class If{constructor(e){this.source=e,this._closedPromise=new Promise(n=>this._closedPromiseResolve=n)}cancel(e){return Z(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Z(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e,n="read"){return Z(this,void 0,void 0,function*(){return yield this.source.next({cmd:n,size:e})})}throw(e){return Z(this,void 0,void 0,function*(){const n=this.source.throw&&(yield this.source.throw(e))||pn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}return(e){return Z(this,void 0,void 0,function*(){const n=this.source.return&&(yield this.source.return(e))||pn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}}class I5 extends $_{constructor(e,n){super(),this.position=0,this.buffer=Ee(e),this.size=n===void 0?this.buffer.byteLength:n}readInt32(e){const{buffer:n,byteOffset:i}=this.readAt(e,4);return new DataView(n,i).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:n,size:i,position:r}=this;return n&&r<i?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(i,r+Math.min(i-r,e)),n.subarray(r,this.position)):null}readAt(e,n){const i=this.buffer,r=Math.min(this.size,e+n);return i?i.subarray(e,r):new Uint8Array(n)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class I_ extends Eg{constructor(e,n){super(),this.position=0,this._handle=e,typeof n=="number"?this.size=n:this._pending=Z(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return Z(this,void 0,void 0,function*(){const{buffer:n,byteOffset:i}=yield this.readAt(e,4);return new DataView(n,i).getInt32(0,!0)})}seek(e){return Z(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return Z(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:i,position:r}=this;if(n&&r<i){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let s=r,o=0,a=0;const u=Math.min(i,s+Math.min(i-s,e)),c=new Uint8Array(Math.max(0,(this.position=u)-s));for(;(s+=a)<u&&(o+=a)<c.byteLength;)({bytesRead:a}=yield n.read(c,o,c.byteLength-o,s));return c}return null})}readAt(e,n){return Z(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:i,size:r}=this;if(i&&e+n<r){const s=Math.min(r,e+n),o=new Uint8Array(s-e);return(yield i.read(o,0,n,e)).buffer}return new Uint8Array(n)})}close(){return Z(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return Z(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return Z(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const Dgt=65536;function Dp(t){return t<0&&(t=4294967295+t+1),`0x${t.toString(16)}`}const Ag=8,uD=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class TW{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const n=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),i=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let r=n[3]*i[3];this.buffer[0]=r&65535;let s=r>>>16;return r=n[2]*i[3],s+=r,r=n[3]*i[2]>>>0,s+=r,this.buffer[0]+=s<<16,this.buffer[1]=s>>>0<r?Dgt:0,this.buffer[1]+=s>>>16,this.buffer[1]+=n[1]*i[3]+n[2]*i[2]+n[3]*i[1],this.buffer[1]+=n[0]*i[3]+n[1]*i[2]+n[2]*i[1]+n[3]*i[0]<<16,this}_plus(e){const n=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],n<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=n}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${Dp(this.buffer[1])} ${Dp(this.buffer[0])}`}}class De extends TW{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,n=new Uint32Array(2)){return De.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return De.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const i=e.length,r=new De(n);for(let s=0;s<i;){const o=Ag<i-s?Ag:i-s,a=new De(new Uint32Array([Number.parseInt(e.slice(s,s+o),10),0])),u=new De(new Uint32Array([uD[o],0]));r.times(u),r.plus(a),s+=o}return r}static convertArray(e){const n=new Uint32Array(e.length*2);for(let i=-1,r=e.length;++i<r;)De.from(e[i],new Uint32Array(n.buffer,n.byteOffset+2*i*4,2));return n}static multiply(e,n){return new De(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new De(new Uint32Array(e.buffer)).plus(n)}}class yr extends TW{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const n=this.buffer[1]<<0,i=e.buffer[1]<<0;return n<i||n===i&&this.buffer[0]<e.buffer[0]}static from(e,n=new Uint32Array(2)){return yr.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return yr.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const i=e.startsWith("-"),r=e.length,s=new yr(n);for(let o=i?1:0;o<r;){const a=Ag<r-o?Ag:r-o,u=new yr(new Uint32Array([Number.parseInt(e.slice(o,o+a),10),0])),c=new yr(new Uint32Array([uD[a],0]));s.times(c),s.plus(u),o+=a}return i?s.negate():s}static convertArray(e){const n=new Uint32Array(e.length*2);for(let i=-1,r=e.length;++i<r;)yr.from(e[i],new Uint32Array(n.buffer,n.byteOffset+2*i*4,2));return n}static multiply(e,n){return new yr(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new yr(new Uint32Array(e.buffer)).plus(n)}}class na{constructor(e){this.buffer=e}high(){return new yr(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new yr(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const n=new De(new Uint32Array([this.buffer[3],0])),i=new De(new Uint32Array([this.buffer[2],0])),r=new De(new Uint32Array([this.buffer[1],0])),s=new De(new Uint32Array([this.buffer[0],0])),o=new De(new Uint32Array([e.buffer[3],0])),a=new De(new Uint32Array([e.buffer[2],0])),u=new De(new Uint32Array([e.buffer[1],0])),c=new De(new Uint32Array([e.buffer[0],0]));let l=De.multiply(s,c);this.buffer[0]=l.low();const f=new De(new Uint32Array([l.high(),0]));return l=De.multiply(r,c),f.plus(l),l=De.multiply(s,u),f.plus(l),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(l)?1:0,this.buffer[2]=f.high(),new De(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(De.multiply(i,c)).plus(De.multiply(r,u)).plus(De.multiply(s,a)),this.buffer[3]+=De.multiply(n,c).plus(De.multiply(i,u)).plus(De.multiply(r,a)).plus(De.multiply(s,o)).low(),this}plus(e){const n=new Uint32Array(4);return n[3]=this.buffer[3]+e.buffer[3]>>>0,n[2]=this.buffer[2]+e.buffer[2]>>>0,n[1]=this.buffer[1]+e.buffer[1]>>>0,n[0]=this.buffer[0]+e.buffer[0]>>>0,n[0]<this.buffer[0]>>>0&&++n[1],n[1]<this.buffer[1]>>>0&&++n[2],n[2]<this.buffer[2]>>>0&&++n[3],this.buffer[3]=n[3],this.buffer[2]=n[2],this.buffer[1]=n[1],this.buffer[0]=n[0],this}hex(){return`${Dp(this.buffer[3])} ${Dp(this.buffer[2])} ${Dp(this.buffer[1])} ${Dp(this.buffer[0])}`}static multiply(e,n){return new na(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new na(new Uint32Array(e.buffer)).plus(n)}static from(e,n=new Uint32Array(4)){return na.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(4)){return na.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(4)){const i=e.startsWith("-"),r=e.length,s=new na(n);for(let o=i?1:0;o<r;){const a=Ag<r-o?Ag:r-o,u=new na(new Uint32Array([Number.parseInt(e.slice(o,o+a),10),0,0,0])),c=new na(new Uint32Array([uD[a],0,0,0]));s.times(c),s.plus(u),o+=a}return i?s.negate():s}static convertArray(e){const n=new Uint32Array(e.length*4);for(let i=-1,r=e.length;++i<r;)na.from(e[i],new Uint32Array(n.buffer,n.byteOffset+4*4*i,4));return n}}class FW extends te{constructor(e,n,i,r,s=li.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=n,this.buffers=i,this.dictionaries=r,this.metadataVersion=s}visit(e){return super.visit(e instanceof Sn?e.type:e)}visitNull(e,{length:n}=this.nextFieldNode()){return ce({type:e,length:n})}visitBool(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitInt(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFloat(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitUtf8(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDate(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTimestamp(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTime(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDecimal(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitList(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),children:this.visitMany(e.children)})}visitUnion(e,{length:n,nullCount:i}=this.nextFieldNode()){return this.metadataVersion<li.V5&&this.readNullBitmap(e,i),e.mode===rr.Sparse?this.visitSparseUnion(e,{length:n,nullCount:i}):this.visitDenseUnion(e,{length:n,nullCount:i})}visitDenseUnion(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDuration(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFixedSizeList(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),child:this.visit(e.children[0])})}visitMap(e,{length:n,nullCount:i}=this.nextFieldNode()){return ce({type:e,length:n,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,n,i=this.nextBufferRange()){return n>0&&this.readData(e,i)||new Uint8Array(0)}readOffsets(e,n){return this.readData(e,n)}readTypeIds(e,n){return this.readData(e,n)}readData(e,{length:n,offset:i}=this.nextBufferRange()){return this.bytes.subarray(i,i+n)}readDictionary(e){return this.dictionaries.get(e.id)}}class Cgt extends FW{constructor(e,n,i,r,s){super(new Uint8Array(0),n,i,r,s),this.sources=e}readNullBitmap(e,n,{offset:i}=this.nextBufferRange()){return n<=0?new Uint8Array(0):b_(this.sources[i])}readOffsets(e,{offset:n}=this.nextBufferRange()){return Re(Uint8Array,Re(Int32Array,this.sources[n]))}readTypeIds(e,{offset:n}=this.nextBufferRange()){return Re(Uint8Array,Re(e.ArrayType,this.sources[n]))}readData(e,{offset:n}=this.nextBufferRange()){const{sources:i}=this;return At.isTimestamp(e)||(At.isInt(e)||At.isTime(e))&&e.bitWidth===64||At.isDuration(e)||At.isDate(e)&&e.unit===rc.MILLISECOND?Re(Uint8Array,yr.convertArray(i[n])):At.isDecimal(e)?Re(Uint8Array,na.convertArray(i[n])):At.isBinary(e)||At.isFixedSizeBinary(e)?Ngt(i[n]):At.isBool(e)?b_(i[n]):At.isUtf8(e)?Hk(i[n].join("")):Re(Uint8Array,Re(e.ArrayType,i[n].map(r=>+r)))}}function Ngt(t){const e=t.join(""),n=new Uint8Array(e.length/2);for(let i=0;i<e.length;i+=2)n[i>>1]=Number.parseInt(e.slice(i,i+2),16);return n}class zt extends te{compareSchemas(e,n){return e===n||n instanceof e.constructor&&this.compareManyFields(e.fields,n.fields)}compareManyFields(e,n){return e===n||Array.isArray(e)&&Array.isArray(n)&&e.length===n.length&&e.every((i,r)=>this.compareFields(i,n[r]))}compareFields(e,n){return e===n||n instanceof e.constructor&&e.name===n.name&&e.nullable===n.nullable&&this.visit(e.type,n.type)}}function fr(t,e){return e instanceof t.constructor}function cb(t,e){return t===e||fr(t,e)}function mc(t,e){return t===e||fr(t,e)&&t.bitWidth===e.bitWidth&&t.isSigned===e.isSigned}function XS(t,e){return t===e||fr(t,e)&&t.precision===e.precision}function Ogt(t,e){return t===e||fr(t,e)&&t.byteWidth===e.byteWidth}function cD(t,e){return t===e||fr(t,e)&&t.unit===e.unit}function lb(t,e){return t===e||fr(t,e)&&t.unit===e.unit&&t.timezone===e.timezone}function fb(t,e){return t===e||fr(t,e)&&t.unit===e.unit&&t.bitWidth===e.bitWidth}function Rgt(t,e){return t===e||fr(t,e)&&t.children.length===e.children.length&&Tl.compareManyFields(t.children,e.children)}function Lgt(t,e){return t===e||fr(t,e)&&t.children.length===e.children.length&&Tl.compareManyFields(t.children,e.children)}function lD(t,e){return t===e||fr(t,e)&&t.mode===e.mode&&t.typeIds.every((n,i)=>n===e.typeIds[i])&&Tl.compareManyFields(t.children,e.children)}function Bgt(t,e){return t===e||fr(t,e)&&t.id===e.id&&t.isOrdered===e.isOrdered&&Tl.visit(t.indices,e.indices)&&Tl.visit(t.dictionary,e.dictionary)}function fD(t,e){return t===e||fr(t,e)&&t.unit===e.unit}function db(t,e){return t===e||fr(t,e)&&t.unit===e.unit}function Pgt(t,e){return t===e||fr(t,e)&&t.listSize===e.listSize&&t.children.length===e.children.length&&Tl.compareManyFields(t.children,e.children)}function zgt(t,e){return t===e||fr(t,e)&&t.keysSorted===e.keysSorted&&t.children.length===e.children.length&&Tl.compareManyFields(t.children,e.children)}zt.prototype.visitNull=cb;zt.prototype.visitBool=cb;zt.prototype.visitInt=mc;zt.prototype.visitInt8=mc;zt.prototype.visitInt16=mc;zt.prototype.visitInt32=mc;zt.prototype.visitInt64=mc;zt.prototype.visitUint8=mc;zt.prototype.visitUint16=mc;zt.prototype.visitUint32=mc;zt.prototype.visitUint64=mc;zt.prototype.visitFloat=XS;zt.prototype.visitFloat16=XS;zt.prototype.visitFloat32=XS;zt.prototype.visitFloat64=XS;zt.prototype.visitUtf8=cb;zt.prototype.visitBinary=cb;zt.prototype.visitFixedSizeBinary=Ogt;zt.prototype.visitDate=cD;zt.prototype.visitDateDay=cD;zt.prototype.visitDateMillisecond=cD;zt.prototype.visitTimestamp=lb;zt.prototype.visitTimestampSecond=lb;zt.prototype.visitTimestampMillisecond=lb;zt.prototype.visitTimestampMicrosecond=lb;zt.prototype.visitTimestampNanosecond=lb;zt.prototype.visitTime=fb;zt.prototype.visitTimeSecond=fb;zt.prototype.visitTimeMillisecond=fb;zt.prototype.visitTimeMicrosecond=fb;zt.prototype.visitTimeNanosecond=fb;zt.prototype.visitDecimal=cb;zt.prototype.visitList=Rgt;zt.prototype.visitStruct=Lgt;zt.prototype.visitUnion=lD;zt.prototype.visitDenseUnion=lD;zt.prototype.visitSparseUnion=lD;zt.prototype.visitDictionary=Bgt;zt.prototype.visitInterval=fD;zt.prototype.visitIntervalDayTime=fD;zt.prototype.visitIntervalYearMonth=fD;zt.prototype.visitDuration=db;zt.prototype.visitDurationSecond=db;zt.prototype.visitDurationMillisecond=db;zt.prototype.visitDurationMicrosecond=db;zt.prototype.visitDurationNanosecond=db;zt.prototype.visitFixedSizeList=Pgt;zt.prototype.visitMap=zgt;const Tl=new zt;function OM(t,e){return Tl.compareSchemas(t,e)}function Q$(t,e){return Ugt(t,e.map(n=>n.data.concat()))}function Ugt(t,e){const n=[...t.fields],i=[],r={numBatches:e.reduce((f,d)=>Math.max(f,d.length),0)};let s=0,o=0,a=-1;const u=e.length;let c,l=[];for(;r.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,a=-1;++a<u;)l[a]=c=e[a].shift(),o=Math.min(o,c?c.length:o);Number.isFinite(o)&&(l=jgt(n,o,l,e,r),o>0&&(i[s++]=ce({type:new Xi(n),length:o,nullCount:0,children:l.slice()})))}return[t=t.assign(n),i.map(f=>new _r(t,f))]}function jgt(t,e,n,i,r){var s;const o=(e+63&-64)>>3;for(let a=-1,u=i.length;++a<u;){const c=n[a],l=c==null?void 0:c.length;if(l>=e)l===e?n[a]=c:(n[a]=c.slice(0,e),r.numBatches=Math.max(r.numBatches,i[a].unshift(c.slice(e,l-e))));else{const f=t[a];t[a]=f.clone({nullable:!0}),n[a]=(s=c==null?void 0:c._changeLengthAndBackfillNullBitmap(e))!==null&&s!==void 0?s:ce({type:f.type,length:e,nullCount:e,nullBitmap:new Uint8Array(o)})}}return n}var kW;class Vi{constructor(...e){var n,i;if(e.length===0)return this.batches=[],this.schema=new Fe([]),this._offsets=[0],this;let r,s;e[0]instanceof Fe&&(r=e.shift()),e.at(-1)instanceof Uint32Array&&(s=e.pop());const o=u=>{if(u){if(u instanceof _r)return[u];if(u instanceof Vi)return u.batches;if(u instanceof ze){if(u.type instanceof Xi)return[new _r(new Fe(u.type.children),u)]}else{if(Array.isArray(u))return u.flatMap(c=>o(c));if(typeof u[Symbol.iterator]=="function")return[...u].flatMap(c=>o(c));if(typeof u=="object"){const c=Object.keys(u),l=c.map(h=>new hn([u[h]])),f=new Fe(c.map((h,p)=>new Sn(String(h),l[p].type))),[,d]=Q$(f,l);return d.length===0?[new _r(u)]:d}}}return[]},a=e.flatMap(u=>o(u));if(r=(i=r??((n=a[0])===null||n===void 0?void 0:n.schema))!==null&&i!==void 0?i:new Fe([]),!(r instanceof Fe))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const u of a){if(!(u instanceof _r))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!OM(r,u.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=r,this.batches=a,this._offsets=s??vW(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,n)=>e+n.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=bW(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}set(e,n){}indexOf(e,n){return-1}getByteLength(e){return 0}[Symbol.iterator](){return this.batches.length>0?oD.visit(new hn(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const n=this.schema,i=this.data.concat(e.flatMap(({data:r})=>r));return new Vi(n,i.map(r=>new _r(n,r)))}slice(e,n){const i=this.schema;[e,n]=mW({length:this.numRows},e,n);const r=wW(this.data,this._offsets,e,n);return new Vi(i,r.map(s=>new _r(i,s)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(n=>n.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const n=this.data.map(i=>i.children[e]);if(n.length===0){const{type:i}=this.schema.fields[e],r=ce({type:i,length:0,nullCount:0});n.push(r._changeLengthAndBackfillNullBitmap(this.numRows))}return new hn(n)}return null}setChild(e,n){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(r=>r.name===e),n)}setChildAt(e,n){let i=this.schema,r=[...this.batches];if(e>-1&&e<this.numCols){n||(n=new hn([ce({type:new Al,length:this.numRows})]));const s=i.fields.slice(),o=s[e].clone({type:n.type}),a=this.schema.fields.map((u,c)=>this.getChildAt(c));[s[e],a[e]]=[o,n],[i,r]=Q$(i,a)}return new Vi(i,r)}select(e){const n=this.schema.fields.reduce((i,r,s)=>i.set(r.name,s),new Map);return this.selectAt(e.map(i=>n.get(i)).filter(i=>i>-1))}selectAt(e){const n=this.schema.selectAt(e),i=this.batches.map(r=>r.selectAt(e));return new Vi(n,i)}assign(e){const n=this.schema.fields,[i,r]=e.schema.fields.reduce((a,u,c)=>{const[l,f]=a,d=n.findIndex(h=>h.name===u.name);return~d?f[d]=c:l.push(c),a},[[],[]]),s=this.schema.assign(e.schema),o=[...n.map((a,u)=>[u,r[u]]).map(([a,u])=>u===void 0?this.getChildAt(a):e.getChildAt(u)),...i.map(a=>e.getChildAt(a))].filter(Boolean);return new Vi(...Q$(s,o))}}kW=Symbol.toStringTag;Vi[kW]=(t=>(t.schema=null,t.batches=[],t._offsets=new Uint32Array([0]),t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,t.isValid=tg(sD),t.get=tg(Cr.getVisitFn(C.Struct)),t.set=_W(Rs.getVisitFn(C.Struct)),t.indexOf=xW(v_.getVisitFn(C.Struct)),t.getByteLength=tg(Na.getVisitFn(C.Struct)),"Table"))(Vi.prototype);var DW;let _r=class Q0{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof Fe))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=ce({nullCount:0,type:new Xi(this.schema.fields),children:this.schema.fields.map(n=>ce({type:n.type,nullCount:0}))})]=e,!(this.data instanceof ze))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=M5(this.schema,this.data.children);break}case 1:{const[n]=e,{fields:i,children:r,length:s}=Object.keys(n).reduce((u,c,l)=>(u.children[l]=n[c],u.length=Math.max(u.length,n[c].length),u.fields[l]=Sn.new({name:c,type:n[c].type,nullable:!0}),u),{length:0,fields:new Array,children:new Array}),o=new Fe(i),a=ce({type:new Xi(i),length:s,children:r,nullCount:0});[this.schema,this.data]=M5(o,a.children,s);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=CW(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return Cr.visit(this.data,e)}set(e,n){return Rs.visit(this.data,e,n)}indexOf(e,n){return v_.visit(this.data,e,n)}getByteLength(e){return Na.visit(this.data,e)}[Symbol.iterator](){return oD.visit(new hn([this.data]))}toArray(){return[...this]}concat(...e){return new Vi(this.schema,[this,...e])}slice(e,n){const[i]=new hn([this.data]).slice(e,n).data;return new Q0(this.schema,i)}getChild(e){var n;return this.getChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new hn([this.data.children[e]]):null}setChild(e,n){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(r=>r.name===e),n)}setChildAt(e,n){let i=this.schema,r=this.data;if(e>-1&&e<this.numCols){n||(n=new hn([ce({type:new Al,length:this.numRows})]));const s=i.fields.slice(),o=r.children.slice(),a=s[e].clone({type:n.type});[s[e],o[e]]=[a,n.data[0]],i=new Fe(s,new Map(this.schema.metadata)),r=ce({type:new Xi(s),children:o})}return new Q0(i,r)}select(e){const n=this.schema.select(e),i=new Xi(n.fields),r=[];for(const s of e){const o=this.schema.fields.findIndex(a=>a.name===s);~o&&(r[o]=this.data.children[o])}return new Q0(n,ce({type:i,length:this.numRows,children:r}))}selectAt(e){const n=this.schema.selectAt(e),i=e.map(s=>this.data.children[s]).filter(Boolean),r=ce({type:new Xi(n.fields),length:this.numRows,children:i});return new Q0(n,r)}};DW=Symbol.toStringTag;_r[DW]=(t=>(t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(_r.prototype);function M5(t,e,n=e.reduce((i,r)=>Math.max(i,r.length),0)){var i;const r=[...t.fields],s=[...e],o=(n+63&-64)>>3;for(const[a,u]of t.fields.entries()){const c=e[a];(!c||c.length!==n)&&(r[a]=u.clone({nullable:!0}),s[a]=(i=c==null?void 0:c._changeLengthAndBackfillNullBitmap(n))!==null&&i!==void 0?i:ce({type:u.type,length:n,nullCount:n,nullBitmap:new Uint8Array(o)}))}return[t.assign(r),ce({type:new Xi(r),length:n,children:s})]}function CW(t,e,n=new Map){var i,r;if(((i=t==null?void 0:t.length)!==null&&i!==void 0?i:0)>0&&(t==null?void 0:t.length)===(e==null?void 0:e.length))for(let s=-1,o=t.length;++s<o;){const{type:a}=t[s],u=e[s];for(const c of[u,...((r=u==null?void 0:u.dictionary)===null||r===void 0?void 0:r.data)||[]])CW(a.children,c==null?void 0:c.children,n);if(At.isDictionary(a)){const{id:c}=a;if(!n.has(c))u!=null&&u.dictionary&&n.set(c,u.dictionary);else if(n.get(c)!==u.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return n}class dD extends _r{constructor(e){const n=e.fields.map(r=>ce({type:r.type})),i=ce({type:new Xi(e.fields),nullCount:0,children:n});super(e,i)}}var M_;(function(t){t[t.BUFFER=0]="BUFFER"})(M_||(M_={}));var T_;(function(t){t[t.LZ4_FRAME=0]="LZ4_FRAME",t[t.ZSTD=1]="ZSTD"})(T_||(T_={}));class Wc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBodyCompression(e,n){return(n||new Wc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,n){return e.setPosition(e.position()+yt),(n||new Wc).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):T_.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):M_.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,n){e.addFieldInt8(0,n,T_.LZ4_FRAME)}static addMethod(e,n){e.addFieldInt8(1,n,M_.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,n,i){return Wc.startBodyCompression(e),Wc.addCodec(e,n),Wc.addMethod(e,i),Wc.endBodyCompression(e)}}let NW=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,n,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(n??0)),e.offset()}},OW=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,n,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(n??0)),e.offset()}},ku=class RM{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsRecordBatch(e,n){return(n||new RM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,n){return e.setPosition(e.position()+yt),(n||new RM).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,n){const i=this.bb.__offset(this.bb_pos,6);return i?(n||new OW).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,n){const i=this.bb.__offset(this.bb_pos,8);return i?(n||new NW).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new Wc).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addNodes(e,n){e.addFieldOffset(1,n,0)}static startNodesVector(e,n){e.startVector(16,n,8)}static addBuffers(e,n){e.addFieldOffset(2,n,0)}static startBuffersVector(e,n){e.startVector(16,n,8)}static addCompression(e,n){e.addFieldOffset(3,n,0)}static endRecordBatch(e){return e.endObject()}},Ip=class LM{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryBatch(e,n){return(n||new LM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,n){return e.setPosition(e.position()+yt),(n||new LM).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new ku).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addData(e,n){e.addFieldOffset(1,n,0)}static addIsDelta(e,n){e.addFieldInt8(2,+n,0)}static endDictionaryBatch(e){return e.endObject()}};var F_;(function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"})(F_||(F_={}));let Nc=class Jo{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMessage(e,n){return(n||new Jo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,n){return e.setPosition(e.position()+yt),(n||new Jo).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xg.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):F_.NONE}header(e){const n=this.bb.__offset(this.bb_pos,8);return n?this.bb.__union(e,this.bb_pos+n):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,n){const i=this.bb.__offset(this.bb_pos,12);return i?(n||new Ln).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,xg.V1)}static addHeaderType(e,n){e.addFieldInt8(1,n,F_.NONE)}static addHeader(e,n){e.addFieldOffset(2,n,0)}static addBodyLength(e,n){e.addFieldInt64(3,n,BigInt("0"))}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let i=n.length-1;i>=0;i--)e.addOffset(n[i]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,n){e.finish(n)}static finishSizePrefixedMessageBuffer(e,n){e.finish(n,void 0,!0)}static createMessage(e,n,i,r,s,o){return Jo.startMessage(e),Jo.addVersion(e,n),Jo.addHeaderType(e,i),Jo.addHeader(e,r),Jo.addBodyLength(e,s),Jo.addCustomMetadata(e,o),Jo.endMessage(e)}};class qgt extends te{visit(e,n){return e==null||n==null?void 0:super.visit(e,n)}visitNull(e,n){return gd.startNull(n),gd.endNull(n)}visitInt(e,n){return Xr.startInt(n),Xr.addBitWidth(n,e.bitWidth),Xr.addIsSigned(n,e.isSigned),Xr.endInt(n)}visitFloat(e,n){return ga.startFloatingPoint(n),ga.addPrecision(n,e.precision),ga.endFloatingPoint(n)}visitBinary(e,n){return dd.startBinary(n),dd.endBinary(n)}visitBool(e,n){return hd.startBool(n),hd.endBool(n)}visitUtf8(e,n){return yd.startUtf8(n),yd.endUtf8(n)}visitDecimal(e,n){return vr.startDecimal(n),vr.addScale(n,e.scale),vr.addPrecision(n,e.precision),vr.addBitWidth(n,e.bitWidth),vr.endDecimal(n)}visitDate(e,n){return Ww.startDate(n),Ww.addUnit(n,e.unit),Ww.endDate(n)}visitTime(e,n){return J0.startTime(n),J0.addUnit(n,e.unit),J0.addBitWidth(n,e.bitWidth),J0.endTime(n)}visitTimestamp(e,n){const i=e.timezone&&n.createString(e.timezone)||void 0;return Ss.startTimestamp(n),Ss.addUnit(n,e.unit),i!==void 0&&Ss.addTimezone(n,i),Ss.endTimestamp(n)}visitInterval(e,n){return ma.startInterval(n),ma.addUnit(n,e.unit),ma.endInterval(n)}visitDuration(e,n){return da.startDuration(n),da.addUnit(n,e.unit),da.endDuration(n)}visitList(e,n){return pd.startList(n),pd.endList(n)}visitStruct(e,n){return md.startStruct_(n),md.endStruct_(n)}visitUnion(e,n){Jf.startTypeIdsVector(n,e.typeIds.length);const i=Jf.createTypeIdsVector(n,e.typeIds);return Jf.startUnion(n),Jf.addMode(n,e.mode),Jf.addTypeIds(n,i),Jf.endUnion(n)}visitDictionary(e,n){const i=this.visit(e.indices,n);return zu.startDictionaryEncoding(n),zu.addId(n,BigInt(e.id)),zu.addIsOrdered(n,e.isOrdered),i!==void 0&&zu.addIndexType(n,i),zu.endDictionaryEncoding(n)}visitFixedSizeBinary(e,n){return ha.startFixedSizeBinary(n),ha.addByteWidth(n,e.byteWidth),ha.endFixedSizeBinary(n)}visitFixedSizeList(e,n){return pa.startFixedSizeList(n),pa.addListSize(n,e.listSize),pa.endFixedSizeList(n)}visitMap(e,n){return Gw.startMap(n),Gw.addKeysSorted(n,e.keysSorted),Gw.endMap(n)}}const Z$=new qgt;function Vgt(t,e=new Map){return new Fe(Ggt(t,e),Xw(t.metadata),e)}function RW(t){return new ss(t.count,LW(t.columns),BW(t.columns))}function Wgt(t){return new Oa(RW(t.data),t.id,t.isDelta)}function Ggt(t,e){return(t.fields||[]).filter(Boolean).map(n=>Sn.fromJSON(n,e))}function T5(t,e){return(t.children||[]).filter(Boolean).map(n=>Sn.fromJSON(n,e))}function LW(t){return(t||[]).reduce((e,n)=>[...e,new Fl(n.count,Ygt(n.VALIDITY)),...LW(n.children)],[])}function BW(t,e=[]){for(let n=-1,i=(t||[]).length;++n<i;){const r=t[n];r.VALIDITY&&e.push(new _a(e.length,r.VALIDITY.length)),r.TYPE_ID&&e.push(new _a(e.length,r.TYPE_ID.length)),r.OFFSET&&e.push(new _a(e.length,r.OFFSET.length)),r.DATA&&e.push(new _a(e.length,r.DATA.length)),e=BW(r.children,e)}return e}function Ygt(t){return(t||[]).reduce((e,n)=>e+ +(n===0),0)}function Hgt(t,e){let n,i,r,s,o,a;return!e||!(s=t.dictionary)?(o=k5(t,T5(t,e)),r=new Sn(t.name,o,t.nullable,Xw(t.metadata))):e.has(n=s.id)?(i=(i=s.indexType)?F5(i):new s1,a=new _g(e.get(n),i,n,s.isOrdered),r=new Sn(t.name,a,t.nullable,Xw(t.metadata))):(i=(i=s.indexType)?F5(i):new s1,e.set(n,o=k5(t,T5(t,e))),a=new _g(o,i,n,s.isOrdered),r=new Sn(t.name,a,t.nullable,Xw(t.metadata))),r||null}function Xw(t=[]){return new Map(t.map(({key:e,value:n})=>[e,n]))}function F5(t){return new $l(t.isSigned,t.bitWidth)}function k5(t,e){const n=t.type.name;switch(n){case"NONE":return new Al;case"null":return new Al;case"binary":return new r_;case"utf8":return new s_;case"bool":return new o_;case"list":return new d_((e||[])[0]);case"struct":return new Xi(e||[]);case"struct_":return new Xi(e||[])}switch(n){case"int":{const i=t.type;return new $l(i.isSigned,i.bitWidth)}case"floatingpoint":{const i=t.type;return new o1(Ir[i.precision])}case"decimal":{const i=t.type;return new a_(i.scale,i.precision,i.bitWidth)}case"date":{const i=t.type;return new u_(rc[i.unit])}case"time":{const i=t.type;return new a1(Ht[i.unit],i.bitWidth)}case"timestamp":{const i=t.type;return new c_(Ht[i.unit],i.timezone)}case"interval":{const i=t.type;return new l_(El[i.unit])}case"duration":{const i=t.type;return new f_(Ht[i.unit])}case"union":{const i=t.type,[r,...s]=(i.mode+"").toLowerCase(),o=r.toUpperCase()+s.join("");return new h_(rr[o],i.typeIds||[],e||[])}case"fixedsizebinary":{const i=t.type;return new p_(i.byteWidth)}case"fixedsizelist":{const i=t.type;return new g_(i.listSize,(e||[])[0])}case"map":{const i=t.type;return new m_((e||[])[0],i.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var Xgt=zS,Kgt=Da;class Ki{static fromJSON(e,n){const i=new Ki(0,li.V5,n);return i._createHeader=Jgt(e,n),i}static decode(e){e=new Kgt(Ee(e));const n=Nc.getRootAsMessage(e),i=n.bodyLength(),r=n.version(),s=n.headerType(),o=new Ki(i,r,s);return o._createHeader=Qgt(n,s),o}static encode(e){const n=new Xgt;let i=-1;return e.isSchema()?i=Fe.encode(n,e.header()):e.isRecordBatch()?i=ss.encode(n,e.header()):e.isDictionaryBatch()&&(i=Oa.encode(n,e.header())),Nc.startMessage(n),Nc.addVersion(n,li.V5),Nc.addHeader(n,i),Nc.addHeaderType(n,e.headerType),Nc.addBodyLength(n,BigInt(e.bodyLength)),Nc.finishMessageBuffer(n,Nc.endMessage(n)),n.asUint8Array()}static from(e,n=0){if(e instanceof Fe)return new Ki(0,li.V5,Te.Schema,e);if(e instanceof ss)return new Ki(n,li.V5,Te.RecordBatch,e);if(e instanceof Oa)return new Ki(n,li.V5,Te.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Te.Schema}isRecordBatch(){return this.headerType===Te.RecordBatch}isDictionaryBatch(){return this.headerType===Te.DictionaryBatch}constructor(e,n,i,r){this._version=n,this._headerType=i,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength=Io(e)}}class ss{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,n,i){this._nodes=n,this._buffers=i,this._length=Io(e)}}class Oa{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,n,i=!1){this._data=e,this._isDelta=i,this._id=Io(n)}}class _a{constructor(e,n){this.offset=Io(e),this.length=Io(n)}}class Fl{constructor(e,n){this.length=Io(e),this.nullCount=Io(n)}}function Jgt(t,e){return()=>{switch(e){case Te.Schema:return Fe.fromJSON(t);case Te.RecordBatch:return ss.fromJSON(t);case Te.DictionaryBatch:return Oa.fromJSON(t)}throw new Error(`Unrecognized Message type: { name: ${Te[e]}, type: ${e} }`)}}function Qgt(t,e){return()=>{switch(e){case Te.Schema:return Fe.decode(t.header(new ea),new Map,t.version());case Te.RecordBatch:return ss.decode(t.header(new ku),t.version());case Te.DictionaryBatch:return Oa.decode(t.header(new Ip),t.version())}throw new Error(`Unrecognized Message type: { name: ${Te[e]}, type: ${e} }`)}}Sn.encode=cmt;Sn.decode=amt;Sn.fromJSON=Hgt;Fe.encode=umt;Fe.decode=Zgt;Fe.fromJSON=Vgt;ss.encode=lmt;ss.decode=tmt;ss.fromJSON=RW;Oa.encode=fmt;Oa.decode=emt;Oa.fromJSON=Wgt;Fl.encode=dmt;Fl.decode=imt;_a.encode=hmt;_a.decode=nmt;function Zgt(t,e=new Map,n=li.V5){const i=omt(t,e);return new Fe(i,Kw(t),e,n)}function tmt(t,e=li.V5){if(t.compression()!==null)throw new Error("Record batch compression not implemented");return new ss(t.length(),rmt(t),smt(t,e))}function emt(t,e=li.V5){return new Oa(ss.decode(t.data(),e),t.id(),t.isDelta())}function nmt(t){return new _a(t.offset(),t.length())}function imt(t){return new Fl(t.length(),t.nullCount())}function rmt(t){const e=[];for(let n,i=-1,r=-1,s=t.nodesLength();++i<s;)(n=t.nodes(i))&&(e[++r]=Fl.decode(n));return e}function smt(t,e){const n=[];for(let i,r=-1,s=-1,o=t.buffersLength();++r<o;)(i=t.buffers(r))&&(e<li.V4&&(i.bb_pos+=8*(r+1)),n[++s]=_a.decode(i));return n}function omt(t,e){const n=[];for(let i,r=-1,s=-1,o=t.fieldsLength();++r<o;)(i=t.fields(r))&&(n[++s]=Sn.decode(i,e));return n}function D5(t,e){const n=[];for(let i,r=-1,s=-1,o=t.childrenLength();++r<o;)(i=t.children(r))&&(n[++s]=Sn.decode(i,e));return n}function amt(t,e){let n,i,r,s,o,a;return!e||!(a=t.dictionary())?(r=N5(t,D5(t,e)),i=new Sn(t.name(),r,t.nullable(),Kw(t))):e.has(n=Io(a.id()))?(s=(s=a.indexType())?C5(s):new s1,o=new _g(e.get(n),s,n,a.isOrdered()),i=new Sn(t.name(),o,t.nullable(),Kw(t))):(s=(s=a.indexType())?C5(s):new s1,e.set(n,r=N5(t,D5(t,e))),o=new _g(r,s,n,a.isOrdered()),i=new Sn(t.name(),o,t.nullable(),Kw(t))),i||null}function Kw(t){const e=new Map;if(t)for(let n,i,r=-1,s=Math.trunc(t.customMetadataLength());++r<s;)(n=t.customMetadata(r))&&(i=n.key())!=null&&e.set(i,n.value());return e}function C5(t){return new $l(t.isSigned(),t.bitWidth())}function N5(t,e){const n=t.typeType();switch(n){case nn.NONE:return new Al;case nn.Null:return new Al;case nn.Binary:return new r_;case nn.Utf8:return new s_;case nn.Bool:return new o_;case nn.List:return new d_((e||[])[0]);case nn.Struct_:return new Xi(e||[])}switch(n){case nn.Int:{const i=t.type(new Xr);return new $l(i.isSigned(),i.bitWidth())}case nn.FloatingPoint:{const i=t.type(new ga);return new o1(i.precision())}case nn.Decimal:{const i=t.type(new vr);return new a_(i.scale(),i.precision(),i.bitWidth())}case nn.Date:{const i=t.type(new Ww);return new u_(i.unit())}case nn.Time:{const i=t.type(new J0);return new a1(i.unit(),i.bitWidth())}case nn.Timestamp:{const i=t.type(new Ss);return new c_(i.unit(),i.timezone())}case nn.Interval:{const i=t.type(new ma);return new l_(i.unit())}case nn.Duration:{const i=t.type(new da);return new f_(i.unit())}case nn.Union:{const i=t.type(new Jf);return new h_(i.mode(),i.typeIdsArray()||[],e||[])}case nn.FixedSizeBinary:{const i=t.type(new ha);return new p_(i.byteWidth())}case nn.FixedSizeList:{const i=t.type(new pa);return new g_(i.listSize(),(e||[])[0])}case nn.Map:{const i=t.type(new Gw);return new m_((e||[])[0],i.keysSorted())}}throw new Error(`Unrecognized type: "${nn[n]}" (${n})`)}function umt(t,e){const n=e.fields.map(s=>Sn.encode(t,s));ea.startFieldsVector(t,n.length);const i=ea.createFieldsVector(t,n),r=e.metadata&&e.metadata.size>0?ea.createCustomMetadataVector(t,[...e.metadata].map(([s,o])=>{const a=t.createString(`${s}`),u=t.createString(`${o}`);return Ln.startKeyValue(t),Ln.addKey(t,a),Ln.addValue(t,u),Ln.endKeyValue(t)})):-1;return ea.startSchema(t),ea.addFields(t,i),ea.addEndianness(t,pmt?Sg.Little:Sg.Big),r!==-1&&ea.addCustomMetadata(t,r),ea.endSchema(t)}function cmt(t,e){let n=-1,i=-1,r=-1;const s=e.type;let o=e.typeId;At.isDictionary(s)?(o=s.dictionary.typeId,r=Z$.visit(s,t),i=Z$.visit(s.dictionary,t)):i=Z$.visit(s,t);const a=(s.children||[]).map(l=>Sn.encode(t,l)),u=ws.createChildrenVector(t,a),c=e.metadata&&e.metadata.size>0?ws.createCustomMetadataVector(t,[...e.metadata].map(([l,f])=>{const d=t.createString(`${l}`),h=t.createString(`${f}`);return Ln.startKeyValue(t),Ln.addKey(t,d),Ln.addValue(t,h),Ln.endKeyValue(t)})):-1;return e.name&&(n=t.createString(e.name)),ws.startField(t),ws.addType(t,i),ws.addTypeType(t,o),ws.addChildren(t,u),ws.addNullable(t,!!e.nullable),n!==-1&&ws.addName(t,n),r!==-1&&ws.addDictionary(t,r),c!==-1&&ws.addCustomMetadata(t,c),ws.endField(t)}function lmt(t,e){const n=e.nodes||[],i=e.buffers||[];ku.startNodesVector(t,n.length);for(const o of n.slice().reverse())Fl.encode(t,o);const r=t.endVector();ku.startBuffersVector(t,i.length);for(const o of i.slice().reverse())_a.encode(t,o);const s=t.endVector();return ku.startRecordBatch(t),ku.addLength(t,BigInt(e.length)),ku.addNodes(t,r),ku.addBuffers(t,s),ku.endRecordBatch(t)}function fmt(t,e){const n=ss.encode(t,e.data);return Ip.startDictionaryBatch(t),Ip.addId(t,BigInt(e.id)),Ip.addIsDelta(t,e.isDelta),Ip.addData(t,n),Ip.endDictionaryBatch(t)}function dmt(t,e){return OW.createFieldNode(t,BigInt(e.length),BigInt(e.nullCount))}function hmt(t,e){return NW.createBuffer(t,BigInt(e.offset),BigInt(e.length))}const pmt=(()=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),new Int16Array(t)[0]===256})(),hD=t=>`Expected ${Te[t]} Message in stream, but was null or length 0.`,pD=t=>`Header pointer of flatbuffer-encoded ${Te[t]} Message is null or length 0.`,PW=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,zW=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`;class UW{constructor(e){this.source=e instanceof $_?e:new $_(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?pn:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(hD(e));return n.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const n=Ee(this.source.read(e));if(n.byteLength<e)throw new Error(zW(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()}readSchema(e=!1){const n=Te.Schema,i=this.readMessage(n),r=i==null?void 0:i.header();if(e&&!r)throw new Error(pD(n));return r}readMetadataLength(){const e=this.source.read(KS),n=e&&new Da(e),i=(n==null?void 0:n.readInt32(0))||0;return{done:i===0,value:i}}readMetadata(e){const n=this.source.read(e);if(!n)return pn;if(n.byteLength<e)throw new Error(PW(e,n.byteLength));return{done:!1,value:Ki.decode(n)}}}class gmt{constructor(e,n){this.source=e instanceof Eg?e:eV(e)?new I_(e,n):new Eg(e)}[Symbol.asyncIterator](){return this}next(){return Z(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?pn:e})}throw(e){return Z(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return Z(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return Z(this,void 0,void 0,function*(){let n;if((n=yield this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(hD(e));return n.value})}readMessageBody(e){return Z(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const n=Ee(yield this.source.read(e));if(n.byteLength<e)throw new Error(zW(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()})}readSchema(e=!1){return Z(this,void 0,void 0,function*(){const n=Te.Schema,i=yield this.readMessage(n),r=i==null?void 0:i.header();if(e&&!r)throw new Error(pD(n));return r})}readMetadataLength(){return Z(this,void 0,void 0,function*(){const e=yield this.source.read(KS),n=e&&new Da(e),i=(n==null?void 0:n.readInt32(0))||0;return{done:i===0,value:i}})}readMetadata(e){return Z(this,void 0,void 0,function*(){const n=yield this.source.read(e);if(!n)return pn;if(n.byteLength<e)throw new Error(PW(e,n.byteLength));return{done:!1,value:Ki.decode(n)}})}}class mmt extends UW{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof $5?e:new $5(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:Ki.fromJSON(e.schema,Te.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const n=e.dictionaries[this._dictionaryIndex++];return this._body=n.data.columns,{done:!1,value:Ki.fromJSON(n,Te.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const n=e.batches[this._batchIndex++];return this._body=n.columns,{done:!1,value:Ki.fromJSON(n,Te.RecordBatch)}}return this._body=[],pn}readMessageBody(e){return n(this._body);function n(i){return(i||[]).reduce((r,s)=>[...r,...s.VALIDITY&&[s.VALIDITY]||[],...s.TYPE_ID&&[s.TYPE_ID]||[],...s.OFFSET&&[s.OFFSET]||[],...s.DATA&&[s.DATA]||[],...n(s.children)],[])}}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(hD(e));return n.value}readSchema(){const e=Te.Schema,n=this.readMessage(e),i=n==null?void 0:n.header();if(!n||!i)throw new Error(pD(e));return i}}const KS=4,BM="ARROW1",c1=new Uint8Array(BM.length);for(let t=0;t<BM.length;t+=1)c1[t]=BM.codePointAt(t);function gD(t,e=0){for(let n=-1,i=c1.length;++n<i;)if(c1[n]!==t[e+n])return!1;return!0}const hb=c1.length,jW=hb+KS,ymt=hb*2+KS;class Ds extends aD{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const n=this._impl.open(e);return Bd(n)?n.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return xs.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return xs.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof Ds?e:TM(e)?_mt(e):eV(e)?Emt(e):Bd(e)?Z(this,void 0,void 0,function*(){return yield Ds.from(yield e)}):nV(e)||Xk(e)||iV(e)||mm(e)?Smt(new Eg(e)):xmt(new $_(e))}static readAll(e){return e instanceof Ds?e.isSync()?O5(e):R5(e):TM(e)||ArrayBuffer.isView(e)||ub(e)||tV(e)?O5(e):R5(e)}}class k_ extends Ds{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Nn(this,arguments,function*(){yield rt(yield*hl(ns(this[Symbol.iterator]())))})}}class D_ extends Ds{constructor(e){super(e),this._impl=e}readAll(){var e,n,i,r;return Z(this,void 0,void 0,function*(){const s=new Array;try{for(var o=!0,a=ns(this),u;u=yield a.next(),e=u.done,!e;o=!0){r=u.value,o=!1;const c=r;s.push(c)}}catch(c){n={error:c}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return s})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class qW extends k_{constructor(e){super(e),this._impl=e}}class bmt extends D_{constructor(e){super(e),this._impl=e}}class VW{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,n){const i=this._loadVectors(e,n,this.schema.fields),r=ce({type:new Xi(this.schema.fields),length:e.length,children:i});return new _r(this.schema,r)}_loadDictionaryBatch(e,n){const{id:i,isDelta:r}=e,{dictionaries:s,schema:o}=this,a=s.get(i);if(r||!a){const u=o.dictionaries.get(i),c=this._loadVectors(e.data,n,[u]);return(a&&r?a.concat(new hn(c)):new hn(c)).memoize()}return a.memoize()}_loadVectors(e,n,i){return new FW(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}class C_ extends VW{constructor(e,n){super(n),this._reader=TM(e)?new mmt(this._handle=e):new UW(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=GW(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):pn}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):pn}next(){if(this.closed)return pn;let e;const{_reader:n}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),r=n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),r=n.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(i,r);this.dictionaries.set(i.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new dD(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class N_ extends VW{constructor(e,n){super(n),this._reader=new gmt(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Z(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return Z(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=GW(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return Z(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):pn})}return(e){return Z(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):pn})}next(){return Z(this,void 0,void 0,function*(){if(this.closed)return pn;let e;const{_reader:n}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),r=yield n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),r=yield n.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(i,r);this.dictionaries.set(i.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new dD(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return Z(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class WW extends C_{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,n){super(e instanceof I5?e:new I5(e),n)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var n;if(this.closed)return null;this._footer||this.open();const i=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(i&&this._handle.seek(i.offset)){const r=this._reader.readMessage(Te.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),o=this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,o)}}return null}_readDictionaryBatch(e){var n;const i=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(i&&this._handle.seek(i.offset)){const r=this._reader.readMessage(Te.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),o=this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}}_readFooter(){const{_handle:e}=this,n=e.size-jW,i=e.readInt32(n),r=e.readAt(n-i,i);return u1.decode(r)}_readNextMessageAndValidate(e){var n;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const i=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(this._recordBatchIndex);if(i&&this._handle.seek(i.offset))return this._reader.readMessage(e)}return null}}class vmt extends N_{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...n){const i=typeof n[0]!="number"?n.shift():void 0,r=n[0]instanceof Map?n.shift():void 0;super(e instanceof I_?e:new I_(e,i),r)}isFile(){return!0}isAsync(){return!0}open(e){const n=Object.create(null,{open:{get:()=>super.open}});return Z(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const i of this._footer.dictionaryBatches())i&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield n.open.call(this,e)})}readRecordBatch(e){var n;return Z(this,void 0,void 0,function*(){if(this.closed)return null;this._footer||(yield this.open());const i=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(i&&(yield this._handle.seek(i.offset))){const r=yield this._reader.readMessage(Te.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),o=yield this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,o)}}return null})}_readDictionaryBatch(e){var n;return Z(this,void 0,void 0,function*(){const i=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(i&&(yield this._handle.seek(i.offset))){const r=yield this._reader.readMessage(Te.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),o=yield this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}})}_readFooter(){return Z(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const n=e.size-jW,i=yield e.readInt32(n),r=yield e.readAt(n-i,i);return u1.decode(r)})}_readNextMessageAndValidate(e){return Z(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=this._footer.getRecordBatch(this._recordBatchIndex);if(n&&(yield this._handle.seek(n.offset)))return yield this._reader.readMessage(e)}return null})}}class wmt extends C_{constructor(e,n){super(e,n)}_loadVectors(e,n,i){return new Cgt(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}function GW(t,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:t.autoDestroy}function*O5(t){const e=Ds.from(t);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function R5(t){return Nn(this,arguments,function*(){const n=yield rt(Ds.from(t));try{if(!(yield rt(n.open({autoDestroy:!1}))).closed)do yield yield rt(n);while(!(yield rt(n.reset().open())).closed)}finally{yield rt(n.cancel())}})}function _mt(t){return new k_(new wmt(t))}function xmt(t){const e=t.peek(hb+7&-8);return e&&e.byteLength>=4?gD(e)?new qW(new WW(t.read())):new k_(new C_(t)):new k_(new C_(function*(){}()))}function Smt(t){return Z(this,void 0,void 0,function*(){const e=yield t.peek(hb+7&-8);return e&&e.byteLength>=4?gD(e)?new qW(new WW(yield t.read())):new D_(new N_(t)):new D_(new N_(function(){return Nn(this,arguments,function*(){})}()))})}function Emt(t){return Z(this,void 0,void 0,function*(){const{size:e}=yield t.stat(),n=new I_(t,e);return e>=ymt&&gD(yield n.readAt(0,hb+7&-8))?new bmt(new vmt(n)):new D_(new N_(n))})}class Mn extends te{static assemble(...e){const n=r=>r.flatMap(s=>Array.isArray(s)?n(s):s instanceof _r?s.data.children:s.data),i=new Mn;return i.visitMany(n(e)),i}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof hn)return this.visitMany(e.data),this;const{type:n}=e;if(!At.isDictionary(n)){const{length:i}=e;if(i>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(At.isUnion(n))this.nodes.push(new Fl(i,0));else{const{nullCount:r}=e;At.isNull(n)||vo.call(this,r<=0?new Uint8Array(0):y_(e.offset,i,e.nullBitmap)),this.nodes.push(new Fl(i,r))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function vo(t){const e=t.byteLength+7&-8;return this.buffers.push(t),this.bufferRegions.push(new _a(this._byteLength,e)),this._byteLength+=e,this}function Amt(t){var e;const{type:n,length:i,typeIds:r,valueOffsets:s}=t;if(vo.call(this,r),n.mode===rr.Sparse)return PM.call(this,t);if(n.mode===rr.Dense){if(t.offset<=0)return vo.call(this,s),PM.call(this,t);{const o=new Int32Array(i),a=Object.create(null),u=Object.create(null);for(let c,l,f=-1;++f<i;)(c=r[f])!==void 0&&((l=a[c])===void 0&&(l=a[c]=s[f]),o[f]=s[f]-l,u[c]=((e=u[c])!==null&&e!==void 0?e:0)+1);vo.call(this,o),this.visitMany(t.children.map((c,l)=>{const f=n.typeIds[l],d=a[f],h=u[f];return c.slice(d,Math.min(i,h))}))}}return this}function $mt(t){let e;return t.nullCount>=t.length?vo.call(this,new Uint8Array(0)):(e=t.values)instanceof Uint8Array?vo.call(this,y_(t.offset,t.length,e)):vo.call(this,b_(t.values))}function yc(t){return vo.call(this,t.values.subarray(0,t.length*t.stride))}function YW(t){const{length:e,values:n,valueOffsets:i}=t,{[0]:r,[e]:s}=i,o=Math.min(s-r,n.byteLength-r);return vo.call(this,sV(-r,e+1,i)),vo.call(this,n.subarray(r,r+o)),this}function mD(t){const{length:e,valueOffsets:n}=t;if(n){const{[0]:i,[e]:r}=n;return vo.call(this,sV(-i,e+1,n)),this.visit(t.children[0].slice(i,r-i))}return this.visit(t.children[0])}function PM(t){return this.visitMany(t.type.children.map((e,n)=>t.children[n]).filter(Boolean))[0]}Mn.prototype.visitBool=$mt;Mn.prototype.visitInt=yc;Mn.prototype.visitFloat=yc;Mn.prototype.visitUtf8=YW;Mn.prototype.visitBinary=YW;Mn.prototype.visitFixedSizeBinary=yc;Mn.prototype.visitDate=yc;Mn.prototype.visitTimestamp=yc;Mn.prototype.visitTime=yc;Mn.prototype.visitDecimal=yc;Mn.prototype.visitList=mD;Mn.prototype.visitStruct=PM;Mn.prototype.visitUnion=Amt;Mn.prototype.visitInterval=yc;Mn.prototype.visitDuration=yc;Mn.prototype.visitFixedSizeList=mD;Mn.prototype.visitMap=mD;class HW extends aD{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new Hw,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,Dr(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof e.autoDestroy=="boolean"?e.autoDestroy:!0,this._writeLegacyIpcFormat=typeof e.writeLegacyIpcFormat=="boolean"?e.writeLegacyIpcFormat:!1}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return Bd(e)?e.then(n=>this.writeAll(n)):mm(e)?wD(this,e):vD(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,n=null){return e===this._sink||e instanceof Hw?this._sink=e:(this._sink=new Hw,e&&Vht(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&Wht(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,(!n||!OM(n,this._schema))&&(n==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=n,this._writeSchema(n))),this}write(e){let n=null;if(this._sink){if(e==null)return this.finish()&&void 0;if(e instanceof Vi&&!(n=e.schema))return this.finish()&&void 0;if(e instanceof _r&&!(n=e.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(n&&!OM(n,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,n)}e instanceof _r?e instanceof dD||this._writeRecordBatch(e):e instanceof Vi?this.writeAll(e.batches):ub(e)&&this.writeAll(e)}_writeMessage(e,n=8){const i=n-1,r=Ki.encode(e),s=r.byteLength,o=this._writeLegacyIpcFormat?4:8,a=s+o+i&~i,u=a-s-o;return e.headerType===Te.RecordBatch?this._recordBatchBlocks.push(new Ml(a,e.bodyLength,this._position)):e.headerType===Te.DictionaryBatch&&this._dictionaryBlocks.push(new Ml(a,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-o)),s>0&&this._write(r),this._writePadding(u)}_write(e){if(this._started){const n=Ee(e);n&&n.byteLength>0&&(this._sink.write(n),this._position+=n.byteLength)}return this}_writeSchema(e){return this._writeMessage(Ki.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(c1)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:n,nodes:i,bufferRegions:r,buffers:s}=Mn.assemble(e),o=new ss(e.numRows,i,r),a=Ki.from(o,n);return this._writeDictionaries(e)._writeMessage(a)._writeBodyBuffers(s)}_writeDictionaryBatch(e,n,i=!1){this._dictionaryDeltaOffsets.set(n,e.length+(this._dictionaryDeltaOffsets.get(n)||0));const{byteLength:r,nodes:s,bufferRegions:o,buffers:a}=Mn.assemble(new hn([e])),u=new ss(e.length,s,o),c=new Oa(u,n,i),l=Ki.from(c,r);return this._writeMessage(l)._writeBodyBuffers(a)}_writeBodyBuffers(e){let n,i,r;for(let s=-1,o=e.length;++s<o;)(n=e[s])&&(i=n.byteLength)>0&&(this._write(n),(r=(i+7&-8)-i)>0&&this._writePadding(r));return this}_writeDictionaries(e){for(let[n,i]of e.dictionaries){let r=this._dictionaryDeltaOffsets.get(n)||0;if(r===0||(i=i==null?void 0:i.slice(r)).length>0)for(const s of i.data)this._writeDictionaryBatch(s,n,r>0),r+=s.length}return this}}class yD extends HW{static writeAll(e,n){const i=new yD(n);return Bd(e)?e.then(r=>i.writeAll(r)):mm(e)?wD(i,e):vD(i,e)}}class bD extends HW{static writeAll(e){const n=new bD;return Bd(e)?e.then(i=>n.writeAll(i)):mm(e)?wD(n,e):vD(n,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeFooter(e){const n=u1.encode(new u1(e,li.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(n)._write(Int32Array.of(n.byteLength))._writeMagic()}}function vD(t,e){let n=e;e instanceof Vi&&(n=e.batches,t.reset(void 0,e.schema));for(const i of n)t.write(i);return t.finish()}function wD(t,e){var n,i,r,s,o,a,u;return Z(this,void 0,void 0,function*(){try{for(n=!0,i=ns(e);r=yield i.next(),s=r.done,!s;n=!0){u=r.value,n=!1;const c=u;t.write(c)}}catch(c){o={error:c}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return t.finish()})}function Imt(t,e="stream"){return(e==="stream"?yD:bD).writeAll(t).toUint8Array(!0)}var Mmt=Object.create,XW=Object.defineProperty,Tmt=Object.getOwnPropertyDescriptor,Fmt=Object.getOwnPropertyNames,kmt=Object.getPrototypeOf,Dmt=Object.prototype.hasOwnProperty,Cmt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Nmt=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Fmt(e))!Dmt.call(t,r)&&r!==n&&XW(t,r,{get:()=>e[r],enumerable:!(i=Tmt(e,r))||i.enumerable});return t},Omt=(t,e,n)=>(n=t!=null?Mmt(kmt(t)):{},Nmt(e||!t||!t.__esModule?XW(n,"default",{value:t,enumerable:!0}):n,t)),Rmt=Cmt((t,e)=>{e.exports=Worker}),Lmt=(t=>(t[t.UNDEFINED=0]="UNDEFINED",t[t.AUTOMATIC=1]="AUTOMATIC",t[t.READ_ONLY=2]="READ_ONLY",t[t.READ_WRITE=3]="READ_WRITE",t))(Lmt||{}),Bmt=(t=>(t[t.IDENTIFIER=0]="IDENTIFIER",t[t.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",t[t.STRING_CONSTANT=2]="STRING_CONSTANT",t[t.OPERATOR=3]="OPERATOR",t[t.KEYWORD=4]="KEYWORD",t[t.COMMENT=5]="COMMENT",t))(Bmt||{}),Pmt=(t=>(t[t.NONE=0]="NONE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARNING=3]="WARNING",t[t.ERROR=4]="ERROR",t))(Pmt||{}),zmt=(t=>(t[t.NONE=0]="NONE",t[t.CONNECT=1]="CONNECT",t[t.DISCONNECT=2]="DISCONNECT",t[t.OPEN=3]="OPEN",t[t.QUERY=4]="QUERY",t[t.INSTANTIATE=5]="INSTANTIATE",t))(zmt||{}),Umt=(t=>(t[t.NONE=0]="NONE",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR",t[t.START=3]="START",t[t.RUN=4]="RUN",t[t.CAPTURE=5]="CAPTURE",t))(Umt||{}),jmt=(t=>(t[t.NONE=0]="NONE",t[t.WEB_WORKER=1]="WEB_WORKER",t[t.NODE_WORKER=2]="NODE_WORKER",t[t.BINDINGS=3]="BINDINGS",t[t.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",t))(jmt||{}),qmt=class{log(e){}},Vmt=class{constructor(t=2){this.level=t}log(t){t.level>=this.level&&console.log(t)}},Wmt=(t=>(t[t.SUCCESS=0]="SUCCESS",t))(Wmt||{}),Gmt=class{constructor(e,n){this._bindings=e,this._conn=n}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.runQuery(this._conn,e),i=Ds.from(n);return console.assert(i.isSync(),"Reader is not sync"),console.assert(i.isFile(),"Reader is not file"),new Vi(i)}async send(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.startPendingQuery(this._conn,e);for(;n==null;)n=await this._bindings.pollPendingQuery(this._conn);let i=new KW(this._bindings,this._conn,n),r=await Ds.from(i);return console.assert(r.isAsync()),console.assert(r.isStream()),r}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let n=await this._bindings.createPrepared(this._conn,e);return new Ymt(this._bindings,this._conn,n)}async insertArrowTable(e,n){let i=Imt(e,"stream");await this.insertArrowFromIPCStream(i,n)}async insertArrowFromIPCStream(e,n){await this._bindings.insertArrowFromIPCStream(this._conn,e,n)}async insertCSVFromPath(e,n){await this._bindings.insertCSVFromPath(this._conn,e,n)}async insertJSONFromPath(e,n){await this._bindings.insertJSONFromPath(this._conn,e,n)}},KW=class{constructor(t,e,n){this.db=t,this.conn=e,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let t;return this._inFlight!=null?(t=await this._inFlight,this._inFlight=null):t=await this.db.fetchQueryResults(this.conn),this._depleted=t.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:t}}[Symbol.asyncIterator](){return this}},Ymt=class{constructor(e,n,i){this.bindings=e,this.connectionId=n,this.statementId=i}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let n=await this.bindings.runPrepared(this.connectionId,this.statementId,e),i=Ds.from(n);return console.assert(i.isSync()),console.assert(i.isFile()),new Vi(i)}async send(...e){let n=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),i=new KW(this.bindings,this.connectionId,n),r=await Ds.from(i);return console.assert(r.isAsync()),console.assert(r.isStream()),r}},Hmt=(t=>(t.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",t.CLOSE_PREPARED="CLOSE_PREPARED",t.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",t.CONNECT="CONNECT",t.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",t.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",t.CREATE_PREPARED="CREATE_PREPARED",t.DISCONNECT="DISCONNECT",t.DROP_FILE="DROP_FILE",t.DROP_FILES="DROP_FILES",t.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",t.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",t.FLUSH_FILES="FLUSH_FILES",t.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",t.GET_TABLE_NAMES="GET_TABLE_NAMES",t.GET_VERSION="GET_VERSION",t.GLOB_FILE_INFOS="GLOB_FILE_INFOS",t.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",t.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",t.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",t.INSTANTIATE="INSTANTIATE",t.OPEN="OPEN",t.PING="PING",t.POLL_PENDING_QUERY="POLL_PENDING_QUERY",t.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",t.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",t.REGISTER_FILE_URL="REGISTER_FILE_URL",t.RESET="RESET",t.RUN_PREPARED="RUN_PREPARED",t.RUN_QUERY="RUN_QUERY",t.SEND_PREPARED="SEND_PREPARED",t.START_PENDING_QUERY="START_PENDING_QUERY",t.TOKENIZE="TOKENIZE",t))(Hmt||{}),Xmt=(t=>(t.CONNECTION_INFO="CONNECTION_INFO",t.ERROR="ERROR",t.FEATURE_FLAGS="FEATURE_FLAGS",t.FILE_BUFFER="FILE_BUFFER",t.FILE_INFOS="FILE_INFOS",t.FILE_SIZE="FILE_SIZE",t.FILE_STATISTICS="FILE_STATISTICS",t.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",t.LOG="LOG",t.OK="OK",t.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",t.QUERY_PLAN="QUERY_PLAN",t.QUERY_RESULT="QUERY_RESULT",t.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",t.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",t.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",t.REGISTERED_FILE="REGISTERED_FILE",t.SCRIPT_TOKENS="SCRIPT_TOKENS",t.SUCCESS="SUCCESS",t.TABLE_NAMES="TABLE_NAMES",t.VERSION_STRING="VERSION_STRING",t))(Xmt||{}),ge=class{constructor(e,n){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=e,this.data=n,this.promise=new Promise((i,r)=>{this.promiseResolver=i,this.promiseRejecter=r})}};function Jw(t){switch(t.typeId){case C.Binary:return{sqlType:"binary"};case C.Bool:return{sqlType:"bool"};case C.Date:return{sqlType:"date"};case C.DateDay:return{sqlType:"date32[d]"};case C.DateMillisecond:return{sqlType:"date64[ms]"};case C.Decimal:{let e=t;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case C.Float:return{sqlType:"float"};case C.Float16:return{sqlType:"float16"};case C.Float32:return{sqlType:"float32"};case C.Float64:return{sqlType:"float64"};case C.Int:return{sqlType:"int32"};case C.Int16:return{sqlType:"int16"};case C.Int32:return{sqlType:"int32"};case C.Int64:return{sqlType:"int64"};case C.Uint16:return{sqlType:"uint16"};case C.Uint32:return{sqlType:"uint32"};case C.Uint64:return{sqlType:"uint64"};case C.Uint8:return{sqlType:"uint8"};case C.IntervalDayTime:return{sqlType:"interval[dt]"};case C.IntervalYearMonth:return{sqlType:"interval[m]"};case C.List:return{sqlType:"list",valueType:Jw(t.valueType)};case C.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:t.byteWidth};case C.Null:return{sqlType:"null"};case C.Utf8:return{sqlType:"utf8"};case C.Struct:return{sqlType:"struct",fields:t.children.map(e=>zM(e.name,e.type))};case C.Map:{let e=t;return{sqlType:"map",keyType:Jw(e.keyType),valueType:Jw(e.valueType)}}case C.Time:return{sqlType:"time[s]"};case C.TimeMicrosecond:return{sqlType:"time[us]"};case C.TimeMillisecond:return{sqlType:"time[ms]"};case C.TimeNanosecond:return{sqlType:"time[ns]"};case C.TimeSecond:return{sqlType:"time[s]"};case C.Timestamp:return{sqlType:"timestamp",timezone:t.timezone||void 0};case C.TimestampSecond:return{sqlType:"timestamp[s]",timezone:t.timezone||void 0};case C.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:t.timezone||void 0};case C.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:t.timezone||void 0};case C.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:t.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(t.toString()))}function zM(t,e){let n=Jw(e);return n.name=t,n}var Kmt=new TextEncoder,Jmt=class{constructor(t,e=null){this._onInstantiationProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=t,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),e!=null&&this.attach(e)}get logger(){return this._logger}attach(t){this._worker=t,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,n)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(t,e=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let n=this._nextMessageId++;return this._pendingRequests.set(n,t),this._worker.postMessage({messageId:n,type:t.type,data:t.data},e),await t.promise}onMessage(t){var e;let n=t.data;switch(n.type){case"LOG":{this._logger.log(n.data);return}case"INSTANTIATE_PROGRESS":{for(let r of this._onInstantiationProgress)r(n.data);return}}let i=this._pendingRequests.get(n.requestId);if(!i){console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"));return}if(this._pendingRequests.delete(n.requestId),n.type=="ERROR"){let r=new Error(n.data.message);r.name=n.data.name,(e=Object.getOwnPropertyDescriptor(r,"stack"))!=null&&e.writable&&(r.stack=n.data.stack),i.promiseRejecter(r);return}switch(i.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(n.type=="OK"){i.promiseResolver(n.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],n.type=="OK"){i.promiseResolver(n.data);return}break;case"GLOB_FILE_INFOS":if(n.type=="FILE_INFOS"){i.promiseResolver(n.data);return}break;case"GET_VERSION":if(n.type=="VERSION_STRING"){i.promiseResolver(n.data);return}break;case"GET_FEATURE_FLAGS":if(n.type=="FEATURE_FLAGS"){i.promiseResolver(n.data);return}break;case"GET_TABLE_NAMES":if(n.type=="TABLE_NAMES"){i.promiseResolver(n.data);return}break;case"TOKENIZE":if(n.type=="SCRIPT_TOKENS"){i.promiseResolver(n.data);return}break;case"COPY_FILE_TO_BUFFER":if(n.type=="FILE_BUFFER"){i.promiseResolver(n.data);return}break;case"EXPORT_FILE_STATISTICS":if(n.type=="FILE_STATISTICS"){i.promiseResolver(n.data);return}break;case"CONNECT":if(n.type=="CONNECTION_INFO"){i.promiseResolver(n.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(n.type=="QUERY_RESULT"){i.promiseResolver(n.data);return}break;case"SEND_PREPARED":if(n.type=="QUERY_RESULT_HEADER"){i.promiseResolver(n.data);return}break;case"START_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){i.promiseResolver(n.data);return}break;case"POLL_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){i.promiseResolver(n.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],n.type=="SUCCESS"){i.promiseResolver(n.data);return}break;case"FETCH_QUERY_RESULTS":if(n.type=="QUERY_RESULT_CHUNK"){i.promiseResolver(n.data);return}break;case"CREATE_PREPARED":if(n.type=="PREPARED_STATEMENT_ID"){i.promiseResolver(n.data);return}break}i.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}onError(t){console.error(t),console.error("error in duckdb worker: ".concat(t.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let t=new ge("RESET",null);return await this.postTask(t)}async ping(){let t=new ge("PING",null);await this.postTask(t)}async dropFile(t){let e=new ge("DROP_FILE",t);return await this.postTask(e)}async dropFiles(){let t=new ge("DROP_FILES",null);return await this.postTask(t)}async flushFiles(){let t=new ge("FLUSH_FILES",null);return await this.postTask(t)}async instantiate(t,e=null,n=i=>{}){this._onInstantiationProgress.push(n);let i=new ge("INSTANTIATE",[t,e]);return await this.postTask(i)}async getVersion(){let t=new ge("GET_VERSION",null);return await this.postTask(t)}async getFeatureFlags(){let t=new ge("GET_FEATURE_FLAGS",null);return await this.postTask(t)}async open(t){let e=new ge("OPEN",t);await this.postTask(e)}async tokenize(t){let e=new ge("TOKENIZE",t);return await this.postTask(e)}async connectInternal(){let t=new ge("CONNECT",null);return await this.postTask(t)}async connect(){let t=await this.connectInternal();return new Gmt(this,t)}async disconnect(t){let e=new ge("DISCONNECT",t);await this.postTask(e)}async runQuery(t,e){let n=new ge("RUN_QUERY",[t,e]);return await this.postTask(n)}async startPendingQuery(t,e){let n=new ge("START_PENDING_QUERY",[t,e]);return await this.postTask(n)}async pollPendingQuery(t){let e=new ge("POLL_PENDING_QUERY",t);return await this.postTask(e)}async cancelPendingQuery(t){let e=new ge("CANCEL_PENDING_QUERY",t);return await this.postTask(e)}async fetchQueryResults(t){let e=new ge("FETCH_QUERY_RESULTS",t);return await this.postTask(e)}async getTableNames(t,e){let n=new ge("GET_TABLE_NAMES",[t,e]);return await this.postTask(n)}async createPrepared(t,e){let n=new ge("CREATE_PREPARED",[t,e]);return await this.postTask(n)}async closePrepared(t,e){let n=new ge("CLOSE_PREPARED",[t,e]);await this.postTask(n)}async runPrepared(t,e,n){let i=new ge("RUN_PREPARED",[t,e,n]);return await this.postTask(i)}async sendPrepared(t,e,n){let i=new ge("SEND_PREPARED",[t,e,n]);return await this.postTask(i)}async globFiles(t){let e=new ge("GLOB_FILE_INFOS",t);return await this.postTask(e)}async registerFileText(t,e){let n=Kmt.encode(e);await this.registerFileBuffer(t,n)}async registerFileURL(t,e,n,i){e===void 0&&(e=t);let r=new ge("REGISTER_FILE_URL",[t,e,n,i]);await this.postTask(r)}async registerEmptyFileBuffer(t){let e=new ge("REGISTER_FILE_BUFFER",[t,new Uint8Array]);await this.postTask(e)}async registerFileBuffer(t,e){let n=new ge("REGISTER_FILE_BUFFER",[t,e]);await this.postTask(n,[e.buffer])}async registerFileHandle(t,e,n,i){let r=new ge("REGISTER_FILE_HANDLE",[t,e,n,i]);await this.postTask(r,[])}async collectFileStatistics(t,e){let n=new ge("COLLECT_FILE_STATISTICS",[t,e]);await this.postTask(n,[])}async exportFileStatistics(t){let e=new ge("EXPORT_FILE_STATISTICS",t);return await this.postTask(e,[])}async copyFileToBuffer(t){let e=new ge("COPY_FILE_TO_BUFFER",t);return await this.postTask(e)}async copyFileToPath(t,e){let n=new ge("COPY_FILE_TO_PATH",[t,e]);await this.postTask(n)}async insertArrowFromIPCStream(t,e,n){if(e.length==0)return;let i=new ge("INSERT_ARROW_FROM_IPC_STREAM",[t,e,n]);await this.postTask(i,[e.buffer])}async insertCSVFromPath(t,e,n){if(n.columns!==void 0){let r=[];for(let s in n.columns){let o=n.columns[s];r.push(zM(s,o))}n.columnsFlat=r,delete n.columns}let i=new ge("IMPORT_CSV_FROM_PATH",[t,e,n]);await this.postTask(i)}async insertJSONFromPath(t,e,n){if(n.columns!==void 0){let r=[];for(let s in n.columns){let o=n.columns[s];r.push(zM(s,o))}n.columnsFlat=r,delete n.columns}let i=new ge("IMPORT_JSON_FROM_PATH",[t,e,n]);await this.postTask(i)}},Qmt=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),Zmt=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),t0t=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),e0t=()=>(async t=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(t)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),_D={name:"@duckdb/duckdb-wasm",version:"1.28.1-dev99.0",description:"DuckDB powered by WebAssembly",license:"MIT",repository:{type:"git",url:"https://github.com/duckdb/duckdb-wasm.git"},keywords:["sql","duckdb","relational","database","data","query","wasm","analytics","olap","arrow","parquet","json","csv"],dependencies:{"apache-arrow":"^14.0.1"},devDependencies:{"@types/emscripten":"^1.39.10","@types/jasmine":"^5.1.4","@typescript-eslint/eslint-plugin":"^6.18.0","@typescript-eslint/parser":"^6.18.0",esbuild:"^0.19.10",eslint:"^8.56.0","eslint-plugin-jasmine":"^4.1.3","eslint-plugin-react":"^7.33.2","fast-glob":"^3.3.2",jasmine:"^5.1.0","jasmine-core":"^5.1.1","jasmine-spec-reporter":"^7.0.0","js-sha256":"^0.10.1",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-coverage":"^2.2.1","karma-firefox-launcher":"^2.1.2","karma-jasmine":"^5.1.0","karma-jasmine-html-reporter":"^2.1.0","karma-sourcemap-loader":"^0.4.0","karma-spec-reporter":"^0.0.36","make-dir":"^4.0.0",nyc:"^15.1.0",prettier:"^3.2.2",puppeteer:"^21.7.0",rimraf:"^5.0.5",s3rver:"^3.7.1",typedoc:"^0.25.7",typescript:"^5.3.3","wasm-feature-detect":"^1.6.1","web-worker":"^1.2.0"},scripts:{"build:debug":"node bundle.mjs debug && tsc --emitDeclarationOnly","build:release":"node bundle.mjs release && tsc --emitDeclarationOnly",docs:"typedoc",report:"node ./coverage.mjs","test:node":"node --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:debug":"node --inspect-brk --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:coverage":"nyc -r json --report-dir ./coverage/node node ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:firefox":"karma start ./karma/tests-firefox.cjs","test:chrome":"karma start ./karma/tests-chrome.cjs","test:chrome:eh":"karma start ./karma/tests-chrome-eh.cjs","test:chrome:coverage":"karma start ./karma/tests-chrome-coverage.cjs","test:browser":"karma start ./karma/tests-all.cjs","test:browser:debug":"karma start ./karma/tests-debug.cjs",test:"npm run test:chrome && npm run test:node","test:coverage":"npm run test:chrome:coverage && npm run test:node:coverage && npm run report",lint:"eslint src test"},files:["dist","!dist/types/test"],main:"dist/duckdb-browser.cjs",module:"dist/duckdb-browser.mjs",types:"dist/duckdb-browser.d.ts",jsdelivr:"dist/duckdb-browser.cjs",unpkg:"dist/duckdb-browser.mjs",sideEffects:!1,browser:{fs:!1,path:!1,perf_hooks:!1,os:!1,worker_threads:!1},exports:{"./dist/duckdb-mvp.wasm":"./dist/duckdb-mvp.wasm","./dist/duckdb-eh.wasm":"./dist/duckdb-eh.wasm","./dist/duckdb-coi.wasm":"./dist/duckdb-coi.wasm","./dist/duckdb-browser":"./dist/duckdb-browser.mjs","./dist/duckdb-browser.cjs":"./dist/duckdb-browser.cjs","./dist/duckdb-browser.mjs":"./dist/duckdb-browser.mjs","./dist/duckdb-browser-blocking":"./dist/duckdb-browser-blocking.mjs","./dist/duckdb-browser-blocking.mjs":"./dist/duckdb-browser-blocking.mjs","./dist/duckdb-browser-blocking.cjs":"./dist/duckdb-browser-blocking.cjs","./dist/duckdb-browser-coi.pthread.worker.js":"./dist/duckdb-browser-coi.pthread.worker.js","./dist/duckdb-browser-coi.worker.js":"./dist/duckdb-browser-coi.worker.js","./dist/duckdb-browser-eh.worker.js":"./dist/duckdb-browser-eh.worker.js","./dist/duckdb-browser-mvp.worker.js":"./dist/duckdb-browser-mvp.worker.js","./dist/duckdb-node":"./dist/duckdb-node.cjs","./dist/duckdb-node.cjs":"./dist/duckdb-node.cjs","./dist/duckdb-node-blocking":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-blocking.cjs":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-eh.worker.cjs":"./dist/duckdb-node-eh.worker.cjs","./dist/duckdb-node-mvp.worker.cjs":"./dist/duckdb-node-mvp.worker.cjs","./blocking":{browser:{types:"./dist/duckdb-browser-blocking.d.ts",import:"./dist/duckdb-browser-blocking.mjs",require:"./dist/duckdb-browser-blocking.cjs"},node:{types:"./dist/duckdb-node-blocking.d.ts",require:"./dist/duckdb-node-blocking.cjs",import:"./dist/duckdb-node-blocking.cjs"},types:"./dist/duckdb-browser-blocking.d.ts",import:"./dist/duckdb-browser-blocking.mjs",require:"./dist/duckdb-browser-blocking.cjs"},".":{browser:{types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"},node:{types:"./dist/duckdb-node.d.ts",import:"./dist/duckdb-node.cjs",require:"./dist/duckdb-node.cjs"},types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"}}},n0t=_D.name,i0t=_D.version,xD=_D.version.split(".");xD[0];xD[1];xD[2];var r0t=()=>typeof navigator>"u";function s0t(){let t="https://cdn.jsdelivr.net/npm/".concat(n0t,"@").concat(i0t,"/dist/");return{mvp:{mainModule:"".concat(t,"duckdb-mvp.wasm"),mainWorker:"".concat(t,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(t,"duckdb-eh.wasm"),mainWorker:"".concat(t,"duckdb-browser-eh.worker.js")}}}var tI=null,eI=null,nI=null,iI=null,rI=null;async function o0t(){return tI==null&&(tI=typeof BigInt64Array<"u"),eI==null&&(eI=await Zmt()),nI==null&&(nI=await e0t()),iI==null&&(iI=await t0t()),rI==null&&(rI=await Qmt()),{bigInt64Array:tI,crossOriginIsolated:r0t()||globalThis.crossOriginIsolated||!1,wasmExceptions:eI,wasmSIMD:iI,wasmThreads:nI,wasmBulkMemory:rI}}async function a0t(t){let e=await o0t();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&t.coi)return{mainModule:t.coi.mainModule,mainWorker:t.coi.mainWorker,pthreadWorker:t.coi.pthreadWorker};if(t.eh)return{mainModule:t.eh.mainModule,mainWorker:t.eh.mainWorker,pthreadWorker:null}}return{mainModule:t.mvp.mainModule,mainWorker:t.mvp.mainWorker,pthreadWorker:null}}Omt(Rmt());function u0t(){let t=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),t.decode(e))}u0t();var c0t=(t=>(t[t.BUFFER=0]="BUFFER",t[t.NODE_FS=1]="NODE_FS",t[t.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",t[t.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",t[t.HTTP=4]="HTTP",t[t.S3=5]="S3",t))(c0t||{});function l0t(t={}){const{duckdb:e,connection:n,...i}=t;let r=e,s=n,o;function a(){return o||(o=(r?Promise.resolve(r):f0t(i).then(l=>r=l)).then(l=>l.connect()).then(l=>s=l)),o}async function u(){return r||await a(),r}async function c(){return s||await a(),s}return{getDuckDB:u,getConnection:c,query:async l=>{const{type:f,sql:d}=l,p=await(await c()).query(d);return f==="exec"?void 0:f==="arrow"?p:Array.from(p)}}}async function f0t({log:t=!1}={}){const e=s0t(),n=await a0t(e),i=URL.createObjectURL(new Blob([`importScripts("${n.mainWorker}");`],{type:"text/javascript"})),r=new Worker(i),s=t?new Vmt:new qmt,o=new Jmt(s,r);return await o.instantiate(n.mainModule,n.pthreadWorker),URL.revokeObjectURL(i),o}function d0t(){const t=new Set;let e,n=new Promise(i=>e=i);return{pending(i){t.add(i)},ready(i){return t.delete(i),t.size===0},resolve(){n=new Promise(i=>{e(),e=i})},get promise(){return n}}}const JW=Symbol("Fixed"),h0t=Symbol("Transform");function Ze(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Pd(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function bh(t){let e,n,i;t.length!==2?(e=Ze,n=(a,u)=>Ze(t(a),u),i=(a,u)=>t(a)-u):(e=t===Ze||t===Pd?t:p0t,n=t,i=t);function r(a,u,c=0,l=a.length){if(c<l){if(e(u,u)!==0)return l;do{const f=c+l>>>1;n(a[f],u)<0?c=f+1:l=f}while(c<l)}return c}function s(a,u,c=0,l=a.length){if(c<l){if(e(u,u)!==0)return l;do{const f=c+l>>>1;n(a[f],u)<=0?c=f+1:l=f}while(c<l)}return c}function o(a,u,c=0,l=a.length){const f=r(a,u,c,l-1);return f>c&&i(a[f-1],u)>-i(a[f],u)?f-1:f}return{left:r,center:o,right:s}}function p0t(){return 0}function QW(t){return t===null?NaN:+t}function*g0t(t,e){if(e===void 0)for(let n of t)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of t)(i=e(i,++n,t))!=null&&(i=+i)>=i&&(yield i)}}const ZW=bh(Ze),sc=ZW.right,m0t=ZW.left;bh(QW).center;const tG=eG(nG),y0t=eG(b0t);function eG(t){return function(e,n,i=n){if(!((n=+n)>=0))throw new RangeError("invalid rx");if(!((i=+i)>=0))throw new RangeError("invalid ry");let{data:r,width:s,height:o}=e;if(!((s=Math.floor(s))>=0))throw new RangeError("invalid width");if(!((o=Math.floor(o!==void 0?o:r.length/s))>=0))throw new RangeError("invalid height");if(!s||!o||!n&&!i)return e;const a=n&&t(n),u=i&&t(i),c=r.slice();return a&&u?(qh(a,c,r,s,o),qh(a,r,c,s,o),qh(a,c,r,s,o),Vh(u,r,c,s,o),Vh(u,c,r,s,o),Vh(u,r,c,s,o)):a?(qh(a,r,c,s,o),qh(a,c,r,s,o),qh(a,r,c,s,o)):u&&(Vh(u,r,c,s,o),Vh(u,c,r,s,o),Vh(u,r,c,s,o)),e}}function qh(t,e,n,i,r){for(let s=0,o=i*r;s<o;)t(e,n,s,s+=i,1)}function Vh(t,e,n,i,r){for(let s=0,o=i*r;s<i;++s)t(e,n,s,s+o,i)}function b0t(t){const e=nG(t);return(n,i,r,s,o)=>{r<<=2,s<<=2,o<<=2,e(n,i,r+0,s+0,o),e(n,i,r+1,s+1,o),e(n,i,r+2,s+2,o),e(n,i,r+3,s+3,o)}}function nG(t){const e=Math.floor(t);if(e===t)return v0t(t);const n=t-e,i=2*t+1;return(r,s,o,a,u)=>{if(!((a-=u)>=o))return;let c=e*s[o];const l=u*e,f=l+u;for(let d=o,h=o+l;d<h;d+=u)c+=s[Math.min(a,d)];for(let d=o,h=a;d<=h;d+=u)c+=s[Math.min(a,d+l)],r[d]=(c+n*(s[Math.max(o,d-f)]+s[Math.min(a,d+f)]))/i,c-=s[Math.max(o,d-l)]}}function v0t(t){const e=2*t+1;return(n,i,r,s,o)=>{if(!((s-=o)>=r))return;let a=t*i[r];const u=o*t;for(let c=r,l=r+u;c<l;c+=o)a+=i[Math.min(s,c)];for(let c=r,l=s;c<=l;c+=o)a+=i[Math.min(s,c+u)],n[c]=a/e,a-=i[Math.max(r,c-u)]}}function JS(t,e){let n=0;if(e===void 0)for(let i of t)i!=null&&(i=+i)>=i&&++n;else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(r=+r)>=r&&++n}return n}function w0t(t){return t.length|0}function _0t(t){return!(t>0)}function x0t(t){return typeof t!="object"||"length"in t?t:Array.from(t)}function S0t(t){return e=>t(...e)}function E0t(...t){const e=typeof t[t.length-1]=="function"&&S0t(t.pop());t=t.map(x0t);const n=t.map(w0t),i=t.length-1,r=new Array(i+1).fill(0),s=[];if(i<0||n.some(_0t))return s;for(;;){s.push(r.map((a,u)=>t[u][a]));let o=i;for(;++r[o]===n[o];){if(o===0)return e?s.map(e):s;r[o--]=0}}}function A0t(t,e){var n=0,i=0;return Float64Array.from(t,e===void 0?r=>n+=+r||0:r=>n+=+e(r,i++,t)||0)}function SD(t,e){let n=0,i,r=0,s=0;if(e===void 0)for(let o of t)o!=null&&(o=+o)>=o&&(i=o-r,r+=i/++n,s+=i*(o-r));else{let o=-1;for(let a of t)(a=e(a,++o,t))!=null&&(a=+a)>=a&&(i=a-r,r+=i/++n,s+=i*(a-r))}if(n>1)return s/(n-1)}function bm(t,e){const n=SD(t,e);return n&&Math.sqrt(n)}function zn(t,e){let n,i;if(e===void 0)for(const r of t)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(n===void 0?s>=s&&(n=i=s):(n>s&&(n=s),i<s&&(i=s)))}return[n,i]}class Zi{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(n[i++]=a),e=o}return n[i]=e,this._n=i+1,this}valueOf(){const e=this._partials;let n=this._n,i,r,s,o=0;if(n>0){for(o=e[--n];n>0&&(i=o,r=e[--n],o=i+r,s=r-(o-i),!s););n>0&&(s<0&&e[n-1]<0||s>0&&e[n-1]>0)&&(r=s*2,i=o+r,r==i-o&&(o=i))}return o}}class zd extends Map{constructor(e,n=sG){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(UM(this,e))}has(e){return super.has(UM(this,e))}set(e,n){return super.set(iG(this,e),n)}delete(e){return super.delete(rG(this,e))}}class oc extends Set{constructor(e,n=sG){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const i of e)this.add(i)}has(e){return super.has(UM(this,e))}add(e){return super.add(iG(this,e))}delete(e){return super.delete(rG(this,e))}}function UM({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function iG({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function rG({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function sG(t){return t!==null&&typeof t=="object"?t.valueOf():t}function jM(t){return t}function bc(t,...e){return ED(t,jM,jM,e)}function eg(t,e,...n){return ED(t,jM,e,n)}function $0t(t,e,...n){return ED(t,Array.from,e,n)}function ED(t,e,n,i){return function r(s,o){if(o>=i.length)return n(s);const a=new zd,u=i[o++];let c=-1;for(const l of s){const f=u(l,++c,s),d=a.get(f);d?d.push(l):a.set(f,[l])}for(const[l,f]of a)a.set(l,r(f,o));return e(a)}(t,0)}function oG(t,e){return Array.from(e,n=>t[n])}function O_(t,...e){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");t=Array.from(t);let[n]=e;if(n&&n.length!==2||e.length>1){const i=Uint32Array.from(t,(r,s)=>s);return e.length>1?(e=e.map(r=>t.map(r)),i.sort((r,s)=>{for(const o of e){const a=l1(o[r],o[s]);if(a)return a}})):(n=t.map(n),i.sort((r,s)=>l1(n[r],n[s]))),oG(t,i)}return t.sort(AD(n))}function AD(t=Ze){if(t===Ze)return l1;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,n)=>{const i=t(e,n);return i||i===0?i:(t(n,n)===0)-(t(e,e)===0)}}function l1(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}function $D(t,e,n){return(e.length!==2?O_(eg(t,e,n),([i,r],[s,o])=>Ze(r,o)||Ze(i,s)):O_(bc(t,n),([i,r],[s,o])=>e(r,o)||Ze(i,s))).map(([i])=>i)}const I0t=Math.sqrt(50),M0t=Math.sqrt(10),T0t=Math.sqrt(2);function R_(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=I0t?10:s>=M0t?5:s>=T0t?2:1;let a,u,c;return r<0?(c=Math.pow(10,-r)/o,a=Math.round(t*c),u=Math.round(e*c),a/c<t&&++a,u/c>e&&--u,c=-c):(c=Math.pow(10,r)*o,a=Math.round(t/c),u=Math.round(e/c),a*c<t&&++a,u*c>e&&--u),u<a&&.5<=n&&n<2?R_(t,e,n*2):[a,u,c]}function kl(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?R_(e,t,n):R_(t,e,n);if(!(s>=r))return[];const a=s-r+1,u=new Array(a);if(i)if(o<0)for(let c=0;c<a;++c)u[c]=(s-c)/-o;else for(let c=0;c<a;++c)u[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)u[c]=(r+c)/-o;else for(let c=0;c<a;++c)u[c]=(r+c)*o;return u}function f1(t,e,n){return e=+e,t=+t,n=+n,R_(t,e,n)[2]}function Dl(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?f1(e,t,n):f1(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function aG(t,e,n){let i;for(;;){const r=f1(t,e,n);if(r===i||r===0||!isFinite(r))return[t,e];r>0?(t=Math.floor(t/r)*r,e=Math.ceil(e/r)*r):r<0&&(t=Math.ceil(t*r)/r,e=Math.floor(e*r)/r),i=r}}function ID(t){return Math.max(1,Math.ceil(Math.log(JS(t))/Math.LN2)+1)}function tn(t,e){let n;if(e===void 0)for(const i of t)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function F0t(t,e){let n,i=-1,r=-1;if(e===void 0)for(const s of t)++r,s!=null&&(n<s||n===void 0&&s>=s)&&(n=s,i=r);else for(let s of t)(s=e(s,++r,t))!=null&&(n<s||n===void 0&&s>=s)&&(n=s,i=r);return i}function yi(t,e){let n;if(e===void 0)for(const i of t)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function k0t(t,e){let n,i=-1,r=-1;if(e===void 0)for(const s of t)++r,s!=null&&(n>s||n===void 0&&s>=s)&&(n=s,i=r);else for(let s of t)(s=e(s,++r,t))!=null&&(n>s||n===void 0&&s>=s)&&(n=s,i=r);return i}function uG(t,e,n=0,i=1/0,r){if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(t.length-1,i)),!(n<=e&&e<=i))return t;for(r=r===void 0?l1:AD(r);i>n;){if(i-n>600){const u=i-n+1,c=e-n+1,l=Math.log(u),f=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*f*(u-f)/u)*(c-u/2<0?-1:1),h=Math.max(n,Math.floor(e-c*f/u+d)),p=Math.min(i,Math.floor(e+(u-c)*f/u+d));uG(t,e,h,p,r)}const s=t[e];let o=n,a=i;for(u0(t,n,e),r(t[i],s)>0&&u0(t,n,i);o<a;){for(u0(t,o,a),++o,--a;r(t[o],s)<0;)++o;for(;r(t[a],s)>0;)--a}r(t[n],s)===0?u0(t,n,a):(++a,u0(t,a,i)),a<=e&&(n=a+1),e<=a&&(i=a-1)}return t}function u0(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function MD(t,e=Ze){let n,i=!1;if(e.length===1){let r;for(const s of t){const o=e(s);(i?Ze(o,r)>0:Ze(o,o)===0)&&(n=s,r=o,i=!0)}}else for(const r of t)(i?e(r,n)>0:e(r,r)===0)&&(n=r,i=!0);return n}function Ra(t,e,n){if(t=Float64Array.from(g0t(t,n)),!(!(i=t.length)||isNaN(e=+e))){if(e<=0||i<2)return yi(t);if(e>=1)return tn(t);var i,r=(i-1)*e,s=Math.floor(r),o=tn(uG(t,s).subarray(0,s+1)),a=yi(t.subarray(s+1));return o+(a-o)*(r-s)}}function cG(t,e,n=QW){if(!(!(i=t.length)||isNaN(e=+e))){if(e<=0||i<2)return+n(t[0],0,t);if(e>=1)return+n(t[i-1],i-1,t);var i,r=(i-1)*e,s=Math.floor(r),o=+n(t[s],s,t),a=+n(t[s+1],s+1,t);return o+(a-o)*(r-s)}}function D0t(t,e,n){const i=JS(t),r=Ra(t,.75)-Ra(t,.25);return i&&r?Math.ceil((n-e)/(2*r*Math.pow(i,-1/3))):1}function lG(t,e,n){const i=JS(t),r=bm(t);return i&&r?Math.ceil((n-e)*Math.cbrt(i)/(3.49*r)):1}function pb(t,e){let n=0,i=0;if(e===void 0)for(let r of t)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function Ud(t,e){return Ra(t,.5,e)}function*C0t(t){for(const e of t)yield*e}function fG(t){return Array.from(C0t(t))}function dG(t,e){const n=new zd;if(e===void 0)for(let s of t)s!=null&&s>=s&&n.set(s,(n.get(s)||0)+1);else{let s=-1;for(let o of t)(o=e(o,++s,t))!=null&&o>=o&&n.set(o,(n.get(o)||0)+1)}let i,r=0;for(const[s,o]of n)o>r&&(r=o,i=s);return i}function N0t(t,e=O0t){const n=[];let i,r=!1;for(const s of t)r&&n.push(e(i,s)),i=s,r=!0;return n}function O0t(t,e){return[t,e]}function Un(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function hG(t,e=Ze){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let n=Array.from(t);const i=new Float64Array(n.length);e.length!==2&&(n=n.map(e),e=Ze);const r=(a,u)=>e(n[a],n[u]);let s,o;return t=Uint32Array.from(n,(a,u)=>u),t.sort(e===Ze?(a,u)=>l1(n[a],n[u]):AD(r)),t.forEach((a,u)=>{const c=r(a,s===void 0?a:s);c>=0?((s===void 0||c>0)&&(s=a,o=u),i[a]=o):i[a]=NaN}),i}function R0t(t,e=Ze){let n,i=!1;if(e.length===1){let r;for(const s of t){const o=e(s);(i?Ze(o,r)<0:Ze(o,o)===0)&&(n=s,r=o,i=!0)}}else for(const r of t)(i?e(r,n)<0:e(r,r)===0)&&(n=r,i=!0);return n}function Ls(t,e){let n=0;if(e===void 0)for(let i of t)(i=+i)&&(n+=i);else{let i=-1;for(let r of t)(r=+e(r,++i,t))&&(n+=r)}return n}function L_(t){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(t).reverse()}function L0t(t,...e){t=new oc(t),e=e.map(B0t);t:for(const n of t)for(const i of e)if(!i.has(n)){t.delete(n);continue t}return t}function B0t(t){return t instanceof oc?t:new oc(t)}function P0t(...t){const e=new oc;for(const n of t)for(const i of n)e.add(i);return e}function z0t(t){return t}var sI=1,oI=2,qM=3,Tv=4,L5=1e-6;function U0t(t){return"translate("+t+",0)"}function j0t(t){return"translate(0,"+t+")"}function q0t(t){return e=>+t(e)}function V0t(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function W0t(){return!this.__axis}function G0t(t,e){var n=[],i=null,r=null,s=6,o=6,a=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===sI||t===Tv?-1:1,l=t===Tv||t===oI?"x":"y",f=t===sI||t===qM?U0t:j0t;function d(h){var p=i??(e.ticks?e.ticks.apply(e,n):e.domain()),g=r??(e.tickFormat?e.tickFormat.apply(e,n):z0t),m=Math.max(s,0)+a,y=e.range(),b=+y[0]+u,v=+y[y.length-1]+u,w=(e.bandwidth?V0t:q0t)(e.copy(),u),_=h.selection?h.selection():h,S=_.selectAll(".domain").data([null]),x=_.selectAll(".tick").data(p,e).order(),E=x.exit(),A=x.enter().append("g").attr("class","tick"),$=x.select("line"),I=x.select("text");S=S.merge(S.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(A),$=$.merge(A.append("line").attr("stroke","currentColor").attr(l+"2",c*s)),I=I.merge(A.append("text").attr("fill","currentColor").attr(l,c*m).attr("dy",t===sI?"0em":t===qM?"0.71em":"0.32em")),h!==_&&(S=S.transition(h),x=x.transition(h),$=$.transition(h),I=I.transition(h),E=E.transition(h).attr("opacity",L5).attr("transform",function(k){return isFinite(k=w(k))?f(k+u):this.getAttribute("transform")}),A.attr("opacity",L5).attr("transform",function(k){var T=this.parentNode.__axis;return f((T&&isFinite(T=T(k))?T:w(k))+u)})),E.remove(),S.attr("d",t===Tv||t===oI?o?"M"+c*o+","+b+"H"+u+"V"+v+"H"+c*o:"M"+u+","+b+"V"+v:o?"M"+b+","+c*o+"V"+u+"H"+v+"V"+c*o:"M"+b+","+u+"H"+v),x.attr("opacity",1).attr("transform",function(k){return f(w(k)+u)}),$.attr(l+"2",c*s),I.attr(l,c*m).text(g),_.filter(W0t).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===oI?"start":t===Tv?"end":"middle"),_.each(function(){this.__axis=w})}return d.scale=function(h){return arguments.length?(e=h,d):e},d.ticks=function(){return n=Array.from(arguments),d},d.tickArguments=function(h){return arguments.length?(n=h==null?[]:Array.from(h),d):n.slice()},d.tickValues=function(h){return arguments.length?(i=h==null?null:Array.from(h),d):i&&i.slice()},d.tickFormat=function(h){return arguments.length?(r=h,d):r},d.tickSize=function(h){return arguments.length?(s=o=+h,d):s},d.tickSizeInner=function(h){return arguments.length?(s=+h,d):s},d.tickSizeOuter=function(h){return arguments.length?(o=+h,d):o},d.tickPadding=function(h){return arguments.length?(a=+h,d):a},d.offset=function(h){return arguments.length?(u=+h,d):u},d}function Y0t(t){return G0t(qM,t)}var H0t={value:()=>{}};function QS(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Qw(n)}function Qw(t){this._=t}function X0t(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Qw.prototype=QS.prototype={constructor:Qw,on:function(t,e){var n=this._,i=X0t(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=K0t(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=B5(n[r],t.name,e);else if(e==null)for(r in n)n[r]=B5(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Qw(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function K0t(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function B5(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=H0t,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var VM="http://www.w3.org/1999/xhtml";const jd={svg:"http://www.w3.org/2000/svg",xhtml:VM,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ZS(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),jd.hasOwnProperty(e)?{space:jd[e],local:t}:t}function J0t(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===VM&&e.documentElement.namespaceURI===VM?e.createElement(t):e.createElementNS(n,t)}}function Q0t(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function tE(t){var e=ZS(t);return(e.local?Q0t:J0t)(e)}function Z0t(){}function TD(t){return t==null?Z0t:function(){return this.querySelector(t)}}function tyt(t){typeof t!="function"&&(t=TD(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,a=i[r]=new Array(o),u,c,l=0;l<o;++l)(u=s[l])&&(c=t.call(u,u.__data__,l,s))&&("__data__"in u&&(c.__data__=u.__data__),a[l]=c);return new os(i,this._parents)}function eyt(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function nyt(){return[]}function pG(t){return t==null?nyt:function(){return this.querySelectorAll(t)}}function iyt(t){return function(){return eyt(t.apply(this,arguments))}}function ryt(t){typeof t=="function"?t=iyt(t):t=pG(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],a=o.length,u,c=0;c<a;++c)(u=o[c])&&(i.push(t.call(u,u.__data__,c,o)),r.push(u));return new os(i,r)}function gG(t){return function(){return this.matches(t)}}function mG(t){return function(e){return e.matches(t)}}var syt=Array.prototype.find;function oyt(t){return function(){return syt.call(this.children,t)}}function ayt(){return this.firstElementChild}function uyt(t){return this.select(t==null?ayt:oyt(typeof t=="function"?t:mG(t)))}var cyt=Array.prototype.filter;function lyt(){return Array.from(this.children)}function fyt(t){return function(){return cyt.call(this.children,t)}}function dyt(t){return this.selectAll(t==null?lyt:fyt(typeof t=="function"?t:mG(t)))}function hyt(t){typeof t!="function"&&(t=gG(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,a=i[r]=[],u,c=0;c<o;++c)(u=s[c])&&t.call(u,u.__data__,c,s)&&a.push(u);return new os(i,this._parents)}function yG(t){return new Array(t.length)}function pyt(){return new os(this._enter||this._groups.map(yG),this._parents)}function B_(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}B_.prototype={constructor:B_,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function gyt(t){return function(){return t}}function myt(t,e,n,i,r,s){for(var o=0,a,u=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):n[o]=new B_(t,s[o]);for(;o<u;++o)(a=e[o])&&(r[o]=a)}function yyt(t,e,n,i,r,s,o){var a,u,c=new Map,l=e.length,f=s.length,d=new Array(l),h;for(a=0;a<l;++a)(u=e[a])&&(d[a]=h=o.call(u,u.__data__,a,e)+"",c.has(h)?r[a]=u:c.set(h,u));for(a=0;a<f;++a)h=o.call(t,s[a],a,s)+"",(u=c.get(h))?(i[a]=u,u.__data__=s[a],c.delete(h)):n[a]=new B_(t,s[a]);for(a=0;a<l;++a)(u=e[a])&&c.get(d[a])===u&&(r[a]=u)}function byt(t){return t.__data__}function vyt(t,e){if(!arguments.length)return Array.from(this,byt);var n=e?yyt:myt,i=this._parents,r=this._groups;typeof t!="function"&&(t=gyt(t));for(var s=r.length,o=new Array(s),a=new Array(s),u=new Array(s),c=0;c<s;++c){var l=i[c],f=r[c],d=f.length,h=wyt(t.call(l,l&&l.__data__,c,i)),p=h.length,g=a[c]=new Array(p),m=o[c]=new Array(p),y=u[c]=new Array(d);n(l,f,g,m,y,h,e);for(var b=0,v=0,w,_;b<p;++b)if(w=g[b]){for(b>=v&&(v=b+1);!(_=m[v])&&++v<p;);w._next=_||null}}return o=new os(o,i),o._enter=a,o._exit=u,o}function wyt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function _yt(){return new os(this._exit||this._groups.map(yG),this._parents)}function xyt(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Syt(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),u=0;u<o;++u)for(var c=n[u],l=i[u],f=c.length,d=a[u]=new Array(f),h,p=0;p<f;++p)(h=c[p]||l[p])&&(d[p]=h);for(;u<r;++u)a[u]=n[u];return new os(a,this._parents)}function Eyt(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Ayt(t){t||(t=$yt);function e(f,d){return f&&d?t(f.__data__,d.__data__):!f-!d}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,u=r[s]=new Array(a),c,l=0;l<a;++l)(c=o[l])&&(u[l]=c);u.sort(e)}return new os(r,this._parents).order()}function $yt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Iyt(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Myt(){return Array.from(this)}function Tyt(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Fyt(){let t=0;for(const e of this)++t;return t}function kyt(){return!this.node()}function Dyt(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&t.call(a,a.__data__,s,r);return this}function Cyt(t){return function(){this.removeAttribute(t)}}function Nyt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Oyt(t,e){return function(){this.setAttribute(t,e)}}function Ryt(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Lyt(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Byt(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Pyt(t,e){var n=ZS(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Nyt:Cyt:typeof e=="function"?n.local?Byt:Lyt:n.local?Ryt:Oyt)(n,e))}function bG(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function zyt(t){return function(){this.style.removeProperty(t)}}function Uyt(t,e,n){return function(){this.style.setProperty(t,e,n)}}function jyt(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function qyt(t,e,n){return arguments.length>1?this.each((e==null?zyt:typeof e=="function"?jyt:Uyt)(t,e,n??"")):$g(this.node(),t)}function $g(t,e){return t.style.getPropertyValue(e)||bG(t).getComputedStyle(t,null).getPropertyValue(e)}function Vyt(t){return function(){delete this[t]}}function Wyt(t,e){return function(){this[t]=e}}function Gyt(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Yyt(t,e){return arguments.length>1?this.each((e==null?Vyt:typeof e=="function"?Gyt:Wyt)(t,e)):this.node()[t]}function vG(t){return t.trim().split(/^|\s+/)}function FD(t){return t.classList||new wG(t)}function wG(t){this._node=t,this._names=vG(t.getAttribute("class")||"")}wG.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function _G(t,e){for(var n=FD(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function xG(t,e){for(var n=FD(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Hyt(t){return function(){_G(this,t)}}function Xyt(t){return function(){xG(this,t)}}function Kyt(t,e){return function(){(e.apply(this,arguments)?_G:xG)(this,t)}}function Jyt(t,e){var n=vG(t+"");if(arguments.length<2){for(var i=FD(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?Kyt:e?Hyt:Xyt)(n,e))}function Qyt(){this.textContent=""}function Zyt(t){return function(){this.textContent=t}}function t1t(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function e1t(t){return arguments.length?this.each(t==null?Qyt:(typeof t=="function"?t1t:Zyt)(t)):this.node().textContent}function n1t(){this.innerHTML=""}function i1t(t){return function(){this.innerHTML=t}}function r1t(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function s1t(t){return arguments.length?this.each(t==null?n1t:(typeof t=="function"?r1t:i1t)(t)):this.node().innerHTML}function o1t(){this.nextSibling&&this.parentNode.appendChild(this)}function a1t(){return this.each(o1t)}function u1t(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function c1t(){return this.each(u1t)}function l1t(t){var e=typeof t=="function"?t:tE(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function f1t(){return null}function d1t(t,e){var n=typeof t=="function"?t:tE(t),i=e==null?f1t:typeof e=="function"?e:TD(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function h1t(){var t=this.parentNode;t&&t.removeChild(this)}function p1t(){return this.each(h1t)}function g1t(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function m1t(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function y1t(t){return this.select(t?m1t:g1t)}function b1t(t){return arguments.length?this.property("__data__",t):this.node().__data__}function v1t(t){return function(e){t.call(this,e,this.__data__)}}function w1t(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function _1t(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function x1t(t,e,n){return function(){var i=this.__on,r,s=v1t(e);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function S1t(t,e,n){var i=w1t(t+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,c=a.length,l;u<c;++u)for(r=0,l=a[u];r<s;++r)if((o=i[r]).type===l.type&&o.name===l.name)return l.value}return}for(a=e?x1t:_1t,r=0;r<s;++r)this.each(a(i[r],e,n));return this}function SG(t,e,n){var i=bG(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function E1t(t,e){return function(){return SG(this,t,e)}}function A1t(t,e){return function(){return SG(this,t,e.apply(this,arguments))}}function $1t(t,e){return this.each((typeof e=="function"?A1t:E1t)(t,e))}function*I1t(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var EG=[null];function os(t,e){this._groups=t,this._parents=e}function gb(){return new os([[document.documentElement]],EG)}function M1t(){return this}os.prototype=gb.prototype={constructor:os,select:tyt,selectAll:ryt,selectChild:uyt,selectChildren:dyt,filter:hyt,data:vyt,enter:pyt,exit:_yt,join:xyt,merge:Syt,selection:M1t,order:Eyt,sort:Ayt,call:Iyt,nodes:Myt,node:Tyt,size:Fyt,empty:kyt,each:Dyt,attr:Pyt,style:qyt,property:Yyt,classed:Jyt,text:e1t,html:s1t,raise:a1t,lower:c1t,append:l1t,insert:d1t,remove:p1t,clone:y1t,datum:b1t,on:S1t,dispatch:$1t,[Symbol.iterator]:I1t};function fi(t){return typeof t=="string"?new os([[document.querySelector(t)]],[document.documentElement]):new os([[t]],EG)}function T1t(t){let e;for(;e=t.sourceEvent;)t=e;return t}function WM(t,e){if(t=T1t(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const GM={capture:!0,passive:!1};function YM(t){t.preventDefault(),t.stopImmediatePropagation()}function F1t(t){var e=t.document.documentElement,n=fi(t).on("dragstart.drag",YM,GM);"onselectstart"in e?n.on("selectstart.drag",YM,GM):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function k1t(t,e){var n=t.document.documentElement,i=fi(t).on("dragstart.drag",null);e&&(i.on("click.drag",YM,GM),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function vm(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function mb(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function uf(){}var qd=.7,Ig=1/qd,ng="\\s*([+-]?\\d+)\\s*",d1="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ea="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",D1t=/^#([0-9a-f]{3,8})$/,C1t=new RegExp(`^rgb\\(${ng},${ng},${ng}\\)$`),N1t=new RegExp(`^rgb\\(${Ea},${Ea},${Ea}\\)$`),O1t=new RegExp(`^rgba\\(${ng},${ng},${ng},${d1}\\)$`),R1t=new RegExp(`^rgba\\(${Ea},${Ea},${Ea},${d1}\\)$`),L1t=new RegExp(`^hsl\\(${d1},${Ea},${Ea}\\)$`),B1t=new RegExp(`^hsla\\(${d1},${Ea},${Ea},${d1}\\)$`),P5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};vm(uf,Cl,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:z5,formatHex:z5,formatHex8:P1t,formatHsl:z1t,formatRgb:U5,toString:U5});function z5(){return this.rgb().formatHex()}function P1t(){return this.rgb().formatHex8()}function z1t(){return AG(this).formatHsl()}function U5(){return this.rgb().formatRgb()}function Cl(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=D1t.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?j5(e):n===3?new Zn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Fv(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Fv(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=C1t.exec(t))?new Zn(e[1],e[2],e[3],1):(e=N1t.exec(t))?new Zn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=O1t.exec(t))?Fv(e[1],e[2],e[3],e[4]):(e=R1t.exec(t))?Fv(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=L1t.exec(t))?W5(e[1],e[2]/100,e[3]/100,1):(e=B1t.exec(t))?W5(e[1],e[2]/100,e[3]/100,e[4]):P5.hasOwnProperty(t)?j5(P5[t]):t==="transparent"?new Zn(NaN,NaN,NaN,0):null}function j5(t){return new Zn(t>>16&255,t>>8&255,t&255,1)}function Fv(t,e,n,i){return i<=0&&(t=e=n=NaN),new Zn(t,e,n,i)}function kD(t){return t instanceof uf||(t=Cl(t)),t?(t=t.rgb(),new Zn(t.r,t.g,t.b,t.opacity)):new Zn}function Nr(t,e,n,i){return arguments.length===1?kD(t):new Zn(t,e,n,i??1)}function Zn(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}vm(Zn,Nr,mb(uf,{brighter(t){return t=t==null?Ig:Math.pow(Ig,t),new Zn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?qd:Math.pow(qd,t),new Zn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Zn(Ad(this.r),Ad(this.g),Ad(this.b),P_(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:q5,formatHex:q5,formatHex8:U1t,formatRgb:V5,toString:V5}));function q5(){return`#${bd(this.r)}${bd(this.g)}${bd(this.b)}`}function U1t(){return`#${bd(this.r)}${bd(this.g)}${bd(this.b)}${bd((isNaN(this.opacity)?1:this.opacity)*255)}`}function V5(){const t=P_(this.opacity);return`${t===1?"rgb(":"rgba("}${Ad(this.r)}, ${Ad(this.g)}, ${Ad(this.b)}${t===1?")":`, ${t})`}`}function P_(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ad(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function bd(t){return t=Ad(t),(t<16?"0":"")+t.toString(16)}function W5(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new fo(t,e,n,i)}function AG(t){if(t instanceof fo)return new fo(t.h,t.s,t.l,t.opacity);if(t instanceof uf||(t=Cl(t)),!t)return new fo;if(t instanceof fo)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,a=s-r,u=(s+r)/2;return a?(e===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-e)/a+2:o=(e-n)/a+4,a/=u<.5?s+r:2-s-r,o*=60):a=u>0&&u<1?0:o,new fo(o,a,u,t.opacity)}function z_(t,e,n,i){return arguments.length===1?AG(t):new fo(t,e,n,i??1)}function fo(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}vm(fo,z_,mb(uf,{brighter(t){return t=t==null?Ig:Math.pow(Ig,t),new fo(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?qd:Math.pow(qd,t),new fo(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Zn(aI(t>=240?t-240:t+120,r,i),aI(t,r,i),aI(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new fo(G5(this.h),kv(this.s),kv(this.l),P_(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=P_(this.opacity);return`${t===1?"hsl(":"hsla("}${G5(this.h)}, ${kv(this.s)*100}%, ${kv(this.l)*100}%${t===1?")":`, ${t})`}`}}));function G5(t){return t=(t||0)%360,t<0?t+360:t}function kv(t){return Math.max(0,Math.min(1,t||0))}function aI(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const $G=Math.PI/180,IG=180/Math.PI,U_=18,MG=.96422,TG=1,FG=.82521,kG=4/29,ig=6/29,DG=3*ig*ig,j1t=ig*ig*ig;function CG(t){if(t instanceof Aa)return new Aa(t.l,t.a,t.b,t.opacity);if(t instanceof qu)return NG(t);t instanceof Zn||(t=kD(t));var e=fI(t.r),n=fI(t.g),i=fI(t.b),r=uI((.2225045*e+.7168786*n+.0606169*i)/TG),s,o;return e===n&&n===i?s=o=r:(s=uI((.4360747*e+.3850649*n+.1430804*i)/MG),o=uI((.0139322*e+.0971045*n+.7141733*i)/FG)),new Aa(116*r-16,500*(s-r),200*(r-o),t.opacity)}function j_(t,e,n,i){return arguments.length===1?CG(t):new Aa(t,e,n,i??1)}function Aa(t,e,n,i){this.l=+t,this.a=+e,this.b=+n,this.opacity=+i}vm(Aa,j_,mb(uf,{brighter(t){return new Aa(this.l+U_*(t??1),this.a,this.b,this.opacity)},darker(t){return new Aa(this.l-U_*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return e=MG*cI(e),t=TG*cI(t),n=FG*cI(n),new Zn(lI(3.1338561*e-1.6168667*t-.4906146*n),lI(-.9787684*e+1.9161415*t+.033454*n),lI(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}}));function uI(t){return t>j1t?Math.pow(t,1/3):t/DG+kG}function cI(t){return t>ig?t*t*t:DG*(t-kG)}function lI(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function fI(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function q1t(t){if(t instanceof qu)return new qu(t.h,t.c,t.l,t.opacity);if(t instanceof Aa||(t=CG(t)),t.a===0&&t.b===0)return new qu(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*IG;return new qu(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function q_(t,e,n,i){return arguments.length===1?q1t(t):new qu(t,e,n,i??1)}function qu(t,e,n,i){this.h=+t,this.c=+e,this.l=+n,this.opacity=+i}function NG(t){if(isNaN(t.h))return new Aa(t.l,0,0,t.opacity);var e=t.h*$G;return new Aa(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}vm(qu,q_,mb(uf,{brighter(t){return new qu(this.h,this.c,this.l+U_*(t??1),this.opacity)},darker(t){return new qu(this.h,this.c,this.l-U_*(t??1),this.opacity)},rgb(){return NG(this).rgb()}}));var OG=-.14861,DD=1.78277,CD=-.29227,eE=-.90649,h1=1.97294,Y5=h1*eE,H5=h1*DD,X5=DD*CD-eE*OG;function V1t(t){if(t instanceof $d)return new $d(t.h,t.s,t.l,t.opacity);t instanceof Zn||(t=kD(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(X5*i+Y5*e-H5*n)/(X5+Y5-H5),s=i-r,o=(h1*(n-r)-CD*s)/eE,a=Math.sqrt(o*o+s*s)/(h1*r*(1-r)),u=a?Math.atan2(o,s)*IG-120:NaN;return new $d(u<0?u+360:u,a,r,t.opacity)}function La(t,e,n,i){return arguments.length===1?V1t(t):new $d(t,e,n,i??1)}function $d(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}vm($d,La,mb(uf,{brighter(t){return t=t==null?Ig:Math.pow(Ig,t),new $d(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?qd:Math.pow(qd,t),new $d(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*$G,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new Zn(255*(e+n*(OG*i+DD*r)),255*(e+n*(CD*i+eE*r)),255*(e+n*(h1*i)),this.opacity)}}));function RG(t,e,n,i,r){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*i+o*r)/6}function LG(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],s=t[i+1],o=i>0?t[i-1]:2*r-s,a=i<e-1?t[i+2]:2*s-r;return RG((n-i/e)*e,o,r,s,a)}}function BG(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],s=t[i%e],o=t[(i+1)%e],a=t[(i+2)%e];return RG((n-i/e)*e,r,s,o,a)}}const nE=t=>()=>t;function PG(t,e){return function(n){return t+n*e}}function W1t(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function iE(t,e){var n=e-t;return n?PG(t,n>180||n<-180?n-360*Math.round(n/360):n):nE(isNaN(t)?e:t)}function G1t(t){return(t=+t)==1?ti:function(e,n){return n-e?W1t(e,n,t):nE(isNaN(e)?n:e)}}function ti(t,e){var n=e-t;return n?PG(t,n):nE(isNaN(t)?e:t)}const Nl=function t(e){var n=G1t(e);function i(r,s){var o=n((r=Nr(r)).r,(s=Nr(s)).r),a=n(r.g,s.g),u=n(r.b,s.b),c=ti(r.opacity,s.opacity);return function(l){return r.r=o(l),r.g=a(l),r.b=u(l),r.opacity=c(l),r+""}}return i.gamma=t,i}(1);function zG(t){return function(e){var n=e.length,i=new Array(n),r=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=Nr(e[o]),i[o]=a.r||0,r[o]=a.g||0,s[o]=a.b||0;return i=t(i),r=t(r),s=t(s),a.opacity=1,function(u){return a.r=i(u),a.g=r(u),a.b=s(u),a+""}}}var UG=zG(LG),Y1t=zG(BG);function ND(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function jG(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function H1t(t,e){return(jG(e)?ND:qG)(t,e)}function qG(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=vc(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(a){for(o=0;o<i;++o)s[o]=r[o](a);return s}}function VG(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function ci(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function WG(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=vc(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var HM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dI=new RegExp(HM.source,"g");function X1t(t){return function(){return t}}function K1t(t){return function(e){return t(e)+""}}function OD(t,e){var n=HM.lastIndex=dI.lastIndex=0,i,r,s,o=-1,a=[],u=[];for(t=t+"",e=e+"";(i=HM.exec(t))&&(r=dI.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,u.push({i:o,x:ci(i,r)})),n=dI.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?K1t(u[0].x):X1t(e):(e=u.length,function(c){for(var l=0,f;l<e;++l)a[(f=u[l]).i]=f.x(c);return a.join("")})}function vc(t,e){var n=typeof e,i;return e==null||n==="boolean"?nE(e):(n==="number"?ci:n==="string"?(i=Cl(e))?(e=i,Nl):OD:e instanceof Cl?Nl:e instanceof Date?VG:jG(e)?ND:Array.isArray(e)?qG:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?WG:ci)(t,e)}function J1t(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function Q1t(t,e){var n=iE(+t,+e);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function wm(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var K5=180/Math.PI,XM={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function GG(t,e,n,i,r,s){var o,a,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*i)&&(n-=t*u,i-=e*u),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,u/=a),t*i<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*K5,skewX:Math.atan(u)*K5,scaleX:o,scaleY:a}}var Dv;function Z1t(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?XM:GG(e.a,e.b,e.c,e.d,e.e,e.f)}function tbt(t){return t==null||(Dv||(Dv=document.createElementNS("http://www.w3.org/2000/svg","g")),Dv.setAttribute("transform",t),!(t=Dv.transform.baseVal.consolidate()))?XM:(t=t.matrix,GG(t.a,t.b,t.c,t.d,t.e,t.f))}function YG(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,l,f,d,h,p){if(c!==f||l!==d){var g=h.push("translate(",null,e,null,n);p.push({i:g-4,x:ci(c,f)},{i:g-2,x:ci(l,d)})}else(f||d)&&h.push("translate("+f+e+d+n)}function o(c,l,f,d){c!==l?(c-l>180?l+=360:l-c>180&&(c+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:ci(c,l)})):l&&f.push(r(f)+"rotate("+l+i)}function a(c,l,f,d){c!==l?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:ci(c,l)}):l&&f.push(r(f)+"skewX("+l+i)}function u(c,l,f,d,h,p){if(c!==f||l!==d){var g=h.push(r(h)+"scale(",null,",",null,")");p.push({i:g-4,x:ci(c,f)},{i:g-2,x:ci(l,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(c,l){var f=[],d=[];return c=t(c),l=t(l),s(c.translateX,c.translateY,l.translateX,l.translateY,f,d),o(c.rotate,l.rotate,f,d),a(c.skewX,l.skewX,f,d),u(c.scaleX,c.scaleY,l.scaleX,l.scaleY,f,d),c=l=null,function(h){for(var p=-1,g=d.length,m;++p<g;)f[(m=d[p]).i]=m.x(h);return f.join("")}}}var HG=YG(Z1t,"px, ","px)","deg)"),XG=YG(tbt,", ",")",")"),ebt=1e-12;function J5(t){return((t=Math.exp(t))+1/t)/2}function nbt(t){return((t=Math.exp(t))-1/t)/2}function ibt(t){return((t=Math.exp(2*t))-1)/(t+1)}const rbt=function t(e,n,i){function r(s,o){var a=s[0],u=s[1],c=s[2],l=o[0],f=o[1],d=o[2],h=l-a,p=f-u,g=h*h+p*p,m,y;if(g<ebt)y=Math.log(d/c)/e,m=function(x){return[a+x*h,u+x*p,c*Math.exp(e*x*y)]};else{var b=Math.sqrt(g),v=(d*d-c*c+i*g)/(2*c*n*b),w=(d*d-c*c-i*g)/(2*d*n*b),_=Math.log(Math.sqrt(v*v+1)-v),S=Math.log(Math.sqrt(w*w+1)-w);y=(S-_)/e,m=function(x){var E=x*y,A=J5(_),$=c/(n*b)*(A*ibt(e*E+_)-nbt(_));return[a+$*h,u+$*p,c*A/J5(e*E+_)]}}return m.duration=y*1e3*e/Math.SQRT2,m}return r.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return t(o,a,u)},r}(Math.SQRT2,2,4);function KG(t){return function(e,n){var i=t((e=z_(e)).h,(n=z_(n)).h),r=ti(e.s,n.s),s=ti(e.l,n.l),o=ti(e.opacity,n.opacity);return function(a){return e.h=i(a),e.s=r(a),e.l=s(a),e.opacity=o(a),e+""}}}const JG=KG(iE);var sbt=KG(ti);function QG(t,e){var n=ti((t=j_(t)).l,(e=j_(e)).l),i=ti(t.a,e.a),r=ti(t.b,e.b),s=ti(t.opacity,e.opacity);return function(o){return t.l=n(o),t.a=i(o),t.b=r(o),t.opacity=s(o),t+""}}function ZG(t){return function(e,n){var i=t((e=q_(e)).h,(n=q_(n)).h),r=ti(e.c,n.c),s=ti(e.l,n.l),o=ti(e.opacity,n.opacity);return function(a){return e.h=i(a),e.c=r(a),e.l=s(a),e.opacity=o(a),e+""}}}const tY=ZG(iE);var obt=ZG(ti);function eY(t){return function e(n){n=+n;function i(r,s){var o=t((r=La(r)).h,(s=La(s)).h),a=ti(r.s,s.s),u=ti(r.l,s.l),c=ti(r.opacity,s.opacity);return function(l){return r.h=o(l),r.s=a(l),r.l=u(Math.pow(l,n)),r.opacity=c(l),r+""}}return i.gamma=e,i}(1)}const abt=eY(iE);var rE=eY(ti);function _m(t,e){e===void 0&&(e=t,t=vc);for(var n=0,i=e.length-1,r=e[0],s=new Array(i<0?0:i);n<i;)s[n]=t(r,r=e[++n]);return function(o){var a=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return s[a](o-a)}}function Bs(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t(i/(e-1));return n}const ubt=Object.freeze(Object.defineProperty({__proto__:null,interpolate:vc,interpolateArray:H1t,interpolateBasis:LG,interpolateBasisClosed:BG,interpolateCubehelix:abt,interpolateCubehelixLong:rE,interpolateDate:VG,interpolateDiscrete:J1t,interpolateHcl:tY,interpolateHclLong:obt,interpolateHsl:JG,interpolateHslLong:sbt,interpolateHue:Q1t,interpolateLab:QG,interpolateNumber:ci,interpolateNumberArray:ND,interpolateObject:WG,interpolateRgb:Nl,interpolateRgbBasis:UG,interpolateRgbBasisClosed:Y1t,interpolateRound:wm,interpolateString:OD,interpolateTransformCss:HG,interpolateTransformSvg:XG,interpolateZoom:rbt,piecewise:_m,quantize:Bs},Symbol.toStringTag,{value:"Module"}));var Mg=0,Z0=0,c0=0,nY=1e3,V_,ty,W_=0,Vd=0,sE=0,p1=typeof performance=="object"&&performance.now?performance:Date,iY=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function oE(){return Vd||(iY(cbt),Vd=p1.now()+sE)}function cbt(){Vd=0}function g1(){this._call=this._time=this._next=null}g1.prototype=RD.prototype={constructor:g1,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?oE():+n)+(e==null?0:+e),!this._next&&ty!==this&&(ty?ty._next=this:V_=this,ty=this),this._call=t,this._time=n,KM()},stop:function(){this._call&&(this._call=null,this._time=1/0,KM())}};function RD(t,e,n){var i=new g1;return i.restart(t,e,n),i}function lbt(){oE(),++Mg;for(var t=V_,e;t;)(e=Vd-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Mg}function Q5(){Vd=(W_=p1.now())+sE,Mg=Z0=0;try{lbt()}finally{Mg=0,dbt(),Vd=0}}function fbt(){var t=p1.now(),e=t-W_;e>nY&&(sE-=e,W_=t)}function dbt(){for(var t,e=V_,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:V_=n);ty=t,KM(i)}function KM(t){if(!Mg){Z0&&(Z0=clearTimeout(Z0));var e=t-Vd;e>24?(t<1/0&&(Z0=setTimeout(Q5,t-p1.now()-sE)),c0&&(c0=clearInterval(c0))):(c0||(W_=p1.now(),c0=setInterval(fbt,nY)),Mg=1,iY(Q5))}}function Z5(t,e,n){var i=new g1;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}function hbt(t,e,n){var i=new g1,r=e;return e==null?(i.restart(t,e,n),i):(i._restart=i.restart,i.restart=function(s,o,a){o=+o,a=a==null?oE():+a,i._restart(function u(c){c+=r,i._restart(u,r+=o,a),s(c)},o,a)},i.restart(t,e,n),i)}var pbt=QS("start","end","cancel","interrupt"),gbt=[],rY=0,tL=1,JM=2,Zw=3,eL=4,QM=5,t2=6;function aE(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;mbt(t,n,{name:e,index:i,group:r,on:pbt,tween:gbt,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:rY})}function LD(t,e){var n=Oo(t,e);if(n.state>rY)throw new Error("too late; already scheduled");return n}function Ya(t,e){var n=Oo(t,e);if(n.state>Zw)throw new Error("too late; already running");return n}function Oo(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function mbt(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=RD(s,0,n.time);function s(c){n.state=tL,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var l,f,d,h;if(n.state!==tL)return u();for(l in i)if(h=i[l],h.name===n.name){if(h.state===Zw)return Z5(o);h.state===eL?(h.state=t2,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[l]):+l<e&&(h.state=t2,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[l])}if(Z5(function(){n.state===Zw&&(n.state=eL,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=JM,n.on.call("start",t,t.__data__,n.index,n.group),n.state===JM){for(n.state=Zw,r=new Array(d=n.tween.length),l=0,f=-1;l<d;++l)(h=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(r[++f]=h);r.length=f+1}}function a(c){for(var l=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(u),n.state=QM,1),f=-1,d=r.length;++f<d;)r[f].call(t,l);n.state===QM&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=t2,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function ZM(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>JM&&i.state<QM,i.state=t2,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function ybt(t){return this.each(function(){ZM(this,t)})}function bbt(t,e){var n,i;return function(){var r=Ya(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function vbt(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Ya(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:e,value:n},u=0,c=r.length;u<c;++u)if(r[u].name===e){r[u]=a;break}u===c&&r.push(a)}s.tween=r}}function wbt(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Oo(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?bbt:vbt)(n,t,e))}function BD(t,e,n){var i=t._id;return t.each(function(){var r=Ya(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Oo(r,i).value[e]}}function sY(t,e){var n;return(typeof e=="number"?ci:e instanceof Cl?Nl:(n=Cl(e))?(e=n,Nl):OD)(t,e)}function _bt(t){return function(){this.removeAttribute(t)}}function xbt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Sbt(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function Ebt(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Abt(t,e,n){var i,r,s;return function(){var o,a=n(this),u;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=a+"",o===u?null:o===i&&u===r?s:(r=u,s=e(i=o,a)))}}function $bt(t,e,n){var i,r,s;return function(){var o,a=n(this),u;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=a+"",o===u?null:o===i&&u===r?s:(r=u,s=e(i=o,a)))}}function Ibt(t,e){var n=ZS(t),i=n==="transform"?XG:sY;return this.attrTween(t,typeof e=="function"?(n.local?$bt:Abt)(n,i,BD(this,"attr."+t,e)):e==null?(n.local?xbt:_bt)(n):(n.local?Ebt:Sbt)(n,i,e))}function Mbt(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Tbt(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Fbt(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Tbt(t,s)),n}return r._value=e,r}function kbt(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Mbt(t,s)),n}return r._value=e,r}function Dbt(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=ZS(t);return this.tween(n,(i.local?Fbt:kbt)(i,e))}function Cbt(t,e){return function(){LD(this,t).delay=+e.apply(this,arguments)}}function Nbt(t,e){return e=+e,function(){LD(this,t).delay=e}}function Obt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Cbt:Nbt)(e,t)):Oo(this.node(),e).delay}function Rbt(t,e){return function(){Ya(this,t).duration=+e.apply(this,arguments)}}function Lbt(t,e){return e=+e,function(){Ya(this,t).duration=e}}function Bbt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Rbt:Lbt)(e,t)):Oo(this.node(),e).duration}function Pbt(t,e){if(typeof e!="function")throw new Error;return function(){Ya(this,t).ease=e}}function zbt(t){var e=this._id;return arguments.length?this.each(Pbt(e,t)):Oo(this.node(),e).ease}function Ubt(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Ya(this,t).ease=n}}function jbt(t){if(typeof t!="function")throw new Error;return this.each(Ubt(this._id,t))}function qbt(t){typeof t!="function"&&(t=gG(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,a=i[r]=[],u,c=0;c<o;++c)(u=s[c])&&t.call(u,u.__data__,c,s)&&a.push(u);return new ac(i,this._parents,this._name,this._id)}function Vbt(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var u=e[a],c=n[a],l=u.length,f=o[a]=new Array(l),d,h=0;h<l;++h)(d=u[h]||c[h])&&(f[h]=d);for(;a<i;++a)o[a]=e[a];return new ac(o,this._parents,this._name,this._id)}function Wbt(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Gbt(t,e,n){var i,r,s=Wbt(e)?LD:Ya;return function(){var o=s(this,t),a=o.on;a!==i&&(r=(i=a).copy()).on(e,n),o.on=r}}function Ybt(t,e){var n=this._id;return arguments.length<2?Oo(this.node(),n).on.on(t):this.each(Gbt(n,t,e))}function Hbt(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Xbt(){return this.on("end.remove",Hbt(this._id))}function Kbt(t){var e=this._name,n=this._id;typeof t!="function"&&(t=TD(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],u=a.length,c=s[o]=new Array(u),l,f,d=0;d<u;++d)(l=a[d])&&(f=t.call(l,l.__data__,d,a))&&("__data__"in l&&(f.__data__=l.__data__),c[d]=f,aE(c[d],e,n,d,c,Oo(l,n)));return new ac(s,this._parents,e,n)}function Jbt(t){var e=this._name,n=this._id;typeof t!="function"&&(t=pG(t));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var u=i[a],c=u.length,l,f=0;f<c;++f)if(l=u[f]){for(var d=t.call(l,l.__data__,f,u),h,p=Oo(l,n),g=0,m=d.length;g<m;++g)(h=d[g])&&aE(h,e,n,g,d,p);s.push(d),o.push(l)}return new ac(s,o,e,n)}var Qbt=gb.prototype.constructor;function Zbt(){return new Qbt(this._groups,this._parents)}function tvt(t,e){var n,i,r;return function(){var s=$g(this,t),o=(this.style.removeProperty(t),$g(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function oY(t){return function(){this.style.removeProperty(t)}}function evt(t,e,n){var i,r=n+"",s;return function(){var o=$g(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function nvt(t,e,n){var i,r,s;return function(){var o=$g(this,t),a=n(this),u=a+"";return a==null&&(u=a=(this.style.removeProperty(t),$g(this,t))),o===u?null:o===i&&u===r?s:(r=u,s=e(i=o,a))}}function ivt(t,e){var n,i,r,s="style."+e,o="end."+s,a;return function(){var u=Ya(this,t),c=u.on,l=u.value[s]==null?a||(a=oY(e)):void 0;(c!==n||r!==l)&&(i=(n=c).copy()).on(o,r=l),u.on=i}}function rvt(t,e,n){var i=(t+="")=="transform"?HG:sY;return e==null?this.styleTween(t,tvt(t,i)).on("end.style."+t,oY(t)):typeof e=="function"?this.styleTween(t,nvt(t,i,BD(this,"style."+t,e))).each(ivt(this._id,t)):this.styleTween(t,evt(t,i,e),n).on("end.style."+t,null)}function svt(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function ovt(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&svt(t,o,n)),i}return s._value=e,s}function avt(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,ovt(t,e,n??""))}function uvt(t){return function(){this.textContent=t}}function cvt(t){return function(){var e=t(this);this.textContent=e??""}}function lvt(t){return this.tween("text",typeof t=="function"?cvt(BD(this,"text",t)):uvt(t==null?"":t+""))}function fvt(t){return function(e){this.textContent=t.call(this,e)}}function dvt(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&fvt(r)),e}return i._value=t,i}function hvt(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,dvt(t))}function pvt(){for(var t=this._name,e=this._id,n=aY(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,u,c=0;c<a;++c)if(u=o[c]){var l=Oo(u,e);aE(u,t,n,c,o,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new ac(i,this._parents,t,n)}function gvt(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},u={value:function(){--r===0&&s()}};n.each(function(){var c=Ya(this,i),l=c.on;l!==t&&(e=(t=l).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(u)),c.on=e}),r===0&&s()})}var mvt=0;function ac(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function aY(){return++mvt}var lu=gb.prototype;ac.prototype={constructor:ac,select:Kbt,selectAll:Jbt,selectChild:lu.selectChild,selectChildren:lu.selectChildren,filter:qbt,merge:Vbt,selection:Zbt,transition:pvt,call:lu.call,nodes:lu.nodes,node:lu.node,size:lu.size,empty:lu.empty,each:lu.each,on:Ybt,attr:Ibt,attrTween:Dbt,style:rvt,styleTween:avt,text:lvt,textTween:hvt,remove:Xbt,tween:wbt,delay:Obt,duration:Bbt,ease:zbt,easeVarying:jbt,end:gvt,[Symbol.iterator]:lu[Symbol.iterator]};function yvt(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var bvt={time:null,delay:0,duration:250,ease:yvt};function vvt(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function wvt(t){var e,n;t instanceof ac?(e=t._id,t=t._name):(e=aY(),(n=bvt).time=oE(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,u,c=0;c<a;++c)(u=o[c])&&aE(u,t,e,c,o,n||vvt(u,e));return new ac(i,this._parents,t,e)}gb.prototype.interrupt=ybt;gb.prototype.transition=wvt;const hI=t=>()=>t;function _vt(t,{sourceEvent:e,target:n,selection:i,mode:r,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:i,enumerable:!0,configurable:!0},mode:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function xvt(t){t.stopImmediatePropagation()}function pI(t){t.preventDefault(),t.stopImmediatePropagation()}var nL={name:"drag"},gI={name:"space"},Wh={name:"handle"},Gh={name:"center"};const{abs:iL,max:wi,min:_i}=Math;function rL(t){return[+t[0],+t[1]]}function sL(t){return[rL(t[0]),rL(t[1])]}var e2={name:"x",handles:["w","e"].map(G_),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},n2={name:"y",handles:["n","s"].map(G_),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},fu={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},oL={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},aL={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Svt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Evt={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function G_(t){return{type:t}}function Avt(t){return!t.ctrlKey&&!t.button}function $vt(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Ivt(){return navigator.maxTouchPoints||"ontouchstart"in this}function mI(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function Mvt(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function Tvt(){return uY(e2)}function Fvt(){return uY(n2)}function uY(t){var e=$vt,n=Avt,i=Ivt,r=!0,s=QS("start","brush","end"),o=6,a;function u(m){var y=m.property("__brush",g).selectAll(".overlay").data([G_("overlay")]);y.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",fu.overlay).merge(y).each(function(){var v=mI(this).extent;fi(this).attr("x",v[0][0]).attr("y",v[0][1]).attr("width",v[1][0]-v[0][0]).attr("height",v[1][1]-v[0][1])}),m.selectAll(".selection").data([G_("selection")]).enter().append("rect").attr("class","selection").attr("cursor",fu.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var b=m.selectAll(".handle").data(t.handles,function(v){return v.type});b.exit().remove(),b.enter().append("rect").attr("class",function(v){return"handle handle--"+v.type}).attr("cursor",function(v){return fu[v.type]}),m.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(i).on("touchstart.brush",d).on("touchmove.brush",h).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(m,y,b){m.tween?m.on("start.brush",function(v){l(this,arguments).beforestart().start(v)}).on("interrupt.brush end.brush",function(v){l(this,arguments).end(v)}).tween("brush",function(){var v=this,w=v.__brush,_=l(v,arguments),S=w.selection,x=t.input(typeof y=="function"?y.apply(this,arguments):y,w.extent),E=vc(S,x);function A($){w.selection=$===1&&x===null?null:E($),c.call(v),_.brush()}return S!==null&&x!==null?A:A(1)}):m.each(function(){var v=this,w=arguments,_=v.__brush,S=t.input(typeof y=="function"?y.apply(v,w):y,_.extent),x=l(v,w).beforestart();ZM(v),_.selection=S===null?null:S,c.call(v),x.start(b).brush(b).end(b)})},u.clear=function(m,y){u.move(m,null,y)};function c(){var m=fi(this),y=mI(this).selection;y?(m.selectAll(".selection").style("display",null).attr("x",y[0][0]).attr("y",y[0][1]).attr("width",y[1][0]-y[0][0]).attr("height",y[1][1]-y[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(b){return b.type[b.type.length-1]==="e"?y[1][0]-o/2:y[0][0]-o/2}).attr("y",function(b){return b.type[0]==="s"?y[1][1]-o/2:y[0][1]-o/2}).attr("width",function(b){return b.type==="n"||b.type==="s"?y[1][0]-y[0][0]+o:o}).attr("height",function(b){return b.type==="e"||b.type==="w"?y[1][1]-y[0][1]+o:o})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function l(m,y,b){var v=m.__brush.emitter;return v&&(!b||!v.clean)?v:new f(m,y,b)}function f(m,y,b){this.that=m,this.args=y,this.state=m.__brush,this.active=0,this.clean=b}f.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(m,y){return this.starting?(this.starting=!1,this.emit("start",m,y)):this.emit("brush",m),this},brush:function(m,y){return this.emit("brush",m,y),this},end:function(m,y){return--this.active===0&&(delete this.state.emitter,this.emit("end",m,y)),this},emit:function(m,y,b){var v=fi(this.that).datum();s.call(m,this.that,new _vt(m,{sourceEvent:y,target:u,selection:t.output(this.state.selection),mode:b,dispatch:s}),v)}};function d(m){if(a&&!m.touches||!n.apply(this,arguments))return;var y=this,b=m.target.__data__.type,v=(r&&m.metaKey?b="overlay":b)==="selection"?nL:r&&m.altKey?Gh:Wh,w=t===n2?null:Svt[b],_=t===e2?null:Evt[b],S=mI(y),x=S.extent,E=S.selection,A=x[0][0],$,I,k=x[0][1],T,M,F=x[1][0],D,N,R=x[1][1],L,B,P=0,U=0,H,nt=w&&_&&r&&m.shiftKey,ft,dt,et=Array.from(m.touches||[m],ht=>{const $e=ht.identifier;return ht=WM(ht,y),ht.point0=ht.slice(),ht.identifier=$e,ht});ZM(y);var ct=l(y,arguments,!0).beforestart();if(b==="overlay"){E&&(H=!0);const ht=[et[0],et[1]||et[0]];S.selection=E=[[$=t===n2?A:_i(ht[0][0],ht[1][0]),T=t===e2?k:_i(ht[0][1],ht[1][1])],[D=t===n2?F:wi(ht[0][0],ht[1][0]),L=t===e2?R:wi(ht[0][1],ht[1][1])]],et.length>1&&Vt(m)}else $=E[0][0],T=E[0][1],D=E[1][0],L=E[1][1];I=$,M=T,N=D,B=L;var G=fi(y).attr("pointer-events","none"),st=G.selectAll(".overlay").attr("cursor",fu[b]);if(m.touches)ct.moved=V,ct.ended=mt;else{var lt=fi(m.view).on("mousemove.brush",V,!0).on("mouseup.brush",mt,!0);r&&lt.on("keydown.brush",ee,!0).on("keyup.brush",oe,!0),F1t(m.view)}c.call(y),ct.start(m,v.name);function V(ht){for(const $e of ht.changedTouches||[ht])for(const Wr of et)Wr.identifier===$e.identifier&&(Wr.cur=WM($e,y));if(nt&&!ft&&!dt&&et.length===1){const $e=et[0];iL($e.cur[0]-$e[0])>iL($e.cur[1]-$e[1])?dt=!0:ft=!0}for(const $e of et)$e.cur&&($e[0]=$e.cur[0],$e[1]=$e.cur[1]);H=!0,pI(ht),Vt(ht)}function Vt(ht){const $e=et[0],Wr=$e.point0;var Go;switch(P=$e[0]-Wr[0],U=$e[1]-Wr[1],v){case gI:case nL:{w&&(P=wi(A-$,_i(F-D,P)),I=$+P,N=D+P),_&&(U=wi(k-T,_i(R-L,U)),M=T+U,B=L+U);break}case Wh:{et[1]?(w&&(I=wi(A,_i(F,et[0][0])),N=wi(A,_i(F,et[1][0])),w=1),_&&(M=wi(k,_i(R,et[0][1])),B=wi(k,_i(R,et[1][1])),_=1)):(w<0?(P=wi(A-$,_i(F-$,P)),I=$+P,N=D):w>0&&(P=wi(A-D,_i(F-D,P)),I=$,N=D+P),_<0?(U=wi(k-T,_i(R-T,U)),M=T+U,B=L):_>0&&(U=wi(k-L,_i(R-L,U)),M=T,B=L+U));break}case Gh:{w&&(I=wi(A,_i(F,$-P*w)),N=wi(A,_i(F,D+P*w))),_&&(M=wi(k,_i(R,T-U*_)),B=wi(k,_i(R,L+U*_)));break}}N<I&&(w*=-1,Go=$,$=D,D=Go,Go=I,I=N,N=Go,b in oL&&st.attr("cursor",fu[b=oL[b]])),B<M&&(_*=-1,Go=T,T=L,L=Go,Go=M,M=B,B=Go,b in aL&&st.attr("cursor",fu[b=aL[b]])),S.selection&&(E=S.selection),ft&&(I=E[0][0],N=E[1][0]),dt&&(M=E[0][1],B=E[1][1]),(E[0][0]!==I||E[0][1]!==M||E[1][0]!==N||E[1][1]!==B)&&(S.selection=[[I,M],[N,B]],c.call(y),ct.brush(ht,v.name))}function mt(ht){if(xvt(ht),ht.touches){if(ht.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else k1t(ht.view,H),lt.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);G.attr("pointer-events","all"),st.attr("cursor",fu.overlay),S.selection&&(E=S.selection),Mvt(E)&&(S.selection=null,c.call(y)),ct.end(ht,v.name)}function ee(ht){switch(ht.keyCode){case 16:{nt=w&&_;break}case 18:{v===Wh&&(w&&(D=N-P*w,$=I+P*w),_&&(L=B-U*_,T=M+U*_),v=Gh,Vt(ht));break}case 32:{(v===Wh||v===Gh)&&(w<0?D=N-P:w>0&&($=I-P),_<0?L=B-U:_>0&&(T=M-U),v=gI,st.attr("cursor",fu.selection),Vt(ht));break}default:return}pI(ht)}function oe(ht){switch(ht.keyCode){case 16:{nt&&(ft=dt=nt=!1,Vt(ht));break}case 18:{v===Gh&&(w<0?D=N:w>0&&($=I),_<0?L=B:_>0&&(T=M),v=Wh,Vt(ht));break}case 32:{v===gI&&(ht.altKey?(w&&(D=N-P*w,$=I+P*w),_&&(L=B-U*_,T=M+U*_),v=Gh):(w<0?D=N:w>0&&($=I),_<0?L=B:_>0&&(T=M),v=Wh),st.attr("cursor",fu[b]),Vt(ht));break}default:return}pI(ht)}}function h(m){l(this,arguments).moved(m)}function p(m){l(this,arguments).ended(m)}function g(){var m=this.__brush||{selection:null};return m.extent=sL(e.apply(this,arguments)),m.dim=t,m}return u.extent=function(m){return arguments.length?(e=typeof m=="function"?m:hI(sL(m)),u):e},u.filter=function(m){return arguments.length?(n=typeof m=="function"?m:hI(!!m),u):n},u.touchable=function(m){return arguments.length?(i=typeof m=="function"?m:hI(!!m),u):i},u.handleSize=function(m){return arguments.length?(o=+m,u):o},u.keyModifiers=function(m){return arguments.length?(r=!!m,u):r},u.on=function(){var m=s.on.apply(s,arguments);return m===s?u:m},u}const tT=Math.PI,eT=2*tT,Zf=1e-6,kvt=eT-Zf;function cY(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Dvt(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return cY;const n=10**e;return function(i){this._+=i[0];for(let r=1,s=i.length;r<s;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}let uE=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?cY:Dvt(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,i,r){this._append`Q${+e},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(e,n,i,r,s,o){this._append`C${+e},${+n},${+i},${+r},${this._x1=+s},${this._y1=+o}`}arcTo(e,n,i,r,s){if(e=+e,n=+n,i=+i,r=+r,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,u=i-e,c=r-n,l=o-e,f=a-n,d=l*l+f*f;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(d>Zf)if(!(Math.abs(f*u-c*l)>Zf)||!s)this._append`L${this._x1=e},${this._y1=n}`;else{let h=i-o,p=r-a,g=u*u+c*c,m=h*h+p*p,y=Math.sqrt(g),b=Math.sqrt(d),v=s*Math.tan((tT-Math.acos((g+d-m)/(2*y*b)))/2),w=v/b,_=v/y;Math.abs(w-1)>Zf&&this._append`L${e+w*l},${n+w*f}`,this._append`A${s},${s},0,0,${+(f*h>l*p)},${this._x1=e+_*u},${this._y1=n+_*c}`}}arc(e,n,i,r,s,o){if(e=+e,n=+n,i=+i,o=!!o,i<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(r),u=i*Math.sin(r),c=e+a,l=n+u,f=1^o,d=o?r-s:s-r;this._x1===null?this._append`M${c},${l}`:(Math.abs(this._x1-c)>Zf||Math.abs(this._y1-l)>Zf)&&this._append`L${c},${l}`,i&&(d<0&&(d=d%eT+eT),d>kvt?this._append`A${i},${i},0,1,${f},${e-a},${n-u}A${i},${i},0,1,${f},${this._x1=c},${this._y1=l}`:d>Zf&&this._append`A${i},${i},0,${+(d>=tT)},${f},${this._x1=e+i*Math.cos(s)},${this._y1=n+i*Math.sin(s)}`)}rect(e,n,i,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}};function cE(){return new uE}cE.prototype=uE.prototype;function Vu(t=3){return new uE(+t)}var Cvt=Array.prototype,lY=Cvt.slice;function Nvt(t,e){return t-e}function Ovt(t){for(var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}const Gc=t=>()=>t;function Rvt(t,e){for(var n=-1,i=e.length,r;++n<i;)if(r=Lvt(t,e[n]))return r;return 0}function Lvt(t,e){for(var n=e[0],i=e[1],r=-1,s=0,o=t.length,a=o-1;s<o;a=s++){var u=t[s],c=u[0],l=u[1],f=t[a],d=f[0],h=f[1];if(Bvt(u,f,e))return 0;l>i!=h>i&&n<(d-c)*(i-l)/(h-l)+c&&(r=-r)}return r}function Bvt(t,e,n){var i;return Pvt(t,e,n)&&zvt(t[i=+(t[0]===e[0])],n[i],e[i])}function Pvt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(e[1]-t[1])}function zvt(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}function Uvt(){}var du=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function nT(){var t=1,e=1,n=ID,i=u;function r(c){var l=n(c);if(Array.isArray(l))l=l.slice().sort(Nvt);else{const f=zn(c,jvt);for(l=kl(...aG(f[0],f[1],l),l);l[l.length-1]>=f[1];)l.pop();for(;l[1]<f[0];)l.shift()}return l.map(f=>s(c,f))}function s(c,l){const f=l==null?NaN:+l;if(isNaN(f))throw new Error(`invalid value: ${l}`);var d=[],h=[];return o(c,f,function(p){i(p,c,f),Ovt(p)>0?d.push([p]):h.push(p)}),h.forEach(function(p){for(var g=0,m=d.length,y;g<m;++g)if(Rvt((y=d[g])[0],p)!==-1){y.push(p);return}}),{type:"MultiPolygon",value:l,coordinates:d}}function o(c,l,f){var d=new Array,h=new Array,p,g,m,y,b,v;for(p=g=-1,y=Mf(c[0],l),du[y<<1].forEach(w);++p<t-1;)m=y,y=Mf(c[p+1],l),du[m|y<<1].forEach(w);for(du[y<<0].forEach(w);++g<e-1;){for(p=-1,y=Mf(c[g*t+t],l),b=Mf(c[g*t],l),du[y<<1|b<<2].forEach(w);++p<t-1;)m=y,y=Mf(c[g*t+t+p+1],l),v=b,b=Mf(c[g*t+p+1],l),du[m|y<<1|b<<2|v<<3].forEach(w);du[y|b<<3].forEach(w)}for(p=-1,b=c[g*t]>=l,du[b<<2].forEach(w);++p<t-1;)v=b,b=Mf(c[g*t+p+1],l),du[b<<2|v<<3].forEach(w);du[b<<3].forEach(w);function w(_){var S=[_[0][0]+p,_[0][1]+g],x=[_[1][0]+p,_[1][1]+g],E=a(S),A=a(x),$,I;($=h[E])?(I=d[A])?(delete h[$.end],delete d[I.start],$===I?($.ring.push(x),f($.ring)):d[$.start]=h[I.end]={start:$.start,end:I.end,ring:$.ring.concat(I.ring)}):(delete h[$.end],$.ring.push(x),h[$.end=A]=$):($=d[A])?(I=h[E])?(delete d[$.start],delete h[I.end],$===I?($.ring.push(x),f($.ring)):d[I.start]=h[$.end]={start:I.start,end:$.end,ring:I.ring.concat($.ring)}):(delete d[$.start],$.ring.unshift(S),d[$.start=E]=$):d[E]=h[A]={start:E,end:A,ring:[S,x]}}}function a(c){return c[0]*2+c[1]*(t+1)*4}function u(c,l,f){c.forEach(function(d){var h=d[0],p=d[1],g=h|0,m=p|0,y=yI(l[m*t+g]);h>0&&h<t&&g===h&&(d[0]=uL(h,yI(l[m*t+g-1]),y,f)),p>0&&p<e&&m===p&&(d[1]=uL(p,yI(l[(m-1)*t+g]),y,f))})}return r.contour=s,r.size=function(c){if(!arguments.length)return[t,e];var l=Math.floor(c[0]),f=Math.floor(c[1]);if(!(l>=0&&f>=0))throw new Error("invalid size");return t=l,e=f,r},r.thresholds=function(c){return arguments.length?(n=typeof c=="function"?c:Array.isArray(c)?Gc(lY.call(c)):Gc(c),r):n},r.smooth=function(c){return arguments.length?(i=c?u:Uvt,r):i===u},r}function jvt(t){return isFinite(t)?t:NaN}function Mf(t,e){return t==null?!1:+t>=e}function yI(t){return t==null||isNaN(t=+t)?-1/0:t}function uL(t,e,n,i){const r=i-e,s=n-e,o=isFinite(r)||isFinite(s)?r/s:Math.sign(r)/Math.sign(s);return isNaN(o)?t:t+o-.5}function qvt(t){return t[0]}function Vvt(t){return t[1]}function Wvt(){return 1}function Gvt(){var t=qvt,e=Vvt,n=Wvt,i=960,r=500,s=20,o=2,a=s*3,u=i+a*2>>o,c=r+a*2>>o,l=Gc(20);function f(b){var v=new Float32Array(u*c),w=Math.pow(2,-o),_=-1;for(const T of b){var S=(t(T,++_,b)+a)*w,x=(e(T,_,b)+a)*w,E=+n(T,_,b);if(E&&S>=0&&S<u&&x>=0&&x<c){var A=Math.floor(S),$=Math.floor(x),I=S-A-.5,k=x-$-.5;v[A+$*u]+=(1-I)*(1-k)*E,v[A+1+$*u]+=I*(1-k)*E,v[A+1+($+1)*u]+=I*k*E,v[A+($+1)*u]+=(1-I)*k*E}}return tG({data:v,width:u,height:c},s*w),v}function d(b){var v=f(b),w=l(v),_=Math.pow(2,2*o);return Array.isArray(w)||(w=kl(Number.MIN_VALUE,tn(v)/_,w)),nT().size([u,c]).thresholds(w.map(S=>S*_))(v).map((S,x)=>(S.value=+w[x],h(S)))}d.contours=function(b){var v=f(b),w=nT().size([u,c]),_=Math.pow(2,2*o),S=x=>{x=+x;var E=h(w.contour(v,x*_));return E.value=x,E};return Object.defineProperty(S,"max",{get:()=>tn(v)/_}),S};function h(b){return b.coordinates.forEach(p),b}function p(b){b.forEach(g)}function g(b){b.forEach(m)}function m(b){b[0]=b[0]*Math.pow(2,o)-a,b[1]=b[1]*Math.pow(2,o)-a}function y(){return a=s*3,u=i+a*2>>o,c=r+a*2>>o,d}return d.x=function(b){return arguments.length?(t=typeof b=="function"?b:Gc(+b),d):t},d.y=function(b){return arguments.length?(e=typeof b=="function"?b:Gc(+b),d):e},d.weight=function(b){return arguments.length?(n=typeof b=="function"?b:Gc(+b),d):n},d.size=function(b){if(!arguments.length)return[i,r];var v=+b[0],w=+b[1];if(!(v>=0&&w>=0))throw new Error("invalid size");return i=v,r=w,y()},d.cellSize=function(b){if(!arguments.length)return 1<<o;if(!((b=+b)>=1))throw new Error("invalid cell size");return o=Math.floor(Math.log(b)/Math.LN2),y()},d.thresholds=function(b){return arguments.length?(l=typeof b=="function"?b:Array.isArray(b)?Gc(lY.call(b)):Gc(b),d):l},d.bandwidth=function(b){if(!arguments.length)return Math.sqrt(s*(s+1));if(!((b=+b)>=0))throw new Error("invalid bandwidth");return s=(Math.sqrt(4*b*b+1)-1)/2,y()},d}const Xu=11102230246251565e-32,xi=134217729,Yvt=(3+8*Xu)*Xu;function bI(t,e,n,i,r){let s,o,a,u,c=e[0],l=i[0],f=0,d=0;l>c==l>-c?(s=c,c=e[++f]):(s=l,l=i[++d]);let h=0;if(f<t&&d<n)for(l>c==l>-c?(o=c+s,a=s-(o-c),c=e[++f]):(o=l+s,a=s-(o-l),l=i[++d]),s=o,a!==0&&(r[h++]=a);f<t&&d<n;)l>c==l>-c?(o=s+c,u=o-s,a=s-(o-u)+(c-u),c=e[++f]):(o=s+l,u=o-s,a=s-(o-u)+(l-u),l=i[++d]),s=o,a!==0&&(r[h++]=a);for(;f<t;)o=s+c,u=o-s,a=s-(o-u)+(c-u),c=e[++f],s=o,a!==0&&(r[h++]=a);for(;d<n;)o=s+l,u=o-s,a=s-(o-u)+(l-u),l=i[++d],s=o,a!==0&&(r[h++]=a);return(s!==0||h===0)&&(r[h++]=s),h}function Hvt(t,e){let n=e[0];for(let i=1;i<t;i++)n+=e[i];return n}function yb(t){return new Float64Array(t)}const Xvt=(3+16*Xu)*Xu,Kvt=(2+12*Xu)*Xu,Jvt=(9+64*Xu)*Xu*Xu,Yh=yb(4),cL=yb(8),lL=yb(12),fL=yb(16),Pi=yb(4);function Qvt(t,e,n,i,r,s,o){let a,u,c,l,f,d,h,p,g,m,y,b,v,w,_,S,x,E;const A=t-r,$=n-r,I=e-s,k=i-s;w=A*k,d=xi*A,h=d-(d-A),p=A-h,d=xi*k,g=d-(d-k),m=k-g,_=p*m-(w-h*g-p*g-h*m),S=I*$,d=xi*I,h=d-(d-I),p=I-h,d=xi*$,g=d-(d-$),m=$-g,x=p*m-(S-h*g-p*g-h*m),y=_-x,f=_-y,Yh[0]=_-(y+f)+(f-x),b=w+y,f=b-w,v=w-(b-f)+(y-f),y=v-S,f=v-y,Yh[1]=v-(y+f)+(f-S),E=b+y,f=E-b,Yh[2]=b-(E-f)+(y-f),Yh[3]=E;let T=Hvt(4,Yh),M=Kvt*o;if(T>=M||-T>=M||(f=t-A,a=t-(A+f)+(f-r),f=n-$,c=n-($+f)+(f-r),f=e-I,u=e-(I+f)+(f-s),f=i-k,l=i-(k+f)+(f-s),a===0&&u===0&&c===0&&l===0)||(M=Jvt*o+Yvt*Math.abs(T),T+=A*l+k*a-(I*c+$*u),T>=M||-T>=M))return T;w=a*k,d=xi*a,h=d-(d-a),p=a-h,d=xi*k,g=d-(d-k),m=k-g,_=p*m-(w-h*g-p*g-h*m),S=u*$,d=xi*u,h=d-(d-u),p=u-h,d=xi*$,g=d-(d-$),m=$-g,x=p*m-(S-h*g-p*g-h*m),y=_-x,f=_-y,Pi[0]=_-(y+f)+(f-x),b=w+y,f=b-w,v=w-(b-f)+(y-f),y=v-S,f=v-y,Pi[1]=v-(y+f)+(f-S),E=b+y,f=E-b,Pi[2]=b-(E-f)+(y-f),Pi[3]=E;const F=bI(4,Yh,4,Pi,cL);w=A*l,d=xi*A,h=d-(d-A),p=A-h,d=xi*l,g=d-(d-l),m=l-g,_=p*m-(w-h*g-p*g-h*m),S=I*c,d=xi*I,h=d-(d-I),p=I-h,d=xi*c,g=d-(d-c),m=c-g,x=p*m-(S-h*g-p*g-h*m),y=_-x,f=_-y,Pi[0]=_-(y+f)+(f-x),b=w+y,f=b-w,v=w-(b-f)+(y-f),y=v-S,f=v-y,Pi[1]=v-(y+f)+(f-S),E=b+y,f=E-b,Pi[2]=b-(E-f)+(y-f),Pi[3]=E;const D=bI(F,cL,4,Pi,lL);w=a*l,d=xi*a,h=d-(d-a),p=a-h,d=xi*l,g=d-(d-l),m=l-g,_=p*m-(w-h*g-p*g-h*m),S=u*c,d=xi*u,h=d-(d-u),p=u-h,d=xi*c,g=d-(d-c),m=c-g,x=p*m-(S-h*g-p*g-h*m),y=_-x,f=_-y,Pi[0]=_-(y+f)+(f-x),b=w+y,f=b-w,v=w-(b-f)+(y-f),y=v-S,f=v-y,Pi[1]=v-(y+f)+(f-S),E=b+y,f=E-b,Pi[2]=b-(E-f)+(y-f),Pi[3]=E;const N=bI(D,lL,4,Pi,fL);return fL[N-1]}function Cv(t,e,n,i,r,s){const o=(e-s)*(n-r),a=(t-r)*(i-s),u=o-a,c=Math.abs(o+a);return Math.abs(u)>=Xvt*c?u:-Qvt(t,e,n,i,r,s,c)}const dL=Math.pow(2,-52),Nv=new Uint32Array(512);class Y_{static from(e,n=iwt,i=rwt){const r=e.length,s=new Float64Array(r*2);for(let o=0;o<r;o++){const a=e[o];s[2*o]=n(a),s[2*o+1]=i(a)}return new Y_(s)}constructor(e){const n=e.length>>1;if(n>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:e,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:s}=this,o=e.length>>1;let a=1/0,u=1/0,c=-1/0,l=-1/0;for(let A=0;A<o;A++){const $=e[2*A],I=e[2*A+1];$<a&&(a=$),I<u&&(u=I),$>c&&(c=$),I>l&&(l=I),this._ids[A]=A}const f=(a+c)/2,d=(u+l)/2;let h,p,g;for(let A=0,$=1/0;A<o;A++){const I=vI(f,d,e[2*A],e[2*A+1]);I<$&&(h=A,$=I)}const m=e[2*h],y=e[2*h+1];for(let A=0,$=1/0;A<o;A++){if(A===h)continue;const I=vI(m,y,e[2*A],e[2*A+1]);I<$&&I>0&&(p=A,$=I)}let b=e[2*p],v=e[2*p+1],w=1/0;for(let A=0;A<o;A++){if(A===h||A===p)continue;const $=ewt(m,y,b,v,e[2*A],e[2*A+1]);$<w&&(g=A,w=$)}let _=e[2*g],S=e[2*g+1];if(w===1/0){for(let I=0;I<o;I++)this._dists[I]=e[2*I]-e[0]||e[2*I+1]-e[1];Cp(this._ids,this._dists,0,o-1);const A=new Uint32Array(o);let $=0;for(let I=0,k=-1/0;I<o;I++){const T=this._ids[I],M=this._dists[T];M>k&&(A[$++]=T,k=M)}this.hull=A.subarray(0,$),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Cv(m,y,b,v,_,S)<0){const A=p,$=b,I=v;p=g,b=_,v=S,g=A,_=$,S=I}const x=nwt(m,y,b,v,_,S);this._cx=x.x,this._cy=x.y;for(let A=0;A<o;A++)this._dists[A]=vI(e[2*A],e[2*A+1],x.x,x.y);Cp(this._ids,this._dists,0,o-1),this._hullStart=h;let E=3;i[h]=n[g]=p,i[p]=n[h]=g,i[g]=n[p]=h,r[h]=0,r[p]=1,r[g]=2,s.fill(-1),s[this._hashKey(m,y)]=h,s[this._hashKey(b,v)]=p,s[this._hashKey(_,S)]=g,this.trianglesLen=0,this._addTriangle(h,p,g,-1,-1,-1);for(let A=0,$,I;A<this._ids.length;A++){const k=this._ids[A],T=e[2*k],M=e[2*k+1];if(A>0&&Math.abs(T-$)<=dL&&Math.abs(M-I)<=dL||($=T,I=M,k===h||k===p||k===g))continue;let F=0;for(let B=0,P=this._hashKey(T,M);B<this._hashSize&&(F=s[(P+B)%this._hashSize],!(F!==-1&&F!==i[F]));B++);F=n[F];let D=F,N;for(;N=i[D],Cv(T,M,e[2*D],e[2*D+1],e[2*N],e[2*N+1])>=0;)if(D=N,D===F){D=-1;break}if(D===-1)continue;let R=this._addTriangle(D,k,i[D],-1,-1,r[D]);r[k]=this._legalize(R+2),r[D]=R,E++;let L=i[D];for(;N=i[L],Cv(T,M,e[2*L],e[2*L+1],e[2*N],e[2*N+1])<0;)R=this._addTriangle(L,k,N,r[k],-1,r[L]),r[k]=this._legalize(R+2),i[L]=L,E--,L=N;if(D===F)for(;N=n[D],Cv(T,M,e[2*N],e[2*N+1],e[2*D],e[2*D+1])<0;)R=this._addTriangle(N,k,D,-1,r[D],r[N]),this._legalize(R+2),r[N]=R,i[D]=D,E--,D=N;this._hullStart=n[k]=D,i[D]=n[L]=k,i[k]=L,s[this._hashKey(T,M)]=k,s[this._hashKey(e[2*D],e[2*D+1])]=D}this.hull=new Uint32Array(E);for(let A=0,$=this._hullStart;A<E;A++)this.hull[A]=$,$=i[$];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,n){return Math.floor(Zvt(e-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:n,_halfedges:i,coords:r}=this;let s=0,o=0;for(;;){const a=i[e],u=e-e%3;if(o=u+(e+2)%3,a===-1){if(s===0)break;e=Nv[--s];continue}const c=a-a%3,l=u+(e+1)%3,f=c+(a+2)%3,d=n[o],h=n[e],p=n[l],g=n[f];if(twt(r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1],r[2*g],r[2*g+1])){n[e]=g,n[a]=d;const y=i[f];if(y===-1){let v=this._hullStart;do{if(this._hullTri[v]===f){this._hullTri[v]=e;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(e,y),this._link(a,i[o]),this._link(o,f);const b=c+(a+1)%3;s<Nv.length&&(Nv[s++]=b)}else{if(s===0)break;e=Nv[--s]}}return o}_link(e,n){this._halfedges[e]=n,n!==-1&&(this._halfedges[n]=e)}_addTriangle(e,n,i,r,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function Zvt(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}function vI(t,e,n,i){const r=t-n,s=e-i;return r*r+s*s}function twt(t,e,n,i,r,s,o,a){const u=t-o,c=e-a,l=n-o,f=i-a,d=r-o,h=s-a,p=u*u+c*c,g=l*l+f*f,m=d*d+h*h;return u*(f*m-g*h)-c*(l*m-g*d)+p*(l*h-f*d)<0}function ewt(t,e,n,i,r,s){const o=n-t,a=i-e,u=r-t,c=s-e,l=o*o+a*a,f=u*u+c*c,d=.5/(o*c-a*u),h=(c*l-a*f)*d,p=(o*f-u*l)*d;return h*h+p*p}function nwt(t,e,n,i,r,s){const o=n-t,a=i-e,u=r-t,c=s-e,l=o*o+a*a,f=u*u+c*c,d=.5/(o*c-a*u),h=t+(c*l-a*f)*d,p=e+(o*f-u*l)*d;return{x:h,y:p}}function Cp(t,e,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const s=t[r],o=e[s];let a=r-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=s}else{const r=n+i>>1;let s=n+1,o=i;l0(t,r,s),e[t[n]]>e[t[i]]&&l0(t,n,i),e[t[s]]>e[t[i]]&&l0(t,s,i),e[t[n]]>e[t[s]]&&l0(t,n,s);const a=t[s],u=e[a];for(;;){do s++;while(e[t[s]]<u);do o--;while(e[t[o]]>u);if(o<s)break;l0(t,s,o)}t[n+1]=t[o],t[o]=a,i-s+1>=o-n?(Cp(t,e,s,i),Cp(t,e,n,o-1)):(Cp(t,e,n,o-1),Cp(t,e,s,i))}}function l0(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function iwt(t){return t[0]}function rwt(t){return t[1]}const hL=1e-6;class vd{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,n){this._+=`L${this._x1=+e},${this._y1=+n}`}arc(e,n,i){e=+e,n=+n,i=+i;const r=e+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>hL||Math.abs(this._y1-s)>hL)&&(this._+="L"+r+","+s),i&&(this._+=`A${i},${i},0,1,1,${e-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(e,n,i,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class iT{constructor(){this._=[]}moveTo(e,n){this._.push([e,n])}closePath(){this._.push(this._[0].slice())}lineTo(e,n){this._.push([e,n])}value(){return this._.length?this._:null}}let swt=class{constructor(e,[n,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=r,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:n,triangles:i},vectors:r}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let g=0,m=0,y=i.length,b,v;g<y;g+=3,m+=2){const w=i[g]*2,_=i[g+1]*2,S=i[g+2]*2,x=e[w],E=e[w+1],A=e[_],$=e[_+1],I=e[S],k=e[S+1],T=A-x,M=$-E,F=I-x,D=k-E,N=(T*D-M*F)*2;if(Math.abs(N)<1e-9){if(s===void 0){s=o=0;for(const L of n)s+=e[L*2],o+=e[L*2+1];s/=n.length,o/=n.length}const R=1e9*Math.sign((s-x)*D-(o-E)*F);b=(x+I)/2-R*D,v=(E+k)/2+R*F}else{const R=1/N,L=T*T+M*M,B=F*F+D*D;b=x+(D*L-M*B)*R,v=E+(T*B-F*L)*R}a[m]=b,a[m+1]=v}let u=n[n.length-1],c,l=u*4,f,d=e[2*u],h,p=e[2*u+1];r.fill(0);for(let g=0;g<n.length;++g)u=n[g],c=l,f=d,h=p,l=u*4,d=e[2*u],p=e[2*u+1],r[c+2]=r[l]=h-p,r[c+3]=r[l+1]=d-f}render(e){const n=e==null?e=new vd:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let l=0,f=i.length;l<f;++l){const d=i[l];if(d<l)continue;const h=Math.floor(l/3)*2,p=Math.floor(d/3)*2,g=o[h],m=o[h+1],y=o[p],b=o[p+1];this._renderSegment(g,m,y,b,e)}let u,c=s[s.length-1];for(let l=0;l<s.length;++l){u=c,c=s[l];const f=Math.floor(r[c]/3)*2,d=o[f],h=o[f+1],p=u*4,g=this._project(d,h,a[p+2],a[p+3]);g&&this._renderSegment(d,h,g[0],g[1],e)}return n&&n.value()}renderBounds(e){const n=e==null?e=new vd:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(e,n){const i=n==null?n=new vd:void 0,r=this._clip(e);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(r[o]!==r[o-2]||r[o+1]!==r[o-1])&&n.lineTo(r[o],r[o+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let n=0,i=e.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(e){const n=new iT;return this.renderCell(e,n),n.value()}_renderSegment(e,n,i,r,s){let o;const a=this._regioncode(e,n),u=this._regioncode(i,r);a===0&&u===0?(s.moveTo(e,n),s.lineTo(i,r)):(o=this._clipSegment(e,n,i,r,a,u))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(e,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(e,n,i)===e}*neighbors(e){const n=this._clip(e);if(n)for(const i of this.delaunay.neighbors(e)){const r=this._clip(i);if(r){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,u=r.length;a<u;a+=2)if(n[s]===r[a]&&n[s+1]===r[a+1]&&n[(s+2)%o]===r[(a+u-2)%u]&&n[(s+3)%o]===r[(a+u-1)%u]){yield i;break t}}}}_cell(e){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,o=i[e];if(o===-1)return null;const a=[];let u=o;do{const c=Math.floor(u/3);if(a.push(n[c*2],n[c*2+1]),u=u%3===2?u-2:u+1,s[u]!==e)break;u=r[u]}while(u!==o&&u!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(e);if(n===null)return null;const{vectors:i}=this,r=e*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(e,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(e,n))}_clipFinite(e,n){const i=n.length;let r=null,s,o,a=n[i-2],u=n[i-1],c,l=this._regioncode(a,u),f,d=0;for(let h=0;h<i;h+=2)if(s=a,o=u,a=n[h],u=n[h+1],c=l,l=this._regioncode(a,u),c===0&&l===0)f=d,d=0,r?r.push(a,u):r=[a,u];else{let p,g,m,y,b;if(c===0){if((p=this._clipSegment(s,o,a,u,c,l))===null)continue;[g,m,y,b]=p}else{if((p=this._clipSegment(a,u,s,o,l,c))===null)continue;[y,b,g,m]=p,f=d,d=this._edgecode(g,m),f&&d&&this._edge(e,f,d,r,r.length),r?r.push(g,m):r=[g,m]}f=d,d=this._edgecode(y,b),f&&d&&this._edge(e,f,d,r,r.length),r?r.push(y,b):r=[y,b]}if(r)f=d,d=this._edgecode(r[0],r[1]),f&&d&&this._edge(e,f,d,r,r.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(e,n,i,r,s,o){const a=s<o;for(a&&([e,n,i,r,s,o]=[i,r,e,n,o,s]);;){if(s===0&&o===0)return a?[i,r,e,n]:[e,n,i,r];if(s&o)return null;let u,c,l=s||o;l&8?(u=e+(i-e)*(this.ymax-n)/(r-n),c=this.ymax):l&4?(u=e+(i-e)*(this.ymin-n)/(r-n),c=this.ymin):l&2?(c=n+(r-n)*(this.xmax-e)/(i-e),u=this.xmax):(c=n+(r-n)*(this.xmin-e)/(i-e),u=this.xmin),s?(e=u,n=c,s=this._regioncode(e,n)):(i=u,r=c,o=this._regioncode(i,r))}}_clipInfinite(e,n,i,r,s,o){let a=Array.from(n),u;if((u=this._project(a[0],a[1],i,r))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(u[0],u[1]),a=this._clipFinite(e,a))for(let c=0,l=a.length,f,d=this._edgecode(a[l-2],a[l-1]);c<l;c+=2)f=d,d=this._edgecode(a[c],a[c+1]),f&&d&&(c=this._edge(e,f,d,a,c),l=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,n,i,r,s){for(;n!==i;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(r[s]!==o||r[s+1]!==a)&&this.contains(e,o,a)&&(r.splice(s,0,o,a),s+=2)}return s}_project(e,n,i,r){let s=1/0,o,a,u;if(r<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/r)<s&&(u=this.ymin,a=e+(s=o)*i)}else if(r>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/r)<s&&(u=this.ymax,a=e+(s=o)*i)}if(i>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/i)<s&&(a=this.xmax,u=n+(s=o)*r)}else if(i<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/i)<s&&(a=this.xmin,u=n+(s=o)*r)}return[a,u]}_edgecode(e,n){return(e===this.xmin?1:e===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(e,n){return(e<this.xmin?1:e>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let n=0;n<e.length;n+=2){const i=(n+2)%e.length,r=(n+4)%e.length;(e[n]===e[i]&&e[i]===e[r]||e[n+1]===e[i+1]&&e[i+1]===e[r+1])&&(e.splice(i,2),n-=2)}e.length||(e=null)}return e}};const owt=2*Math.PI,Hh=Math.pow;function awt(t){return t[0]}function uwt(t){return t[1]}function cwt(t){const{triangles:e,coords:n}=t;for(let i=0;i<e.length;i+=3){const r=2*e[i],s=2*e[i+1],o=2*e[i+2];if((n[o]-n[r])*(n[s+1]-n[r+1])-(n[s]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}function lwt(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class wc{static from(e,n=awt,i=uwt,r){return new wc("length"in e?fwt(e,n,i,r):Float64Array.from(dwt(e,n,i,r)))}constructor(e){this._delaunator=new Y_(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,n=this.points;if(e.hull&&e.hull.length>2&&cwt(e)){this.collinear=Int32Array.from({length:n.length/2},(d,h)=>h).sort((d,h)=>n[2*d]-n[2*h]||n[2*d+1]-n[2*h+1]);const u=this.collinear[0],c=this.collinear[this.collinear.length-1],l=[n[2*u],n[2*u+1],n[2*c],n[2*c+1]],f=1e-8*Math.hypot(l[3]-l[1],l[2]-l[0]);for(let d=0,h=n.length/2;d<h;++d){const p=lwt(n[2*d],n[2*d+1],f);n[2*d]=p[0],n[2*d+1]=p[1]}this._delaunator=new Y_(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,c=i.length;u<c;++u){const l=s[u%3===2?u-2:u+1];(i[u]===-1||o[l]===-1)&&(o[l]=u)}for(let u=0,c=r.length;u<c;++u)a[r[u]]=u;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,r.length===2&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(e){return new swt(this,e)}*neighbors(e){const{inedges:n,hull:i,_hullIndex:r,halfedges:s,triangles:o,collinear:a}=this;if(a){const f=a.indexOf(e);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[e];if(u===-1)return;let c=u,l=-1;do{if(yield l=o[c],c=c%3===2?c-2:c+1,o[c]!==e)return;if(c=s[c],c===-1){const f=i[(r[e]+1)%i.length];f!==l&&(yield f);return}}while(c!==u)}find(e,n,i=0){if(e=+e,e!==e||(n=+n,n!==n))return-1;const r=i;let s;for(;(s=this._step(i,e,n))>=0&&s!==i&&s!==r;)i=s;return s}_step(e,n,i){const{inedges:r,hull:s,_hullIndex:o,halfedges:a,triangles:u,points:c}=this;if(r[e]===-1||!c.length)return(e+1)%(c.length>>1);let l=e,f=Hh(n-c[e*2],2)+Hh(i-c[e*2+1],2);const d=r[e];let h=d;do{let p=u[h];const g=Hh(n-c[p*2],2)+Hh(i-c[p*2+1],2);if(g<f&&(f=g,l=p),h=h%3===2?h-2:h+1,u[h]!==e)break;if(h=a[h],h===-1){if(h=s[(o[e]+1)%s.length],h!==p&&Hh(n-c[h*2],2)+Hh(i-c[h*2+1],2)<f)return h;break}}while(h!==d);return l}render(e){const n=e==null?e=new vd:void 0,{points:i,halfedges:r,triangles:s}=this;for(let o=0,a=r.length;o<a;++o){const u=r[o];if(u<o)continue;const c=s[o]*2,l=s[u]*2;e.moveTo(i[c],i[c+1]),e.lineTo(i[l],i[l+1])}return this.renderHull(e),n&&n.value()}renderPoints(e,n){n===void 0&&(!e||typeof e.moveTo!="function")&&(n=e,e=null),n=n==null?2:+n;const i=e==null?e=new vd:void 0,{points:r}=this;for(let s=0,o=r.length;s<o;s+=2){const a=r[s],u=r[s+1];e.moveTo(a+n,u),e.arc(a,u,n,0,owt)}return i&&i.value()}renderHull(e){const n=e==null?e=new vd:void 0,{hull:i,points:r}=this,s=i[0]*2,o=i.length;e.moveTo(r[s],r[s+1]);for(let a=1;a<o;++a){const u=2*i[a];e.lineTo(r[u],r[u+1])}return e.closePath(),n&&n.value()}hullPolygon(){const e=new iT;return this.renderHull(e),e.value()}renderTriangle(e,n){const i=n==null?n=new vd:void 0,{points:r,triangles:s}=this,o=s[e*=3]*2,a=s[e+1]*2,u=s[e+2]*2;return n.moveTo(r[o],r[o+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[u],r[u+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:e}=this;for(let n=0,i=e.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(e){const n=new iT;return this.renderTriangle(e,n),n.value()}}function fwt(t,e,n,i){const r=t.length,s=new Float64Array(r*2);for(let o=0;o<r;++o){const a=t[o];s[o*2]=e.call(i,a,o,t),s[o*2+1]=n.call(i,a,o,t)}return s}function*dwt(t,e,n,i){let r=0;for(const s of t)yield e.call(i,s,r,t),yield n.call(i,s,r,t),++r}var pL={},wI={},_I=34,f0=10,xI=13;function fY(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function hwt(t,e){var n=fY(t);return function(i,r){return e(n(i),r,t)}}function gL(t){var e=Object.create(null),n=[];return t.forEach(function(i){for(var r in i)r in e||n.push(e[r]=r)}),n}function gr(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function pwt(t){return t<0?"-"+gr(-t,6):t>9999?"+"+gr(t,6):gr(t,4)}function gwt(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),r=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":pwt(t.getUTCFullYear())+"-"+gr(t.getUTCMonth()+1,2)+"-"+gr(t.getUTCDate(),2)+(r?"T"+gr(e,2)+":"+gr(n,2)+":"+gr(i,2)+"."+gr(r,3)+"Z":i?"T"+gr(e,2)+":"+gr(n,2)+":"+gr(i,2)+"Z":n||e?"T"+gr(e,2)+":"+gr(n,2)+"Z":"")}function mwt(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function i(f,d){var h,p,g=r(f,function(m,y){if(h)return h(m,y-1);p=m,h=d?hwt(m,d):fY(m)});return g.columns=p||[],g}function r(f,d){var h=[],p=f.length,g=0,m=0,y,b=p<=0,v=!1;f.charCodeAt(p-1)===f0&&--p,f.charCodeAt(p-1)===xI&&--p;function w(){if(b)return wI;if(v)return v=!1,pL;var S,x=g,E;if(f.charCodeAt(x)===_I){for(;g++<p&&f.charCodeAt(g)!==_I||f.charCodeAt(++g)===_I;);return(S=g)>=p?b=!0:(E=f.charCodeAt(g++))===f0?v=!0:E===xI&&(v=!0,f.charCodeAt(g)===f0&&++g),f.slice(x+1,S-1).replace(/""/g,'"')}for(;g<p;){if((E=f.charCodeAt(S=g++))===f0)v=!0;else if(E===xI)v=!0,f.charCodeAt(g)===f0&&++g;else if(E!==n)continue;return f.slice(x,S)}return b=!0,f.slice(x,p)}for(;(y=w())!==wI;){for(var _=[];y!==pL&&y!==wI;)_.push(y),y=w();d&&(_=d(_,m++))==null||h.push(_)}return h}function s(f,d){return f.map(function(h){return d.map(function(p){return l(h[p])}).join(t)})}function o(f,d){return d==null&&(d=gL(f)),[d.map(l).join(t)].concat(s(f,d)).join(`
`)}function a(f,d){return d==null&&(d=gL(f)),s(f,d).join(`
`)}function u(f){return f.map(c).join(`
`)}function c(f){return f.map(l).join(t)}function l(f){return f==null?"":f instanceof Date?gwt(f):e.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:o,formatBody:a,formatRows:u,formatRow:c,formatValue:l}}function ywt(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,a,u=0,c=0;for(s=0;s<o;++s)a=n[s],u+=a.x,c+=a.y;for(u=(u/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)a=n[s],a.x-=u,a.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function bwt(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return dY(this.cover(e,n),e,n,t)}function dY(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},a=t._x0,u=t._y0,c=t._x1,l=t._y1,f,d,h,p,g,m,y,b;if(!s)return t._root=o,t;for(;s.length;)if((g=e>=(f=(a+c)/2))?a=f:c=f,(m=n>=(d=(u+l)/2))?u=d:l=d,r=s,!(s=s[y=m<<1|g]))return r[y]=o,t;if(h=+t._x.call(null,s.data),p=+t._y.call(null,s.data),e===h&&n===p)return o.next=s,r?r[y]=o:t._root=o,t;do r=r?r[y]=new Array(4):t._root=new Array(4),(g=e>=(f=(a+c)/2))?a=f:c=f,(m=n>=(d=(u+l)/2))?u=d:l=d;while((y=m<<1|g)===(b=(p>=d)<<1|h>=f));return r[b]=s,r[y]=o,t}function vwt(t){var e,n,i=t.length,r,s,o=new Array(i),a=new Array(i),u=1/0,c=1/0,l=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,a[n]=s,r<u&&(u=r),r>l&&(l=r),s<c&&(c=s),s>f&&(f=s));if(u>l||c>f)return this;for(this.cover(u,c).cover(l,f),n=0;n<i;++n)dY(this,o[n],a[n],t[n]);return this}function wwt(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,a=this._root,u,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,u=new Array(4),u[c]=a,a=u,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function _wt(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function xwt(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Ji(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Swt(t,e,n){var i,r=this._x0,s=this._y0,o,a,u,c,l=this._x1,f=this._y1,d=[],h=this._root,p,g;for(h&&d.push(new Ji(h,r,s,l,f)),n==null?n=1/0:(r=t-n,s=e-n,l=t+n,f=e+n,n*=n);p=d.pop();)if(!(!(h=p.node)||(o=p.x0)>l||(a=p.y0)>f||(u=p.x1)<r||(c=p.y1)<s))if(h.length){var m=(o+u)/2,y=(a+c)/2;d.push(new Ji(h[3],m,y,u,c),new Ji(h[2],o,y,m,c),new Ji(h[1],m,a,u,y),new Ji(h[0],o,a,m,y)),(g=(e>=y)<<1|t>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var b=t-+this._x.call(null,h.data),v=e-+this._y.call(null,h.data),w=b*b+v*v;if(w<n){var _=Math.sqrt(n=w);r=t-_,s=e-_,l=t+_,f=e+_,i=h.data}}return i}function Ewt(t){if(isNaN(l=+this._x.call(null,t))||isNaN(f=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,a=this._y0,u=this._x1,c=this._y1,l,f,d,h,p,g,m,y;if(!n)return this;if(n.length)for(;;){if((p=l>=(d=(o+u)/2))?o=d:u=d,(g=f>=(h=(a+c)/2))?a=h:c=h,e=n,!(n=n[m=g<<1|p]))return this;if(!n.length)break;(e[m+1&3]||e[m+2&3]||e[m+3&3])&&(i=e,y=m)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[m]=s:delete e[m],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=s,this)}function Awt(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function $wt(){return this._root}function Iwt(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function Mwt(t){var e=[],n,i=this._root,r,s,o,a,u;for(i&&e.push(new Ji(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,a=n.x1,u=n.y1)&&i.length){var c=(s+a)/2,l=(o+u)/2;(r=i[3])&&e.push(new Ji(r,c,l,a,u)),(r=i[2])&&e.push(new Ji(r,s,l,c,u)),(r=i[1])&&e.push(new Ji(r,c,o,a,l)),(r=i[0])&&e.push(new Ji(r,s,o,c,l))}return this}function Twt(t){var e=[],n=[],i;for(this._root&&e.push(new Ji(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.y0,u=i.x1,c=i.y1,l=(o+u)/2,f=(a+c)/2;(s=r[0])&&e.push(new Ji(s,o,a,l,f)),(s=r[1])&&e.push(new Ji(s,l,a,u,f)),(s=r[2])&&e.push(new Ji(s,o,f,l,c)),(s=r[3])&&e.push(new Ji(s,l,f,u,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function Fwt(t){return t[0]}function kwt(t){return arguments.length?(this._x=t,this):this._x}function Dwt(t){return t[1]}function Cwt(t){return arguments.length?(this._y=t,this):this._y}function PD(t,e,n){var i=new zD(e??Fwt,n??Dwt,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function zD(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function mL(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var dr=PD.prototype=zD.prototype;dr.copy=function(){var t=new zD(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=mL(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=mL(i));return t};dr.add=bwt;dr.addAll=vwt;dr.cover=wwt;dr.data=_wt;dr.extent=xwt;dr.find=Swt;dr.remove=Ewt;dr.removeAll=Awt;dr.root=$wt;dr.size=Iwt;dr.visit=Mwt;dr.visitAfter=Twt;dr.x=kwt;dr.y=Cwt;function Qi(t){return function(){return t}}function el(t){return(t()-.5)*1e-6}function Nwt(t){return t.x+t.vx}function Owt(t){return t.y+t.vy}function Rwt(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=Qi(t==null?1:+t));function o(){for(var c,l=e.length,f,d,h,p,g,m,y=0;y<s;++y)for(f=PD(e,Nwt,Owt).visitAfter(a),c=0;c<l;++c)d=e[c],g=n[d.index],m=g*g,h=d.x+d.vx,p=d.y+d.vy,f.visit(b);function b(v,w,_,S,x){var E=v.data,A=v.r,$=g+A;if(E){if(E.index>d.index){var I=h-E.x-E.vx,k=p-E.y-E.vy,T=I*I+k*k;T<$*$&&(I===0&&(I=el(i),T+=I*I),k===0&&(k=el(i),T+=k*k),T=($-(T=Math.sqrt(T)))/T*r,d.vx+=(I*=T)*($=(A*=A)/(m+A)),d.vy+=(k*=T)*$,E.vx-=I*($=1-$),E.vy-=k*$)}return}return w>h+$||S<h-$||_>p+$||x<p-$}}function a(c){if(c.data)return c.r=n[c.data.index];for(var l=c.r=0;l<4;++l)c[l]&&c[l].r>c.r&&(c.r=c[l].r)}function u(){if(e){var c,l=e.length,f;for(n=new Array(l),c=0;c<l;++c)f=e[c],n[f.index]=+t(f,c,e)}}return o.initialize=function(c,l){e=c,i=l,u()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Qi(+c),u(),o):t},o}function Lwt(t){return t.index}function yL(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Bwt(t){var e=Lwt,n=f,i,r=Qi(30),s,o,a,u,c,l=1;t==null&&(t=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,b=t.length;y<l;++y)for(var v=0,w,_,S,x,E,A,$;v<b;++v)w=t[v],_=w.source,S=w.target,x=S.x+S.vx-_.x-_.vx||el(c),E=S.y+S.vy-_.y-_.vy||el(c),A=Math.sqrt(x*x+E*E),A=(A-s[v])/A*m*i[v],x*=A,E*=A,S.vx-=x*($=u[v]),S.vy-=E*$,_.vx+=x*($=1-$),_.vy+=E*$}function h(){if(o){var m,y=o.length,b=t.length,v=new Map(o.map((_,S)=>[e(_,S,o),_])),w;for(m=0,a=new Array(y);m<b;++m)w=t[m],w.index=m,typeof w.source!="object"&&(w.source=yL(v,w.source)),typeof w.target!="object"&&(w.target=yL(v,w.target)),a[w.source.index]=(a[w.source.index]||0)+1,a[w.target.index]=(a[w.target.index]||0)+1;for(m=0,u=new Array(b);m<b;++m)w=t[m],u[m]=a[w.source.index]/(a[w.source.index]+a[w.target.index]);i=new Array(b),p(),s=new Array(b),g()}}function p(){if(o)for(var m=0,y=t.length;m<y;++m)i[m]=+n(t[m],m,t)}function g(){if(o)for(var m=0,y=t.length;m<y;++m)s[m]=+r(t[m],m,t)}return d.initialize=function(m,y){o=m,c=y,h()},d.links=function(m){return arguments.length?(t=m,h(),d):t},d.id=function(m){return arguments.length?(e=m,d):e},d.iterations=function(m){return arguments.length?(l=+m,d):l},d.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Qi(+m),p(),d):n},d.distance=function(m){return arguments.length?(r=typeof m=="function"?m:Qi(+m),g(),d):r},d}const Pwt=1664525,zwt=1013904223,bL=4294967296;function Uwt(){let t=1;return()=>(t=(Pwt*t+zwt)%bL)/bL}function jwt(t){return t.x}function qwt(t){return t.y}var Vwt=10,Wwt=Math.PI*(3-Math.sqrt(5));function Gwt(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,a=new Map,u=RD(f),c=QS("tick","end"),l=Uwt();t==null&&(t=[]);function f(){d(),c.call("tick",e),n<i&&(u.stop(),c.call("end",e))}function d(g){var m,y=t.length,b;g===void 0&&(g=1);for(var v=0;v<g;++v)for(n+=(s-n)*r,a.forEach(function(w){w(n)}),m=0;m<y;++m)b=t[m],b.fx==null?b.x+=b.vx*=o:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=o:(b.y=b.fy,b.vy=0);return e}function h(){for(var g=0,m=t.length,y;g<m;++g){if(y=t[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var b=Vwt*Math.sqrt(.5+g),v=g*Wwt;y.x=b*Math.cos(v),y.y=b*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(t,l),g}return h(),e={tick:d,restart:function(){return u.restart(f),e},stop:function(){return u.stop(),e},nodes:function(g){return arguments.length?(t=g,h(),a.forEach(p),e):t},alpha:function(g){return arguments.length?(n=+g,e):n},alphaMin:function(g){return arguments.length?(i=+g,e):i},alphaDecay:function(g){return arguments.length?(r=+g,e):+r},alphaTarget:function(g){return arguments.length?(s=+g,e):s},velocityDecay:function(g){return arguments.length?(o=1-g,e):1-o},randomSource:function(g){return arguments.length?(l=g,a.forEach(p),e):l},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),e):a.get(g)},find:function(g,m,y){var b=0,v=t.length,w,_,S,x,E;for(y==null?y=1/0:y*=y,b=0;b<v;++b)x=t[b],w=g-x.x,_=m-x.y,S=w*w+_*_,S<y&&(E=x,y=S);return E},on:function(g,m){return arguments.length>1?(c.on(g,m),e):c.on(g)}}}function Ywt(){var t,e,n,i,r=Qi(-30),s,o=1,a=1/0,u=.81;function c(h){var p,g=t.length,m=PD(t,jwt,qwt).visitAfter(f);for(i=h,p=0;p<g;++p)e=t[p],m.visit(d)}function l(){if(t){var h,p=t.length,g;for(s=new Array(p),h=0;h<p;++h)g=t[h],s[g.index]=+r(g,h,t)}}function f(h){var p=0,g,m,y=0,b,v,w;if(h.length){for(b=v=w=0;w<4;++w)(g=h[w])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,b+=m*g.x,v+=m*g.y);h.x=b/y,h.y=v/y}else{g=h,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}h.value=p}function d(h,p,g,m){if(!h.value)return!0;var y=h.x-e.x,b=h.y-e.y,v=m-p,w=y*y+b*b;if(v*v/u<w)return w<a&&(y===0&&(y=el(n),w+=y*y),b===0&&(b=el(n),w+=b*b),w<o&&(w=Math.sqrt(o*w)),e.vx+=y*h.value*i/w,e.vy+=b*h.value*i/w),!0;if(h.length||w>=a)return;(h.data!==e||h.next)&&(y===0&&(y=el(n),w+=y*y),b===0&&(b=el(n),w+=b*b),w<o&&(w=Math.sqrt(o*w)));do h.data!==e&&(v=s[h.data.index]*i/w,e.vx+=y*v,e.vy+=b*v);while(h=h.next)}return c.initialize=function(h,p){t=h,n=p,l()},c.strength=function(h){return arguments.length?(r=typeof h=="function"?h:Qi(+h),l(),c):r},c.distanceMin=function(h){return arguments.length?(o=h*h,c):Math.sqrt(o)},c.distanceMax=function(h){return arguments.length?(a=h*h,c):Math.sqrt(a)},c.theta=function(h){return arguments.length?(u=h*h,c):Math.sqrt(u)},c}function Hwt(t){var e=Qi(.1),n,i,r;typeof t!="function"&&(t=Qi(t==null?0:+t));function s(a){for(var u=0,c=n.length,l;u<c;++u)l=n[u],l.vx+=(r[u]-l.x)*i[u]*a}function o(){if(n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Qi(+a),o(),s):e},s.x=function(a){return arguments.length?(t=typeof a=="function"?a:Qi(+a),o(),s):t},s}function Xwt(t){var e=Qi(.1),n,i,r;typeof t!="function"&&(t=Qi(t==null?0:+t));function s(a){for(var u=0,c=n.length,l;u<c;++u)l=n[u],l.vy+=(r[u]-l.y)*i[u]*a}function o(){if(n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Qi(+a),o(),s):e},s.y=function(a){return arguments.length?(t=typeof a=="function"?a:Qi(+a),o(),s):t},s}function Kwt(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function H_(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Tg(t){return t=H_(Math.abs(t)),t?t[1]:NaN}function Jwt(t,e){return function(n,i){for(var r=n.length,s=[],o=0,a=t[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),s.push(n.substring(r-=a,r+a)),!((u+=a+1)>i));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function Qwt(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Zwt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wd(t){if(!(e=Zwt.exec(t)))throw new Error("invalid format: "+t);var e;return new UD({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Wd.prototype=UD.prototype;function UD(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}UD.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function t2t(t){t:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break t;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var hY;function e2t(t,e){var n=H_(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(hY=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+H_(t,Math.max(0,e+s-1))[0]}function vL(t,e){var n=H_(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const wL={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Kwt,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>vL(t*100,e),r:vL,s:e2t,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function _L(t){return t}var xL=Array.prototype.map,SL=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function pY(t){var e=t.grouping===void 0||t.thousands===void 0?_L:Jwt(xL.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?_L:Qwt(xL.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"−":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function c(f){f=Wd(f);var d=f.fill,h=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,v=f.precision,w=f.trim,_=f.type;_==="n"?(b=!0,_="g"):wL[_]||(v===void 0&&(v=12),w=!0,_="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var S=g==="$"?n:g==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",x=g==="$"?i:/[%p]/.test(_)?o:"",E=wL[_],A=/[defgprs%]/.test(_);v=v===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function $(I){var k=S,T=x,M,F,D;if(_==="c")T=E(I)+T,I="";else{I=+I;var N=I<0||1/I<0;if(I=isNaN(I)?u:E(Math.abs(I),v),w&&(I=t2t(I)),N&&+I==0&&p!=="+"&&(N=!1),k=(N?p==="("?p:a:p==="-"||p==="("?"":p)+k,T=(_==="s"?SL[8+hY/3]:"")+T+(N&&p==="("?")":""),A){for(M=-1,F=I.length;++M<F;)if(D=I.charCodeAt(M),48>D||D>57){T=(D===46?r+I.slice(M+1):I.slice(M))+T,I=I.slice(0,M);break}}}b&&!m&&(I=e(I,1/0));var R=k.length+I.length+T.length,L=R<y?new Array(y-R+1).join(d):"";switch(b&&m&&(I=e(L+I,L.length?y-T.length:1/0),L=""),h){case"<":I=k+I+T+L;break;case"=":I=k+L+I+T;break;case"^":I=L.slice(0,R=L.length>>1)+k+I+T+L.slice(R);break;default:I=L+k+I+T;break}return s(I)}return $.toString=function(){return f+""},$}function l(f,d){var h=c((f=Wd(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Tg(d)/3)))*3,g=Math.pow(10,-p),m=SL[8+p/3];return function(y){return h(g*y)+m}}return{format:c,formatPrefix:l}}var Ov,vh,jD;n2t({thousands:",",grouping:[3],currency:["$",""]});function n2t(t){return Ov=pY(t),vh=Ov.format,jD=Ov.formatPrefix,Ov}function gY(t){return Math.max(0,-Tg(Math.abs(t)))}function mY(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Tg(e)/3)))*3-Tg(Math.abs(t)))}function yY(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Tg(e)-Tg(t))+1}var St=1e-6,X_=1e-12,re=Math.PI,_n=re/2,K_=re/4,sr=re*2,An=180/re,ne=re/180,he=Math.abs,xm=Math.atan,Ps=Math.atan2,Et=Math.cos,Rv=Math.ceil,bY=Math.exp,rT=Math.hypot,J_=Math.log,SI=Math.pow,_t=Math.sin,Is=Math.sign||function(t){return t>0?1:t<0?-1:0},or=Math.sqrt,qD=Math.tan;function vY(t){return t>1?0:t<-1?re:Math.acos(t)}function Or(t){return t>1?_n:t<-1?-_n:Math.asin(t)}function di(){}function Q_(t,e){t&&AL.hasOwnProperty(t.type)&&AL[t.type](t,e)}var EL={Feature:function(t,e){Q_(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)Q_(n[i].geometry,e)}},AL={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){sT(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)sT(n[i],e,0)},Polygon:function(t,e){$L(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)$L(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)Q_(n[i],e)}};function sT(t,e,n){var i=-1,r=t.length-n,s;for(e.lineStart();++i<r;)s=t[i],e.point(s[0],s[1],s[2]);e.lineEnd()}function $L(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)sT(t[n],e,1);e.polygonEnd()}function ya(t,e){t&&EL.hasOwnProperty(t.type)?EL[t.type](t,e):Q_(t,e)}var Z_=new Zi,tx=new Zi,wY,_Y,oT,aT,uT,Ba={point:di,lineStart:di,lineEnd:di,polygonStart:function(){Z_=new Zi,Ba.lineStart=i2t,Ba.lineEnd=r2t},polygonEnd:function(){var t=+Z_;tx.add(t<0?sr+t:t),this.lineStart=this.lineEnd=this.point=di},sphere:function(){tx.add(sr)}};function i2t(){Ba.point=s2t}function r2t(){xY(wY,_Y)}function s2t(t,e){Ba.point=xY,wY=t,_Y=e,t*=ne,e*=ne,oT=t,aT=Et(e=e/2+K_),uT=_t(e)}function xY(t,e){t*=ne,e*=ne,e=e/2+K_;var n=t-oT,i=n>=0?1:-1,r=i*n,s=Et(e),o=_t(e),a=uT*o,u=aT*s+a*Et(r),c=a*i*_t(r);Z_.add(Ps(c,u)),oT=t,aT=s,uT=o}function o2t(t){return tx=new Zi,ya(t,Ba),tx*2}function ex(t){return[Ps(t[1],t[0]),Or(t[2])]}function Gd(t){var e=t[0],n=t[1],i=Et(n);return[i*Et(e),i*_t(e),_t(n)]}function Lv(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Fg(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function EI(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Bv(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function nx(t){var e=or(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var cn,xr,yn,Kr,td,SY,EY,rg,Fy,Yc,uc,Ou={point:cT,lineStart:IL,lineEnd:ML,polygonStart:function(){Ou.point=$Y,Ou.lineStart=a2t,Ou.lineEnd=u2t,Fy=new Zi,Ba.polygonStart()},polygonEnd:function(){Ba.polygonEnd(),Ou.point=cT,Ou.lineStart=IL,Ou.lineEnd=ML,Z_<0?(cn=-(yn=180),xr=-(Kr=90)):Fy>St?Kr=90:Fy<-St&&(xr=-90),uc[0]=cn,uc[1]=yn},sphere:function(){cn=-(yn=180),xr=-(Kr=90)}};function cT(t,e){Yc.push(uc=[cn=t,yn=t]),e<xr&&(xr=e),e>Kr&&(Kr=e)}function AY(t,e){var n=Gd([t*ne,e*ne]);if(rg){var i=Fg(rg,n),r=[i[1],-i[0],0],s=Fg(r,i);nx(s),s=ex(s);var o=t-td,a=o>0?1:-1,u=s[0]*An*a,c,l=he(o)>180;l^(a*td<u&&u<a*t)?(c=s[1]*An,c>Kr&&(Kr=c)):(u=(u+360)%360-180,l^(a*td<u&&u<a*t)?(c=-s[1]*An,c<xr&&(xr=c)):(e<xr&&(xr=e),e>Kr&&(Kr=e))),l?t<td?Hr(cn,t)>Hr(cn,yn)&&(yn=t):Hr(t,yn)>Hr(cn,yn)&&(cn=t):yn>=cn?(t<cn&&(cn=t),t>yn&&(yn=t)):t>td?Hr(cn,t)>Hr(cn,yn)&&(yn=t):Hr(t,yn)>Hr(cn,yn)&&(cn=t)}else Yc.push(uc=[cn=t,yn=t]);e<xr&&(xr=e),e>Kr&&(Kr=e),rg=n,td=t}function IL(){Ou.point=AY}function ML(){uc[0]=cn,uc[1]=yn,Ou.point=cT,rg=null}function $Y(t,e){if(rg){var n=t-td;Fy.add(he(n)>180?n+(n>0?360:-360):n)}else SY=t,EY=e;Ba.point(t,e),AY(t,e)}function a2t(){Ba.lineStart()}function u2t(){$Y(SY,EY),Ba.lineEnd(),he(Fy)>St&&(cn=-(yn=180)),uc[0]=cn,uc[1]=yn,rg=null}function Hr(t,e){return(e-=t)<0?e+360:e}function c2t(t,e){return t[0]-e[0]}function TL(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function l2t(t){var e,n,i,r,s,o,a;if(Kr=yn=-(cn=xr=1/0),Yc=[],ya(t,Ou),n=Yc.length){for(Yc.sort(c2t),e=1,i=Yc[0],s=[i];e<n;++e)r=Yc[e],TL(i,r[0])||TL(i,r[1])?(Hr(i[0],r[1])>Hr(i[0],i[1])&&(i[1]=r[1]),Hr(r[0],i[1])>Hr(i[0],i[1])&&(i[0]=r[0])):s.push(i=r);for(o=-1/0,n=s.length-1,e=0,i=s[n];e<=n;i=r,++e)r=s[e],(a=Hr(i[1],r[0]))>o&&(o=a,cn=r[0],yn=i[1])}return Yc=uc=null,cn===1/0||xr===1/0?[[NaN,NaN],[NaN,NaN]]:[[cn,xr],[yn,Kr]]}var ey,ix,rx,sx,ox,ax,ux,cx,lT,fT,dT,IY,MY,Wi,Gi,Yi,po={sphere:di,point:VD,lineStart:FL,lineEnd:kL,polygonStart:function(){po.lineStart=h2t,po.lineEnd=p2t},polygonEnd:function(){po.lineStart=FL,po.lineEnd=kL}};function VD(t,e){t*=ne,e*=ne;var n=Et(e);bb(n*Et(t),n*_t(t),_t(e))}function bb(t,e,n){++ey,rx+=(t-rx)/ey,sx+=(e-sx)/ey,ox+=(n-ox)/ey}function FL(){po.point=f2t}function f2t(t,e){t*=ne,e*=ne;var n=Et(e);Wi=n*Et(t),Gi=n*_t(t),Yi=_t(e),po.point=d2t,bb(Wi,Gi,Yi)}function d2t(t,e){t*=ne,e*=ne;var n=Et(e),i=n*Et(t),r=n*_t(t),s=_t(e),o=Ps(or((o=Gi*s-Yi*r)*o+(o=Yi*i-Wi*s)*o+(o=Wi*r-Gi*i)*o),Wi*i+Gi*r+Yi*s);ix+=o,ax+=o*(Wi+(Wi=i)),ux+=o*(Gi+(Gi=r)),cx+=o*(Yi+(Yi=s)),bb(Wi,Gi,Yi)}function kL(){po.point=VD}function h2t(){po.point=g2t}function p2t(){TY(IY,MY),po.point=VD}function g2t(t,e){IY=t,MY=e,t*=ne,e*=ne,po.point=TY;var n=Et(e);Wi=n*Et(t),Gi=n*_t(t),Yi=_t(e),bb(Wi,Gi,Yi)}function TY(t,e){t*=ne,e*=ne;var n=Et(e),i=n*Et(t),r=n*_t(t),s=_t(e),o=Gi*s-Yi*r,a=Yi*i-Wi*s,u=Wi*r-Gi*i,c=rT(o,a,u),l=Or(c),f=c&&-l/c;lT.add(f*o),fT.add(f*a),dT.add(f*u),ix+=l,ax+=l*(Wi+(Wi=i)),ux+=l*(Gi+(Gi=r)),cx+=l*(Yi+(Yi=s)),bb(Wi,Gi,Yi)}function FY(t){ey=ix=rx=sx=ox=ax=ux=cx=0,lT=new Zi,fT=new Zi,dT=new Zi,ya(t,po);var e=+lT,n=+fT,i=+dT,r=rT(e,n,i);return r<X_&&(e=ax,n=ux,i=cx,ix<St&&(e=rx,n=sx,i=ox),r=rT(e,n,i),r<X_)?[NaN,NaN]:[Ps(n,e)*An,Or(i/r)*An]}function hT(t,e){function n(i,r){return i=t(i,r),e(i[0],i[1])}return t.invert&&e.invert&&(n.invert=function(i,r){return i=e.invert(i,r),i&&t.invert(i[0],i[1])}),n}function pT(t,e){return he(t)>re&&(t-=Math.round(t/sr)*sr),[t,e]}pT.invert=pT;function kY(t,e,n){return(t%=sr)?e||n?hT(CL(t),NL(e,n)):CL(t):e||n?NL(e,n):pT}function DL(t){return function(e,n){return e+=t,he(e)>re&&(e-=Math.round(e/sr)*sr),[e,n]}}function CL(t){var e=DL(t);return e.invert=DL(-t),e}function NL(t,e){var n=Et(t),i=_t(t),r=Et(e),s=_t(e);function o(a,u){var c=Et(u),l=Et(a)*c,f=_t(a)*c,d=_t(u),h=d*n+l*i;return[Ps(f*r-h*s,l*n-d*i),Or(h*r+f*s)]}return o.invert=function(a,u){var c=Et(u),l=Et(a)*c,f=_t(a)*c,d=_t(u),h=d*r-f*s;return[Ps(f*r+d*s,l*n+h*i),Or(h*n-l*i)]},o}function m2t(t){t=kY(t[0]*ne,t[1]*ne,t.length>2?t[2]*ne:0);function e(n){return n=t(n[0]*ne,n[1]*ne),n[0]*=An,n[1]*=An,n}return e.invert=function(n){return n=t.invert(n[0]*ne,n[1]*ne),n[0]*=An,n[1]*=An,n},e}function y2t(t,e,n,i,r,s){if(n){var o=Et(e),a=_t(e),u=i*n;r==null?(r=e+i*sr,s=e-u/2):(r=OL(o,r),s=OL(o,s),(i>0?r<s:r>s)&&(r+=i*sr));for(var c,l=r;i>0?l>s:l<s;l-=u)c=ex([o,-a*Et(l),-a*_t(l)]),t.point(c[0],c[1])}}function OL(t,e){e=Gd(e),e[0]-=t,nx(e);var n=vY(-e[1]);return((-e[2]<0?-n:n)+sr-St)%sr}function DY(){var t=[],e;return{point:function(n,i,r){e.push([n,i,r])},lineStart:function(){t.push(e=[])},lineEnd:di,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function i2(t,e){return he(t[0]-e[0])<St&&he(t[1]-e[1])<St}function Pv(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function CY(t,e,n,i,r){var s=[],o=[],a,u;if(t.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],y=p[g],b;if(i2(m,y)){if(!m[2]&&!y[2]){for(r.lineStart(),a=0;a<g;++a)r.point((m=p[a])[0],m[1]);r.lineEnd();return}y[0]+=2*St}s.push(b=new Pv(m,p,null,!0)),o.push(b.o=new Pv(m,null,b,!1)),s.push(b=new Pv(y,p,null,!1)),o.push(b.o=new Pv(y,null,b,!0))}}),!!s.length){for(o.sort(e),RL(s),RL(o),a=0,u=o.length;a<u;++a)o[a].e=n=!n;for(var c=s[0],l,f;;){for(var d=c,h=!0;d.v;)if((d=d.n)===c)return;l=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,u=l.length;a<u;++a)r.point((f=l[a])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(l=d.p.z,a=l.length-1;a>=0;--a)r.point((f=l[a])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,l=d.z,h=!h}while(!d.v);r.lineEnd()}}}function RL(t){if(e=t.length){for(var e,n=0,i=t[0],r;++n<e;)i.n=r=t[n],r.p=i,i=r;i.n=r=t[0],r.p=i}}function AI(t){return he(t[0])<=re?t[0]:Is(t[0])*((he(t[0])+re)%sr-re)}function b2t(t,e){var n=AI(e),i=e[1],r=_t(i),s=[_t(n),-Et(n),0],o=0,a=0,u=new Zi;r===1?i=_n+St:r===-1&&(i=-_n-St);for(var c=0,l=t.length;c<l;++c)if(d=(f=t[c]).length)for(var f,d,h=f[d-1],p=AI(h),g=h[1]/2+K_,m=_t(g),y=Et(g),b=0;b<d;++b,p=w,m=S,y=x,h=v){var v=f[b],w=AI(v),_=v[1]/2+K_,S=_t(_),x=Et(_),E=w-p,A=E>=0?1:-1,$=A*E,I=$>re,k=m*S;if(u.add(Ps(k*A*_t($),y*x+k*Et($))),o+=I?E+A*sr:E,I^p>=n^w>=n){var T=Fg(Gd(h),Gd(v));nx(T);var M=Fg(s,T);nx(M);var F=(I^E>=0?-1:1)*Or(M[2]);(i>F||i===F&&(T[0]||T[1]))&&(a+=I^E>=0?1:-1)}}return(o<-St||o<St&&u<-X_)^a&1}function NY(t,e,n,i){return function(r){var s=e(r),o=DY(),a=e(o),u=!1,c,l,f,d={point:h,lineStart:g,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=b,d.lineEnd=v,l=[],c=[]},polygonEnd:function(){d.point=h,d.lineStart=g,d.lineEnd=m,l=fG(l);var w=b2t(c,i);l.length?(u||(r.polygonStart(),u=!0),CY(l,w2t,w,n,r)):w&&(u||(r.polygonStart(),u=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),u&&(r.polygonEnd(),u=!1),l=c=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(w,_){t(w,_)&&r.point(w,_)}function p(w,_){s.point(w,_)}function g(){d.point=p,s.lineStart()}function m(){d.point=h,s.lineEnd()}function y(w,_){f.push([w,_]),a.point(w,_)}function b(){a.lineStart(),f=[]}function v(){y(f[0][0],f[0][1]),a.lineEnd();var w=a.clean(),_=o.result(),S,x=_.length,E,A,$;if(f.pop(),c.push(f),f=null,!!x){if(w&1){if(A=_[0],(E=A.length-1)>0){for(u||(r.polygonStart(),u=!0),r.lineStart(),S=0;S<E;++S)r.point(($=A[S])[0],$[1]);r.lineEnd()}return}x>1&&w&2&&_.push(_.pop().concat(_.shift())),l.push(_.filter(v2t))}}return d}}function v2t(t){return t.length>1}function w2t(t,e){return((t=t.x)[0]<0?t[1]-_n-St:_n-t[1])-((e=e.x)[0]<0?e[1]-_n-St:_n-e[1])}const LL=NY(function(){return!0},_2t,S2t,[-re,-_n]);function _2t(t){var e=NaN,n=NaN,i=NaN,r;return{lineStart:function(){t.lineStart(),r=1},point:function(s,o){var a=s>0?re:-re,u=he(s-e);he(u-re)<St?(t.point(e,n=(n+o)/2>0?_n:-_n),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(s,n),r=0):i!==a&&u>=re&&(he(e-i)<St&&(e-=i*St),he(s-a)<St&&(s-=a*St),n=x2t(e,n,s,o),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(a,n),r=0),t.point(e=s,n=o),i=a},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-r}}}function x2t(t,e,n,i){var r,s,o=_t(t-n);return he(o)>St?xm((_t(e)*(s=Et(i))*_t(n)-_t(i)*(r=Et(e))*_t(t))/(r*s*o)):(e+i)/2}function S2t(t,e,n,i){var r;if(t==null)r=n*_n,i.point(-re,r),i.point(0,r),i.point(re,r),i.point(re,0),i.point(re,-r),i.point(0,-r),i.point(-re,-r),i.point(-re,0),i.point(-re,r);else if(he(t[0]-e[0])>St){var s=t[0]<e[0]?re:-re;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(e[0],e[1])}function E2t(t){var e=Et(t),n=6*ne,i=e>0,r=he(e)>St;function s(l,f,d,h){y2t(h,t,n,d,l,f)}function o(l,f){return Et(l)*Et(f)>e}function a(l){var f,d,h,p,g;return{lineStart:function(){p=h=!1,g=1},point:function(m,y){var b=[m,y],v,w=o(m,y),_=i?w?0:c(m,y):w?c(m+(m<0?re:-re),y):0;if(!f&&(p=h=w)&&l.lineStart(),w!==h&&(v=u(f,b),(!v||i2(f,v)||i2(b,v))&&(b[2]=1)),w!==h)g=0,w?(l.lineStart(),v=u(b,f),l.point(v[0],v[1])):(v=u(f,b),l.point(v[0],v[1],2),l.lineEnd()),f=v;else if(r&&f&&i^w){var S;!(_&d)&&(S=u(b,f,!0))&&(g=0,i?(l.lineStart(),l.point(S[0][0],S[0][1]),l.point(S[1][0],S[1][1]),l.lineEnd()):(l.point(S[1][0],S[1][1]),l.lineEnd(),l.lineStart(),l.point(S[0][0],S[0][1],3)))}w&&(!f||!i2(f,b))&&l.point(b[0],b[1]),f=b,h=w,d=_},lineEnd:function(){h&&l.lineEnd(),f=null},clean:function(){return g|(p&&h)<<1}}}function u(l,f,d){var h=Gd(l),p=Gd(f),g=[1,0,0],m=Fg(h,p),y=Lv(m,m),b=m[0],v=y-b*b;if(!v)return!d&&l;var w=e*y/v,_=-e*b/v,S=Fg(g,m),x=Bv(g,w),E=Bv(m,_);EI(x,E);var A=S,$=Lv(x,A),I=Lv(A,A),k=$*$-I*(Lv(x,x)-1);if(!(k<0)){var T=or(k),M=Bv(A,(-$-T)/I);if(EI(M,x),M=ex(M),!d)return M;var F=l[0],D=f[0],N=l[1],R=f[1],L;D<F&&(L=F,F=D,D=L);var B=D-F,P=he(B-re)<St,U=P||B<St;if(!P&&R<N&&(L=N,N=R,R=L),U?P?N+R>0^M[1]<(he(M[0]-F)<St?N:R):N<=M[1]&&M[1]<=R:B>re^(F<=M[0]&&M[0]<=D)){var H=Bv(A,(-$+T)/I);return EI(H,x),[M,ex(H)]}}}function c(l,f){var d=i?t:re-t,h=0;return l<-d?h|=1:l>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return NY(o,a,s,i?[0,-t]:[-re,t-re])}function A2t(t,e,n,i,r,s){var o=t[0],a=t[1],u=e[0],c=e[1],l=0,f=1,d=u-o,h=c-a,p;if(p=n-o,!(!d&&p>0)){if(p/=d,d<0){if(p<l)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>l&&(l=p)}if(p=r-o,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>l&&(l=p)}else if(d>0){if(p<l)return;p<f&&(f=p)}if(p=i-a,!(!h&&p>0)){if(p/=h,h<0){if(p<l)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>l&&(l=p)}if(p=s-a,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>l&&(l=p)}else if(h>0){if(p<l)return;p<f&&(f=p)}return l>0&&(t[0]=o+l*d,t[1]=a+l*h),f<1&&(e[0]=o+f*d,e[1]=a+f*h),!0}}}}}var ny=1e9,zv=-ny;function WD(t,e,n,i){function r(c,l){return t<=c&&c<=n&&e<=l&&l<=i}function s(c,l,f,d){var h=0,p=0;if(c==null||(h=o(c,f))!==(p=o(l,f))||u(c,l)<0^f>0)do d.point(h===0||h===3?t:n,h>1?i:e);while((h=(h+f+4)%4)!==p);else d.point(l[0],l[1])}function o(c,l){return he(c[0]-t)<St?l>0?0:3:he(c[0]-n)<St?l>0?2:1:he(c[1]-e)<St?l>0?1:0:l>0?3:2}function a(c,l){return u(c.x,l.x)}function u(c,l){var f=o(c,1),d=o(l,1);return f!==d?f-d:f===0?l[1]-c[1]:f===1?c[0]-l[0]:f===2?c[1]-l[1]:l[0]-c[0]}return function(c){var l=c,f=DY(),d,h,p,g,m,y,b,v,w,_,S,x={point:E,lineStart:k,lineEnd:T,polygonStart:$,polygonEnd:I};function E(F,D){r(F,D)&&l.point(F,D)}function A(){for(var F=0,D=0,N=h.length;D<N;++D)for(var R=h[D],L=1,B=R.length,P=R[0],U,H,nt=P[0],ft=P[1];L<B;++L)U=nt,H=ft,P=R[L],nt=P[0],ft=P[1],H<=i?ft>i&&(nt-U)*(i-H)>(ft-H)*(t-U)&&++F:ft<=i&&(nt-U)*(i-H)<(ft-H)*(t-U)&&--F;return F}function $(){l=f,d=[],h=[],S=!0}function I(){var F=A(),D=S&&F,N=(d=fG(d)).length;(D||N)&&(c.polygonStart(),D&&(c.lineStart(),s(null,null,1,c),c.lineEnd()),N&&CY(d,a,F,s,c),c.polygonEnd()),l=c,d=h=p=null}function k(){x.point=M,h&&h.push(p=[]),_=!0,w=!1,b=v=NaN}function T(){d&&(M(g,m),y&&w&&f.rejoin(),d.push(f.result())),x.point=E,w&&l.lineEnd()}function M(F,D){var N=r(F,D);if(h&&p.push([F,D]),_)g=F,m=D,y=N,_=!1,N&&(l.lineStart(),l.point(F,D));else if(N&&w)l.point(F,D);else{var R=[b=Math.max(zv,Math.min(ny,b)),v=Math.max(zv,Math.min(ny,v))],L=[F=Math.max(zv,Math.min(ny,F)),D=Math.max(zv,Math.min(ny,D))];A2t(R,L,t,e,n,i)?(w||(l.lineStart(),l.point(R[0],R[1])),l.point(L[0],L[1]),N||l.lineEnd(),S=!1):N&&(l.lineStart(),l.point(F,D),S=!1)}b=F,v=D,w=N}return x}}function BL(t,e,n){var i=Un(t,e-St,n).concat(e);return function(r){return i.map(function(s){return[r,s]})}}function PL(t,e,n){var i=Un(t,e-St,n).concat(e);return function(r){return i.map(function(s){return[s,r]})}}function OY(){var t,e,n,i,r,s,o,a,u=10,c=u,l=90,f=360,d,h,p,g,m=2.5;function y(){return{type:"MultiLineString",coordinates:b()}}function b(){return Un(Rv(i/l)*l,n,l).map(p).concat(Un(Rv(a/f)*f,o,f).map(g)).concat(Un(Rv(e/u)*u,t,u).filter(function(v){return he(v%l)>St}).map(d)).concat(Un(Rv(s/c)*c,r,c).filter(function(v){return he(v%f)>St}).map(h))}return y.lines=function(){return b().map(function(v){return{type:"LineString",coordinates:v}})},y.outline=function(){return{type:"Polygon",coordinates:[p(i).concat(g(o).slice(1),p(n).reverse().slice(1),g(a).reverse().slice(1))]}},y.extent=function(v){return arguments.length?y.extentMajor(v).extentMinor(v):y.extentMinor()},y.extentMajor=function(v){return arguments.length?(i=+v[0][0],n=+v[1][0],a=+v[0][1],o=+v[1][1],i>n&&(v=i,i=n,n=v),a>o&&(v=a,a=o,o=v),y.precision(m)):[[i,a],[n,o]]},y.extentMinor=function(v){return arguments.length?(e=+v[0][0],t=+v[1][0],s=+v[0][1],r=+v[1][1],e>t&&(v=e,e=t,t=v),s>r&&(v=s,s=r,r=v),y.precision(m)):[[e,s],[t,r]]},y.step=function(v){return arguments.length?y.stepMajor(v).stepMinor(v):y.stepMinor()},y.stepMajor=function(v){return arguments.length?(l=+v[0],f=+v[1],y):[l,f]},y.stepMinor=function(v){return arguments.length?(u=+v[0],c=+v[1],y):[u,c]},y.precision=function(v){return arguments.length?(m=+v,d=BL(s,r,90),h=PL(e,t,m),p=BL(a,o,90),g=PL(i,n,m),y):m},y.extentMajor([[-180,-90+St],[180,90-St]]).extentMinor([[-180,-80-St],[180,80+St]])}function $2t(){return OY()()}const m1=t=>t;var $I=new Zi,gT=new Zi,RY,LY,mT,yT,Uu={point:di,lineStart:di,lineEnd:di,polygonStart:function(){Uu.lineStart=I2t,Uu.lineEnd=T2t},polygonEnd:function(){Uu.lineStart=Uu.lineEnd=Uu.point=di,$I.add(he(gT)),gT=new Zi},result:function(){var t=$I/2;return $I=new Zi,t}};function I2t(){Uu.point=M2t}function M2t(t,e){Uu.point=BY,RY=mT=t,LY=yT=e}function BY(t,e){gT.add(yT*t-mT*e),mT=t,yT=e}function T2t(){BY(RY,LY)}var kg=1/0,lx=kg,y1=-kg,fx=y1,dx={point:F2t,lineStart:di,lineEnd:di,polygonStart:di,polygonEnd:di,result:function(){var t=[[kg,lx],[y1,fx]];return y1=fx=-(lx=kg=1/0),t}};function F2t(t,e){t<kg&&(kg=t),t>y1&&(y1=t),e<lx&&(lx=e),e>fx&&(fx=e)}var bT=0,vT=0,iy=0,hx=0,px=0,Np=0,wT=0,_T=0,ry=0,PY,zY,ba,va,As={point:Yd,lineStart:zL,lineEnd:UL,polygonStart:function(){As.lineStart=C2t,As.lineEnd=N2t},polygonEnd:function(){As.point=Yd,As.lineStart=zL,As.lineEnd=UL},result:function(){var t=ry?[wT/ry,_T/ry]:Np?[hx/Np,px/Np]:iy?[bT/iy,vT/iy]:[NaN,NaN];return bT=vT=iy=hx=px=Np=wT=_T=ry=0,t}};function Yd(t,e){bT+=t,vT+=e,++iy}function zL(){As.point=k2t}function k2t(t,e){As.point=D2t,Yd(ba=t,va=e)}function D2t(t,e){var n=t-ba,i=e-va,r=or(n*n+i*i);hx+=r*(ba+t)/2,px+=r*(va+e)/2,Np+=r,Yd(ba=t,va=e)}function UL(){As.point=Yd}function C2t(){As.point=O2t}function N2t(){UY(PY,zY)}function O2t(t,e){As.point=UY,Yd(PY=ba=t,zY=va=e)}function UY(t,e){var n=t-ba,i=e-va,r=or(n*n+i*i);hx+=r*(ba+t)/2,px+=r*(va+e)/2,Np+=r,r=va*t-ba*e,wT+=r*(ba+t),_T+=r*(va+e),ry+=r*3,Yd(ba=t,va=e)}function jY(t){this._context=t}jY.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,sr);break}}},result:di};var xT=new Zi,II,qY,VY,sy,oy,b1={point:di,lineStart:function(){b1.point=R2t},lineEnd:function(){II&&WY(qY,VY),b1.point=di},polygonStart:function(){II=!0},polygonEnd:function(){II=null},result:function(){var t=+xT;return xT=new Zi,t}};function R2t(t,e){b1.point=WY,qY=sy=t,VY=oy=e}function WY(t,e){sy-=t,oy-=e,xT.add(or(sy*sy+oy*oy)),sy=t,oy=e}let jL,gx,qL,VL;class WL{constructor(e){this._append=e==null?GY:L2t(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,n){switch(this._point){case 0:{this._append`M${e},${n}`,this._point=1;break}case 1:{this._append`L${e},${n}`;break}default:{if(this._append`M${e},${n}`,this._radius!==qL||this._append!==gx){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,qL=i,gx=this._append,VL=this._,this._=r}this._+=VL;break}}}result(){const e=this._;return this._="",e.length?e:null}}function GY(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function L2t(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return GY;if(e!==jL){const n=10**e;jL=e,gx=function(r){let s=1;this._+=r[0];for(const o=r.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}return gx}function Ha(t,e){let n=3,i=4.5,r,s;function o(a){return a&&(typeof i=="function"&&s.pointRadius(+i.apply(this,arguments)),ya(a,r(s))),s.result()}return o.area=function(a){return ya(a,r(Uu)),Uu.result()},o.measure=function(a){return ya(a,r(b1)),b1.result()},o.bounds=function(a){return ya(a,r(dx)),dx.result()},o.centroid=function(a){return ya(a,r(As)),As.result()},o.projection=function(a){return arguments.length?(r=a==null?(t=null,m1):(t=a).stream,o):t},o.context=function(a){return arguments.length?(s=a==null?(e=null,new WL(n)):new jY(e=a),typeof i!="function"&&s.pointRadius(i),o):e},o.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(s.pointRadius(+a),+a),o):i},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const u=Math.floor(a);if(!(u>=0))throw new RangeError(`invalid digits: ${a}`);n=u}return e===null&&(s=new WL(n)),o},o.projection(t).digits(n).context(e)}function mx(t){return{stream:vb(t)}}function vb(t){return function(e){var n=new ST;for(var i in t)n[i]=t[i];return n.stream=e,n}}function ST(){}ST.prototype={constructor:ST,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function GD(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),ya(n,t.stream(dx)),e(dx.result()),i!=null&&t.clipExtent(i),t}function lE(t,e,n){return GD(t,function(i){var r=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+e[0][0]+(r-o*(i[1][0]+i[0][0]))/2,u=+e[0][1]+(s-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([a,u])},n)}function YD(t,e,n){return lE(t,[[0,0],e],n)}function HD(t,e,n){return GD(t,function(i){var r=+e,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];t.scale(150*s).translate([o,a])},n)}function XD(t,e,n){return GD(t,function(i){var r=+e,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;t.scale(150*s).translate([o,a])},n)}var GL=16,B2t=Et(30*ne);function YL(t,e){return+e?z2t(t,e):P2t(t)}function P2t(t){return vb({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function z2t(t,e){function n(i,r,s,o,a,u,c,l,f,d,h,p,g,m){var y=c-i,b=l-r,v=y*y+b*b;if(v>4*e&&g--){var w=o+d,_=a+h,S=u+p,x=or(w*w+_*_+S*S),E=Or(S/=x),A=he(he(S)-1)<St||he(s-f)<St?(s+f)/2:Ps(_,w),$=t(A,E),I=$[0],k=$[1],T=I-i,M=k-r,F=b*T-y*M;(F*F/v>e||he((y*T+b*M)/v-.5)>.3||o*d+a*h+u*p<B2t)&&(n(i,r,s,o,a,u,I,k,A,w/=x,_/=x,S,g,m),m.point(I,k),n(I,k,A,w,_,S,c,l,f,d,h,p,g,m))}}return function(i){var r,s,o,a,u,c,l,f,d,h,p,g,m={point:y,lineStart:b,lineEnd:w,polygonStart:function(){i.polygonStart(),m.lineStart=_},polygonEnd:function(){i.polygonEnd(),m.lineStart=b}};function y(E,A){E=t(E,A),i.point(E[0],E[1])}function b(){f=NaN,m.point=v,i.lineStart()}function v(E,A){var $=Gd([E,A]),I=t(E,A);n(f,d,l,h,p,g,f=I[0],d=I[1],l=E,h=$[0],p=$[1],g=$[2],GL,i),i.point(f,d)}function w(){m.point=y,i.lineEnd()}function _(){b(),m.point=S,m.lineEnd=x}function S(E,A){v(r=E,A),s=f,o=d,a=h,u=p,c=g,m.point=v}function x(){n(f,d,l,h,p,g,s,o,r,a,u,c,GL,i),m.lineEnd=w,w()}return m}}var U2t=vb({point:function(t,e){this.stream.point(t*ne,e*ne)}});function j2t(t){return vb({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}function q2t(t,e,n,i,r){function s(o,a){return o*=i,a*=r,[e+t*o,n-t*a]}return s.invert=function(o,a){return[(o-e)/t*i,(n-a)/t*r]},s}function HL(t,e,n,i,r,s){if(!s)return q2t(t,e,n,i,r);var o=Et(s),a=_t(s),u=o*t,c=a*t,l=o/t,f=a/t,d=(a*n-o*e)/t,h=(a*e+o*n)/t;function p(g,m){return g*=i,m*=r,[u*g-c*m+e,n-c*g-u*m]}return p.invert=function(g,m){return[i*(l*g-f*m+d),r*(h-f*g-l*m)]},p}function Xa(t){return YY(function(){return t})()}function YY(t){var e,n=150,i=480,r=250,s=0,o=0,a=0,u=0,c=0,l,f=0,d=1,h=1,p=null,g=LL,m=null,y,b,v,w=m1,_=.5,S,x,E,A,$;function I(F){return E(F[0]*ne,F[1]*ne)}function k(F){return F=E.invert(F[0],F[1]),F&&[F[0]*An,F[1]*An]}I.stream=function(F){return A&&$===F?A:A=U2t(j2t(l)(g(S(w($=F)))))},I.preclip=function(F){return arguments.length?(g=F,p=void 0,M()):g},I.postclip=function(F){return arguments.length?(w=F,m=y=b=v=null,M()):w},I.clipAngle=function(F){return arguments.length?(g=+F?E2t(p=F*ne):(p=null,LL),M()):p*An},I.clipExtent=function(F){return arguments.length?(w=F==null?(m=y=b=v=null,m1):WD(m=+F[0][0],y=+F[0][1],b=+F[1][0],v=+F[1][1]),M()):m==null?null:[[m,y],[b,v]]},I.scale=function(F){return arguments.length?(n=+F,T()):n},I.translate=function(F){return arguments.length?(i=+F[0],r=+F[1],T()):[i,r]},I.center=function(F){return arguments.length?(s=F[0]%360*ne,o=F[1]%360*ne,T()):[s*An,o*An]},I.rotate=function(F){return arguments.length?(a=F[0]%360*ne,u=F[1]%360*ne,c=F.length>2?F[2]%360*ne:0,T()):[a*An,u*An,c*An]},I.angle=function(F){return arguments.length?(f=F%360*ne,T()):f*An},I.reflectX=function(F){return arguments.length?(d=F?-1:1,T()):d<0},I.reflectY=function(F){return arguments.length?(h=F?-1:1,T()):h<0},I.precision=function(F){return arguments.length?(S=YL(x,_=F*F),M()):or(_)},I.fitExtent=function(F,D){return lE(I,F,D)},I.fitSize=function(F,D){return YD(I,F,D)},I.fitWidth=function(F,D){return HD(I,F,D)},I.fitHeight=function(F,D){return XD(I,F,D)};function T(){var F=HL(n,0,0,d,h,f).apply(null,e(s,o)),D=HL(n,i-F[0],r-F[1],d,h,f);return l=kY(a,u,c),x=hT(e,D),E=hT(l,x),S=YL(x,_),M()}function M(){return A=$=null,I}return function(){return e=t.apply(this,arguments),I.invert=e.invert&&k,T()}}function KD(t){var e=0,n=re/3,i=YY(t),r=i(e,n);return r.parallels=function(s){return arguments.length?i(e=s[0]*ne,n=s[1]*ne):[e*An,n*An]},r}function V2t(t){var e=Et(t);function n(i,r){return[i*e,_t(r)/e]}return n.invert=function(i,r){return[i/e,Or(r*e)]},n}function W2t(t,e){var n=_t(t),i=(n+_t(e))/2;if(he(i)<St)return V2t(t);var r=1+n*(2*i-n),s=or(r)/i;function o(a,u){var c=or(r-2*i*_t(u))/i;return[c*_t(a*=i),s-c*Et(a)]}return o.invert=function(a,u){var c=s-u,l=Ps(a,he(c))*Is(c);return c*i<0&&(l-=re*Is(a)*Is(c)),[l/i,Or((r-(a*a+c*c)*i*i)/(2*i))]},o}function v1(){return KD(W2t).scale(155.424).center([0,33.6442])}function JD(){return v1().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function G2t(t){var e=t.length;return{point:function(n,i){for(var r=-1;++r<e;)t[r].point(n,i)},sphere:function(){for(var n=-1;++n<e;)t[n].sphere()},lineStart:function(){for(var n=-1;++n<e;)t[n].lineStart()},lineEnd:function(){for(var n=-1;++n<e;)t[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<e;)t[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<e;)t[n].polygonEnd()}}}function HY(){var t,e,n=JD(),i,r=v1().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=v1().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,c={point:function(d,h){u=[d,h]}};function l(d){var h=d[0],p=d[1];return u=null,i.point(h,p),u||(s.point(h,p),u)||(a.point(h,p),u)}l.invert=function(d){var h=n.scale(),p=n.translate(),g=(d[0]-p[0])/h,m=(d[1]-p[1])/h;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?r:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(d)},l.stream=function(d){return t&&e===d?t:t=G2t([n.stream(e=d),r.stream(d),o.stream(d)])},l.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),o.precision(d),f()):n.precision()},l.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),o.scale(d),l.translate(n.translate())):n.scale()},l.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),p=+d[0],g=+d[1];return i=n.translate(d).clipExtent([[p-.455*h,g-.238*h],[p+.455*h,g+.238*h]]).stream(c),s=r.translate([p-.307*h,g+.201*h]).clipExtent([[p-.425*h+St,g+.12*h+St],[p-.214*h-St,g+.234*h-St]]).stream(c),a=o.translate([p-.205*h,g+.212*h]).clipExtent([[p-.214*h+St,g+.166*h+St],[p-.115*h-St,g+.234*h-St]]).stream(c),f()},l.fitExtent=function(d,h){return lE(l,d,h)},l.fitSize=function(d,h){return YD(l,d,h)},l.fitWidth=function(d,h){return HD(l,d,h)},l.fitHeight=function(d,h){return XD(l,d,h)};function f(){return t=e=null,l}return l.scale(1070)}function XY(t){return function(e,n){var i=Et(e),r=Et(n),s=t(i*r);return s===1/0?[2,0]:[s*r*_t(e),s*_t(n)]}}function wb(t){return function(e,n){var i=or(e*e+n*n),r=t(i),s=_t(r),o=Et(r);return[Ps(e*s,i*o),Or(i&&n*s/i)]}}var KY=XY(function(t){return or(2/(1+t))});KY.invert=wb(function(t){return 2*Or(t/2)});function JY(){return Xa(KY).scale(124.75).clipAngle(180-.001)}var QY=XY(function(t){return(t=vY(t))&&t/_t(t)});QY.invert=wb(function(t){return t});function ZY(){return Xa(QY).scale(79.4188).clipAngle(180-.001)}function fE(t,e){return[t,J_(qD((_n+e)/2))]}fE.invert=function(t,e){return[t,2*xm(bY(e))-_n]};function tH(){return eH(fE).scale(961/sr)}function eH(t){var e=Xa(t),n=e.center,i=e.scale,r=e.translate,s=e.clipExtent,o=null,a,u,c;e.scale=function(f){return arguments.length?(i(f),l()):i()},e.translate=function(f){return arguments.length?(r(f),l()):r()},e.center=function(f){return arguments.length?(n(f),l()):n()},e.clipExtent=function(f){return arguments.length?(f==null?o=a=u=c=null:(o=+f[0][0],a=+f[0][1],u=+f[1][0],c=+f[1][1]),l()):o==null?null:[[o,a],[u,c]]};function l(){var f=re*i(),d=e(m2t(e.rotate()).invert([0,0]));return s(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:t===fE?[[Math.max(d[0]-f,o),a],[Math.min(d[0]+f,u),c]]:[[o,Math.max(d[1]-f,a)],[u,Math.min(d[1]+f,c)]])}return l()}function Uv(t){return qD((_n+t)/2)}function Y2t(t,e){var n=Et(t),i=t===e?_t(t):J_(n/Et(e))/J_(Uv(e)/Uv(t)),r=n*SI(Uv(t),i)/i;if(!i)return fE;function s(o,a){r>0?a<-_n+St&&(a=-_n+St):a>_n-St&&(a=_n-St);var u=r/SI(Uv(a),i);return[u*_t(i*o),r-u*Et(i*o)]}return s.invert=function(o,a){var u=r-a,c=Is(i)*or(o*o+u*u),l=Ps(o,he(u))*Is(u);return u*i<0&&(l-=re*Is(o)*Is(u)),[l/i,2*xm(SI(r/c,1/i))-_n]},s}function nH(){return KD(Y2t).scale(109.5).parallels([30,30])}function yx(t,e){return[t,e]}yx.invert=yx;function iH(){return Xa(yx).scale(152.63)}function H2t(t,e){var n=Et(t),i=t===e?_t(t):(n-Et(e))/(e-t),r=n/i+t;if(he(i)<St)return yx;function s(o,a){var u=r-a,c=i*o;return[u*_t(c),r-u*Et(c)]}return s.invert=function(o,a){var u=r-a,c=Ps(o,he(u))*Is(u);return u*i<0&&(c-=re*Is(o)*Is(u)),[c/i,r-Is(i)*or(o*o+u*u)]},s}function rH(){return KD(H2t).scale(131.154).center([0,13.9389])}var ky=1.340264,Dy=-.081106,Cy=893e-6,Ny=.003796,bx=or(3)/2,X2t=12;function sH(t,e){var n=Or(bx*_t(e)),i=n*n,r=i*i*i;return[t*Et(n)/(bx*(ky+3*Dy*i+r*(7*Cy+9*Ny*i))),n*(ky+Dy*i+r*(Cy+Ny*i))]}sH.invert=function(t,e){for(var n=e,i=n*n,r=i*i*i,s=0,o,a,u;s<X2t&&(a=n*(ky+Dy*i+r*(Cy+Ny*i))-e,u=ky+3*Dy*i+r*(7*Cy+9*Ny*i),n-=o=a/u,i=n*n,r=i*i*i,!(he(o)<X_));++s);return[bx*t*(ky+3*Dy*i+r*(7*Cy+9*Ny*i))/Et(n),Or(_t(n)/bx)]};function oH(){return Xa(sH).scale(177.158)}function aH(t,e){var n=Et(e),i=Et(t)*n;return[n*_t(t)/i,_t(e)/i]}aH.invert=wb(xm);function uH(){return Xa(aH).scale(144.049).clipAngle(60)}function K2t(){var t=1,e=0,n=0,i=1,r=1,s=0,o,a,u=null,c,l,f,d=1,h=1,p=vb({point:function(w,_){var S=v([w,_]);this.stream.point(S[0],S[1])}}),g=m1,m,y;function b(){return d=t*i,h=t*r,m=y=null,v}function v(w){var _=w[0]*d,S=w[1]*h;if(s){var x=S*o-_*a;_=_*o+S*a,S=x}return[_+e,S+n]}return v.invert=function(w){var _=w[0]-e,S=w[1]-n;if(s){var x=S*o+_*a;_=_*o-S*a,S=x}return[_/d,S/h]},v.stream=function(w){return m&&y===w?m:m=p(g(y=w))},v.postclip=function(w){return arguments.length?(g=w,u=c=l=f=null,b()):g},v.clipExtent=function(w){return arguments.length?(g=w==null?(u=c=l=f=null,m1):WD(u=+w[0][0],c=+w[0][1],l=+w[1][0],f=+w[1][1]),b()):u==null?null:[[u,c],[l,f]]},v.scale=function(w){return arguments.length?(t=+w,b()):t},v.translate=function(w){return arguments.length?(e=+w[0],n=+w[1],b()):[e,n]},v.angle=function(w){return arguments.length?(s=w%360*ne,a=_t(s),o=Et(s),b()):s*An},v.reflectX=function(w){return arguments.length?(i=w?-1:1,b()):i<0},v.reflectY=function(w){return arguments.length?(r=w?-1:1,b()):r<0},v.fitExtent=function(w,_){return lE(v,w,_)},v.fitSize=function(w,_){return YD(v,w,_)},v.fitWidth=function(w,_){return HD(v,w,_)},v.fitHeight=function(w,_){return XD(v,w,_)},v}function cH(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),e*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}cH.invert=function(t,e){var n=e,i=25,r;do{var s=n*n,o=s*s;n-=r=(n*(1.007226+s*(.015085+o*(-.044475+.028874*s-.005916*o)))-e)/(1.007226+s*(.015085*3+o*(-.044475*7+.028874*9*s-.005916*11*o)))}while(he(r)>St&&--i>0);return[t/(.8707+(s=n*n)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),n]};function J2t(){return Xa(cH).scale(175.295)}function lH(t,e){return[Et(e)*_t(t),_t(e)]}lH.invert=wb(Or);function fH(){return Xa(lH).scale(249.5).clipAngle(90+St)}function dH(t,e){var n=Et(e),i=1+Et(t)*n;return[n*_t(t)/i,_t(e)/i]}dH.invert=wb(function(t){return 2*xm(t)});function hH(){return Xa(dH).scale(250).clipAngle(142)}function pH(t,e){return[J_(qD((_n+e)/2)),-t]}pH.invert=function(t,e){return[-e,2*xm(bY(t))-_n]};function gH(){var t=eH(pH),e=t.center,n=t.rotate;return t.center=function(i){return arguments.length?e([-i[1],i[0]]):(i=e(),[i[1],-i[0]])},t.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}function Q2t(t,e){return t.parent===e.parent?1:2}function Z2t(t){return t.reduce(t_t,0)/t.length}function t_t(t,e){return t+e.x}function e_t(t){return 1+t.reduce(n_t,0)}function n_t(t,e){return Math.max(t,e.y)}function i_t(t){for(var e;e=t.children;)t=e[0];return t}function r_t(t){for(var e;e=t.children;)t=e[e.length-1];return t}function QD(){var t=Q2t,e=1,n=1,i=!1;function r(s){var o,a=0;s.eachAfter(function(d){var h=d.children;h?(d.x=Z2t(h),d.y=e_t(h)):(d.x=o?a+=t(d,o):0,d.y=0,o=d)});var u=i_t(s),c=r_t(s),l=u.x-t(u,c)/2,f=c.x+t(c,u)/2;return s.eachAfter(i?function(d){d.x=(d.x-s.x)*e,d.y=(s.y-d.y)*n}:function(d){d.x=(d.x-l)/(f-l)*e,d.y=(1-(s.y?d.y/s.y:1))*n})}return r.separation=function(s){return arguments.length?(t=s,r):t},r.size=function(s){return arguments.length?(i=!1,e=+s[0],n=+s[1],r):i?null:[e,n]},r.nodeSize=function(s){return arguments.length?(i=!0,e=+s[0],n=+s[1],r):i?[e,n]:null},r}function s_t(t){var e=0,n=t.children,i=n&&n.length;if(!i)e=1;else for(;--i>=0;)e+=n[i].value;t.value=e}function o_t(){return this.eachAfter(s_t)}function a_t(t,e){let n=-1;for(const i of this)t.call(e,i,++n,this);return this}function u_t(t,e){for(var n=this,i=[n],r,s,o=-1;n=i.pop();)if(t.call(e,n,++o,this),r=n.children)for(s=r.length-1;s>=0;--s)i.push(r[s]);return this}function c_t(t,e){for(var n=this,i=[n],r=[],s,o,a,u=-1;n=i.pop();)if(r.push(n),s=n.children)for(o=0,a=s.length;o<a;++o)i.push(s[o]);for(;n=r.pop();)t.call(e,n,++u,this);return this}function l_t(t,e){let n=-1;for(const i of this)if(t.call(e,i,++n,this))return i}function f_t(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n})}function d_t(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function h_t(t){for(var e=this,n=p_t(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i}function p_t(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;for(t=n.pop(),e=i.pop();t===e;)r=t,t=n.pop(),e=i.pop();return r}function g_t(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function m_t(){return Array.from(this)}function y_t(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function b_t(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e}function*v_t(){var t=this,e,n=[t],i,r,s;do for(e=n.reverse(),n=[];t=e.pop();)if(yield t,i=t.children)for(r=0,s=i.length;r<s;++r)n.push(i[r]);while(n.length)}function ZD(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=x_t)):e===void 0&&(e=__t);for(var n=new Dg(t),i,r=[n],s,o,a,u;i=r.pop();)if((o=e(i.data))&&(u=(o=Array.from(o)).length))for(i.children=o,a=u-1;a>=0;--a)r.push(s=o[a]=new Dg(o[a])),s.parent=i,s.depth=i.depth+1;return n.eachBefore(mH)}function w_t(){return ZD(this).eachBefore(S_t)}function __t(t){return t.children}function x_t(t){return Array.isArray(t)?t[1]:null}function S_t(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function mH(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function Dg(t){this.data=t,this.depth=this.height=0,this.parent=null}Dg.prototype=ZD.prototype={constructor:Dg,count:o_t,each:a_t,eachAfter:c_t,eachBefore:u_t,find:l_t,sum:f_t,sort:d_t,path:h_t,ancestors:g_t,descendants:m_t,leaves:y_t,links:b_t,copy:w_t,[Symbol.iterator]:v_t};function r2(t){return t==null?null:yH(t)}function yH(t){if(typeof t!="function")throw new Error;return t}function rd(){return 0}function Mp(t){return function(){return t}}const E_t=1664525,A_t=1013904223,XL=4294967296;function $_t(){let t=1;return()=>(t=(E_t*t+A_t)%XL)/XL}function I_t(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function M_t(t,e){let n=t.length,i,r;for(;n;)r=e()*n--|0,i=t[n],t[n]=t[r],t[r]=i;return t}function T_t(t,e){for(var n=0,i=(t=M_t(Array.from(t),e)).length,r=[],s,o;n<i;)s=t[n],o&&bH(o,s)?++n:(o=k_t(r=F_t(r,s)),n=0);return o}function F_t(t,e){var n,i;if(MI(e,t))return[e];for(n=0;n<t.length;++n)if(jv(e,t[n])&&MI(ay(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(i=n+1;i<t.length;++i)if(jv(ay(t[n],t[i]),e)&&jv(ay(t[n],e),t[i])&&jv(ay(t[i],e),t[n])&&MI(vH(t[n],t[i],e),t))return[t[n],t[i],e];throw new Error}function jv(t,e){var n=t.r-e.r,i=e.x-t.x,r=e.y-t.y;return n<0||n*n<i*i+r*r}function bH(t,e){var n=t.r-e.r+Math.max(t.r,e.r,1)*1e-9,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function MI(t,e){for(var n=0;n<e.length;++n)if(!bH(t,e[n]))return!1;return!0}function k_t(t){switch(t.length){case 1:return D_t(t[0]);case 2:return ay(t[0],t[1]);case 3:return vH(t[0],t[1],t[2])}}function D_t(t){return{x:t.x,y:t.y,r:t.r}}function ay(t,e){var n=t.x,i=t.y,r=t.r,s=e.x,o=e.y,a=e.r,u=s-n,c=o-i,l=a-r,f=Math.sqrt(u*u+c*c);return{x:(n+s+u/f*l)/2,y:(i+o+c/f*l)/2,r:(f+r+a)/2}}function vH(t,e,n){var i=t.x,r=t.y,s=t.r,o=e.x,a=e.y,u=e.r,c=n.x,l=n.y,f=n.r,d=i-o,h=i-c,p=r-a,g=r-l,m=u-s,y=f-s,b=i*i+r*r-s*s,v=b-o*o-a*a+u*u,w=b-c*c-l*l+f*f,_=h*p-d*g,S=(p*w-g*v)/(_*2)-i,x=(g*m-p*y)/_,E=(h*v-d*w)/(_*2)-r,A=(d*y-h*m)/_,$=x*x+A*A-1,I=2*(s+S*x+E*A),k=S*S+E*E-s*s,T=-(Math.abs($)>1e-6?(I+Math.sqrt(I*I-4*$*k))/(2*$):k/I);return{x:i+S+x*T,y:r+E+A*T,r:T}}function KL(t,e,n){var i=t.x-e.x,r,s,o=t.y-e.y,a,u,c=i*i+o*o;c?(s=e.r+n.r,s*=s,u=t.r+n.r,u*=u,s>u?(r=(c+u-s)/(2*c),a=Math.sqrt(Math.max(0,u/c-r*r)),n.x=t.x-r*i-a*o,n.y=t.y-r*o+a*i):(r=(c+s-u)/(2*c),a=Math.sqrt(Math.max(0,s/c-r*r)),n.x=e.x+r*i-a*o,n.y=e.y+r*o+a*i)):(n.x=e.x+n.r,n.y=e.y)}function JL(t,e){var n=t.r+e.r-1e-6,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function QL(t){var e=t._,n=t.next._,i=e.r+n.r,r=(e.x*n.r+n.x*e.r)/i,s=(e.y*n.r+n.y*e.r)/i;return r*r+s*s}function qv(t){this._=t,this.next=null,this.previous=null}function C_t(t,e){if(!(s=(t=I_t(t)).length))return 0;var n,i,r,s,o,a,u,c,l,f,d;if(n=t[0],n.x=0,n.y=0,!(s>1))return n.r;if(i=t[1],n.x=-i.r,i.x=n.r,i.y=0,!(s>2))return n.r+i.r;KL(i,n,r=t[2]),n=new qv(n),i=new qv(i),r=new qv(r),n.next=r.previous=i,i.next=n.previous=r,r.next=i.previous=n;t:for(u=3;u<s;++u){KL(n._,i._,r=t[u]),r=new qv(r),c=i.next,l=n.previous,f=i._.r,d=n._.r;do if(f<=d){if(JL(c._,r._)){i=c,n.next=i,i.previous=n,--u;continue t}f+=c._.r,c=c.next}else{if(JL(l._,r._)){n=l,n.next=i,i.previous=n,--u;continue t}d+=l._.r,l=l.previous}while(c!==l.next);for(r.previous=n,r.next=i,n.next=i.previous=i=r,o=QL(n);(r=r.next)!==i;)(a=QL(r))<o&&(n=r,o=a);i=n.next}for(n=[i._],r=i;(r=r.next)!==i;)n.push(r._);for(r=T_t(n,e),u=0;u<s;++u)n=t[u],n.x-=r.x,n.y-=r.y;return r.r}function N_t(t){return Math.sqrt(t.value)}function O_t(){var t=null,e=1,n=1,i=rd;function r(s){const o=$_t();return s.x=e/2,s.y=n/2,t?s.eachBefore(ZL(t)).eachAfter(TI(i,.5,o)).eachBefore(tB(1)):s.eachBefore(ZL(N_t)).eachAfter(TI(rd,1,o)).eachAfter(TI(i,s.r/Math.min(e,n),o)).eachBefore(tB(Math.min(e,n)/(2*s.r))),s}return r.radius=function(s){return arguments.length?(t=r2(s),r):t},r.size=function(s){return arguments.length?(e=+s[0],n=+s[1],r):[e,n]},r.padding=function(s){return arguments.length?(i=typeof s=="function"?s:Mp(+s),r):i},r}function ZL(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function TI(t,e,n){return function(i){if(r=i.children){var r,s,o=r.length,a=t(i)*e||0,u;if(a)for(s=0;s<o;++s)r[s].r+=a;if(u=C_t(r,n),a)for(s=0;s<o;++s)r[s].r-=a;i.r=u+a}}}function tB(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function wH(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function _b(t,e,n,i,r){for(var s=t.children,o,a=-1,u=s.length,c=t.value&&(i-e)/t.value;++a<u;)o=s[a],o.y0=n,o.y1=r,o.x0=e,o.x1=e+=o.value*c}function R_t(){var t=1,e=1,n=0,i=!1;function r(o){var a=o.height+1;return o.x0=o.y0=n,o.x1=t,o.y1=e/a,o.eachBefore(s(e,a)),i&&o.eachBefore(wH),o}function s(o,a){return function(u){u.children&&_b(u,u.x0,o*(u.depth+1)/a,u.x1,o*(u.depth+2)/a);var c=u.x0,l=u.y0,f=u.x1-n,d=u.y1-n;f<c&&(c=f=(c+f)/2),d<l&&(l=d=(l+d)/2),u.x0=c,u.y0=l,u.x1=f,u.y1=d}}return r.round=function(o){return arguments.length?(i=!!o,r):i},r.size=function(o){return arguments.length?(t=+o[0],e=+o[1],r):[t,e]},r.padding=function(o){return arguments.length?(n=+o,r):n},r}var L_t={depth:-1},eB={},FI={};function B_t(t){return t.id}function P_t(t){return t.parentId}function vx(){var t=B_t,e=P_t,n;function i(r){var s=Array.from(r),o=t,a=e,u,c,l,f,d,h,p,g,m=new Map;if(n!=null){const y=s.map((w,_)=>z_t(n(w,_,r))),b=y.map(nB),v=new Set(y).add("");for(const w of b)v.has(w)||(v.add(w),y.push(w),b.push(nB(w)),s.push(FI));o=(w,_)=>y[_],a=(w,_)=>b[_]}for(l=0,u=s.length;l<u;++l)c=s[l],h=s[l]=new Dg(c),(p=o(c,l,r))!=null&&(p+="")&&(g=h.id=p,m.set(g,m.has(g)?eB:h)),(p=a(c,l,r))!=null&&(p+="")&&(h.parent=p);for(l=0;l<u;++l)if(h=s[l],p=h.parent){if(d=m.get(p),!d)throw new Error("missing: "+p);if(d===eB)throw new Error("ambiguous: "+p);d.children?d.children.push(h):d.children=[h],h.parent=d}else{if(f)throw new Error("multiple roots");f=h}if(!f)throw new Error("no root");if(n!=null){for(;f.data===FI&&f.children.length===1;)f=f.children[0],--u;for(let y=s.length-1;y>=0&&(h=s[y],h.data===FI);--y)h.data=null}if(f.parent=L_t,f.eachBefore(function(y){y.depth=y.parent.depth+1,--u}).eachBefore(mH),f.parent=null,u>0)throw new Error("cycle");return f}return i.id=function(r){return arguments.length?(t=r2(r),i):t},i.parentId=function(r){return arguments.length?(e=r2(r),i):e},i.path=function(r){return arguments.length?(n=r2(r),i):n},i}function z_t(t){t=`${t}`;let e=t.length;return ET(t,e-1)&&!ET(t,e-2)&&(t=t.slice(0,-1)),t[0]==="/"?t:`/${t}`}function nB(t){let e=t.length;if(e<2)return"";for(;--e>1&&!ET(t,e););return t.slice(0,e)}function ET(t,e){if(t[e]==="/"){let n=0;for(;e>0&&t[--e]==="\\";)++n;if(!(n&1))return!0}return!1}function U_t(t,e){return t.parent===e.parent?1:2}function kI(t){var e=t.children;return e?e[0]:t.t}function DI(t){var e=t.children;return e?e[e.length-1]:t.t}function j_t(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function q_t(t){for(var e=0,n=0,i=t.children,r=i.length,s;--r>=0;)s=i[r],s.z+=e,s.m+=e,e+=s.s+(n+=s.c)}function V_t(t,e,n){return t.a.parent===e.parent?t.a:n}function s2(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}s2.prototype=Object.create(Dg.prototype);function W_t(t){for(var e=new s2(t,0),n,i=[e],r,s,o,a;n=i.pop();)if(s=n._.children)for(n.children=new Array(a=s.length),o=a-1;o>=0;--o)i.push(r=n.children[o]=new s2(s[o],o)),r.parent=n;return(e.parent=new s2(null,0)).children=[e],e}function w1(){var t=U_t,e=1,n=1,i=null;function r(c){var l=W_t(c);if(l.eachAfter(s),l.parent.m=-l.z,l.eachBefore(o),i)c.eachBefore(u);else{var f=c,d=c,h=c;c.eachBefore(function(b){b.x<f.x&&(f=b),b.x>d.x&&(d=b),b.depth>h.depth&&(h=b)});var p=f===d?1:t(f,d)/2,g=p-f.x,m=e/(d.x+p+g),y=n/(h.depth||1);c.eachBefore(function(b){b.x=(b.x+g)*m,b.y=b.depth*y})}return c}function s(c){var l=c.children,f=c.parent.children,d=c.i?f[c.i-1]:null;if(l){q_t(c);var h=(l[0].z+l[l.length-1].z)/2;d?(c.z=d.z+t(c._,d._),c.m=c.z-h):c.z=h}else d&&(c.z=d.z+t(c._,d._));c.parent.A=a(c,d,c.parent.A||f[0])}function o(c){c._.x=c.z+c.parent.m,c.m+=c.parent.m}function a(c,l,f){if(l){for(var d=c,h=c,p=l,g=d.parent.children[0],m=d.m,y=h.m,b=p.m,v=g.m,w;p=DI(p),d=kI(d),p&&d;)g=kI(g),h=DI(h),h.a=c,w=p.z+b-d.z-m+t(p._,d._),w>0&&(j_t(V_t(p,c,f),c,w),m+=w,y+=w),b+=p.m,m+=d.m,v+=g.m,y+=h.m;p&&!DI(h)&&(h.t=p,h.m+=b-y),d&&!kI(g)&&(g.t=d,g.m+=m-v,f=c)}return f}function u(c){c.x*=e,c.y=c.depth*n}return r.separation=function(c){return arguments.length?(t=c,r):t},r.size=function(c){return arguments.length?(i=!1,e=+c[0],n=+c[1],r):i?null:[e,n]},r.nodeSize=function(c){return arguments.length?(i=!0,e=+c[0],n=+c[1],r):i?[e,n]:null},r}function dE(t,e,n,i,r){for(var s=t.children,o,a=-1,u=s.length,c=t.value&&(r-n)/t.value;++a<u;)o=s[a],o.x0=e,o.x1=i,o.y0=n,o.y1=n+=o.value*c}var _H=(1+Math.sqrt(5))/2;function xH(t,e,n,i,r,s){for(var o=[],a=e.children,u,c,l=0,f=0,d=a.length,h,p,g=e.value,m,y,b,v,w,_,S;l<d;){h=r-n,p=s-i;do m=a[f++].value;while(!m&&f<d);for(y=b=m,_=Math.max(p/h,h/p)/(g*t),S=m*m*_,w=Math.max(b/S,S/y);f<d;++f){if(m+=c=a[f].value,c<y&&(y=c),c>b&&(b=c),S=m*m*_,v=Math.max(b/S,S/y),v>w){m-=c;break}w=v}o.push(u={value:m,dice:h<p,children:a.slice(l,f)}),u.dice?_b(u,n,i,r,g?i+=p*m/g:s):dE(u,n,i,g?n+=h*m/g:r,s),g-=m,l=f}return o}const SH=function t(e){function n(i,r,s,o,a){xH(e,i,r,s,o,a)}return n.ratio=function(i){return t((i=+i)>1?i:1)},n}(_H);function G_t(){var t=SH,e=!1,n=1,i=1,r=[0],s=rd,o=rd,a=rd,u=rd,c=rd;function l(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],e&&d.eachBefore(wH),d}function f(d){var h=r[d.depth],p=d.x0+h,g=d.y0+h,m=d.x1-h,y=d.y1-h;m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),d.x0=p,d.y0=g,d.x1=m,d.y1=y,d.children&&(h=r[d.depth+1]=s(d)/2,p+=c(d)-h,g+=o(d)-h,m-=a(d)-h,y-=u(d)-h,m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),t(d,p,g,m,y))}return l.round=function(d){return arguments.length?(e=!!d,l):e},l.size=function(d){return arguments.length?(n=+d[0],i=+d[1],l):[n,i]},l.tile=function(d){return arguments.length?(t=yH(d),l):t},l.padding=function(d){return arguments.length?l.paddingInner(d).paddingOuter(d):l.paddingInner()},l.paddingInner=function(d){return arguments.length?(s=typeof d=="function"?d:Mp(+d),l):s},l.paddingOuter=function(d){return arguments.length?l.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):l.paddingTop()},l.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:Mp(+d),l):o},l.paddingRight=function(d){return arguments.length?(a=typeof d=="function"?d:Mp(+d),l):a},l.paddingBottom=function(d){return arguments.length?(u=typeof d=="function"?d:Mp(+d),l):u},l.paddingLeft=function(d){return arguments.length?(c=typeof d=="function"?d:Mp(+d),l):c},l}function Y_t(t,e,n,i,r){var s=t.children,o,a=s.length,u,c=new Array(a+1);for(c[0]=u=o=0;o<a;++o)c[o+1]=u+=s[o].value;l(0,a,t.value,e,n,i,r);function l(f,d,h,p,g,m,y){if(f>=d-1){var b=s[f];b.x0=p,b.y0=g,b.x1=m,b.y1=y;return}for(var v=c[f],w=h/2+v,_=f+1,S=d-1;_<S;){var x=_+S>>>1;c[x]<w?_=x+1:S=x}w-c[_-1]<c[_]-w&&f+1<_&&--_;var E=c[_]-v,A=h-E;if(m-p>y-g){var $=h?(p*A+m*E)/h:m;l(f,_,E,p,g,$,y),l(_,d,A,$,g,m,y)}else{var I=h?(g*A+y*E)/h:y;l(f,_,E,p,g,m,I),l(_,d,A,p,I,m,y)}}}function H_t(t,e,n,i,r){(t.depth&1?dE:_b)(t,e,n,i,r)}const X_t=function t(e){function n(i,r,s,o,a){if((u=i._squarify)&&u.ratio===e)for(var u,c,l,f,d=-1,h,p=u.length,g=i.value;++d<p;){for(c=u[d],l=c.children,f=c.value=0,h=l.length;f<h;++f)c.value+=l[f].value;c.dice?_b(c,r,s,o,g?s+=(a-s)*c.value/g:a):dE(c,r,s,g?r+=(o-r)*c.value/g:o,a),g-=c.value}else i._squarify=u=xH(e,i,r,s,o,a),u.ratio=e}return n.ratio=function(i){return t((i=+i)>1?i:1)},n}(_H),K_t=1664525,J_t=1013904223,iB=1/4294967296;function t6(t=Math.random()){let e=(0<=t&&t<1?t/iB:Math.abs(t))|0;return()=>(e=K_t*e+J_t|0,iB*(e>>>0))}function Ro(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function cf(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const wx=Symbol("implicit");function xb(){var t=new zd,e=[],n=[],i=wx;function r(s){let o=t.get(s);if(o===void 0){if(i!==wx)return i;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new zd;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return xb(e,n).unknown(i)},Ro.apply(r,arguments),r}function hE(){var t=xb().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,o,a=!1,u=0,c=0,l=.5;delete t.unknown;function f(){var d=e().length,h=r<i,p=h?r:i,g=h?i:r;s=(g-p)/Math.max(1,d-u+c*2),a&&(s=Math.floor(s)),p+=(g-p-s*(d-u))*l,o=s*(1-u),a&&(p=Math.round(p),o=Math.round(o));var m=Un(d).map(function(y){return p+s*y});return n(h?m.reverse():m)}return t.domain=function(d){return arguments.length?(e(d),f()):e()},t.range=function(d){return arguments.length?([i,r]=d,i=+i,r=+r,f()):[i,r]},t.rangeRound=function(d){return[i,r]=d,i=+i,r=+r,a=!0,f()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(d){return arguments.length?(a=!!d,f()):a},t.padding=function(d){return arguments.length?(u=Math.min(1,c=+d),f()):u},t.paddingInner=function(d){return arguments.length?(u=Math.min(1,d),f()):u},t.paddingOuter=function(d){return arguments.length?(c=+d,f()):c},t.align=function(d){return arguments.length?(l=Math.max(0,Math.min(1,d)),f()):l},t.copy=function(){return hE(e(),[i,r]).round(a).paddingInner(u).paddingOuter(c).align(l)},Ro.apply(f(),arguments)}function EH(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return EH(e())},t}function Q_t(){return EH(hE.apply(null,arguments).paddingInner(1))}function Z_t(t){return function(){return t}}function AT(t){return+t}var rB=[0,1];function Ar(t){return t}function $T(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Z_t(isNaN(e)?NaN:.5)}function txt(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function ext(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=$T(r,i),s=n(o,s)):(i=$T(i,r),s=n(s,o)),function(a){return s(i(a))}}function nxt(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=$T(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(a){var u=sc(t,a,1,i)-1;return s[u](r[u](a))}}function Sb(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function pE(){var t=rB,e=rB,n=vc,i,r,s,o=Ar,a,u,c;function l(){var d=Math.min(t.length,e.length);return o!==Ar&&(o=txt(t[0],t[d-1])),a=d>2?nxt:ext,u=c=null,f}function f(d){return d==null||isNaN(d=+d)?s:(u||(u=a(t.map(i),e,n)))(i(o(d)))}return f.invert=function(d){return o(r((c||(c=a(e,t.map(i),ci)))(d)))},f.domain=function(d){return arguments.length?(t=Array.from(d,AT),l()):t.slice()},f.range=function(d){return arguments.length?(e=Array.from(d),l()):e.slice()},f.rangeRound=function(d){return e=Array.from(d),n=wm,l()},f.clamp=function(d){return arguments.length?(o=d?!0:Ar,l()):o!==Ar},f.interpolate=function(d){return arguments.length?(n=d,l()):n},f.unknown=function(d){return arguments.length?(s=d,f):s},function(d,h){return i=d,r=h,l()}}function AH(){return pE()(Ar,Ar)}function $H(t,e,n,i){var r=Dl(t,e,n),s;switch(i=Wd(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=mY(r,o))&&(i.precision=s),jD(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=yY(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=gY(r))&&(i.precision=s-(i.type==="%")*2);break}}return vh(i)}function wh(t){var e=t.domain;return t.ticks=function(n){var i=e();return kl(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return $H(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],a=i[s],u,c,l=10;for(a<o&&(c=o,o=a,a=c,c=r,r=s,s=c);l-- >0;){if(c=f1(o,a,n),c===u)return i[r]=o,i[s]=a,e(i);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;u=c}return t},t}function gE(){var t=AH();return t.copy=function(){return Sb(t,gE())},Ro.apply(t,arguments),wh(t)}function e6(t){var e;function n(i){return i==null||isNaN(i=+i)?e:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(t=Array.from(i,AT),n):t.slice()},n.unknown=function(i){return arguments.length?(e=i,n):e},n.copy=function(){return e6(t).unknown(e)},t=arguments.length?Array.from(t,AT):[0,1],wh(n)}function IH(t,e){t=t.slice();var n=0,i=t.length-1,r=t[n],s=t[i],o;return s<r&&(o=n,n=i,i=o,o=r,r=s,s=o),t[n]=e.floor(r),t[i]=e.ceil(s),t}function sB(t){return Math.log(t)}function oB(t){return Math.exp(t)}function ixt(t){return-Math.log(-t)}function rxt(t){return-Math.exp(-t)}function sxt(t){return isFinite(t)?+("1e"+t):t<0?0:t}function oxt(t){return t===10?sxt:t===Math.E?Math.exp:e=>Math.pow(t,e)}function axt(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function aB(t){return(e,n)=>-t(-e,n)}function n6(t){const e=t(sB,oB),n=e.domain;let i=10,r,s;function o(){return r=axt(i),s=oxt(i),n()[0]<0?(r=aB(r),s=aB(s),t(ixt,rxt)):t(sB,oB),e}return e.base=function(a){return arguments.length?(i=+a,o()):i},e.domain=function(a){return arguments.length?(n(a),o()):n()},e.ticks=a=>{const u=n();let c=u[0],l=u[u.length-1];const f=l<c;f&&([c,l]=[l,c]);let d=r(c),h=r(l),p,g;const m=a==null?10:+a;let y=[];if(!(i%1)&&h-d<m){if(d=Math.floor(d),h=Math.ceil(h),c>0){for(;d<=h;++d)for(p=1;p<i;++p)if(g=d<0?p/s(-d):p*s(d),!(g<c)){if(g>l)break;y.push(g)}}else for(;d<=h;++d)for(p=i-1;p>=1;--p)if(g=d>0?p/s(-d):p*s(d),!(g<c)){if(g>l)break;y.push(g)}y.length*2<m&&(y=kl(c,l,m))}else y=kl(d,h,Math.min(h-d,m)).map(s);return f?y.reverse():y},e.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=i===10?"s":","),typeof u!="function"&&(!(i%1)&&(u=Wd(u)).precision==null&&(u.trim=!0),u=vh(u)),a===1/0)return u;const c=Math.max(1,i*a/e.ticks().length);return l=>{let f=l/s(Math.round(r(l)));return f*i<i-.5&&(f*=i),f<=c?u(l):""}},e.nice=()=>n(IH(n(),{floor:a=>s(Math.floor(r(a))),ceil:a=>s(Math.ceil(r(a)))})),e}function i6(){const t=n6(pE()).domain([1,10]);return t.copy=()=>Sb(t,i6()).base(t.base()),Ro.apply(t,arguments),t}function uB(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function cB(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function r6(t){var e=1,n=t(uB(e),cB(e));return n.constant=function(i){return arguments.length?t(uB(e=+i),cB(e)):e},wh(n)}function s6(){var t=r6(pE());return t.copy=function(){return Sb(t,s6()).constant(t.constant())},Ro.apply(t,arguments)}function lB(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function uxt(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function cxt(t){return t<0?-t*t:t*t}function o6(t){var e=t(Ar,Ar),n=1;function i(){return n===1?t(Ar,Ar):n===.5?t(uxt,cxt):t(lB(n),lB(1/n))}return e.exponent=function(r){return arguments.length?(n=+r,i()):n},wh(e)}function mE(){var t=o6(pE());return t.copy=function(){return Sb(t,mE()).exponent(t.exponent())},Ro.apply(t,arguments),t}function lxt(){return mE.apply(null,arguments).exponent(.5)}function a6(){var t=[],e=[],n=[],i;function r(){var o=0,a=Math.max(1,e.length);for(n=new Array(a-1);++o<a;)n[o-1]=cG(t,o/a);return s}function s(o){return o==null||isNaN(o=+o)?i:e[sc(n,o)]}return s.invertExtent=function(o){var a=e.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:t[0],a<n.length?n[a]:t[t.length-1]]},s.domain=function(o){if(!arguments.length)return t.slice();t=[];for(let a of o)a!=null&&!isNaN(a=+a)&&t.push(a);return t.sort(Ze),r()},s.range=function(o){return arguments.length?(e=Array.from(o),r()):e.slice()},s.unknown=function(o){return arguments.length?(i=o,s):i},s.quantiles=function(){return n.slice()},s.copy=function(){return a6().domain(t).range(e).unknown(i)},Ro.apply(s,arguments)}function MH(){var t=0,e=1,n=1,i=[.5],r=[0,1],s;function o(u){return u!=null&&u<=u?r[sc(i,u,0,n)]:s}function a(){var u=-1;for(i=new Array(n);++u<n;)i[u]=((u+1)*e-(u-n)*t)/(n+1);return o}return o.domain=function(u){return arguments.length?([t,e]=u,t=+t,e=+e,a()):[t,e]},o.range=function(u){return arguments.length?(n=(r=Array.from(u)).length-1,a()):r.slice()},o.invertExtent=function(u){var c=r.indexOf(u);return c<0?[NaN,NaN]:c<1?[t,i[0]]:c>=n?[i[n-1],e]:[i[c-1],i[c]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return i.slice()},o.copy=function(){return MH().domain([t,e]).range(r).unknown(s)},Ro.apply(wh(o),arguments)}function u6(){var t=[.5],e=[0,1],n,i=1;function r(s){return s!=null&&s<=s?e[sc(t,s,0,i)]:n}return r.domain=function(s){return arguments.length?(t=Array.from(s),i=Math.min(t.length,e.length-1),r):t.slice()},r.range=function(s){return arguments.length?(e=Array.from(s),i=Math.min(t.length,e.length-1),r):e.slice()},r.invertExtent=function(s){var o=e.indexOf(s);return[t[o-1],t[o]]},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return u6().domain(t).range(e).unknown(n)},Ro.apply(r,arguments)}const CI=new Date,NI=new Date;function Wn(t,e,n,i){function r(s){return t(s=arguments.length===0?new Date:new Date(+s)),s}return r.floor=s=>(t(s=new Date(+s)),s),r.ceil=s=>(t(s=new Date(s-1)),e(s,1),t(s),s),r.round=s=>{const o=r(s),a=r.ceil(s);return s-o<a-s?o:a},r.offset=(s,o)=>(e(s=new Date(+s),o==null?1:Math.floor(o)),s),r.range=(s,o,a)=>{const u=[];if(s=r.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let c;do u.push(c=new Date(+s)),e(s,a),t(s);while(c<s&&s<o);return u},r.filter=s=>Wn(o=>{if(o>=o)for(;t(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;e(o,-1),!s(o););else for(;--a>=0;)for(;e(o,1),!s(o););}),n&&(r.count=(s,o)=>(CI.setTime(+s),NI.setTime(+o),t(CI),t(NI),Math.floor(n(CI,NI))),r.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?r.filter(i?o=>i(o)%s===0:o=>r.count(0,o)%s===0):r)),r}const Cg=Wn(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Cg.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?Wn(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):Cg);Cg.range;const Wu=1e3,Ms=Wu*60,Gu=Ms*60,cc=Gu*24,c6=cc*7,fB=cc*30,OI=cc*365,Qr=Wn(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Wu)},(t,e)=>(e-t)/Wu,t=>t.getUTCSeconds());Qr.range;const Sm=Wn(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Wu)},(t,e)=>{t.setTime(+t+e*Ms)},(t,e)=>(e-t)/Ms,t=>t.getMinutes());Sm.range;const Em=Wn(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Ms)},(t,e)=>(e-t)/Ms,t=>t.getUTCMinutes());Em.range;const Am=Wn(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Wu-t.getMinutes()*Ms)},(t,e)=>{t.setTime(+t+e*Gu)},(t,e)=>(e-t)/Gu,t=>t.getHours());Am.range;const $m=Wn(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*Gu)},(t,e)=>(e-t)/Gu,t=>t.getUTCHours());$m.range;const wo=Wn(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Ms)/cc,t=>t.getDate()-1);wo.range;const pl=Wn(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/cc,t=>t.getUTCDate()-1);pl.range;const yE=Wn(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/cc,t=>Math.floor(t/cc));yE.range;function _h(t){return Wn(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Ms)/c6)}const Ol=_h(0),_1=_h(1),TH=_h(2),FH=_h(3),Hd=_h(4),kH=_h(5),DH=_h(6);Ol.range;_1.range;TH.range;FH.range;Hd.range;kH.range;DH.range;function xh(t){return Wn(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/c6)}const Rl=xh(0),x1=xh(1),CH=xh(2),NH=xh(3),Xd=xh(4),OH=xh(5),RH=xh(6);Rl.range;x1.range;CH.range;NH.range;Xd.range;OH.range;RH.range;const Kd=Wn(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());Kd.range;const Jd=Wn(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());Jd.range;const zs=Wn(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());zs.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Wn(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});zs.range;const Us=Wn(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());Us.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Wn(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});Us.range;function LH(t,e,n,i,r,s){const o=[[Qr,1,Wu],[Qr,5,5*Wu],[Qr,15,15*Wu],[Qr,30,30*Wu],[s,1,Ms],[s,5,5*Ms],[s,15,15*Ms],[s,30,30*Ms],[r,1,Gu],[r,3,3*Gu],[r,6,6*Gu],[r,12,12*Gu],[i,1,cc],[i,2,2*cc],[n,1,c6],[e,1,fB],[e,3,3*fB],[t,1,OI]];function a(c,l,f){const d=l<c;d&&([c,l]=[l,c]);const h=f&&typeof f.range=="function"?f:u(c,l,f),p=h?h.range(c,+l+1):[];return d?p.reverse():p}function u(c,l,f){const d=Math.abs(l-c)/f,h=bh(([,,m])=>m).right(o,d);if(h===o.length)return t.every(Dl(c/OI,l/OI,f));if(h===0)return Cg.every(Math.max(Dl(c,l,f),1));const[p,g]=o[d/o[h-1][2]<o[h][2]/d?h-1:h];return p.every(g)}return[a,u]}const[fxt,BH]=LH(Us,Jd,Rl,yE,$m,Em),[dxt,hxt]=LH(zs,Kd,Ol,wo,Am,Sm);function RI(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function LI(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function d0(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function PH(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,s=t.days,o=t.shortDays,a=t.months,u=t.shortMonths,c=h0(r),l=p0(r),f=h0(s),d=p0(s),h=h0(o),p=p0(o),g=h0(a),m=p0(a),y=h0(u),b=p0(u),v={a:N,A:R,b:L,B,c:null,d:yB,e:yB,f:Rxt,g:Gxt,G:Hxt,H:Cxt,I:Nxt,j:Oxt,L:zH,m:Lxt,M:Bxt,p:P,q:U,Q:wB,s:_B,S:Pxt,u:zxt,U:Uxt,V:jxt,w:qxt,W:Vxt,x:null,X:null,y:Wxt,Y:Yxt,Z:Xxt,"%":vB},w={a:H,A:nt,b:ft,B:dt,c:null,d:bB,e:bB,f:Zxt,g:cSt,G:fSt,H:Kxt,I:Jxt,j:Qxt,L:jH,m:tSt,M:eSt,p:et,q:ct,Q:wB,s:_B,S:nSt,u:iSt,U:rSt,V:sSt,w:oSt,W:aSt,x:null,X:null,y:uSt,Y:lSt,Z:dSt,"%":vB},_={a:$,A:I,b:k,B:T,c:M,d:gB,e:gB,f:Txt,g:pB,G:hB,H:mB,I:mB,j:Axt,L:Mxt,m:Ext,M:$xt,p:A,q:Sxt,Q:kxt,s:Dxt,S:Ixt,u:bxt,U:vxt,V:wxt,w:yxt,W:_xt,x:F,X:D,y:pB,Y:hB,Z:xxt,"%":Fxt};v.x=S(n,v),v.X=S(i,v),v.c=S(e,v),w.x=S(n,w),w.X=S(i,w),w.c=S(e,w);function S(G,st){return function(lt){var V=[],Vt=-1,mt=0,ee=G.length,oe,ht,$e;for(lt instanceof Date||(lt=new Date(+lt));++Vt<ee;)G.charCodeAt(Vt)===37&&(V.push(G.slice(mt,Vt)),(ht=dB[oe=G.charAt(++Vt)])!=null?oe=G.charAt(++Vt):ht=oe==="e"?" ":"0",($e=st[oe])&&(oe=$e(lt,ht)),V.push(oe),mt=Vt+1);return V.push(G.slice(mt,Vt)),V.join("")}}function x(G,st){return function(lt){var V=d0(1900,void 0,1),Vt=E(V,G,lt+="",0),mt,ee;if(Vt!=lt.length)return null;if("Q"in V)return new Date(V.Q);if("s"in V)return new Date(V.s*1e3+("L"in V?V.L:0));if(st&&!("Z"in V)&&(V.Z=0),"p"in V&&(V.H=V.H%12+V.p*12),V.m===void 0&&(V.m="q"in V?V.q:0),"V"in V){if(V.V<1||V.V>53)return null;"w"in V||(V.w=1),"Z"in V?(mt=LI(d0(V.y,0,1)),ee=mt.getUTCDay(),mt=ee>4||ee===0?x1.ceil(mt):x1(mt),mt=pl.offset(mt,(V.V-1)*7),V.y=mt.getUTCFullYear(),V.m=mt.getUTCMonth(),V.d=mt.getUTCDate()+(V.w+6)%7):(mt=RI(d0(V.y,0,1)),ee=mt.getDay(),mt=ee>4||ee===0?_1.ceil(mt):_1(mt),mt=wo.offset(mt,(V.V-1)*7),V.y=mt.getFullYear(),V.m=mt.getMonth(),V.d=mt.getDate()+(V.w+6)%7)}else("W"in V||"U"in V)&&("w"in V||(V.w="u"in V?V.u%7:"W"in V?1:0),ee="Z"in V?LI(d0(V.y,0,1)).getUTCDay():RI(d0(V.y,0,1)).getDay(),V.m=0,V.d="W"in V?(V.w+6)%7+V.W*7-(ee+5)%7:V.w+V.U*7-(ee+6)%7);return"Z"in V?(V.H+=V.Z/100|0,V.M+=V.Z%100,LI(V)):RI(V)}}function E(G,st,lt,V){for(var Vt=0,mt=st.length,ee=lt.length,oe,ht;Vt<mt;){if(V>=ee)return-1;if(oe=st.charCodeAt(Vt++),oe===37){if(oe=st.charAt(Vt++),ht=_[oe in dB?st.charAt(Vt++):oe],!ht||(V=ht(G,lt,V))<0)return-1}else if(oe!=lt.charCodeAt(V++))return-1}return V}function A(G,st,lt){var V=c.exec(st.slice(lt));return V?(G.p=l.get(V[0].toLowerCase()),lt+V[0].length):-1}function $(G,st,lt){var V=h.exec(st.slice(lt));return V?(G.w=p.get(V[0].toLowerCase()),lt+V[0].length):-1}function I(G,st,lt){var V=f.exec(st.slice(lt));return V?(G.w=d.get(V[0].toLowerCase()),lt+V[0].length):-1}function k(G,st,lt){var V=y.exec(st.slice(lt));return V?(G.m=b.get(V[0].toLowerCase()),lt+V[0].length):-1}function T(G,st,lt){var V=g.exec(st.slice(lt));return V?(G.m=m.get(V[0].toLowerCase()),lt+V[0].length):-1}function M(G,st,lt){return E(G,e,st,lt)}function F(G,st,lt){return E(G,n,st,lt)}function D(G,st,lt){return E(G,i,st,lt)}function N(G){return o[G.getDay()]}function R(G){return s[G.getDay()]}function L(G){return u[G.getMonth()]}function B(G){return a[G.getMonth()]}function P(G){return r[+(G.getHours()>=12)]}function U(G){return 1+~~(G.getMonth()/3)}function H(G){return o[G.getUTCDay()]}function nt(G){return s[G.getUTCDay()]}function ft(G){return u[G.getUTCMonth()]}function dt(G){return a[G.getUTCMonth()]}function et(G){return r[+(G.getUTCHours()>=12)]}function ct(G){return 1+~~(G.getUTCMonth()/3)}return{format:function(G){var st=S(G+="",v);return st.toString=function(){return G},st},parse:function(G){var st=x(G+="",!1);return st.toString=function(){return G},st},utcFormat:function(G){var st=S(G+="",w);return st.toString=function(){return G},st},utcParse:function(G){var st=x(G+="",!0);return st.toString=function(){return G},st}}}var dB={"-":"",_:" ",0:"0"},oi=/^\s*\d+/,pxt=/^%/,gxt=/[\\^$*+?|[\]().{}]/g;function _e(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",s=r.length;return i+(s<n?new Array(n-s+1).join(e)+r:r)}function mxt(t){return t.replace(gxt,"\\$&")}function h0(t){return new RegExp("^(?:"+t.map(mxt).join("|")+")","i")}function p0(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function yxt(t,e,n){var i=oi.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function bxt(t,e,n){var i=oi.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function vxt(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function wxt(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function _xt(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function hB(t,e,n){var i=oi.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function pB(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function xxt(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function Sxt(t,e,n){var i=oi.exec(e.slice(n,n+1));return i?(t.q=i[0]*3-3,n+i[0].length):-1}function Ext(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function gB(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function Axt(t,e,n){var i=oi.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function mB(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function $xt(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function Ixt(t,e,n){var i=oi.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function Mxt(t,e,n){var i=oi.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function Txt(t,e,n){var i=oi.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Fxt(t,e,n){var i=pxt.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function kxt(t,e,n){var i=oi.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function Dxt(t,e,n){var i=oi.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function yB(t,e){return _e(t.getDate(),e,2)}function Cxt(t,e){return _e(t.getHours(),e,2)}function Nxt(t,e){return _e(t.getHours()%12||12,e,2)}function Oxt(t,e){return _e(1+wo.count(zs(t),t),e,3)}function zH(t,e){return _e(t.getMilliseconds(),e,3)}function Rxt(t,e){return zH(t,e)+"000"}function Lxt(t,e){return _e(t.getMonth()+1,e,2)}function Bxt(t,e){return _e(t.getMinutes(),e,2)}function Pxt(t,e){return _e(t.getSeconds(),e,2)}function zxt(t){var e=t.getDay();return e===0?7:e}function Uxt(t,e){return _e(Ol.count(zs(t)-1,t),e,2)}function UH(t){var e=t.getDay();return e>=4||e===0?Hd(t):Hd.ceil(t)}function jxt(t,e){return t=UH(t),_e(Hd.count(zs(t),t)+(zs(t).getDay()===4),e,2)}function qxt(t){return t.getDay()}function Vxt(t,e){return _e(_1.count(zs(t)-1,t),e,2)}function Wxt(t,e){return _e(t.getFullYear()%100,e,2)}function Gxt(t,e){return t=UH(t),_e(t.getFullYear()%100,e,2)}function Yxt(t,e){return _e(t.getFullYear()%1e4,e,4)}function Hxt(t,e){var n=t.getDay();return t=n>=4||n===0?Hd(t):Hd.ceil(t),_e(t.getFullYear()%1e4,e,4)}function Xxt(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+_e(e/60|0,"0",2)+_e(e%60,"0",2)}function bB(t,e){return _e(t.getUTCDate(),e,2)}function Kxt(t,e){return _e(t.getUTCHours(),e,2)}function Jxt(t,e){return _e(t.getUTCHours()%12||12,e,2)}function Qxt(t,e){return _e(1+pl.count(Us(t),t),e,3)}function jH(t,e){return _e(t.getUTCMilliseconds(),e,3)}function Zxt(t,e){return jH(t,e)+"000"}function tSt(t,e){return _e(t.getUTCMonth()+1,e,2)}function eSt(t,e){return _e(t.getUTCMinutes(),e,2)}function nSt(t,e){return _e(t.getUTCSeconds(),e,2)}function iSt(t){var e=t.getUTCDay();return e===0?7:e}function rSt(t,e){return _e(Rl.count(Us(t)-1,t),e,2)}function qH(t){var e=t.getUTCDay();return e>=4||e===0?Xd(t):Xd.ceil(t)}function sSt(t,e){return t=qH(t),_e(Xd.count(Us(t),t)+(Us(t).getUTCDay()===4),e,2)}function oSt(t){return t.getUTCDay()}function aSt(t,e){return _e(x1.count(Us(t)-1,t),e,2)}function uSt(t,e){return _e(t.getUTCFullYear()%100,e,2)}function cSt(t,e){return t=qH(t),_e(t.getUTCFullYear()%100,e,2)}function lSt(t,e){return _e(t.getUTCFullYear()%1e4,e,4)}function fSt(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Xd(t):Xd.ceil(t),_e(t.getUTCFullYear()%1e4,e,4)}function dSt(){return"+0000"}function vB(){return"%"}function wB(t){return+t}function _B(t){return Math.floor(+t/1e3)}var Xh,bE,VH,Im,WH;hSt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function hSt(t){return Xh=PH(t),bE=Xh.format,VH=Xh.parse,Im=Xh.utcFormat,WH=Xh.utcParse,Xh}function pSt(t){return new Date(t)}function gSt(t){return t instanceof Date?+t:+new Date(+t)}function l6(t,e,n,i,r,s,o,a,u,c){var l=AH(),f=l.invert,d=l.domain,h=c(".%L"),p=c(":%S"),g=c("%I:%M"),m=c("%I %p"),y=c("%a %d"),b=c("%b %d"),v=c("%B"),w=c("%Y");function _(S){return(u(S)<S?h:a(S)<S?p:o(S)<S?g:s(S)<S?m:i(S)<S?r(S)<S?y:b:n(S)<S?v:w)(S)}return l.invert=function(S){return new Date(f(S))},l.domain=function(S){return arguments.length?d(Array.from(S,gSt)):d().map(pSt)},l.ticks=function(S){var x=d();return t(x[0],x[x.length-1],S??10)},l.tickFormat=function(S,x){return x==null?_:c(x)},l.nice=function(S){var x=d();return(!S||typeof S.range!="function")&&(S=e(x[0],x[x.length-1],S??10)),S?d(IH(x,S)):l},l.copy=function(){return Sb(l,l6(t,e,n,i,r,s,o,a,u,c))},l}function GH(){return Ro.apply(l6(dxt,hxt,zs,Kd,Ol,wo,Am,Sm,Qr,bE).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function YH(){return Ro.apply(l6(fxt,BH,Us,Jd,Rl,pl,$m,Em,Qr,Im).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function vE(){var t=0,e=1,n,i,r,s,o=Ar,a=!1,u;function c(f){return f==null||isNaN(f=+f)?u:o(r===0?.5:(f=(s(f)-n)*r,a?Math.max(0,Math.min(1,f)):f))}c.domain=function(f){return arguments.length?([t,e]=f,n=s(t=+t),i=s(e=+e),r=n===i?0:1/(i-n),c):[t,e]},c.clamp=function(f){return arguments.length?(a=!!f,c):a},c.interpolator=function(f){return arguments.length?(o=f,c):o};function l(f){return function(d){var h,p;return arguments.length?([h,p]=d,o=f(h,p),c):[o(0),o(1)]}}return c.range=l(vc),c.rangeRound=l(wm),c.unknown=function(f){return arguments.length?(u=f,c):u},function(f){return s=f,n=f(t),i=f(e),r=n===i?0:1/(i-n),c}}function lf(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function f6(){var t=wh(vE()(Ar));return t.copy=function(){return lf(t,f6())},cf.apply(t,arguments)}function HH(){var t=n6(vE()).domain([1,10]);return t.copy=function(){return lf(t,HH()).base(t.base())},cf.apply(t,arguments)}function XH(){var t=r6(vE());return t.copy=function(){return lf(t,XH()).constant(t.constant())},cf.apply(t,arguments)}function d6(){var t=o6(vE());return t.copy=function(){return lf(t,d6()).exponent(t.exponent())},cf.apply(t,arguments)}function mSt(){return d6.apply(null,arguments).exponent(.5)}function wE(){var t=0,e=.5,n=1,i=1,r,s,o,a,u,c=Ar,l,f=!1,d;function h(g){return isNaN(g=+g)?d:(g=.5+((g=+l(g))-s)*(i*g<i*s?a:u),c(f?Math.max(0,Math.min(1,g)):g))}h.domain=function(g){return arguments.length?([t,e,n]=g,r=l(t=+t),s=l(e=+e),o=l(n=+n),a=r===s?0:.5/(s-r),u=s===o?0:.5/(o-s),i=s<r?-1:1,h):[t,e,n]},h.clamp=function(g){return arguments.length?(f=!!g,h):f},h.interpolator=function(g){return arguments.length?(c=g,h):c};function p(g){return function(m){var y,b,v;return arguments.length?([y,b,v]=m,c=_m(g,[y,b,v]),h):[c(0),c(.5),c(1)]}}return h.range=p(vc),h.rangeRound=p(wm),h.unknown=function(g){return arguments.length?(d=g,h):d},function(g){return l=g,r=g(t),s=g(e),o=g(n),a=r===s?0:.5/(s-r),u=s===o?0:.5/(o-s),i=s<r?-1:1,h}}function h6(){var t=wh(wE()(Ar));return t.copy=function(){return lf(t,h6())},cf.apply(t,arguments)}function p6(){var t=n6(wE()).domain([.1,1,10]);return t.copy=function(){return lf(t,p6()).base(t.base())},cf.apply(t,arguments)}function g6(){var t=r6(wE());return t.copy=function(){return lf(t,g6()).constant(t.constant())},cf.apply(t,arguments)}function _E(){var t=o6(wE());return t.copy=function(){return lf(t,_E()).exponent(t.exponent())},cf.apply(t,arguments)}function ySt(){return _E.apply(null,arguments).exponent(.5)}function Zt(t){for(var e=t.length/6|0,n=new Array(e),i=0;i<e;)n[i]="#"+t.slice(i*6,++i*6);return n}const bSt=Zt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),vSt=Zt("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),wSt=Zt("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),_St=Zt("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),xSt=Zt("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),SSt=Zt("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),ESt=Zt("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),ASt=Zt("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),$St=Zt("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),ISt=Zt("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),MSt=Zt("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),je=t=>UG(t[t.length-1]);var KH=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Zt);const JH=je(KH);var QH=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Zt);const ZH=je(QH);var tX=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Zt);const eX=je(tX);var nX=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Zt);const iX=je(nX);var IT=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Zt);const _x=je(IT);var rX=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Zt);const sX=je(rX);var MT=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Zt);const xx=je(MT);var oX=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Zt);const aX=je(oX);var uX=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Zt);const cX=je(uX);var lX=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Zt);const fX=je(lX);var dX=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Zt);const hX=je(dX);var pX=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Zt);const gX=je(pX);var mX=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Zt);const yX=je(mX);var bX=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Zt);const vX=je(bX);var wX=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Zt);const _X=je(wX);var xX=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Zt);const SX=je(xX);var EX=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Zt);const AX=je(EX);var $X=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Zt);const IX=je($X);var MX=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Zt);const TX=je(MX);var FX=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Zt);const kX=je(FX);var DX=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Zt);const CX=je(DX);var NX=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Zt);const OX=je(NX);var RX=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Zt);const LX=je(RX);var BX=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Zt);const PX=je(BX);var zX=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Zt);const UX=je(zX);var jX=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Zt);const qX=je(jX);var VX=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Zt);const WX=je(VX);function GX(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-t*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-t*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-t*2475.67)))))))+")"}const YX=rE(La(300,.5,0),La(-240,.5,1));var HX=rE(La(-100,.75,.35),La(80,1.5,.8)),XX=rE(La(260,.75,.35),La(80,1.5,.8)),Vv=La();function KX(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return Vv.h=360*t-100,Vv.s=1.5-1.5*e,Vv.l=.8-.9*e,Vv+""}var Wv=Nr(),TSt=Math.PI/3,FSt=Math.PI*2/3;function JX(t){var e;return t=(.5-t)*Math.PI,Wv.r=255*(e=Math.sin(t))*e,Wv.g=255*(e=Math.sin(t+TSt))*e,Wv.b=255*(e=Math.sin(t+FSt))*e,Wv+""}function QX(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-t*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+t*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-t*6838.66)))))))+")"}function xE(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}const ZX=xE(Zt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var tK=xE(Zt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),eK=xE(Zt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),nK=xE(Zt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function Ie(t){return function(){return t}}const xB=Math.abs,Si=Math.atan2,Du=Math.cos,kSt=Math.max,sg=Math.min,mr=Math.sin,Qe=Math.sqrt,Ei=1e-12,Ll=Math.PI,Sx=Ll/2,Eb=2*Ll;function DSt(t){return t>1?0:t<-1?Ll:Math.acos(t)}function SB(t){return t>=1?Sx:t<=-1?-Sx:Math.asin(t)}function SE(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);e=i}return t},()=>new uE(e)}function CSt(t){return t.innerRadius}function NSt(t){return t.outerRadius}function OSt(t){return t.startAngle}function RSt(t){return t.endAngle}function LSt(t){return t&&t.padAngle}function BSt(t,e,n,i,r,s,o,a){var u=n-t,c=i-e,l=o-r,f=a-s,d=f*u-l*c;if(!(d*d<Ei))return d=(l*(e-s)-f*(t-r))/d,[t+d*u,e+d*c]}function Gv(t,e,n,i,r,s,o){var a=t-n,u=e-i,c=(o?s:-s)/Qe(a*a+u*u),l=c*u,f=-c*a,d=t+l,h=e+f,p=n+l,g=i+f,m=(d+p)/2,y=(h+g)/2,b=p-d,v=g-h,w=b*b+v*v,_=r-s,S=d*g-p*h,x=(v<0?-1:1)*Qe(kSt(0,_*_*w-S*S)),E=(S*v-b*x)/w,A=(-S*b-v*x)/w,$=(S*v+b*x)/w,I=(-S*b+v*x)/w,k=E-m,T=A-y,M=$-m,F=I-y;return k*k+T*T>M*M+F*F&&(E=$,A=I),{cx:E,cy:A,x01:-l,y01:-f,x11:E*(r/_-1),y11:A*(r/_-1)}}function PSt(){var t=CSt,e=NSt,n=Ie(0),i=null,r=OSt,s=RSt,o=LSt,a=null,u=SE(c);function c(){var l,f,d=+t.apply(this,arguments),h=+e.apply(this,arguments),p=r.apply(this,arguments)-Sx,g=s.apply(this,arguments)-Sx,m=xB(g-p),y=g>p;if(a||(a=l=u()),h<d&&(f=h,h=d,d=f),!(h>Ei))a.moveTo(0,0);else if(m>Eb-Ei)a.moveTo(h*Du(p),h*mr(p)),a.arc(0,0,h,p,g,!y),d>Ei&&(a.moveTo(d*Du(g),d*mr(g)),a.arc(0,0,d,g,p,y));else{var b=p,v=g,w=p,_=g,S=m,x=m,E=o.apply(this,arguments)/2,A=E>Ei&&(i?+i.apply(this,arguments):Qe(d*d+h*h)),$=sg(xB(h-d)/2,+n.apply(this,arguments)),I=$,k=$,T,M;if(A>Ei){var F=SB(A/d*mr(E)),D=SB(A/h*mr(E));(S-=F*2)>Ei?(F*=y?1:-1,w+=F,_-=F):(S=0,w=_=(p+g)/2),(x-=D*2)>Ei?(D*=y?1:-1,b+=D,v-=D):(x=0,b=v=(p+g)/2)}var N=h*Du(b),R=h*mr(b),L=d*Du(_),B=d*mr(_);if($>Ei){var P=h*Du(v),U=h*mr(v),H=d*Du(w),nt=d*mr(w),ft;if(m<Ll)if(ft=BSt(N,R,H,nt,P,U,L,B)){var dt=N-ft[0],et=R-ft[1],ct=P-ft[0],G=U-ft[1],st=1/mr(DSt((dt*ct+et*G)/(Qe(dt*dt+et*et)*Qe(ct*ct+G*G)))/2),lt=Qe(ft[0]*ft[0]+ft[1]*ft[1]);I=sg($,(d-lt)/(st-1)),k=sg($,(h-lt)/(st+1))}else I=k=0}x>Ei?k>Ei?(T=Gv(H,nt,N,R,h,k,y),M=Gv(P,U,L,B,h,k,y),a.moveTo(T.cx+T.x01,T.cy+T.y01),k<$?a.arc(T.cx,T.cy,k,Si(T.y01,T.x01),Si(M.y01,M.x01),!y):(a.arc(T.cx,T.cy,k,Si(T.y01,T.x01),Si(T.y11,T.x11),!y),a.arc(0,0,h,Si(T.cy+T.y11,T.cx+T.x11),Si(M.cy+M.y11,M.cx+M.x11),!y),a.arc(M.cx,M.cy,k,Si(M.y11,M.x11),Si(M.y01,M.x01),!y))):(a.moveTo(N,R),a.arc(0,0,h,b,v,!y)):a.moveTo(N,R),!(d>Ei)||!(S>Ei)?a.lineTo(L,B):I>Ei?(T=Gv(L,B,P,U,d,-I,y),M=Gv(N,R,H,nt,d,-I,y),a.lineTo(T.cx+T.x01,T.cy+T.y01),I<$?a.arc(T.cx,T.cy,I,Si(T.y01,T.x01),Si(M.y01,M.x01),!y):(a.arc(T.cx,T.cy,I,Si(T.y01,T.x01),Si(T.y11,T.x11),!y),a.arc(0,0,d,Si(T.cy+T.y11,T.cx+T.x11),Si(M.cy+M.y11,M.cx+M.x11),y),a.arc(M.cx,M.cy,I,Si(M.y11,M.x11),Si(M.y01,M.x01),!y))):a.arc(0,0,d,_,w,y)}if(a.closePath(),l)return a=null,l+""||null}return c.centroid=function(){var l=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,f=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2-Ll/2;return[Du(f)*l,mr(f)*l]},c.innerRadius=function(l){return arguments.length?(t=typeof l=="function"?l:Ie(+l),c):t},c.outerRadius=function(l){return arguments.length?(e=typeof l=="function"?l:Ie(+l),c):e},c.cornerRadius=function(l){return arguments.length?(n=typeof l=="function"?l:Ie(+l),c):n},c.padRadius=function(l){return arguments.length?(i=l==null?null:typeof l=="function"?l:Ie(+l),c):i},c.startAngle=function(l){return arguments.length?(r=typeof l=="function"?l:Ie(+l),c):r},c.endAngle=function(l){return arguments.length?(s=typeof l=="function"?l:Ie(+l),c):s},c.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:Ie(+l),c):o},c.context=function(l){return arguments.length?(a=l??null,c):a},c}function iK(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function rK(t){this._context=t}rK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Mm(t){return new rK(t)}function sK(t){return t[0]}function oK(t){return t[1]}function m6(t,e){var n=Ie(!0),i=null,r=Mm,s=null,o=SE(a);t=typeof t=="function"?t:t===void 0?sK:Ie(t),e=typeof e=="function"?e:e===void 0?oK:Ie(e);function a(u){var c,l=(u=iK(u)).length,f,d=!1,h;for(i==null&&(s=r(h=o())),c=0;c<=l;++c)!(c<l&&n(f=u[c],c,u))===d&&((d=!d)?s.lineStart():s.lineEnd()),d&&s.point(+t(f,c,u),+e(f,c,u));if(h)return s=null,h+""||null}return a.x=function(u){return arguments.length?(t=typeof u=="function"?u:Ie(+u),a):t},a.y=function(u){return arguments.length?(e=typeof u=="function"?u:Ie(+u),a):e},a.defined=function(u){return arguments.length?(n=typeof u=="function"?u:Ie(!!u),a):n},a.curve=function(u){return arguments.length?(r=u,i!=null&&(s=r(i)),a):r},a.context=function(u){return arguments.length?(u==null?i=s=null:s=r(i=u),a):i},a}function Ab(t,e,n){var i=null,r=Ie(!0),s=null,o=Mm,a=null,u=SE(c);t=typeof t=="function"?t:t===void 0?sK:Ie(+t),e=typeof e=="function"?e:Ie(e===void 0?0:+e),n=typeof n=="function"?n:n===void 0?oK:Ie(+n);function c(f){var d,h,p,g=(f=iK(f)).length,m,y=!1,b,v=new Array(g),w=new Array(g);for(s==null&&(a=o(b=u())),d=0;d<=g;++d){if(!(d<g&&r(m=f[d],d,f))===y)if(y=!y)h=d,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),p=d-1;p>=h;--p)a.point(v[p],w[p]);a.lineEnd(),a.areaEnd()}y&&(v[d]=+t(m,d,f),w[d]=+e(m,d,f),a.point(i?+i(m,d,f):v[d],n?+n(m,d,f):w[d]))}if(b)return a=null,b+""||null}function l(){return m6().defined(r).curve(o).context(s)}return c.x=function(f){return arguments.length?(t=typeof f=="function"?f:Ie(+f),i=null,c):t},c.x0=function(f){return arguments.length?(t=typeof f=="function"?f:Ie(+f),c):t},c.x1=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:Ie(+f),c):i},c.y=function(f){return arguments.length?(e=typeof f=="function"?f:Ie(+f),n=null,c):e},c.y0=function(f){return arguments.length?(e=typeof f=="function"?f:Ie(+f),c):e},c.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Ie(+f),c):n},c.lineX0=c.lineY0=function(){return l().x(t).y(e)},c.lineY1=function(){return l().x(t).y(n)},c.lineX1=function(){return l().x(i).y(e)},c.defined=function(f){return arguments.length?(r=typeof f=="function"?f:Ie(!!f),c):r},c.curve=function(f){return arguments.length?(o=f,s!=null&&(a=o(s)),c):o},c.context=function(f){return arguments.length?(f==null?s=a=null:a=o(s=f),c):s},c}class aK{constructor(e,n){this._context=e,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,n){switch(e=+e,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,n,e,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,e,this._y0,e,n);break}}this._x0=e,this._y0=n}}function zSt(t){return new aK(t,!0)}function USt(t){return new aK(t,!1)}const jSt=Qe(3),uK={draw(t,e){const n=Qe(e+sg(e/28,.75))*.59436,i=n/2,r=i*jSt;t.moveTo(0,n),t.lineTo(0,-n),t.moveTo(-r,-i),t.lineTo(r,i),t.moveTo(-r,i),t.lineTo(r,-i)}},Ng={draw(t,e){const n=Qe(e/Ll);t.moveTo(n,0),t.arc(0,0,n,0,Eb)}},cK={draw(t,e){const n=Qe(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},lK=Qe(1/3),qSt=lK*2,fK={draw(t,e){const n=Qe(e/qSt),i=n*lK;t.moveTo(0,-n),t.lineTo(i,0),t.lineTo(0,n),t.lineTo(-i,0),t.closePath()}},dK={draw(t,e){const n=Qe(e)*.62625;t.moveTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.lineTo(-n,0),t.closePath()}},hK={draw(t,e){const n=Qe(e-sg(e/7,2))*.87559;t.moveTo(-n,0),t.lineTo(n,0),t.moveTo(0,n),t.lineTo(0,-n)}},pK={draw(t,e){const n=Qe(e),i=-n/2;t.rect(i,i,n,n)}},gK={draw(t,e){const n=Qe(e)*.4431;t.moveTo(n,n),t.lineTo(n,-n),t.lineTo(-n,-n),t.lineTo(-n,n),t.closePath()}},VSt=.8908130915292852,mK=mr(Ll/10)/mr(7*Ll/10),WSt=mr(Eb/10)*mK,GSt=-Du(Eb/10)*mK,yK={draw(t,e){const n=Qe(e*VSt),i=WSt*n,r=GSt*n;t.moveTo(0,-n),t.lineTo(i,r);for(let s=1;s<5;++s){const o=Eb*s/5,a=Du(o),u=mr(o);t.lineTo(u*n,-a*n),t.lineTo(a*i-u*r,u*i+a*r)}t.closePath()}},BI=Qe(3),bK={draw(t,e){const n=-Qe(e/(BI*3));t.moveTo(0,n*2),t.lineTo(-BI*n,-n),t.lineTo(BI*n,-n),t.closePath()}},YSt=Qe(3),vK={draw(t,e){const n=Qe(e)*.6824,i=n/2,r=n*YSt/2;t.moveTo(0,-n),t.lineTo(r,i),t.lineTo(-r,i),t.closePath()}},gs=-.5,ms=Qe(3)/2,TT=1/Qe(12),HSt=(TT/2+1)*3,wK={draw(t,e){const n=Qe(e/HSt),i=n/2,r=n*TT,s=i,o=n*TT+n,a=-s,u=o;t.moveTo(i,r),t.lineTo(s,o),t.lineTo(a,u),t.lineTo(gs*i-ms*r,ms*i+gs*r),t.lineTo(gs*s-ms*o,ms*s+gs*o),t.lineTo(gs*a-ms*u,ms*a+gs*u),t.lineTo(gs*i+ms*r,gs*r-ms*i),t.lineTo(gs*s+ms*o,gs*o-ms*s),t.lineTo(gs*a+ms*u,gs*u-ms*a),t.closePath()}},_K={draw(t,e){const n=Qe(e-sg(e/6,1.7))*.6189;t.moveTo(-n,-n),t.lineTo(n,n),t.moveTo(-n,n),t.lineTo(n,-n)}},XSt=[Ng,cK,fK,pK,yK,bK,wK],KSt=[Ng,hK,_K,vK,uK,gK,dK];function JSt(t,e){let n=null,i=SE(r);t=typeof t=="function"?t:Ie(t||Ng),e=typeof e=="function"?e:Ie(e===void 0?64:+e);function r(){let s;if(n||(n=s=i()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),s)return n=null,s+""||null}return r.type=function(s){return arguments.length?(t=typeof s=="function"?s:Ie(s),r):t},r.size=function(s){return arguments.length?(e=typeof s=="function"?s:Ie(+s),r):e},r.context=function(s){return arguments.length?(n=s??null,r):n},r}function Bl(){}function Ex(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function EE(t){this._context=t}EE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ex(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ex(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function xK(t){return new EE(t)}function SK(t){this._context=t}SK.prototype={areaStart:Bl,areaEnd:Bl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Ex(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function EK(t){return new SK(t)}function AK(t){this._context=t}AK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:Ex(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function $K(t){return new AK(t)}function IK(t,e){this._basis=new EE(t),this._beta=e}IK.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i=t[0],r=e[0],s=t[n]-i,o=e[n]-r,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*t[a]+(1-this._beta)*(i+u*s),this._beta*e[a]+(1-this._beta)*(r+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const MK=function t(e){function n(i){return e===1?new EE(i):new IK(i,e)}return n.beta=function(i){return t(+i)},n}(.85);function Ax(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function y6(t,e){this._context=t,this._k=(1-e)/6}y6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Ax(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Ax(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const TK=function t(e){function n(i){return new y6(i,e)}return n.tension=function(i){return t(+i)},n}(0);function b6(t,e){this._context=t,this._k=(1-e)/6}b6.prototype={areaStart:Bl,areaEnd:Bl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Ax(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const FK=function t(e){function n(i){return new b6(i,e)}return n.tension=function(i){return t(+i)},n}(0);function v6(t,e){this._context=t,this._k=(1-e)/6}v6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ax(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const kK=function t(e){function n(i){return new v6(i,e)}return n.tension=function(i){return t(+i)},n}(0);function w6(t,e,n){var i=t._x1,r=t._y1,s=t._x2,o=t._y2;if(t._l01_a>Ei){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,u=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/u,r=(r*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/u}if(t._l23_a>Ei){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);s=(s*c+t._x1*t._l23_2a-e*t._l12_2a)/l,o=(o*c+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(i,r,s,o,t._x2,t._y2)}function DK(t,e){this._context=t,this._alpha=e}DK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:w6(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const CK=function t(e){function n(i){return e?new DK(i,e):new y6(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function NK(t,e){this._context=t,this._alpha=e}NK.prototype={areaStart:Bl,areaEnd:Bl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:w6(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const OK=function t(e){function n(i){return e?new NK(i,e):new b6(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function RK(t,e){this._context=t,this._alpha=e}RK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:w6(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const LK=function t(e){function n(i){return e?new RK(i,e):new v6(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function BK(t){this._context=t}BK.prototype={areaStart:Bl,areaEnd:Bl,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function PK(t){return new BK(t)}function EB(t){return t<0?-1:1}function AB(t,e,n){var i=t._x1-t._x0,r=e-t._x1,s=(t._y1-t._y0)/(i||r<0&&-0),o=(n-t._y1)/(r||i<0&&-0),a=(s*r+o*i)/(i+r);return(EB(s)+EB(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function $B(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function PI(t,e,n){var i=t._x0,r=t._y0,s=t._x1,o=t._y1,a=(s-i)/3;t._context.bezierCurveTo(i+a,r+a*e,s-a,o-a*n,s,o)}function $x(t){this._context=t}$x.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:PI(this,this._t0,$B(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,PI(this,$B(this,n=AB(this,t,e)),n);break;default:PI(this,this._t0,n=AB(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function zK(t){this._context=new UK(t)}(zK.prototype=Object.create($x.prototype)).point=function(t,e){$x.prototype.point.call(this,e,t)};function UK(t){this._context=t}UK.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,s){this._context.bezierCurveTo(e,t,i,n,s,r)}};function jK(t){return new $x(t)}function qK(t){return new zK(t)}function VK(t){this._context=t}VK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var i=IB(t),r=IB(e),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(i[0][s],r[0][s],i[1][s],r[1][s],t[o],e[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function IB(t){var e,n=t.length-1,i,r=new Array(n),s=new Array(n),o=new Array(n);for(r[0]=0,s[0]=2,o[0]=t[0]+2*t[1],e=1;e<n-1;++e)r[e]=1,s[e]=4,o[e]=4*t[e]+2*t[e+1];for(r[n-1]=2,s[n-1]=7,o[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)i=r[e]/s[e-1],s[e]-=i,o[e]-=i*o[e-1];for(r[n-1]=o[n-1]/s[n-1],e=n-2;e>=0;--e)r[e]=(o[e]-r[e+1])/s[e];for(s[n-1]=(t[n]+r[n-1])/2,e=0;e<n-1;++e)s[e]=2*t[e+1]-r[e+1];return[r,s]}function WK(t){return new VK(t)}function AE(t,e){this._context=t,this._t=e}AE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function GK(t){return new AE(t,.5)}function YK(t){return new AE(t,0)}function HK(t){return new AE(t,1)}function uy(t,e,n){this.k=t,this.x=e,this.y=n}uy.prototype={constructor:uy,scale:function(t){return t===1?this:new uy(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new uy(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};uy.prototype;function tr(t){return t!=null&&!Number.isNaN(t)}function js(t,e){return+tr(e)-+tr(t)||Ze(t,e)}function Ix(t,e){return+tr(e)-+tr(t)||Pd(t,e)}function _6(t){return t!=null&&`${t}`!=""}function Mx(t){return isFinite(t)?t:NaN}function Ku(t){return t>0&&isFinite(t)?t:NaN}function $E(t){return t<0&&isFinite(t)?t:NaN}function XK(t,e){if(t instanceof Date||(t=new Date(+t)),isNaN(t))return typeof e=="function"?e(t):e;const n=t.getUTCHours(),i=t.getUTCMinutes(),r=t.getUTCSeconds(),s=t.getUTCMilliseconds();return`${QSt(t.getUTCFullYear())}-${Ru(t.getUTCMonth()+1,2)}-${Ru(t.getUTCDate(),2)}${n||i||r||s?`T${Ru(n,2)}:${Ru(i,2)}${r||s?`:${Ru(r,2)}${s?`.${Ru(s,3)}`:""}`:""}Z`:""}`}function QSt(t){return t<0?`-${Ru(-t,6)}`:t>9999?`+${Ru(t,6)}`:Ru(t,4)}function Ru(t,e){return`${t}`.padStart(e,"0")}const ZSt=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function KK(t,e){return ZSt.test(t+="")?new Date(t):typeof e=="function"?e(t):e}function Og(t){if(t==null)return;const e=t[0],n=t[t.length-1];return Pd(e,n)}const Op=1e3,nl=Op*60,il=nl*60,Pa=il*24,ia=Pa*7,Id=Pa*30,Bc=Pa*365,zI=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",Op],["5 seconds",5*Op],["15 seconds",15*Op],["30 seconds",30*Op],["minute",nl],["5 minutes",5*nl],["15 minutes",15*nl],["30 minutes",30*nl],["hour",il],["3 hours",3*il],["6 hours",6*il],["12 hours",12*il],["day",Pa],["2 days",2*Pa],["week",ia],["2 weeks",2*ia],["month",Id],["3 months",3*Id],["6 months",6*Id],["year",Bc],["2 years",2*Bc],["5 years",5*Bc],["10 years",10*Bc],["20 years",20*Bc],["50 years",50*Bc],["100 years",100*Bc]],x6=new Map([["second",Op],["minute",nl],["hour",il],["day",Pa],["monday",ia],["tuesday",ia],["wednesday",ia],["thursday",ia],["friday",ia],["saturday",ia],["sunday",ia],["week",ia],["month",Id],["year",Bc]]),JK=new Map([["second",Qr],["minute",Sm],["hour",Am],["day",wo],["monday",_1],["tuesday",TH],["wednesday",FH],["thursday",Hd],["friday",kH],["saturday",DH],["sunday",Ol],["week",Ol],["month",Kd],["year",zs]]),S6=new Map([["second",Qr],["minute",Em],["hour",$m],["day",yE],["monday",x1],["tuesday",CH],["wednesday",NH],["thursday",Xd],["friday",OH],["saturday",RH],["sunday",Rl],["week",Rl],["month",Jd],["year",Us]]),$b=Symbol("intervalDuration"),IE=Symbol("intervalType");for(const[t,e]of JK)e[$b]=x6.get(t),e[IE]="time";for(const[t,e]of S6)e[$b]=x6.get(t),e[IE]="utc";const cy=[["year",Us,"utc"],["month",Jd,"utc"],["day",yE,"utc",6*Id],["hour",$m,"utc",3*Pa],["minute",Em,"utc",6*il],["second",Qr,"utc",30*nl]],o2=[["year",zs,"time"],["month",Kd,"time"],["day",wo,"time",6*Id],["hour",Am,"time",3*Pa],["minute",Sm,"time",6*il],["second",Qr,"time",30*nl]],tEt=[cy[0],o2[0],cy[1],o2[1],cy[2],o2[2],...cy.slice(3)];function E6(t){let e=`${t}`.toLowerCase();e.endsWith("s")&&(e=e.slice(0,-1));let n=1;const i=/^(?:(\d+)\s+)/.exec(e);switch(i&&(e=e.slice(i[0].length),n=+i[1]),e){case"quarter":e="month",n*=3;break;case"half":e="month",n*=6;break}let r=S6.get(e);if(!r)throw new Error(`unknown interval: ${t}`);if(n>1&&!r.every)throw new Error(`non-periodic interval: ${e}`);return[e,n]}function QK(t){return ZK(E6(t),"time")}function A6(t){return ZK(E6(t),"utc")}function ZK([t,e],n){let i=(n==="time"?JK:S6).get(t);return e>1&&(i=i.every(e),i[$b]=x6.get(t)*e,i[IE]=n),i}function MB(t,e){if(!(e>1))return;const n=t[$b];if(!zI.some(([,r])=>r===n)||n%Pa===0&&Pa<n&&n<Id)return;const[i]=zI[bh(([,r])=>Math.log(r)).center(zI,Math.log(n*e))];return(t[IE]==="time"?QK:A6)(i)}function TB(t,e,n){const i=e==="time"?bE:Im;if(n==null)return i(t==="year"?"%Y":t==="month"?"%Y-%m":t==="day"?"%Y-%m-%d":t==="hour"||t==="minute"?"%Y-%m-%dT%H:%M":t==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");const r=eEt(n);switch(t){case"millisecond":return Kh(i(".%L"),i(":%M:%S"),r);case"second":return Kh(i(":%S"),i("%-I:%M"),r);case"minute":return Kh(i("%-I:%M"),i("%p"),r);case"hour":return Kh(i("%-I %p"),i("%b %-d"),r);case"day":return Kh(i("%-d"),i("%b"),r);case"month":return Kh(i("%b"),i("%Y"),r);case"year":return i("%Y")}throw new Error("unable to format time ticks")}function eEt(t){return t==="left"||t==="right"?(e,n)=>`
${e}
${n}`:t==="top"?(e,n)=>`${n}
${e}`:(e,n)=>`${e}
${n}`}function nEt(t){return t==="time"?o2:t==="utc"?cy:tEt}function iEt(t,e,n){const i=tn(N0t(e,(r,s)=>Math.abs(s-r)));if(i<1e3)return TB("millisecond","utc",n);for(const[r,s,o,a]of nEt(t)){if(i>a||r==="hour"&&!i)break;if(e.every(u=>s.floor(u)>=u))return TB(r,o,n)}}function Kh(t,e,n){return(i,r,s)=>{const o=t(i,r),a=e(i,r),u=r-Og(s);return r!==u&&s[u]!==void 0&&a===e(s[u],u)?o:n(o,a)}}const Rg=Object.getPrototypeOf(Uint8Array),rEt=Object.prototype.toString,tJ=Symbol("reindex");function ue(t,e,n){const i=typeof e;return i==="string"?FB(t,eJ(e),n):i==="function"?FB(t,e,n):i==="number"||e instanceof Date||i==="boolean"?He(t,as(e),n):typeof(e==null?void 0:e.transform)=="function"?kB(e.transform(t),n):sEt(kB(e,n),t==null?void 0:t[tJ])}function sEt(t,e){return e?FE(t,e):t}function FB(t,e,n){return He(t,(n==null?void 0:n.prototype)instanceof Rg?oEt(e):e,n)}function kB(t,e){return e===void 0?Rr(t):t instanceof e?t:e.prototype instanceof Rg&&!(t instanceof Rg)?e.from(t,M6):e.from(t)}function oEt(t){return(e,n)=>M6(t(e,n))}const Oy=[null],eJ=t=>e=>e[t],hr={transform:_c},Ot={transform:t=>t},$6=()=>1,aEt=()=>!0,Ii=t=>t==null?t:`${t}`,de=t=>t==null?t:+t,ME=t=>t?t[0]:void 0,S1=t=>t?t[1]:void 0,uEt=t=>t?t[2]:void 0,as=t=>()=>t;function I6(t){const e=+`${t}`.slice(1)/100;return(n,i)=>Ra(n,e,i)}function $r(t){return t instanceof Rg?t:He(t,M6,Float64Array)}function M6(t){return t==null?NaN:Number(t)}function cEt(t){return He(t,nJ)}function nJ(t){return t instanceof Date&&!isNaN(t)?t:typeof t=="string"?KK(t):t==null||isNaN(t=+t)?void 0:new Date(t)}function ar(t,e){return t===void 0&&(t=e),t===null?[void 0,"none"]:Ib(t)?[void 0,t]:[t,void 0]}function In(t,e){return t===void 0&&(t=e),t===null||typeof t=="number"?[void 0,t]:[t,void 0]}function iJ(t,e,n){if(t!=null)return hs(t,e,n)}function hs(t,e,n){const i=`${t}`.toLowerCase();if(!n.includes(i))throw new Error(`invalid ${e}: ${t}`);return i}function Rr(t){return t==null||t instanceof Array||t instanceof Rg?t:Array.from(t)}function He(t,e,n=Array){return t==null?t:t instanceof n?t.map(e):n.from(t,e)}function E1(t,e=Array){return t instanceof e?t.slice():e.from(t)}function rJ({x:t,x1:e,x2:n}){return t!==void 0||e!==void 0||n!==void 0}function sJ({y:t,y1:e,y2:n}){return t!==void 0||e!==void 0||n!==void 0}function TE(t){return rJ(t)||sJ(t)||t.interval!==void 0}function Ks(t){return(t==null?void 0:t.toString)===rEt}function Md(t){return Ks(t)&&(t.type!==void 0||t.domain!==void 0)}function aa(t){return Ks(t)&&typeof t.transform!="function"}function Pl(t){return aa(t)&&t.value===void 0&&t.channel===void 0}function oJ(t,e,n,i=Ot){return e===void 0&&n===void 0?(e=0,n=t===void 0?i:t):e===void 0?e=t===void 0?0:t:n===void 0&&(n=t===void 0?0:t),[e,n]}function Lo(t,e){return t===void 0&&e===void 0?[ME,S1]:[t,e]}function ff({z:t,fill:e,stroke:n}={}){return t===void 0&&([t]=ar(e)),t===void 0&&([t]=ar(n)),t}function _c(t){const e=t.length,n=new Uint32Array(e);for(let i=0;i<e;++i)n[i]=i;return n}function FE(t,e){return He(e,n=>t[n],t.constructor)}function T6(t){return t.length===1?(e,n)=>t(FE(n,e)):t}function Td(t,e,n){return t.subarray?t.subarray(e,n):t.slice(e,n)}function wd(t){return t!==null&&typeof t=="object"?t.valueOf():t}function aJ(t,e){if(e[t]!==void 0)return e[t];switch(t){case"x1":case"x2":t="x";break;case"y1":case"y2":t="y";break}return e[t]}function Zr(t){let e;return[{transform:()=>e,label:Ka(t)},n=>e=n]}function br(t){return t==null?[t]:Zr(t)}function Ka(t,e){return typeof t=="string"?t:t&&t.label!==void 0?t.label:e}function Tx(t,e){return{transform(n){const i=t.transform(n),r=e.transform(n);return ur(i)||ur(r)?He(i,(s,o)=>new Date((+i[o]+ +r[o])/2)):He(i,(s,o)=>(+i[o]+ +r[o])/2,Float64Array)},label:t.label}}function Fx(t,e){const n=uJ(e==null?void 0:e.interval,e==null?void 0:e.type);return n?He(t,n):t}function uJ(t,e){const n=kE(t,e);return n&&(i=>tr(i)?n.floor(i):i)}function kE(t,e){if(t!=null){if(typeof t=="number"){0<t&&t<1&&Number.isInteger(1/t)&&(t=-1/t);const n=Math.abs(t);return t<0?{floor:i=>Math.floor(i*n)/n,offset:i=>(i*n+1)/n,range:(i,r)=>Un(Math.ceil(i*n),r*n).map(s=>s/n)}:{floor:i=>Math.floor(i/n)*n,offset:i=>i+n,range:(i,r)=>Un(Math.ceil(i/n),r/n).map(s=>s*n)}}if(typeof t=="string")return(e==="time"?QK:A6)(t);if(typeof t.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof t.offset!="function")throw new Error("invalid interval; missing offset method");return t}}function Tm(t,e){if(t=kE(t,e),t&&typeof t.range!="function")throw new Error("invalid interval: missing range method");return t}function lEt(t,e){if(t=Tm(t,e),t&&typeof t.ceil!="function")throw new Error("invalid interval: missing ceil method");return t}function fEt(t){return Rp(t)&&typeof(t==null?void 0:t.floor)=="function"&&t.floor()instanceof Date}function Rp(t){return typeof(t==null?void 0:t.range)=="function"}function Fm(t){return t===void 0||aa(t)?t:{value:t}}function dEt(t){return t==null?null:{transform:e=>ue(e,t,Float64Array),label:Ka(t)}}function hEt(t){if(!xc(t))return!1;for(const e of t)if(e!=null)return typeof e=="object"&&"0"in e&&"1"in e}function xc(t){return t&&typeof t[Symbol.iterator]=="function"}function cJ(t){for(const e of t)if(e!=null)return typeof e!="object"||e instanceof Date}function mn(t){for(const e of t){if(e==null)continue;const n=typeof e;return n==="string"||n==="boolean"}}function ur(t){for(const e of t)if(e!=null)return e instanceof Date}function pEt(t){for(const e of t)if(e!=null)return typeof e=="string"&&isNaN(e)&&KK(e)}function gEt(t){for(const e of t)if(e!=null){if(typeof e!="string")return!1;if(e.trim())return!isNaN(e)}}function Lp(t){for(const e of t)if(e!=null)return typeof e=="number"}function UI(t,e){let n;for(const i of t)if(i!=null){if(!e(i))return!1;n=!0}return n}const mEt=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function Ib(t){return typeof t!="string"?!1:(t=t.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(t)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(t)||mEt.has(t))}function yEt(t){return typeof t=="number"&&(0<=t&&t<=1||isNaN(t))}function sn(t){return t==null||Lg(t)}function Lg(t){return/^\s*none\s*$/i.test(t)}function bEt(t){return/^\s*round\s*$/i.test(t)}function FT(t,e){return iJ(t,e,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function Mb(t="middle"){return FT(t,"frameAnchor")}function vEt(t={},...e){let n=t;for(const i of e)for(const r in i)if(n[r]===void 0){const s=i[r];n===t?n={...n,[r]:s}:n[r]=s}return n}function wEt(t){console.warn("named iterables are deprecated; please use an object instead");const e=new Set;return Object.fromEntries(Array.from(t,n=>{const{name:i}=n;if(i==null)throw new Error("missing name");const r=`${i}`;if(r==="__proto__")throw new Error(`illegal name: ${r}`);if(e.has(r))throw new Error(`duplicate name: ${r}`);return e.add(r),[i,n]}))}function F6(t){return xc(t)?wEt(t):t}function lJ(t){return t===!0?t="frame":t===!1?t=null:t!=null&&(t=hs(t,"clip",["frame","sphere"])),t}const xa=Symbol("position"),Sc=Symbol("color"),Tb=Symbol("radius"),Fb=Symbol("length"),kb=Symbol("opacity"),DE=Symbol("symbol"),fJ=Symbol("projection"),gn=new Map([["x",xa],["y",xa],["fx",xa],["fy",xa],["r",Tb],["color",Sc],["opacity",kb],["symbol",DE],["length",Fb],["projection",fJ]]);function _Et(t){return t===xa||t===fJ}function xEt(t){return t===xa||t===Tb||t===Fb||t===kb}const dJ=Math.sqrt(3),hJ=2/dJ,SEt={draw(t,e){const n=Math.sqrt(e/Math.PI),i=n*hJ,r=i/2;t.moveTo(0,i),t.lineTo(n,r),t.lineTo(n,-r),t.lineTo(0,-i),t.lineTo(-n,-r),t.lineTo(-n,r),t.closePath()}},k6=new Map([["asterisk",uK],["circle",Ng],["cross",cK],["diamond",fK],["diamond2",dK],["hexagon",SEt],["plus",hK],["square",pK],["square2",gK],["star",yK],["times",_K],["triangle",bK],["triangle2",vK],["wye",wK]]);function D6(t){return t&&typeof t.draw=="function"}function EEt(t){return D6(t)?!0:typeof t!="string"?!1:k6.has(t.toLowerCase())}function C6(t){if(t==null||D6(t))return t;const e=k6.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid symbol: ${t}`)}function AEt(t){if(t==null||D6(t))return[void 0,t];if(typeof t=="string"){const e=k6.get(`${t}`.toLowerCase());if(e)return[void 0,e]}return[t,void 0]}function Ja({filter:t,sort:e,reverse:n,transform:i,initializer:r,...s}={},o){if(i===void 0&&(t!=null&&(i=N6(t)),e!=null&&!Pl(e)&&(i=jI(i,R6(e))),n&&(i=jI(i,O6))),o!=null&&r!=null)throw new Error("transforms cannot be applied after initializers");return{...s,...(e===null||Pl(e))&&{sort:e},transform:jI(i,o)}}function Lr({filter:t,sort:e,reverse:n,initializer:i,...r}={},s){return i===void 0&&(t!=null&&(i=N6(t)),e!=null&&!Pl(e)&&(i=qI(i,R6(e))),n&&(i=qI(i,O6))),{...r,...(e===null||Pl(e))&&{sort:e},initializer:qI(i,s)}}function jI(t,e){return t==null?e===null?void 0:e:e==null?t===null?void 0:t:function(n,i,r){return{data:n,facets:i}=t.call(this,n,i,r),e.call(this,Rr(n),i,r)}}function qI(t,e){return t==null?e===null?void 0:e:e==null?t===null?void 0:t:function(n,i,r,...s){let o,a,u,c,l,f;return{data:a=n,facets:u=i,channels:o}=t.call(this,n,i,r,...s),{data:l=a,facets:f=u,channels:c}=e.call(this,a,u,{...r,...o},...s),{data:l,facets:f,channels:{...o,...c}}}}function CE(t,e){return(t.initializer!=null?Lr:Ja)(t,e)}function $Et(t,e){return CE(e,N6(t))}function N6(t){return(e,n)=>{const i=ue(e,t);return{data:e,facets:n.map(r=>r.filter(s=>i[s]))}}}function IEt({sort:t,...e}={}){return{...CE(e,O6),sort:Pl(t)?t:null}}function O6(t,e){return{data:t,facets:e.map(n=>n.slice().reverse())}}function MEt({seed:t,sort:e,...n}={}){return{...CE(n,gJ(t==null?Math.random:t6(t))),sort:Pl(e)?e:null}}function pJ(t,{sort:e,...n}={}){return{...(aa(t)&&t.channel!==void 0?Lr:CE)(n,R6(t)),sort:Pl(e)?e:null}}function R6(t){return(typeof t=="function"&&t.length!==1?TEt:gJ)(t)}function TEt(t){return(e,n)=>{const i=(r,s)=>t(e[r],e[s]);return{data:e,facets:n.map(r=>r.slice().sort(i))}}}function gJ(t){let e,n;({channel:e,value:t,order:n}={...Fm(t)});const i=e==null?void 0:e.startsWith("-");if(i&&(e=e.slice(1)),n===void 0&&(n=i?Ix:js),typeof n!="function")switch(`${n}`.toLowerCase()){case"ascending":n=js;break;case"descending":n=Ix;break;default:throw new Error(`invalid order: ${n}`)}return(r,s,o)=>{let a;if(e===void 0)a=ue(r,t);else{if(o===void 0)throw new Error("channel sort requires an initializer");if(a=o[e],!a)return{};a=a.value}const u=(c,l)=>n(a[c],a[l]);return{data:r,facets:s.map(c=>c.slice().sort(u))}}}function L6(t,e){return NE(null,null,t,e)}function A1(t={y:"count"},e={}){const{x:n=Ot}=e;if(n==null)throw new Error("missing channel: x");return NE(n,null,t,e)}function $1(t={x:"count"},e={}){const{y:n=Ot}=e;if(n==null)throw new Error("missing channel: y");return NE(null,n,t,e)}function B6(t={fill:"count"},e={}){let{x:n,y:i}=e;if([n,i]=Lo(n,i),n==null)throw new Error("missing channel: x");if(i==null)throw new Error("missing channel: y");return NE(n,i,t,e)}function NE(t,e,{data:n=j6,filter:i,sort:r,reverse:s,...o}={},a={}){o=yJ(o,a),n=wJ(n,Ot),r=r==null?void 0:bJ("sort",r,a),i=i==null?void 0:vJ("filter",i,a);const[u,c]=br(t),[l,f]=br(e),{z:d,fill:h,stroke:p,x1:g,x2:m,y1:y,y2:b,...v}=a,[w,_]=br(d),[S]=ar(h),[x]=ar(p),[E,A]=br(S),[$,I]=br(x);return{..."z"in a&&{z:w||d},..."fill"in a&&{fill:E||h},..."stroke"in a&&{stroke:$||p},...Ja(v,(k,T,M)=>{const F=Fx(ue(k,t),M==null?void 0:M.x),D=Fx(ue(k,e),M==null?void 0:M.y),N=ue(k,d),R=ue(k,S),L=ue(k,x),B=U6(o,{z:N,fill:R,stroke:L}),P=[],U=[],H=F&&c([]),nt=D&&f([]),ft=N&&_([]),dt=R&&A([]),et=L&&I([]);let ct=0;for(const G of o)G.initialize(k);r&&r.initialize(k),i&&i.initialize(k);for(const G of T){const st=[];for(const lt of o)lt.scope("facet",G);r&&r.scope("facet",G),i&&i.scope("facet",G);for(const[lt,V]of og(G,B))for(const[Vt,mt]of og(V,D))for(const[ee,oe]of og(mt,F)){const ht={data:k};if(F&&(ht.x=ee),D&&(ht.y=Vt),B&&(ht.z=lt),!(i&&!i.reduce(oe,ht))){st.push(ct++),U.push(n.reduceIndex(oe,k,ht)),F&&H.push(ee),D&&nt.push(Vt),N&&ft.push(B===N?lt:N[oe[0]]),R&&dt.push(B===R?lt:R[oe[0]]),L&&et.push(B===L?lt:L[oe[0]]);for(const $e of o)$e.reduce(oe,ht);r&&r.reduce(oe,ht)}}P.push(st)}return _J(P,r,s),{data:U,facets:P}}),...!rl(o,"x")&&(u?{x:u}:{x1:g,x2:m}),...!rl(o,"y")&&(l?{y:l}:{y1:y,y2:b}),...Object.fromEntries(o.map(({name:k,output:T})=>[k,T]))}}function rl(t,...e){for(const{name:n}of t)if(e.includes(n))return!0;return!1}function mJ(t,e,n=P6){const i=Object.entries(t);return e.title!=null&&t.title===void 0&&i.push(["title",OEt]),e.href!=null&&t.href===void 0&&i.push(["href",q6]),i.filter(([,r])=>r!==void 0).map(([r,s])=>s===null?FEt(r):n(r,s,e))}function P6(t,e,n,i=z6){let r;Ks(e)&&"reduce"in e&&(r=e.scale,e=e.reduce);const s=i(t,e,n),[o,a]=Zr(s.label);let u;return{name:t,output:r===void 0?o:{value:o,scale:r},initialize(c){s.initialize(c),u=a([])},scope(c,l){s.scope(c,l)},reduce(c,l){u.push(s.reduce(c,l))}}}function FEt(t){return{name:t,initialize(){},scope(){},reduce(){}}}function z6(t,e,n,i=OE){const r=aJ(t,n),s=i(e,r);let o,a;return{label:Ka(s===kx?null:r,s.label),initialize(u){o=r===void 0?u:ue(u,r),s.scope==="data"&&(a=s.reduceIndex(_c(u),o))},scope(u,c){s.scope===u&&(a=s.reduceIndex(c,o))},reduce(u,c){return s.scope==null?s.reduceIndex(u,o,c):s.reduceIndex(u,o,a,c)}}}function og(t,e){return e?bc(t,n=>e[n]):[[,t]]}function OE(t,e,n=kEt){if(t==null)return n(t);if(typeof t.reduceIndex=="function")return t;if(typeof t.reduce=="function"&&Ks(t))return CEt(t);if(typeof t=="function")return NEt(t);if(/^p\d{2}$/i.test(t))return Au(I6(t));switch(`${t}`.toLowerCase()){case"first":return q6;case"last":return REt;case"identity":return j6;case"count":return kx;case"distinct":return LEt;case"sum":return e==null?kx:BEt;case"proportion":return CB(e,"data");case"proportion-facet":return CB(e,"facet");case"deviation":return Au(bm);case"min":return Au(yi);case"min-index":return Au(k0t);case"max":return Au(tn);case"max-index":return Au(F0t);case"mean":return DB(pb);case"median":return DB(Ud);case"variance":return Au(SD);case"mode":return Au(dG)}return n(t)}function kEt(t){throw new Error(`invalid reduce: ${t}`)}function yJ(t,e){return mJ(t,e,bJ)}function bJ(t,e,n){return P6(t,e,n,vJ)}function vJ(t,e,n){return z6(t,e,n,wJ)}function wJ(t,e){return OE(t,e,DEt)}function DEt(t){switch(`${t}`.toLowerCase()){case"x":return PEt;case"y":return zEt;case"z":return xJ}throw new Error(`invalid group reduce: ${t}`)}function U6(t,e){for(const n in e){const i=e[n];if(i!==void 0&&!t.some(r=>r.name===n))return i}}function _J(t,e,n){if(e){const i=e.output.transform(),r=(s,o)=>js(i[s],i[o]);t.forEach(s=>s.sort(r))}n&&t.forEach(i=>i.reverse())}function CEt(t){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...t,reduceIndex:t.reduce.bind(t)}}function NEt(t){return{reduceIndex(e,n,i){return t(FE(n,e),i)}}}function Au(t){return{reduceIndex(e,n){return t(e,i=>n[i])}}}function DB(t){return{reduceIndex(e,n){const i=t(e,r=>n[r]);return ur(n)?new Date(i):i}}}const j6={reduceIndex(t,e){return FE(e,t)}},q6={reduceIndex(t,e){return e[t[0]]}},OEt={reduceIndex(t,e){const i=O_(eg(t,s=>s.length,s=>e[s]),S1),r=i.slice(-5).reverse();if(r.length<i.length){const s=i.slice(0,-4);r[4]=[`… ${s.length.toLocaleString("en-US")} more`,Ls(s,S1)]}return r.map(([s,o])=>`${s} (${o.toLocaleString("en-US")})`).join(`
`)}},REt={reduceIndex(t,e){return e[t[t.length-1]]}},kx={label:"Frequency",reduceIndex(t){return t.length}},LEt={label:"Distinct",reduceIndex(t,e){const n=new oc;for(const i of t)n.add(e[i]);return n.size}},BEt=Au(Ls);function CB(t,e){return t==null?{scope:e,label:"Frequency",reduceIndex:(n,i,r=1)=>n.length/r}:{scope:e,reduceIndex:(n,i,r=1)=>Ls(n,s=>i[s])/r}}const PEt={reduceIndex(t,e,{x:n}){return n}},zEt={reduceIndex(t,e,{y:n}){return n}},xJ={reduceIndex(t,e,{z:n}){return n}};function UEt(t){if(typeof t!="function")throw new Error(`invalid test function: ${t}`);return{reduceIndex(e,n,{data:i}){return n[e.find(r=>t(i[r],r,i))]}}}function I1(t,{scale:e,type:n,value:i,filter:r,hint:s,label:o=Ka(i)},a){return s===void 0&&typeof(i==null?void 0:i.transform)=="function"&&(s=i.hint),EJ(a,{scale:e,type:n,value:ue(t,i),label:o,filter:r,hint:s})}function SJ(t,e){return Object.fromEntries(Object.entries(t).map(([n,i])=>[n,I1(e,i,n)]))}function V6(t,e){const n=Object.fromEntries(Object.entries(t).map(([i,{scale:r,value:s}])=>{const o=r==null?null:e[r];return[i,o==null?s:He(s,o)]}));return n.channels=t,n}function EJ(t,e){const{scale:n,value:i}=e;if(n===!0||n==="auto")switch(t){case"fill":case"stroke":case"color":e.scale=n!==!0&&UI(i,Ib)?null:"color";break;case"fillOpacity":case"strokeOpacity":case"opacity":e.scale=n!==!0&&UI(i,yEt)?null:"opacity";break;case"symbol":n!==!0&&UI(i,EEt)?(e.scale=null,e.value=He(i,C6)):e.scale="symbol";break;default:e.scale=gn.has(t)?t:null;break}else if(n===!1)e.scale=null;else if(n!=null&&!gn.has(n))throw new Error(`unknown scale: ${n}`);return e}function jEt(t,e,n,i,r){const{order:s,reverse:o,reduce:a=!0,limit:u}=r;for(const c in r){if(!gn.has(c))continue;let{value:l,order:f=s,reverse:d=o,reduce:h=a,limit:p=u}=Fm(r[c]);const g=l==null?void 0:l.startsWith("-");if(g&&(l=l.slice(1)),f=f===void 0?g!==(l==="width"||l==="height")?$J:AJ:WEt(f),h==null||h===!1)continue;const m=c==="fx"||c==="fy"?VEt(e,i[c]):qEt(n,c);if(!m)throw new Error(`missing channel for scale: ${c}`);const y=m.value,[b=0,v=1/0]=xc(p)?p:p<0?[p]:[0,p];if(l==null)m.domain=()=>{let w=Array.from(new oc(y));return d&&(w=w.reverse()),(b!==0||v!==1/0)&&(w=w.slice(b,v)),w};else{const w=l==="data"?t:l==="height"?NB(n,"y1","y2"):l==="width"?NB(n,"x1","x2"):kT(n,l,l==="y"?"y2":l==="x"?"x2":void 0),_=OE(h===!0?"max":h,w);m.domain=()=>{let S=$0t(_c(y),x=>_.reduceIndex(x,w),x=>y[x]);return f&&S.sort(f),d&&S.reverse(),(b!==0||v!==1/0)&&(S=S.slice(b,v)),S.map(ME)}}}}function qEt(t,e){for(const n in t){const i=t[n];if(i.scale===e)return i}}function VEt(t,e){const n=t.original;if(n===t)return e;const i=e.value,r=e.value=[];for(let s=0;s<n.length;++s){const o=i[n[s][0]];for(const a of t[s])r[a]=o}return e}function NB(t,e,n){const i=kT(t,e),r=kT(t,n);return He(r,(s,o)=>Math.abs(s-i[o]),Float64Array)}function kT(t,e,n){let i=t[e];if(!i&&n!==void 0&&(i=t[n]),i)return i.value;throw new Error(`missing channel: ${e}`)}function WEt(t){if(t==null||typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"ascending":return AJ;case"descending":return $J}throw new Error(`invalid order: ${t}`)}function AJ([t,e],[n,i]){return js(e,i)||js(t,n)}function $J([t,e],[n,i]){return Ix(e,i)||js(t,n)}function DT(t,e){let n=t[e];if(n){for(;n.source;)n=n.source;return n.source===null?null:n}}function RE(t={}){const{document:e=typeof window<"u"?window.document:void 0,clip:n}=t;return{document:e,clip:lJ(n)}}function ve(t,{document:e}){return fi(tE(t).call(e.documentElement))}let CT=0,NT;function GEt(){const t=CT;return CT=0,NT=void 0,t}function Ju(t){t!==NT&&(NT=t,console.warn(t),++CT)}const IJ=Math.PI,hu=2*IJ,OB=.618;function YEt({projection:t,inset:e=0,insetTop:n=e,insetRight:i=e,insetBottom:r=e,insetLeft:s=e}={},o){if(t==null)return;if(typeof t.stream=="function")return t;let a,u,c="frame";if(Ks(t)){let _;if({type:t,domain:u,inset:_,insetTop:n=_!==void 0?_:n,insetRight:i=_!==void 0?_:i,insetBottom:r=_!==void 0?_:r,insetLeft:s=_!==void 0?_:s,clip:c=c,...a}=t,t==null)return}typeof t!="function"&&({type:t}=MJ(t));const{width:l,height:f,marginLeft:d,marginRight:h,marginTop:p,marginBottom:g}=o,m=l-d-h-s-i,y=f-p-g-n-r;if(t=t==null?void 0:t({width:m,height:y,clip:c,...a}),t==null)return;c=HEt(c,d,p,l-h,f-g);let b=d+s,v=p+n,w;if(u!=null){const[[_,S],[x,E]]=Ha(t).bounds(u),A=Math.min(m/(x-_),y/(E-S));A>0?(b-=(A*(_+x)-m)/2,v-=(A*(S+E)-y)/2,w=mx({point($,I){this.stream.point($*A+b,I*A+v)}})):Ju("Warning: the projection could not be fit to the specified domain; using the default scale.")}return w??(w=b===0&&v===0?TJ():mx({point(_,S){this.stream.point(_+b,S+v)}})),{stream:_=>t.stream(w.stream(c(_)))}}function MJ(t){switch(`${t}`.toLowerCase()){case"albers-usa":return eo(HY,.7463,.4673);case"albers":return Yv(JD,.7463,.4673);case"azimuthal-equal-area":return eo(JY,4,4);case"azimuthal-equidistant":return eo(ZY,hu,hu);case"conic-conformal":return Yv(nH,hu,hu);case"conic-equal-area":return Yv(v1,6.1702,2.9781);case"conic-equidistant":return Yv(rH,7.312,3.6282);case"equal-earth":return eo(oH,5.4133,2.6347);case"equirectangular":return eo(iH,hu,IJ);case"gnomonic":return eo(uH,3.4641,3.4641);case"identity":return{type:TJ};case"reflect-y":return{type:XEt};case"mercator":return eo(tH,hu,hu);case"orthographic":return eo(fH,2,2);case"stereographic":return eo(hH,2,2);case"transverse-mercator":return eo(gH,hu,hu);default:throw new Error(`unknown projection type: ${t}`)}}function HEt(t,e,n,i,r){if(t===!1||t==null||typeof t=="number")return s=>s;switch(t===!0&&(t="frame"),`${t}`.toLowerCase()){case"frame":return WD(e,n,i,r);default:throw new Error(`unknown projection clip type: ${t}`)}}function eo(t,e,n){return{type:({width:i,height:r,rotate:s,precision:o=.15,clip:a})=>{var c,l,f;const u=t();return o!=null&&((c=u.precision)==null||c.call(u,o)),s!=null&&((l=u.rotate)==null||l.call(u,s)),typeof a=="number"&&((f=u.clipAngle)==null||f.call(u,a)),u.scale(Math.min(i/e,r/n)),u.translate([i/2,r/2]),u},aspectRatio:n/e}}function Yv(t,e,n){const{type:i,aspectRatio:r}=eo(t,e,n);return{type:s=>{const{parallels:o,domain:a,width:u,height:c}=s,l=i(s);return o!=null&&(l.parallels(o),a===void 0&&l.fitSize([u,c],{type:"Sphere"})),l},aspectRatio:r}}const TJ=as({stream:t=>t}),XEt=as(mx({point(t,e){this.stream.point(t,-e)}}));function FJ(t,e,n,i){const r=n[t],s=n[e],o=r.length,a=n[t]=new Float64Array(o).fill(NaN),u=n[e]=new Float64Array(o).fill(NaN);let c;const l=i.stream({point(f,d){a[c]=f,u[c]=d}});for(c=0;c<o;++c)l.point(r[c],s[c])}function KEt({projection:t}={}){return t==null?!1:typeof t.stream=="function"?!0:(Ks(t)&&(t=t.type),t!=null)}function JEt(t){if(typeof(t==null?void 0:t.stream)=="function")return OB;if(Ks(t)&&(t=t.type),t!=null){if(typeof t!="function"){const{aspectRatio:e}=MJ(t);if(e)return e}return OB}}function LE(t,e,{projection:n}){const{x:i,y:r}=t;let s={};return i&&(s.x=i),r&&(s.y=r),s=V6(s,e),n&&(i==null?void 0:i.scale)==="x"&&(r==null?void 0:r.scale)==="y"&&FJ("x","y",s,n),i&&(s.x=$r(s.x)),r&&(s.y=$r(s.y)),s}function QEt(t){const e=[],n=[],i={scale:"x",value:e},r={scale:"y",value:n},s={point(o,a){e.push(o),n.push(a)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(const o of t.value)ya(o,s);return[i,r]}const kJ=new Map([["accent",vSt],["category10",bSt],["dark2",wSt],["observable10",_St],["paired",xSt],["pastel1",SSt],["pastel2",ESt],["set1",ASt],["set2",$St],["set3",ISt],["tableau10",MSt]]);function ZEt(t){return t!=null&&kJ.has(`${t}`.toLowerCase())}const RB=new Map([...kJ,["brbg",pu(KH,JH)],["prgn",pu(QH,ZH)],["piyg",pu(tX,eX)],["puor",pu(nX,iX)],["rdbu",pu(IT,_x)],["rdgy",pu(rX,sX)],["rdylbu",pu(MT,xx)],["rdylgn",pu(oX,aX)],["spectral",pu(uX,cX)],["burd",LB(IT,_x)],["buylrd",LB(MT,xx)],["blues",Hn(NX,OX)],["greens",Hn(RX,LX)],["greys",Hn(BX,PX)],["oranges",Hn(VX,WX)],["purples",Hn(zX,UX)],["reds",Hn(jX,qX)],["turbo",gu(QX)],["viridis",gu(ZX)],["magma",gu(tK)],["inferno",gu(eK)],["plasma",gu(nK)],["cividis",gu(GX)],["cubehelix",gu(YX)],["warm",gu(HX)],["cool",gu(XX)],["bugn",Hn(lX,fX)],["bupu",Hn(dX,hX)],["gnbu",Hn(pX,gX)],["orrd",Hn(mX,yX)],["pubu",Hn(wX,_X)],["pubugn",Hn(bX,vX)],["purd",Hn(xX,SX)],["rdpu",Hn(EX,AX)],["ylgn",Hn(MX,TX)],["ylgnbu",Hn($X,IX)],["ylorbr",Hn(FX,kX)],["ylorrd",Hn(DX,CX)],["rainbow",BB(KX)],["sinebow",BB(JX)]]);function Hn(t,e){return({length:n})=>n===1?[t[3][1]]:n===2?[t[3][1],t[3][2]]:(n=Math.max(3,Math.floor(n)),n>9?Bs(e,n):t[n])}function pu(t,e){return({length:n})=>n===2?[t[3][0],t[3][2]]:(n=Math.max(3,Math.floor(n)),n>11?Bs(e,n):t[n])}function LB(t,e){return({length:n})=>n===2?[t[3][2],t[3][0]]:(n=Math.max(3,Math.floor(n)),n>11?Bs(i=>e(1-i),n):t[n].slice().reverse())}function gu(t){return({length:e})=>Bs(t,Math.max(2,Math.floor(e)))}function BB(t){return({length:e})=>Bs(t,Math.floor(e)+1).slice(0,-1)}function DJ(t){const e=`${t}`.toLowerCase();if(!RB.has(e))throw new Error(`unknown ordinal scheme: ${e}`);return RB.get(e)}function BE(t,e){const n=DJ(t),i=typeof n=="function"?n({length:e}):n;return i.length!==e?i.slice(0,e):i}function tAt(t,e="greys"){const n=new Set,[i,r]=BE(e,2);for(const s of t)if(s!=null)if(s===!0)n.add(r);else if(s===!1)n.add(i);else return;return[...n]}const PB=new Map([["brbg",JH],["prgn",ZH],["piyg",eX],["puor",iX],["rdbu",_x],["rdgy",sX],["rdylbu",xx],["rdylgn",aX],["spectral",cX],["burd",t=>_x(1-t)],["buylrd",t=>xx(1-t)],["blues",OX],["greens",LX],["greys",PX],["purples",UX],["reds",qX],["oranges",WX],["turbo",QX],["viridis",ZX],["magma",tK],["inferno",eK],["plasma",nK],["cividis",GX],["cubehelix",YX],["warm",HX],["cool",XX],["bugn",fX],["bupu",hX],["gnbu",gX],["orrd",yX],["pubugn",vX],["pubu",_X],["purd",SX],["rdpu",AX],["ylgnbu",IX],["ylgn",TX],["ylorbr",kX],["ylorrd",CX],["rainbow",KX],["sinebow",JX]]);function W6(t){const e=`${t}`.toLowerCase();if(!PB.has(e))throw new Error(`unknown quantitative scheme: ${e}`);return PB.get(e)}const eAt=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function nAt(t){return t!=null&&eAt.has(`${t}`.toLowerCase())}const CJ=t=>e=>t(1-e),VI=[0,1],zB=new Map([["number",ci],["rgb",Nl],["hsl",JG],["hcl",tY],["lab",QG]]);function NJ(t){const e=`${t}`.toLowerCase();if(!zB.has(e))throw new Error(`unknown interpolator: ${e}`);return zB.get(e)}function Db(t,e,n,{type:i,nice:r,clamp:s,zero:o,domain:a=RJ(t,n),unknown:u,round:c,scheme:l,interval:f,range:d=gn.get(t)===Tb?hAt(n,a):gn.get(t)===Fb?pAt(n,a):gn.get(t)===kb?VI:void 0,interpolate:h=gn.get(t)===Sc?l==null&&d!==void 0?Nl:W6(l!==void 0?l:i==="cyclical"?"rainbow":"turbo"):c?wm:ci,reverse:p}){if(f=Tm(f,i),(i==="cyclical"||i==="sequential")&&(i="linear"),typeof h!="function"&&(h=NJ(h)),p=!!p,d!==void 0){const g=(a=Rr(a)).length,m=(d=Rr(d)).length;if(g!==m){if(h.length===1)throw new Error("invalid piecewise interpolator");h=_m(h,d),d=void 0}}if(h.length===1?(p&&(h=CJ(h),p=!1),d===void 0&&(d=Float64Array.from(a,(g,m)=>m/(a.length-1)),d.length===2&&(d=VI)),e.interpolate((d===VI?as:Y6)(h))):e.interpolate(h),o){const[g,m]=zn(a);(g>0||m<0)&&(a=E1(a),Og(a)!==Math.sign(g)?a[a.length-1]=0:a[0]=0)}return p&&(a=L_(a)),e.domain(a).unknown(u),r&&(e.nice(iAt(r,i)),a=e.domain()),d!==void 0&&e.range(d),s&&e.clamp(s),{type:i,domain:a,range:d,scale:e,interpolate:h,interval:f}}function iAt(t,e){return t===!0?void 0:typeof t=="number"?t:lEt(t,e)}function rAt(t,e,n){return Db(t,gE(),e,n)}function sAt(t,e,n){return OJ(t,e,{...n,exponent:.5})}function OJ(t,e,{exponent:n=1,...i}){return Db(t,mE().exponent(n),e,{...i,type:"pow"})}function oAt(t,e,{base:n=10,domain:i=gAt(e),...r}){return Db(t,i6().base(n),e,{...r,domain:i})}function aAt(t,e,{constant:n=1,...i}){return Db(t,s6().constant(n),e,i)}function uAt(t,e,{range:n,quantiles:i=n===void 0?5:(n=[...n]).length,n:r=i,scheme:s="rdylbu",domain:o=mAt(e),unknown:a,interpolate:u,reverse:c}){return n===void 0&&(n=u!==void 0?Bs(u,r):gn.get(t)===Sc?BE(s,r):void 0),o.length>0&&(o=a6(o,n===void 0?{length:r}:n).quantiles()),G6(t,e,{domain:o,range:n,reverse:c,unknown:a})}function cAt(t,e,{range:n,n:i=n===void 0?5:(n=[...n]).length,scheme:r="rdylbu",domain:s=RJ(t,e),unknown:o,interpolate:a,reverse:u}){const[c,l]=zn(s);let f;return n===void 0?(f=kl(c,l,i),f[0]<=c&&f.splice(0,1),f[f.length-1]>=l&&f.pop(),i=f.length+1,n=a!==void 0?Bs(a,i):gn.get(t)===Sc?BE(r,i):void 0):(f=Bs(ci(c,l),i+1).slice(1,-1),c instanceof Date&&(f=f.map(d=>new Date(d)))),Og(Rr(s))<0&&f.reverse(),G6(t,e,{domain:f,range:n,reverse:u,unknown:o})}function G6(t,e,{domain:n=[0],unknown:i,scheme:r="rdylbu",interpolate:s,range:o=s!==void 0?Bs(s,n.length+1):gn.get(t)===Sc?BE(r,n.length+1):void 0,reverse:a}){n=Rr(n);const u=Og(n);if(!isNaN(u)&&!lAt(n,u))throw new Error(`the ${t} scale has a non-monotonic domain`);return a&&(o=L_(o)),{type:"threshold",scale:u6(u<0?L_(n):n,o===void 0?[]:o).unknown(i),domain:n,range:o}}function lAt(t,e){for(let n=1,i=t.length,r=t[0];n<i;++n){const s=Pd(r,r=t[n]);if(s!==0&&s!==e)return!1}return!0}function fAt(t){return{type:"identity",scale:xEt(gn.get(t))?e6():e=>e}}function M1(t,e=Mx){return t.length?[yi(t,({value:n})=>n===void 0?n:yi(n,e)),tn(t,({value:n})=>n===void 0?n:tn(n,e))]:[0,1]}function RJ(t,e){const n=gn.get(t);return(n===Tb||n===kb||n===Fb?dAt:M1)(e)}function dAt(t){return[0,t.length?tn(t,({value:e})=>e===void 0?e:tn(e,Mx)):1]}function hAt(t,e){const n=t.find(({radius:o})=>o!==void 0);if(n!==void 0)return[0,n.radius];const i=Ra(t,.5,({value:o})=>o===void 0?NaN:Ra(o,.25,Ku)),r=e.map(o=>3*Math.sqrt(o/i)),s=30/tn(r);return s<1?r.map(o=>o*s):r}function pAt(t,e){const n=Ud(t,({value:s})=>s===void 0?NaN:Ud(s,Math.abs)),i=e.map(s=>12*s/n),r=60/tn(i);return r<1?i.map(s=>s*r):i}function gAt(t){for(const{value:e}of t)if(e!==void 0)for(let n of e){if(n>0)return M1(t,Ku);if(n<0)return M1(t,$E)}return[1,10]}function mAt(t){const e=[];for(const{value:n}of t)if(n!==void 0)for(const i of n)e.push(i);return e}function Y6(t){return(e,n)=>i=>t(e+i*(n-e))}function PE(t,e,n,i,{type:r,nice:s,clamp:o,domain:a=M1(i),unknown:u,pivot:c=0,scheme:l,range:f,symmetric:d=!0,interpolate:h=gn.get(t)===Sc?l==null&&f!==void 0?Nl:W6(l!==void 0?l:"rdbu"):ci,reverse:p}){c=+c,a=Rr(a);let[g,m]=a;if(a.length>2&&Ju(`Warning: the diverging ${t} scale domain contains extra elements.`),Pd(g,m)<0&&([g,m]=[m,g],p=!p),g=Math.min(g,c),m=Math.max(m,c),typeof h!="function"&&(h=NJ(h)),f!==void 0&&(h=h.length===1?Y6(h)(...f):_m(h,f)),p&&(h=CJ(h)),d){const y=n.apply(c),b=y-n.apply(g),v=n.apply(m)-y;b<v?g=n.invert(y-v):b>v&&(m=n.invert(y+b))}return e.domain([g,c,m]).unknown(u).interpolator(h),o&&e.clamp(o),s&&e.nice(s),{type:r,domain:[g,m],pivot:c,interpolate:h,scale:e}}function yAt(t,e,n){return PE(t,h6(),_At,e,n)}function bAt(t,e,n){return LJ(t,e,{...n,exponent:.5})}function LJ(t,e,{exponent:n=1,...i}){return PE(t,_E().exponent(n=+n),EAt(n),e,{...i,type:"diverging-pow"})}function vAt(t,e,{base:n=10,pivot:i=1,domain:r=M1(e,i<0?$E:Ku),...s}){return PE(t,p6().base(n=+n),xAt,e,{domain:r,pivot:i,...s})}function wAt(t,e,{constant:n=1,...i}){return PE(t,g6().constant(n=+n),AAt(n),e,i)}const _At={apply(t){return t},invert(t){return t}},xAt={apply:Math.log,invert:Math.exp},SAt={apply(t){return Math.sign(t)*Math.sqrt(Math.abs(t))},invert(t){return Math.sign(t)*(t*t)}};function EAt(t){return t===.5?SAt:{apply(e){return Math.sign(e)*Math.pow(Math.abs(e),t)},invert(e){return Math.sign(e)*Math.pow(Math.abs(e),1/t)}}}function AAt(t){return{apply(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))},invert(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}}function BJ(t,e,n,i){return Db(t,e,n,i)}function $At(t,e,n){return BJ(t,GH(),e,n)}function IAt(t,e,n){return BJ(t,YH(),e,n)}const Cb=Symbol("ordinal");function PJ(t,e,n,{type:i,interval:r,domain:s,range:o,reverse:a,hint:u}){return r=Tm(r,i),s===void 0&&(s=UJ(n,r,t)),(i==="categorical"||i===Cb)&&(i="ordinal"),a&&(s=L_(s)),s=e.domain(s).domain(),o!==void 0&&(typeof o=="function"&&(o=o(s)),e.range(o)),{type:i,domain:s,range:o,scale:e,hint:u,interval:r}}function MAt(t,e,{type:n,interval:i,domain:r,range:s,scheme:o,unknown:a,...u}){i=Tm(i,n),r===void 0&&(r=UJ(e,i,t));let c;if(gn.get(t)===DE)c=kAt(e),s=s===void 0?DAt(c):He(s,C6);else if(gn.get(t)===Sc&&(s===void 0&&(n==="ordinal"||n===Cb)&&(s=tAt(r,o),s!==void 0&&(o=void 0)),o===void 0&&s===void 0&&(o=n==="ordinal"?"turbo":"observable10"),o!==void 0))if(s!==void 0){const l=W6(o),f=s[0],d=s[1]-s[0];s=({length:h})=>Bs(p=>l(f+d*p),h)}else s=DJ(o);if(a===wx)throw new Error(`implicit unknown on ${t} scale is not supported`);return PJ(t,xb().unknown(a),e,{...u,type:n,domain:r,range:s,hint:c})}function TAt(t,e,{align:n=.5,padding:i=.5,...r}){return zJ(Q_t().align(n).padding(i),e,r,t)}function FAt(t,e,{align:n=.5,padding:i=.1,paddingInner:r=i,paddingOuter:s=t==="fx"||t==="fy"?0:i,...o}){return zJ(hE().align(n).paddingInner(r).paddingOuter(s),e,o,t)}function zJ(t,e,n,i){let{round:r}=n;return r!==void 0&&t.round(r=!!r),t=PJ(i,t,e,n),t.round=r,t}function UJ(t,e,n){const i=new oc;for(const{value:r,domain:s}of t){if(s!==void 0)return s();if(r!==void 0)for(const o of r)i.add(o)}if(e!==void 0){const[r,s]=zn(i).map(e.floor,e);return e.range(r,e.offset(s))}if(i.size>1e4&&gn.get(n)===xa)throw new Error(`implicit ordinal domain of ${n} scale has more than 10,000 values`);return O_(i,js)}function UB(t,e){let n;for(const{hint:i}of t){const r=i==null?void 0:i[e];if(r!==void 0){if(n===void 0)n=r;else if(n!==r)return}}return n}function kAt(t){return{fill:UB(t,"fill"),stroke:UB(t,"stroke")}}function DAt(t){return sn(t.fill)?KSt:XSt}function OT(t,{label:e,inset:n=0,insetTop:i=n,insetRight:r=n,insetBottom:s=n,insetLeft:o=n,round:a,nice:u,clamp:c,zero:l,align:f,padding:d,projection:h,facet:{label:p=e}={},...g}={}){const m={};for(const[y,b]of t){const v=g[y],w=GJ(y,b,{round:gn.get(y)===xa?a:void 0,nice:u,clamp:c,zero:l,align:f,padding:d,projection:h,...v});if(w){let{label:_=y==="fx"||y==="fy"?p:e,percent:S,transform:x,inset:E,insetTop:A=E!==void 0?E:y==="y"?i:0,insetRight:$=E!==void 0?E:y==="x"?r:0,insetBottom:I=E!==void 0?E:y==="y"?s:0,insetLeft:k=E!==void 0?E:y==="x"?o:0}=v||{};if(x==null)x=void 0;else if(typeof x!="function")throw new Error("invalid scale transform; not a function");w.percent=!!S,w.label=_===void 0?NAt(b,w):_,w.transform=x,y==="x"||y==="fx"?(w.insetLeft=+k,w.insetRight=+$):(y==="y"||y==="fy")&&(w.insetTop=+A,w.insetBottom=+I),m[y]=w}}return m}function jB(t){const e={},n={scales:e};for(const[i,r]of Object.entries(t)){const{scale:s,type:o,interval:a,label:u}=r;e[i]=HJ(r),n[i]=s,s.type=o,a!=null&&(s.interval=a),u!=null&&(s.label=u)}return n}function CAt(t,e){const{x:n,y:i,fx:r,fy:s}=t,o=r||s?H6(e):e;r&&qB(r,o),s&&VB(s,o);const a=r||s?qJ(t,e):e;n&&qB(n,a),i&&VB(i,a)}function NAt(t=[],e){let n;for(const{label:i}of t)if(i!==void 0){if(n===void 0)n=i;else if(n!==i)return}if(n!==void 0)return!Sh(e)&&e.percent&&(n=`${n} (%)`),{inferred:!0,toString:()=>n}}function jJ(t){return Math.sign(Og(t.domain()))*Math.sign(Og(t.range()))}function H6(t){const{marginTop:e,marginRight:n,marginBottom:i,marginLeft:r,width:s,height:o,facet:{marginTop:a,marginRight:u,marginBottom:c,marginLeft:l}}=t;return{marginTop:Math.max(e,a),marginRight:Math.max(n,u),marginBottom:Math.max(i,c),marginLeft:Math.max(r,l),width:s,height:o}}function qJ({fx:t,fy:e},n){const{marginTop:i,marginRight:r,marginBottom:s,marginLeft:o,width:a,height:u}=H6(n);return{marginTop:i,marginRight:r,marginBottom:s,marginLeft:o,width:t?t.scale.bandwidth()+o+r:a,height:e?e.scale.bandwidth()+i+s:u,facet:{width:a,height:u}}}function qB(t,e){if(t.range===void 0){const{insetLeft:n,insetRight:i}=t,{width:r,marginLeft:s=0,marginRight:o=0}=e,a=s+n,u=r-o-i;t.range=[a,Math.max(a,u)],Sh(t)||(t.range=WJ(t)),t.scale.range(t.range)}VJ(t)}function VB(t,e){if(t.range===void 0){const{insetTop:n,insetBottom:i}=t,{height:r,marginTop:s=0,marginBottom:o=0}=e,a=s+n,u=r-o-i;t.range=[Math.max(a,u),a],Sh(t)?t.range.reverse():t.range=WJ(t),t.scale.range(t.range)}VJ(t)}function VJ(t){t.round===void 0&&LAt(t)&&OAt(t)<=30&&t.scale.round(!0)}function OAt({scale:t}){const e=t.domain().length,[n,i]=t.range(),r=t.paddingInner?t.paddingInner():1,s=t.paddingOuter?t.paddingOuter():t.padding(),o=e-r,a=Math.abs(i-n)/Math.max(1,o+s*2);return(a-Math.floor(a))*o}function WJ(t){const e=t.scale.domain().length+YJ(t);if(!(e>2))return t.range;const[n,i]=t.range;return Array.from({length:e},(r,s)=>n+s/(e-1)*(i-n))}function RT(t,e,n){return GJ(t,n===void 0?void 0:[{hint:n}],{...e})}function GJ(t,e=[],n={}){const i=RAt(t,e,n);if(n.type===void 0&&n.domain===void 0&&n.range===void 0&&n.interval==null&&t!=="fx"&&t!=="fy"&&Sh({type:i})){const r=e.map(({value:s})=>s).filter(s=>s!==void 0);r.some(ur)?Ju(`Warning: some data associated with the ${t} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${Jh(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${t} scale to "${Jh(i)}".`):r.some(pEt)?Ju(`Warning: some data associated with the ${t} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${Jh(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${t} scale to "${Jh(i)}".`):r.some(gEt)&&Ju(`Warning: some data associated with the ${t} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${Jh(i)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${t} scale to "${Jh(i)}".`)}switch(n.type=i,i){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":n=Hv(e,n,$r);break;case"identity":switch(gn.get(t)){case xa:n=Hv(e,n,$r);break;case DE:n=Hv(e,n,BAt);break}break;case"utc":case"time":n=Hv(e,n,cEt);break}switch(i){case"diverging":return yAt(t,e,n);case"diverging-sqrt":return bAt(t,e,n);case"diverging-pow":return LJ(t,e,n);case"diverging-log":return vAt(t,e,n);case"diverging-symlog":return wAt(t,e,n);case"categorical":case"ordinal":case Cb:return MAt(t,e,n);case"cyclical":case"sequential":case"linear":return rAt(t,e,n);case"sqrt":return sAt(t,e,n);case"threshold":return G6(t,e,n);case"quantile":return uAt(t,e,n);case"quantize":return cAt(t,e,n);case"pow":return OJ(t,e,n);case"log":return oAt(t,e,n);case"symlog":return aAt(t,e,n);case"utc":return IAt(t,e,n);case"time":return $At(t,e,n);case"point":return TAt(t,e,n);case"band":return FAt(t,e,n);case"identity":return fAt(t);case void 0:return;default:throw new Error(`unknown scale type: ${i}`)}}function Jh(t){return typeof t=="symbol"?t.description:t}function WB(t){return typeof t=="string"?`${t}`.toLowerCase():t}const GB={toString:()=>"projection"};function RAt(t,e,{type:n,domain:i,range:r,scheme:s,pivot:o,projection:a}){if(n=WB(n),t==="fx"||t==="fy")return"band";(t==="x"||t==="y")&&a!=null&&(n=GB);for(const c of e){const l=WB(c.type);if(l!==void 0){if(n===void 0)n=l;else if(n!==l)throw new Error(`scale incompatible with channel: ${n} !== ${l}`)}}if(n===GB)return;if(n!==void 0)return n;if(i===void 0&&!e.some(({value:c})=>c!==void 0))return;const u=gn.get(t);if(u===Tb)return"sqrt";if(u===kb||u===Fb)return"linear";if(u===DE)return"ordinal";if((i||r||[]).length>2)return WI(u);if(i!==void 0){if(mn(i))return WI(u);if(ur(i))return"utc"}else{const c=e.map(({value:l})=>l).filter(l=>l!==void 0);if(c.some(mn))return WI(u);if(c.some(ur))return"utc"}if(u===Sc){if(o!=null||nAt(s))return"diverging";if(ZEt(s))return"categorical"}return"linear"}function WI(t){switch(t){case xa:return"point";case Sc:return Cb;default:return"ordinal"}}function Sh({type:t}){return t==="ordinal"||t==="point"||t==="band"||t===Cb}function YJ({type:t}){return t==="threshold"}function LAt({type:t}){return t==="point"||t==="band"}function Ts(t){if(t===void 0)return!0;const e=t.domain(),n=t(e[0]);for(let i=1,r=e.length;i<r;++i)if(t(e[i])-n)return!1;return!0}function Hv(t,{domain:e,...n},i){var r;for(const s of t)s.value!==void 0&&(e===void 0&&(e=(r=s.value)==null?void 0:r.domain),s.value=i(s.value));return{domain:e===void 0?e:i(e),...n}}function BAt(t){return He(t,C6)}function PAt(t={}){let e;for(const n in t)if(gn.has(n)&&Md(t[n])){if(e!==void 0)throw new Error("ambiguous scale definition; multiple scales found");e=HJ(RT(n,t[n]))}if(e===void 0)throw new Error("invalid scale definition; no scale found");return e}function zAt(t){return e=>{if(!gn.has(e=`${e}`))throw new Error(`unknown scale: ${e}`);return t[e]}}function HJ({scale:t,type:e,domain:n,range:i,interpolate:r,interval:s,transform:o,percent:a,pivot:u}){if(e==="identity")return{type:"identity",apply:l=>l,invert:l=>l};const c=t.unknown?t.unknown():void 0;return{type:e,domain:E1(n),...i!==void 0&&{range:E1(i)},...o!==void 0&&{transform:o},...a&&{percent:a},...c!==void 0&&{unknown:c},...s!==void 0&&{interval:s},...r!==void 0&&{interpolate:r},...t.clamp&&{clamp:t.clamp()},...u!==void 0&&{pivot:u,symmetric:!1},...t.base&&{base:t.base()},...t.exponent&&{exponent:t.exponent()},...t.constant&&{constant:t.constant()},...t.align&&{align:t.align(),round:t.round()},...t.padding&&(t.paddingInner?{paddingInner:t.paddingInner(),paddingOuter:t.paddingOuter()}:{padding:t.padding()}),...t.bandwidth&&{bandwidth:t.bandwidth(),step:t.step()},apply:l=>t(l),...t.invert&&{invert:l=>t.invert(l)}}}function X6(t){let e,n;return(...i)=>(((n==null?void 0:n.length)!==i.length||n.some((r,s)=>r!==i[s]))&&(n=i,e=t(...i)),e)}const UAt=X6(t=>new Intl.NumberFormat(t)),jAt=X6((t,e)=>new Intl.DateTimeFormat(t,{timeZone:"UTC",...e&&{month:e}})),qAt=X6((t,e)=>new Intl.DateTimeFormat(t,{timeZone:"UTC",...e&&{weekday:e}}));function VAt(t="en-US"){const e=UAt(t);return n=>n!=null&&!isNaN(n)?e.format(n):void 0}function WAt(t="en-US",e="short"){const n=jAt(t,e);return i=>i!=null&&!isNaN(i=+new Date(Date.UTC(2e3,+i)))?n.format(i):void 0}function GAt(t="en-US",e="short"){const n=qAt(t,e);return i=>i!=null&&!isNaN(i=+new Date(Date.UTC(2001,0,+i)))?n.format(i):void 0}function XJ(t){return XK(t,"Invalid Date")}function YAt(t="en-US"){const e=VAt(t);return n=>(n instanceof Date?XJ:typeof n=="number"?e:Ii)(n)}const Qd=YAt(),hi=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5;let HAt=0;function LT(){return`plot-clip-${++HAt}`}function KJ(t,{title:e,href:n,ariaLabel:i,ariaDescription:r,ariaHidden:s,target:o,fill:a,fillOpacity:u,stroke:c,strokeWidth:l,strokeOpacity:f,strokeLinejoin:d,strokeLinecap:h,strokeMiterlimit:p,strokeDasharray:g,strokeDashoffset:m,opacity:y,mixBlendMode:b,imageFilter:v,paintOrder:w,pointerEvents:_,shapeRendering:S,channels:x},{ariaLabel:E,fill:A="currentColor",fillOpacity:$,stroke:I="none",strokeOpacity:k,strokeWidth:T,strokeLinecap:M,strokeLinejoin:F,strokeMiterlimit:D,paintOrder:N}){A===null&&(a=null,u=null),I===null&&(c=null,f=null),sn(A)?!sn(I)&&(!sn(a)||x!=null&&x.fill)&&(I="none"):sn(I)&&(!sn(c)||x!=null&&x.stroke)&&(A="none");const[R,L]=ar(a,A),[B,P]=In(u,$),[U,H]=ar(c,I),[nt,ft]=In(f,k),[dt,et]=In(y);Lg(H)||(l===void 0&&(l=T),h===void 0&&(h=M),d===void 0&&(d=F),p===void 0&&!bEt(d)&&(p=D),!Lg(L)&&w===void 0&&(w=N));const[ct,G]=In(l);return A!==null&&(t.fill=bn(L,"currentColor"),t.fillOpacity=g0(P,1)),I!==null&&(t.stroke=bn(H,"none"),t.strokeWidth=g0(G,1),t.strokeOpacity=g0(ft,1),t.strokeLinejoin=bn(d,"miter"),t.strokeLinecap=bn(h,"butt"),t.strokeMiterlimit=g0(p,4),t.strokeDasharray=bn(g,"none"),t.strokeDashoffset=bn(m,"0")),t.target=Ii(o),t.ariaLabel=Ii(E),t.ariaDescription=Ii(r),t.ariaHidden=Ii(s),t.opacity=g0(et,1),t.mixBlendMode=bn(b,"normal"),t.imageFilter=bn(v,"none"),t.paintOrder=bn(w,"normal"),t.pointerEvents=bn(_,"auto"),t.shapeRendering=bn(S,"auto"),{title:{value:e,optional:!0,filter:null},href:{value:n,optional:!0,filter:null},ariaLabel:{value:i,optional:!0,filter:null},fill:{value:R,scale:"auto",optional:!0},fillOpacity:{value:B,scale:"auto",optional:!0},stroke:{value:U,scale:"auto",optional:!0},strokeOpacity:{value:nt,scale:"auto",optional:!0},strokeWidth:{value:ct,optional:!0},opacity:{value:dt,scale:"auto",optional:!0}}}function XAt(t,e){e&&t.filter(n=>_6(e[n])).append("title").call(JAt,e)}function KAt(t,e){e&&t.filter(([n])=>_6(e[n])).append("title").call(QAt,e)}function JAt(t,e){e&&t.text(n=>Qd(e[n]))}function QAt(t,e){e&&t.text(([n])=>Qd(e[n]))}function Gn(t,{target:e,tip:n},{ariaLabel:i,title:r,fill:s,fillOpacity:o,stroke:a,strokeOpacity:u,strokeWidth:c,opacity:l,href:f}){i&&Ft(t,"aria-label",d=>i[d]),s&&Ft(t,"fill",d=>s[d]),o&&Ft(t,"fill-opacity",d=>o[d]),a&&Ft(t,"stroke",d=>a[d]),u&&Ft(t,"stroke-opacity",d=>u[d]),c&&Ft(t,"stroke-width",d=>c[d]),l&&Ft(t,"opacity",d=>l[d]),f&&QJ(t,d=>f[d],e),n||XAt(t,r)}function Dx(t,{target:e,tip:n},{ariaLabel:i,title:r,fill:s,fillOpacity:o,stroke:a,strokeOpacity:u,strokeWidth:c,opacity:l,href:f}){i&&Ft(t,"aria-label",([d])=>i[d]),s&&Ft(t,"fill",([d])=>s[d]),o&&Ft(t,"fill-opacity",([d])=>o[d]),a&&Ft(t,"stroke",([d])=>a[d]),u&&Ft(t,"stroke-opacity",([d])=>u[d]),c&&Ft(t,"stroke-width",([d])=>c[d]),l&&Ft(t,"opacity",([d])=>l[d]),f&&QJ(t,([d])=>f[d],e),n||KAt(t,r)}function ZAt({ariaLabel:t,title:e,fill:n,fillOpacity:i,stroke:r,strokeOpacity:s,strokeWidth:o,opacity:a,href:u},{tip:c}){return[t,c?void 0:e,n,i,r,s,o,a,u].filter(l=>l!==void 0)}function K6(t,e,n){const i=bc(t,r=>e[r]);return n===void 0&&i.size>1+t.length>>1&&Ju("Warning: the implicit z channel has high cardinality. This may occur when the fill or stroke channel is associated with quantitative data rather than ordinal or categorical data. You can suppress this warning by setting the z option explicitly; if this data represents a single series, set z to null."),i.values()}function*JJ(t,e,n,i){const{z:r}=n,{z:s}=i,o=ZAt(i,n),a=[...e,...o];for(const u of s?K6(t,s,r):[t]){let c,l;t:for(const f of u){for(const d of a)if(!tr(d[f])){l&&l.push(-1);continue t}if(c===void 0){l&&(yield l),c=o.map(d=>wd(d[f])),l=[f];continue}l.push(f);for(let d=0;d<o.length;++d)if(wd(o[d][f])!==c[d]){yield l,c=o.map(p=>wd(p[f])),l=[f];continue t}}l&&(yield l)}}function t$t(t,e,n,i){let r;const{clip:s=i.clip}=e;switch(s){case"frame":{const{width:o,height:a,marginLeft:u,marginRight:c,marginTop:l,marginBottom:f}=n,d=LT();r=`url(#${d})`,t=ve("svg:g",i).call(h=>h.append("svg:clipPath").attr("id",d).append("rect").attr("x",u).attr("y",l).attr("width",o-c-u).attr("height",a-l-f)).each(function(){this.appendChild(t.node()),t.node=()=>this});break}case"sphere":{const{projection:o}=i;if(!o)throw new Error('the "sphere" clip option requires a projection');const a=LT();r=`url(#${a})`,t.append("clipPath").attr("id",a).append("path").attr("d",Ha(o)({type:"Sphere"}));break}}Ft(t,"aria-label",e.ariaLabel),Ft(t,"aria-description",e.ariaDescription),Ft(t,"aria-hidden",e.ariaHidden),Ft(t,"clip-path",r)}function un(t,e,n,i){t$t(t,e,n,i),Ft(t,"fill",e.fill),Ft(t,"fill-opacity",e.fillOpacity),Ft(t,"stroke",e.stroke),Ft(t,"stroke-width",e.strokeWidth),Ft(t,"stroke-opacity",e.strokeOpacity),Ft(t,"stroke-linejoin",e.strokeLinejoin),Ft(t,"stroke-linecap",e.strokeLinecap),Ft(t,"stroke-miterlimit",e.strokeMiterlimit),Ft(t,"stroke-dasharray",e.strokeDasharray),Ft(t,"stroke-dashoffset",e.strokeDashoffset),Ft(t,"shape-rendering",e.shapeRendering),Ft(t,"filter",e.imageFilter),Ft(t,"paint-order",e.paintOrder);const{pointerEvents:r=i.pointerSticky===!1?"none":void 0}=e;Ft(t,"pointer-events",r)}function en(t,e){e$t(t,"mix-blend-mode",e.mixBlendMode),Ft(t,"opacity",e.opacity)}function QJ(t,e,n){t.each(function(i){const r=e(i);if(r!=null){const s=this.ownerDocument.createElementNS(jd.svg,"a");s.setAttribute("fill","inherit"),s.setAttributeNS(jd.xlink,"href",r),n!=null&&s.setAttribute("target",n),this.parentNode.insertBefore(s,this).appendChild(this)}})}function Ft(t,e,n){n!=null&&t.attr(e,n)}function e$t(t,e,n){n!=null&&t.style(e,n)}function qe(t,e,{x:n,y:i},r=hi,s=hi){r+=e.dx,s+=e.dy,n!=null&&n.bandwidth&&(r+=n.bandwidth()/2),i!=null&&i.bandwidth&&(s+=i.bandwidth()/2),(r||s)&&t.attr("transform",`translate(${r},${s})`)}function bn(t,e){if((t=Ii(t))!==e)return t}function g0(t,e){if((t=de(t))!==e)return t}const n$t=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function J6(t){if(t===void 0)return"plot-d6a7b5";if(t=`${t}`,!n$t.test(t))throw new Error(`invalid class name: ${t}`);return t}function Q6(t,e){if(typeof e=="string")t.property("style",e);else if(e!=null)for(const n of t)Object.assign(n.style,e)}function Qa({frameAnchor:t},{width:e,height:n,marginTop:i,marginRight:r,marginBottom:s,marginLeft:o}){return[/left$/.test(t)?o:/right$/.test(t)?e-r:(o+e-r)/2,/^top/.test(t)?i:/^bottom/.test(t)?n-s:(i+n-s)/2]}function i$t(t,e,n={}){let i=.5-hi,r=.5+hi,s=.5+hi,o=.5-hi;for(const{marginTop:g,marginRight:m,marginBottom:y,marginLeft:b}of e)g>i&&(i=g),m>r&&(r=m),y>s&&(s=y),b>o&&(o=b);let{margin:a,marginTop:u=a!==void 0?a:i,marginRight:c=a!==void 0?a:r,marginBottom:l=a!==void 0?a:s,marginLeft:f=a!==void 0?a:o}=n;u=+u,c=+c,l=+l,f=+f;let{width:d=640,height:h=r$t(t,n,{width:d,marginTopDefault:i,marginRightDefault:r,marginBottomDefault:s,marginLeftDefault:o})+Math.max(0,u-i+l-s)}=n;d=+d,h=+h;const p={width:d,height:h,marginTop:u,marginRight:c,marginBottom:l,marginLeft:f};if(t.fx||t.fy){let{margin:g,marginTop:m=g!==void 0?g:u,marginRight:y=g!==void 0?g:c,marginBottom:b=g!==void 0?g:l,marginLeft:v=g!==void 0?g:f}=n.facet??{};m=+m,y=+y,b=+b,v=+v,p.facet={marginTop:m,marginRight:y,marginBottom:b,marginLeft:v}}return p}function r$t({x:t,y:e,fy:n,fx:i},{projection:r,aspectRatio:s},{width:o,marginTopDefault:a,marginRightDefault:u,marginBottomDefault:c,marginLeftDefault:l}){const f=n?n.scale.domain().length:1,d=JEt(r);if(d){const p=i?i.scale.domain().length:1,g=(1.1*f-.1)/(1.1*p-.1)*d,m=Math.max(.1,Math.min(10,g));return Math.round((o-l-u)*m+a+c)}const h=e?Sh(e)?e.scale.domain().length:Math.max(7,17/f):1;if(s!=null){if(s=+s,!(isFinite(s)&&s>0))throw new Error(`invalid aspectRatio: ${s}`);const p=YB("y",e)/(YB("x",t)*s),g=i?i.scale.bandwidth():1,m=n?n.scale.bandwidth():1,y=g*(o-l-u)-t.insetLeft-t.insetRight;return(p*y+e.insetTop+e.insetBottom)/m+a+c}return!!(e||n)*Math.max(1,Math.min(60,h*f))*20+!!i*30+60}function YB(t,e){if(!e)throw new Error(`aspectRatio requires ${t} scale`);const{type:n,domain:i}=e;let r;switch(n){case"linear":case"utc":case"time":r=Number;break;case"pow":{const a=e.scale.exponent();r=u=>Math.pow(u,a);break}case"log":r=Math.log;break;case"point":case"band":return i.length;default:throw new Error(`unsupported ${t} scale for aspectRatio: ${n}`)}const[s,o]=zn(i);return Math.abs(r(o)-r(s))}function s$t(t,e){const{fx:n,fy:i}=OT(t,e),r=n==null?void 0:n.scale.domain(),s=i==null?void 0:i.scale.domain();return r&&s?E0t(r,s).map(([o,a],u)=>({x:o,y:a,i:u})):r?r.map((o,a)=>({x:o,i:a})):s?s.map((o,a)=>({y:o,i:a})):void 0}function o$t(t,{x:e,y:n}){return e&&(e=BT(e)),n&&(n=BT(n)),t.filter(e&&n?i=>e.has(i.x)&&n.has(i.y):e?i=>e.has(i.x):i=>n.has(i.y)).sort(e&&n?(i,r)=>e.get(i.x)-e.get(r.x)||n.get(i.y)-n.get(r.y):e?(i,r)=>e.get(i.x)-e.get(r.x):(i,r)=>n.get(i.y)-n.get(r.y))}function Z6(t,{fx:e,fy:n}){const i=_c(t),r=e==null?void 0:e.value,s=n==null?void 0:n.value;return e&&n?eg(i,o=>(o.fx=r[o[0]],o.fy=s[o[0]],o),o=>r[o],o=>s[o]):e?eg(i,o=>(o.fx=r[o[0]],o),o=>r[o]):eg(i,o=>(o.fy=s[o[0]],o),o=>s[o])}function a$t(t,e,{marginTop:n,marginLeft:i}){return t&&e?({x:r,y:s})=>`translate(${t(r)-i},${e(s)-n})`:t?({x:r})=>`translate(${t(r)-i},0)`:({y:r})=>`translate(0,${e(r)-n})`}function u$t(t){const e=[],n=new Uint32Array(Ls(t,i=>i.length));for(const i of t){let r=0;for(const s of t)i!==s&&(n.set(s,r),r+=s.length);e.push(n.slice(0,r))}return e}const c$t=new Map([["top",GI],["right",XI],["bottom",YI],["left",HI],["top-left",Xv(GI,HI)],["top-right",Xv(GI,XI)],["bottom-left",Xv(YI,HI)],["bottom-right",Xv(YI,XI)],["top-empty",d$t],["right-empty",g$t],["bottom-empty",h$t],["left-empty",p$t],["empty",m$t]]);function l$t(t){if(t==null)return null;const e=c$t.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid facet anchor: ${t}`)}const HB=new WeakMap;function BT(t){let e=HB.get(t);return e||HB.set(t,e=new zd(He(t,(n,i)=>[n,i]))),e}function df(t,e){return BT(t).get(e)}function f$t(t,e,n){return e=wd(e),n=wd(n),t.find(i=>Object.is(wd(i.x),e)&&Object.is(wd(i.y),n))}function zE(t,e,n){var i;return(i=f$t(t,e,n))==null?void 0:i.empty}function GI(t,{y:e},{y:n}){return e?df(e,n)===0:!0}function YI(t,{y:e},{y:n}){return e?df(e,n)===e.length-1:!0}function HI(t,{x:e},{x:n}){return e?df(e,n)===0:!0}function XI(t,{x:e},{x:n}){return e?df(e,n)===e.length-1:!0}function d$t(t,{y:e},{x:n,y:i,empty:r}){if(r)return!1;if(!e)return;const s=df(e,i);if(s>0)return zE(t,n,e[s-1])}function h$t(t,{y:e},{x:n,y:i,empty:r}){if(r)return!1;if(!e)return;const s=df(e,i);if(s<e.length-1)return zE(t,n,e[s+1])}function p$t(t,{x:e},{x:n,y:i,empty:r}){if(r)return!1;if(!e)return;const s=df(e,n);if(s>0)return zE(t,e[s-1],i)}function g$t(t,{x:e},{x:n,y:i,empty:r}){if(r)return!1;if(!e)return;const s=df(e,n);if(s<e.length-1)return zE(t,e[s+1],i)}function m$t(t,e,{empty:n}){return n}function Xv(t,e){return function(){return t.apply(null,arguments)&&e.apply(null,arguments)}}function KI(t,{channels:{fx:e,fy:n},groups:i}){return e&&n?t.map(({x:r,y:s})=>{var o;return((o=i.get(r))==null?void 0:o.get(s))??[]}):e?t.map(({x:r})=>i.get(r)??[]):t.map(({y:r})=>i.get(r)??[])}let Ve=class{constructor(e,n={},i={},r){const{facet:s="auto",facetAnchor:o,fx:a,fy:u,sort:c,dx:l=0,dy:f=0,margin:d=0,marginTop:h=d,marginRight:p=d,marginBottom:g=d,marginLeft:m=d,clip:y=r==null?void 0:r.clip,channels:b,tip:v,render:w}=i;if(this.data=e,this.sort=Pl(c)?c:null,this.initializer=Lr(i).initializer,this.transform=this.initializer?i.transform:Ja(i).transform,s===null||s===!1?this.facet=null:(this.facet=hs(s===!0?"include":s,"facet",["auto","include","exclude","super"]),this.fx=e===Oy&&typeof a=="string"?[a]:a,this.fy=e===Oy&&typeof u=="string"?[u]:u),this.facetAnchor=l$t(o),n=F6(n),b!==void 0&&(n={...y$t(b),...n}),r!==void 0&&(n={...KJ(this,i,r),...n}),this.channels=Object.fromEntries(Object.entries(n).map(([_,S])=>{if(aa(S.value)){const{value:x,label:E=S.label,scale:A=S.scale}=S.value;S={...S,label:E,scale:A,value:x}}if(e===Oy&&typeof S.value=="string"){const{value:x}=S;S={...S,value:[x]}}return[_,S]}).filter(([_,{value:S,optional:x}])=>{if(S!=null)return!0;if(x)return!1;throw new Error(`missing channel value: ${_}`)})),this.dx=+l,this.dy=+f,this.marginTop=+h,this.marginRight=+p,this.marginBottom=+g,this.marginLeft=+m,this.clip=lJ(y),this.tip=b$t(v),this.facet==="super"){if(a||u)throw new Error("super-faceting cannot use fx or fy");for(const _ in this.channels){const{scale:S}=n[_];if(!(S!=="x"&&S!=="y"))throw new Error("super-faceting cannot use x or y")}}w!=null&&(this.render=Cx(w,this.render))}initialize(e,n,i){let r=Rr(this.data);e===void 0&&r!=null&&(e=[_c(r)]);const s=e;this.transform!=null&&({facets:e,data:r}=this.transform(r,e,i),r=Rr(r)),e!==void 0&&(e.original=s);const o=SJ(this.channels,r);return this.sort!=null&&jEt(r,e,o,n,this.sort),{data:r,facets:e,channels:o}}filter(e,n,i){for(const r in n){const{filter:s=tr}=n[r];if(s!==null){const o=i[r];e=e.filter(a=>s(o[a]))}}return e}project(e,n,i){for(const r in e)if(e[r].scale==="x"&&/^x|x$/.test(r)){const s=r.replace(/^x|x$/,"y");s in e&&e[s].scale==="y"&&FJ(r,s,n,i.projection)}}scale(e,n,i){const r=V6(e,n);return i.projection&&this.project(e,r,i),r}};function qs(...t){return t.plot=Ve.prototype.plot,t}function Cx(t,e){if(t==null)return e===null?void 0:e;if(e==null)return t===null?void 0:t;if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);return function(n,i,r,s,o,a){return t.call(this,n,i,r,s,o,(u,c,l,f,d)=>e.call(this,u,c,l,f,d,a))}}function y$t(t){return Object.fromEntries(Object.entries(F6(t)).map(([e,n])=>(n=typeof n=="string"?{value:n,label:e}:Fm(n),n.filter===void 0&&n.scale==null&&(n={...n,filter:null}),[e,n])))}function b$t(t){return t===!0?"xy":t===!1||t==null?null:typeof t=="string"?hs(t,"tip",["x","y","xy"]):t}function Eh(t,e){return(t==null?void 0:t.tip)===!0?{...t,tip:e}:Ks(t==null?void 0:t.tip)&&t.tip.pointer===void 0?{...t,tip:{...t.tip,pointer:e}}:t}const XB=new WeakMap;function tC(t,e,{x:n,y:i,px:r,py:s,maxRadius:o=40,channels:a,render:u,...c}={}){return o=+o,r!=null&&(n??(n=null),a={...a,px:{value:r,scale:"x"}}),s!=null&&(i??(i=null),a={...a,py:{value:s,scale:"y"}}),{x:n,y:i,channels:a,...c,render:Cx(function(l,f,d,h,p,g){p={...p,pointerSticky:!1};const m=p.ownerSVGElement,{data:y}=p.getMarkState(this);let b=XB.get(m);b||XB.set(m,b={sticky:!1,roots:[],renders:[]});let v=b.renders.push(H)-1;const{x:w,y:_,fx:S,fy:x}=f;let E=S?S(l.fx)-h.marginLeft:0,A=x?x(l.fy)-h.marginTop:0;w!=null&&w.bandwidth&&(E+=w.bandwidth()/2),_!=null&&_.bandwidth&&(A+=_.bandwidth()/2);const $=l.fi!=null;let I;if($){let et=b.facetStates;et||(b.facetStates=et=new Map),I=et.get(this),I||et.set(this,I=new Map)}const[k,T]=Qa(this,h),{px:M,py:F}=d,D=M?et=>M[et]:ZJ(d,k),N=F?et=>F[et]:tQ(d,T);let R,L,B,P;function U(et,ct){if($)if(P&&(P=cancelAnimationFrame(P)),et==null)I.delete(l.fi);else{I.set(l.fi,ct),P=requestAnimationFrame(()=>{P=null;for(const[G,st]of I)if(st<ct||st===ct&&G<l.fi){et=null;break}H(et)});return}H(et)}function H(et){if(R===et&&B===b.sticky)return;R=et,B=p.pointerSticky=b.sticky;const ct=R==null?[]:[R];$&&(ct.fx=l.fx,ct.fy=l.fy,ct.fi=l.fi);const G=g(ct,f,d,h,p);if(L){if($){const st=L.parentNode,lt=L.getAttribute("transform"),V=G.getAttribute("transform");lt?G.setAttribute("transform",lt):G.removeAttribute("transform"),V?st.setAttribute("transform",V):st.removeAttribute("transform"),G.removeAttribute("aria-label"),G.removeAttribute("aria-description"),G.removeAttribute("aria-hidden")}L.replaceWith(G)}return b.roots[v]=L=G,R==null&&(I==null?void 0:I.size)>1||p.dispatchValue(R==null?null:y[R]),G}function nt(et){if(b.sticky||et.pointerType==="mouse"&&et.buttons===1)return;let[ct,G]=WM(et);ct-=E,G-=A;const st=ct<h.marginLeft||ct>h.width-h.marginRight?1:t,lt=G<h.marginTop||G>h.height-h.marginBottom?1:e;let V=null,Vt=o*o;for(const mt of l){const ee=st*(D(mt)-ct),oe=lt*(N(mt)-G),ht=ee*ee+oe*oe;ht<=Vt&&(V=mt,Vt=ht)}if(V!=null&&(t!==1||e!==1)){const mt=D(V)-ct,ee=N(V)-G;Vt=mt*mt+ee*ee}U(V,Vt)}function ft(et){et.pointerType==="mouse"&&R!=null&&(b.sticky&&b.roots.some(ct=>ct==null?void 0:ct.contains(et.target))||(b.sticky?(b.sticky=!1,b.renders.forEach(ct=>ct(null))):(b.sticky=!0,H(R)),et.stopImmediatePropagation()))}function dt(et){et.pointerType==="mouse"&&(b.sticky||U(null))}return m.addEventListener("pointerenter",nt),m.addEventListener("pointermove",nt),m.addEventListener("pointerdown",ft),m.addEventListener("pointerleave",dt),H(null)},u)}}function eC(t){return tC(1,1,t)}function nC(t){return tC(1,.01,t)}function Nx(t){return tC(.01,1,t)}function ZJ({x1:t,x2:e,x:n=t},i){return t&&e?r=>(t[r]+e[r])/2:n?r=>n[r]:()=>i}function tQ({y1:t,y2:e,y:n=t},i){return t&&e?r=>(t[r]+e[r])/2:n?r=>n[r]:()=>i}function eQ(t){return Sh(t)&&t.interval===void 0?void 0:"tabular-nums"}function v$t(t,e){let{label:n=t.label,tickSize:i=6,width:r=240,height:s=44+i,marginTop:o=18,marginRight:a=0,marginBottom:u=16+i,marginLeft:c=0,style:l,ticks:f=(r-c-a)/64,tickFormat:d,fontVariant:h=eQ(t),round:p=!0,opacity:g,className:m}=e;const y=RE(e);m=J6(m),g=In(g)[1],d===null&&(d=()=>null);const b=ve("svg",y).attr("class",`${m}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",r).attr("height",s).attr("viewBox",`0 0 ${r} ${s}`).call(k=>k.append("style").text(`:where(.${m}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${m}-ramp text) {
  white-space: pre;
}`)).call(Q6,l);let v=k=>k.selectAll(".tick line").attr("y1",o+u-s),w;const _=p?(k,T)=>k.rangeRound(T):(k,T)=>k.range(T),{type:S,domain:x,range:E,interpolate:A,scale:$,pivot:I}=t;if(A){const k=E===void 0?A:_m(A.length===1?Y6(A):A,E);w=_($.copy(),Bs(ci(c,r-a),Math.min(x.length+(I!==void 0),E===void 0?1/0:E.length)));const T=256,M=y.document.createElement("canvas");M.width=T,M.height=1;const F=M.getContext("2d");for(let D=0,N=T-1;D<T;++D)F.fillStyle=k(D/N),F.fillRect(D,0,1,1);b.append("image").attr("opacity",g).attr("x",c).attr("y",o).attr("width",r-c-a).attr("height",s-o-u).attr("preserveAspectRatio","none").attr("xlink:href",M.toDataURL())}else if(S==="threshold"){const k=x,T=d===void 0?M=>M:typeof d=="string"?vh(d):d;w=_(gE().domain([-1,E.length-1]),[c,r-a]),b.append("g").attr("fill-opacity",g).selectAll().data(E).enter().append("rect").attr("x",(M,F)=>w(F-1)).attr("y",o).attr("width",(M,F)=>w(F)-w(F-1)).attr("height",s-o-u).attr("fill",M=>M),f=He(k,(M,F)=>F),d=M=>T(k[M],M)}else w=_(hE().domain(x),[c,r-a]),b.append("g").attr("fill-opacity",g).selectAll().data(x).enter().append("rect").attr("x",w).attr("y",o).attr("width",Math.max(0,w.bandwidth()-1)).attr("height",s-o-u).attr("fill",$),v=()=>{};return b.append("g").attr("transform",`translate(0,${s-u})`).call(Y0t(w).ticks(Array.isArray(f)?null:f,typeof d=="string"?d:void 0).tickFormat(typeof d=="function"?d:void 0).tickSize(i).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",bn(h,"normal")).call(v).call(k=>k.select(".domain").remove()),n!==void 0&&b.append("text").attr("x",c).attr("y",o-6).attr("fill","currentColor").attr("font-weight","bold").text(n),b.node()}const Ox=Math.PI/180;function km(t,{marker:e,markerStart:n=e,markerMid:i=e,markerEnd:r=e}={}){t.markerStart=JI(n),t.markerMid=JI(i),t.markerEnd=JI(r)}function JI(t){if(t==null||t===!1)return null;if(t===!0)return JB;if(typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"none":return null;case"arrow":return KB("auto");case"arrow-reverse":return KB("auto-start-reverse");case"dot":return w$t;case"circle":case"circle-fill":return JB;case"circle-stroke":return _$t;case"tick":return QI("auto");case"tick-x":return QI(90);case"tick-y":return QI(0)}throw new Error(`invalid marker: ${t}`)}function KB(t){return(e,n)=>ve("svg:marker",n).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",t).attr("fill","none").attr("stroke",e).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(i=>i.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function w$t(t,e){return ve("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",t).attr("stroke","none").call(n=>n.append("circle").attr("r",2.5)).node()}function JB(t,e){return ve("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",t).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function _$t(t,e){return ve("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",t).attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function QI(t){return(e,n)=>ve("svg:marker",n).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",t).attr("stroke",e).call(i=>i.append("path").attr("d","M0,-3v6")).node()}let x$t=0;function Nb(t,e,{stroke:n},i){return nQ(t,e,n&&(r=>n[r]),i)}function S$t(t,e,{stroke:n},i){return nQ(t,e,n&&(([r])=>n[r]),i)}function nQ(t,{markerStart:e,markerMid:n,markerEnd:i,stroke:r},s=()=>r,o){const a=new Map;function u(c){return function(l){const f=s(l);let d=a.get(c);d||a.set(c,d=new Map);let h=d.get(f);if(!h){const p=this.parentNode.insertBefore(c(f,o),this),g=`plot-marker-${++x$t}`;p.setAttribute("id",g),d.set(f,h=`url(#${g})`)}return h}}e&&t.attr("marker-start",u(e)),n&&t.attr("marker-mid",u(n)),i&&t.attr("marker-end",u(i))}function Ob({inset:t,insetLeft:e,insetRight:n,...i}={}){return[e,n]=iQ(t,e,n),{inset:t,insetLeft:e,insetRight:n,...i}}function Rb({inset:t,insetTop:e,insetBottom:n,...i}={}){return[e,n]=iQ(t,e,n),{inset:t,insetTop:e,insetBottom:n,...i}}function iQ(t,e,n){return t===void 0&&e===void 0&&n===void 0?hi?[1,0]:[.5,.5]:[e,n]}function rQ(t,{interval:e}){return t={...Fm(t)},t.interval=kE(t.interval===void 0?e:t.interval),t}function UE(t,e,n,i){const{[t]:r,[`${t}1`]:s,[`${t}2`]:o}=n,{value:a,interval:u}=rQ(r,n);if(a==null||u==null&&!i)return n;const c=Ka(r);if(u==null){let h;const p={transform:g=>h||(h=ue(g,a)),label:c};return{...n,[t]:void 0,[`${t}1`]:s===void 0?p:s,[`${t}2`]:o===void 0&&!(s===o&&i)?p:o}}let l,f;function d(h){return f!==void 0&&h===l?f:f=He(ue(l=h,a),p=>u.floor(p))}return e({...n,[t]:void 0,[`${t}1`]:s===void 0?{transform:d,label:c}:s,[`${t}2`]:o===void 0?{transform:h=>d(h).map(p=>u.offset(p)),label:c}:o})}function sQ(t,e,n){const{[t]:i}=n,{value:r,interval:s}=rQ(i,n);return r==null||s==null?n:e({...n,[t]:{label:Ka(i),transform:o=>{const a=He(ue(o,r),c=>s.floor(c)),u=a.map(c=>s.offset(c));return a.map(ur(a)?(c,l)=>c==null||isNaN(c=+c)||(l=u[l],l==null)||isNaN(l=+l)?void 0:new Date((c+l)/2):(c,l)=>c==null||(l=u[l],l==null)?NaN:(+c+ +l)/2)}}})}function oQ(t={}){return UE("x",Ob,t,!0)}function aQ(t={}){return UE("y",Rb,t,!0)}function uQ(t={}){return UE("x",Ob,t)}function cQ(t={}){return UE("y",Rb,t)}function lQ(t={}){return sQ("x",Ob,t)}function fQ(t={}){return sQ("y",Rb,t)}const dQ={ariaLabel:"rule",fill:null,stroke:"currentColor"};class hQ extends Ve{constructor(e,n={}){const{x:i,y1:r,y2:s,inset:o=0,insetTop:a=o,insetBottom:u=o}=n;super(e,{x:{value:i,scale:"x",optional:!0},y1:{value:r,scale:"y",optional:!0},y2:{value:s,scale:"y",optional:!0}},Eh(n,"x"),dQ),this.insetTop=de(a),this.insetBottom=de(u),km(this,n)}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y1:c,y2:l}=i,{width:f,height:d,marginTop:h,marginRight:p,marginLeft:g,marginBottom:m}=r,{insetTop:y,insetBottom:b}=this;return ve("svg:g",s).call(un,this,r,s).call(qe,this,{x:u&&o},hi,0).call(v=>v.selectAll().data(e).enter().append("line").call(en,this).attr("x1",u?w=>u[w]:(g+f-p)/2).attr("x2",u?w=>u[w]:(g+f-p)/2).attr("y1",c&&!Ts(a)?w=>c[w]+y:h+y).attr("y2",l&&!Ts(a)?a.bandwidth?w=>l[w]+a.bandwidth()-b:w=>l[w]-b:d-m-b).call(Gn,this,i).call(Nb,this,i,s)).node()}}class pQ extends Ve{constructor(e,n={}){const{x1:i,x2:r,y:s,inset:o=0,insetRight:a=o,insetLeft:u=o}=n;super(e,{y:{value:s,scale:"y",optional:!0},x1:{value:i,scale:"x",optional:!0},x2:{value:r,scale:"x",optional:!0}},Eh(n,"y"),dQ),this.insetRight=de(a),this.insetLeft=de(u),km(this,n)}render(e,n,i,r,s){const{x:o,y:a}=n,{y:u,x1:c,x2:l}=i,{width:f,height:d,marginTop:h,marginRight:p,marginLeft:g,marginBottom:m}=r,{insetLeft:y,insetRight:b}=this;return ve("svg:g",s).call(un,this,r,s).call(qe,this,{y:u&&a},0,hi).call(v=>v.selectAll().data(e).enter().append("line").call(en,this).attr("x1",c&&!Ts(o)?w=>c[w]+y:g+y).attr("x2",l&&!Ts(o)?o.bandwidth?w=>l[w]+o.bandwidth()-b:w=>l[w]-b:f-p-b).attr("y1",u?w=>u[w]:(h+d-m)/2).attr("y2",u?w=>u[w]:(h+d-m)/2).call(Gn,this,i).call(Nb,this,i,s)).node()}}function zl(t,e){let{x:n=Ot,y:i,y1:r,y2:s,...o}=cQ(e);return[r,s]=gQ(i,r,s),new hQ(t,{...o,x:n,y1:r,y2:s})}function Ul(t,e){let{y:n=Ot,x:i,x1:r,x2:s,...o}=uQ(e);return[r,s]=gQ(i,r,s),new pQ(t,{...o,y:n,x1:r,x2:s})}function gQ(t,e,n){if(t==null){if(e===void 0){if(n!==void 0)return[0,n]}else if(n===void 0)return[0,e]}else{if(e===void 0)return n===void 0?[0,t]:[t,n];if(n===void 0)return[t,e]}return[e,n]}function jE(t,...e){let n=e.length;for(let i=0,r=!0;i<n;++i)typeof e[i]!="function"&&(r&&(t=t.slice(),r=!1),t.splice(i,2,t[i]+e[i]+t[i+1]),e.splice(i,1),--i,--n);return i=>{let r=t[0];for(let s=0;s<n;++s)r+=e[s](i)+t[s+1];return r}}const E$t={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},mQ="­";class qE extends Ve{constructor(e,n={}){const{x:i,y:r,text:s=xc(e)&&cJ(e)?Ot:hr,frameAnchor:o,textAnchor:a=/right$/i.test(o)?"end":/left$/i.test(o)?"start":"middle",lineAnchor:u=/^top/i.test(o)?"top":/^bottom/i.test(o)?"bottom":"middle",lineHeight:c=1,lineWidth:l=1/0,textOverflow:f,monospace:d,fontFamily:h=d?"ui-monospace, monospace":void 0,fontSize:p,fontStyle:g,fontVariant:m,fontWeight:y,rotate:b}=n,[v,w]=In(b,0),[_,S]=M$t(p);if(super(e,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},fontSize:{value:_,optional:!0},rotate:{value:dEt(v),optional:!0},text:{value:s,filter:_6,optional:!0}},n,E$t),this.rotate=w,this.textAnchor=bn(a,"middle"),this.lineAnchor=hs(u,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+c,this.lineWidth=+l,this.textOverflow=yQ(f),this.monospace=!!d,this.fontFamily=Ii(h),this.fontSize=S,this.fontStyle=Ii(g),this.fontVariant=Ii(m),this.fontWeight=Ii(y),this.frameAnchor=Mb(o),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${l}`);this.splitLines=_Q(this),this.clipLine=xQ(this)}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y:c,rotate:l,text:f,title:d,fontSize:h}=i,{rotate:p}=this,[g,m]=Qa(this,r);return ve("svg:g",s).call(un,this,r,s).call(wQ,this,f,r).call(qe,this,{x:u&&o,y:c&&a}).call(y=>y.selectAll().data(e).enter().append("text").call(en,this).call(A$t,this,f,d).attr("transform",jE`translate(${u?b=>u[b]:g},${c?b=>c[b]:m})${l?b=>` rotate(${l[b]})`:p?` rotate(${p})`:""}`).call(Ft,"font-size",h&&(b=>h[b])).call(Gn,this,i)).node()}}function yQ(t){return t==null?null:hs(t,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function A$t(t,e,n,i){if(!n)return;const{lineAnchor:r,lineHeight:s,textOverflow:o,splitLines:a,clipLine:u}=e;t.each(function(c){const l=a(Qd(n[c])??"").map(u),f=l.length,d=r==="top"?.71:r==="bottom"?1-f:(164-f*100)/200;if(f>1){let h=0;for(let p=0;p<f;++p){if(++h,!l[p])continue;const g=this.ownerDocument.createElementNS(jd.svg,"tspan");g.setAttribute("x",0),p===h-1?g.setAttribute("y",`${(d+p)*s}em`):g.setAttribute("dy",`${h*s}em`),g.textContent=l[p],this.appendChild(g),h=0}}else d&&this.setAttribute("y",`${d*s}em`),this.textContent=l[0];if(o&&!i&&l[0]!==n[c]){const h=this.ownerDocument.createElementNS(jd.svg,"title");h.textContent=n[c],this.appendChild(h)}})}function Bg(t,{x:e,y:n,...i}={}){return i.frameAnchor===void 0&&([e,n]=Lo(e,n)),new qE(t,{...i,x:e,y:n})}function bQ(t,{x:e=Ot,...n}={}){return new qE(t,fQ({...n,x:e}))}function vQ(t,{y:e=Ot,...n}={}){return new qE(t,lQ({...n,y:e}))}function wQ(t,e,n){Ft(t,"text-anchor",e.textAnchor),Ft(t,"font-family",e.fontFamily),Ft(t,"font-size",e.fontSize),Ft(t,"font-style",e.fontStyle),Ft(t,"font-variant",e.fontVariant===void 0?$$t(n):e.fontVariant),Ft(t,"font-weight",e.fontWeight)}function $$t(t){return t&&(Lp(t)||ur(t))?"tabular-nums":void 0}const I$t=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function M$t(t){return t==null||typeof t=="number"?[void 0,t]:typeof t!="string"?[t,void 0]:(t=t.trim().toLowerCase(),I$t.has(t)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(t)?[void 0,t]:[t,void 0])}function T$t(t,e,n){const i=[];let r,s=0;for(const[o,a,u]of F$t(t)){if(r===void 0&&(r=o),s>r&&n(t,r,a)>e&&(i.push(t.slice(r,s)+(t[s-1]===mQ?"-":"")),r=o),u){i.push(t.slice(r,a)),r=void 0;continue}s=a}return i}function*F$t(t){let e=0,n=0;const i=t.length;for(;n<i;){let r=1;switch(t[n]){case mQ:case"-":++n,yield[e,n,!1],e=n;break;case" ":for(yield[e,n,!1];t[++n]===" ";);e=n;break;case"\r":t[n+1]===`
`&&++r;case`
`:yield[e,n,!0],n+=r,e=n;break;default:++n;break}}yield[e,n,!0]}const QB={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"‘":31,"’":31,"“":47,"”":47,"…":82};function iC(t,e=0,n=t.length){let i=0;for(let r=e;r<n;r=Dm(t,r))i+=QB[t[r]]??(EQ(t,r)?120:QB.e);return i}function rC(t,e=0,n=t.length){let i=0;for(let r=e;r<n;r=Dm(t,r))i+=EQ(t,r)?126:63;return i}function _Q({monospace:t,lineWidth:e,textOverflow:n}){if(n!=null||e==1/0)return s=>s.split(/\r\n?|\n/g);const i=t?rC:iC,r=e*100;return s=>T$t(s,r,i)}function xQ({monospace:t,lineWidth:e,textOverflow:n}){if(n==null||e==1/0)return s=>s;const i=t?rC:iC,r=e*100;switch(n){case"clip-start":return s=>t7(s,r,i,"");case"clip-end":return s=>ZB(s,r,i,"");case"ellipsis-start":return s=>t7(s,r,i,ag);case"ellipsis-middle":return s=>k$t(s,r,i,ag);case"ellipsis-end":return s=>ZB(s,r,i,ag)}}const ag="…";function Pg(t,e,n,i){const r=[];let s=0;for(let o=0,a=0,u=t.length;o<u;o=a){a=Dm(t,o);const c=n(t,o,a);if(s+c>e){for(s+=i;s>e&&o>0;)a=o,o=r.pop(),s-=n(t,o,a);return[o,e-s]}s+=c,r.push(o)}return[-1,0]}function ZB(t,e,n,i){t=t.trim();const r=n(i),[s]=Pg(t,e,n,r);return s<0?t:t.slice(0,s).trimEnd()+i}function k$t(t,e,n,i){t=t.trim();const r=n(t);if(r<=e)return t;const s=n(i)/2,[o,a]=Pg(t,e/2,n,s),[u]=Pg(t,r-e/2-a+s,n,-s);return u<0?i:t.slice(0,o).trimEnd()+i+t.slice(Dm(t,u)).trimStart()}function t7(t,e,n,i){t=t.trim();const r=n(t);if(r<=e)return t;const s=n(i),[o]=Pg(t,r-e+s,n,-s);return o<0?i:i+t.slice(Dm(t,o)).trimStart()}const PT=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,e7=new RegExp("\\p{Extended_Pictographic}","uy");function Dm(t,e){return e+=D$t(t,e)?2:1,N$t(t,e)&&(e=PT.lastIndex),C$t(t,e)?Dm(t,e+1):e}function SQ(t,e){return t.charCodeAt(e)<128}function D$t(t,e){const n=t.charCodeAt(e);if(n>=55296&&n<56320){const i=t.charCodeAt(e+1);return i>=56320&&i<57344}return!1}function C$t(t,e){return t.charCodeAt(e)===8205}function N$t(t,e){return SQ(t,e)?!1:(PT.lastIndex=e,PT.test(t))}function EQ(t,e){return SQ(t,e)?!1:(e7.lastIndex=e,e7.test(t))}const AQ={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},$Q=3.5,O$t=$Q*5,IQ={draw(t,e,n){const i=e*n/O$t;t.moveTo(0,0),t.lineTo(0,-e),t.moveTo(-i,i-e),t.lineTo(0,-e),t.lineTo(i,i-e)}},MQ={draw(t,e,n){t.moveTo(-n,0),t.lineTo(0,-e),t.lineTo(n,0)}},R$t=new Map([["arrow",IQ],["spike",MQ]]);function L$t(t){return t&&typeof t.draw=="function"}function B$t(t){if(L$t(t))return t;const e=R$t.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid shape: ${t}`)}class VE extends Ve{constructor(e,n={}){const{x:i,y:r,r:s=$Q,length:o,rotate:a,shape:u=IQ,anchor:c="middle",frameAnchor:l}=n,[f,d]=In(o,12),[h,p]=In(a,0);super(e,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},length:{value:f,scale:"length",optional:!0},rotate:{value:h,optional:!0}},n,AQ),this.r=+s,this.length=d,this.rotate=p,this.shape=B$t(u),this.anchor=hs(c,"anchor",["start","middle","end"]),this.frameAnchor=Mb(l)}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y:c,length:l,rotate:f}=i,{length:d,rotate:h,anchor:p,shape:g,r:m}=this,[y,b]=Qa(this,r);return ve("svg:g",s).call(un,this,r,s).call(qe,this,{x:u&&o,y:c&&a}).call(v=>v.selectAll().data(e).enter().append("path").call(en,this).attr("transform",jE`translate(${u?w=>u[w]:y},${c?w=>c[w]:b})${f?w=>` rotate(${f[w]})`:h?` rotate(${h})`:""}${p==="start"?"":p==="end"?l?w=>` translate(0,${l[w]})`:` translate(0,${d})`:l?w=>` translate(0,${l[w]/2})`:` translate(0,${d/2})`}`).attr("d",l?w=>{const _=Vu();return g.draw(_,l[w],m),_}:(()=>{const w=Vu();return g.draw(w,d,m),w})()).call(Gn,this,i)).node()}}function TQ(t,e={}){let{x:n,y:i,...r}=e;return e.frameAnchor===void 0&&([n,i]=Lo(n,i)),new VE(t,{...r,x:n,y:i})}function FQ(t,e={}){const{x:n=Ot,...i}=e;return new VE(t,{...i,x:n})}function kQ(t,e={}){const{y:n=Ot,...i}=e;return new VE(t,{...i,y:n})}function P$t(t,e={}){const{shape:n=MQ,stroke:i=AQ.stroke,strokeWidth:r=1,fill:s=i,fillOpacity:o=.3,anchor:a="start",...u}=e;return TQ(t,{...u,shape:n,stroke:i,strokeWidth:r,fill:s,fillOpacity:o,anchor:a})}function hf(t,e){return arguments.length<2&&!xc(t)&&(e=t,t=null),e===void 0&&(e={}),[t,e]}function WE({anchor:t}={},e){return t===void 0?e[0]:hs(t,"anchor",e)}function DQ(t){return WE(t,["left","right"])}function CQ(t){return WE(t,["right","left"])}function NQ(t){return WE(t,["bottom","top"])}function OQ(t){return WE(t,["top","bottom"])}function sC(){const[t,e]=hf(...arguments);return BQ("y",DQ(e),t,e)}function RQ(){const[t,e]=hf(...arguments);return BQ("fy",CQ(e),t,e)}function oC(){const[t,e]=hf(...arguments);return PQ("x",NQ(e),t,e)}function LQ(){const[t,e]=hf(...arguments);return PQ("fx",OQ(e),t,e)}function BQ(t,e,n,{color:i="currentColor",opacity:r=1,stroke:s=i,strokeOpacity:o=r,strokeWidth:a=1,fill:u=i,fillOpacity:c=r,textAnchor:l,textStroke:f,textStrokeOpacity:d,textStrokeWidth:h,tickSize:p=t==="y"?6:0,tickPadding:g,tickRotate:m,x:y,margin:b,marginTop:v=b===void 0?20:b,marginRight:w=b===void 0?e==="right"?40:0:b,marginBottom:_=b===void 0?20:b,marginLeft:S=b===void 0?e==="left"?40:0:b,label:x,labelAnchor:E,labelArrow:A,labelOffset:$,...I}){return p=de(p),g=de(g),m=de(m),E!==void 0&&(E=hs(E,"labelAnchor",["center","top","bottom"])),A=JQ(A),qs(p&&!sn(s)?z$t(t,e,n,{stroke:s,strokeOpacity:o,strokeWidth:a,tickSize:p,tickPadding:g,tickRotate:m,x:y,...I}):null,sn(u)?null:j$t(t,e,n,{fill:u,fillOpacity:c,stroke:f,strokeOpacity:d,strokeWidth:h,textAnchor:l,tickSize:p,tickPadding:g,tickRotate:m,x:y,marginTop:v,marginRight:w,marginBottom:_,marginLeft:S,...I}),!sn(u)&&x!==null?Bg([],YQ({fill:u,fillOpacity:c,...I},function(k,T,M,F,D){const N=F[t],{marginTop:R,marginRight:L,marginBottom:B,marginLeft:P}=t==="y"&&D.inset||D,U=E??(N.bandwidth?"center":"top"),H=$??(e==="right"?L:P)-3;return U==="center"?(this.textAnchor=void 0,this.lineAnchor=e==="right"?"bottom":"top",this.frameAnchor=e,this.rotate=-90):(this.textAnchor=e==="right"?"end":"start",this.lineAnchor=U,this.frameAnchor=`${U}-${e}`,this.rotate=0),this.dy=U==="top"?3-R:U==="bottom"?B-3:0,this.dx=e==="right"?H:-H,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[KQ(t,N,{anchor:e,label:x,labelAnchor:U,labelArrow:A})]}}}})):null)}function PQ(t,e,n,{color:i="currentColor",opacity:r=1,stroke:s=i,strokeOpacity:o=r,strokeWidth:a=1,fill:u=i,fillOpacity:c=r,textAnchor:l,textStroke:f,textStrokeOpacity:d,textStrokeWidth:h,tickSize:p=t==="x"?6:0,tickPadding:g,tickRotate:m,y,margin:b,marginTop:v=b===void 0?e==="top"?30:0:b,marginRight:w=b===void 0?20:b,marginBottom:_=b===void 0?e==="bottom"?30:0:b,marginLeft:S=b===void 0?20:b,label:x,labelAnchor:E,labelArrow:A,labelOffset:$,...I}){return p=de(p),g=de(g),m=de(m),E!==void 0&&(E=hs(E,"labelAnchor",["center","left","right"])),A=JQ(A),qs(p&&!sn(s)?U$t(t,e,n,{stroke:s,strokeOpacity:o,strokeWidth:a,tickSize:p,tickPadding:g,tickRotate:m,y,...I}):null,sn(u)?null:q$t(t,e,n,{fill:u,fillOpacity:c,stroke:f,strokeOpacity:d,strokeWidth:h,textAnchor:l,tickSize:p,tickPadding:g,tickRotate:m,y,marginTop:v,marginRight:w,marginBottom:_,marginLeft:S,...I}),!sn(u)&&x!==null?Bg([],YQ({fill:u,fillOpacity:c,...I},function(k,T,M,F,D){const N=F[t],{marginTop:R,marginRight:L,marginBottom:B,marginLeft:P}=t==="x"&&D.inset||D,U=E??(N.bandwidth?"center":"right"),H=$??(e==="top"?R:B)-3;return U==="center"?(this.frameAnchor=e,this.textAnchor=void 0):(this.frameAnchor=`${e}-${U}`,this.textAnchor=U==="right"?"end":"start"),this.lineAnchor=e,this.dy=e==="top"?-H:H,this.dx=U==="right"?L-3:U==="left"?3-P:0,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[KQ(t,N,{anchor:e,label:x,labelAnchor:U,labelArrow:A})]}}}})):null)}function z$t(t,e,n,{strokeWidth:i=1,strokeLinecap:r=null,strokeLinejoin:s=null,facetAnchor:o=e+(t==="y"?"-empty":""),frameAnchor:a=e,tickSize:u,inset:c=0,insetLeft:l=c,insetRight:f=c,dx:d=0,y:h=t==="y"?void 0:null,...p}){return Cm(kQ,t,n,{ariaLabel:`${t}-axis tick`,ariaHidden:!0},{strokeWidth:i,strokeLinecap:r,strokeLinejoin:s,facetAnchor:o,frameAnchor:a,y:h,...p,dx:e==="left"?+d-hi+ +l:+d+hi-f,anchor:"start",length:u,shape:e==="left"?Y$t:H$t})}function U$t(t,e,n,{strokeWidth:i=1,strokeLinecap:r=null,strokeLinejoin:s=null,facetAnchor:o=e+(t==="x"?"-empty":""),frameAnchor:a=e,tickSize:u,inset:c=0,insetTop:l=c,insetBottom:f=c,dy:d=0,x:h=t==="x"?void 0:null,...p}){return Cm(FQ,t,n,{ariaLabel:`${t}-axis tick`,ariaHidden:!0},{strokeWidth:i,strokeLinejoin:s,strokeLinecap:r,facetAnchor:o,frameAnchor:a,x:h,...p,dy:e==="bottom"?+d-hi-f:+d+hi+ +l,anchor:"start",length:u,shape:e==="bottom"?W$t:G$t})}function j$t(t,e,n,{facetAnchor:i=e+(t==="y"?"-empty":""),frameAnchor:r=e,tickSize:s,tickRotate:o=0,tickPadding:a=Math.max(3,9-s)+(Math.abs(o)>60?4*Math.cos(o*Ox):0),text:u,textAnchor:c=Math.abs(o)>60?"middle":e==="left"?"end":"start",lineAnchor:l=o>60?"top":o<-60?"bottom":"middle",fontVariant:f,inset:d=0,insetLeft:h=d,insetRight:p=d,dx:g=0,y:m=t==="y"?void 0:null,...y}){return Cm(vQ,t,n,{ariaLabel:`${t}-axis tick label`},{facetAnchor:i,frameAnchor:r,text:u,textAnchor:c,lineAnchor:l,fontVariant:f,rotate:o,y:m,...y,dx:e==="left"?+g-s-a+ +h:+g+ +s+ +a-p},function(b,v,w,_,S){f===void 0&&(this.fontVariant=XQ(b)),u===void 0&&(S.text=HQ(b,v,w,_,e))})}function q$t(t,e,n,{facetAnchor:i=e+(t==="x"?"-empty":""),frameAnchor:r=e,tickSize:s,tickRotate:o=0,tickPadding:a=Math.max(3,9-s)+(Math.abs(o)>=10?4*Math.cos(o*Ox):0),text:u,textAnchor:c=Math.abs(o)>=10?o<0^e==="bottom"?"start":"end":"middle",lineAnchor:l=Math.abs(o)>=10?"middle":e==="bottom"?"top":"bottom",fontVariant:f,inset:d=0,insetTop:h=d,insetBottom:p=d,dy:g=0,x:m=t==="x"?void 0:null,...y}){return Cm(bQ,t,n,{ariaLabel:`${t}-axis tick label`},{facetAnchor:i,frameAnchor:r,text:u===void 0?null:u,textAnchor:c,lineAnchor:l,fontVariant:f,rotate:o,x:m,...y,dy:e==="bottom"?+g+ +s+ +a-p:+g-s-a+ +h},function(b,v,w,_,S){f===void 0&&(this.fontVariant=XQ(b)),u===void 0&&(S.text=HQ(b,v,w,_,e))})}function zQ(){const[t,e]=hf(...arguments);return VQ("y",DQ(e),t,e)}function UQ(){const[t,e]=hf(...arguments);return VQ("fy",CQ(e),t,e)}function jQ(){const[t,e]=hf(...arguments);return WQ("x",NQ(e),t,e)}function qQ(){const[t,e]=hf(...arguments);return WQ("fx",OQ(e),t,e)}function VQ(t,e,n,{y:i=t==="y"?void 0:null,x:r=null,x1:s=e==="left"?r:null,x2:o=e==="right"?r:null,...a}){return Cm(Ul,t,n,{ariaLabel:`${t}-grid`,ariaHidden:!0},{y:i,x1:s,x2:o,...GQ(a)})}function WQ(t,e,n,{x:i=t==="x"?void 0:null,y:r=null,y1:s=e==="top"?r:null,y2:o=e==="bottom"?r:null,...a}){return Cm(zl,t,n,{ariaLabel:`${t}-grid`,ariaHidden:!0},{x:i,y1:s,y2:o,...GQ(a)})}function GQ({color:t="currentColor",opacity:e=.1,stroke:n=t,strokeOpacity:i=e,strokeWidth:r=1,...s}){return{stroke:n,strokeOpacity:i,strokeWidth:r,...s}}function YQ({fill:t,fillOpacity:e,fontFamily:n,fontSize:i,fontStyle:r,fontVariant:s,fontWeight:o,monospace:a,pointerEvents:u,shapeRendering:c,clip:l=!1},f){return[,t]=ar(t),[,e]=In(e),{facet:"super",x:null,y:null,fill:t,fillOpacity:e,fontFamily:n,fontSize:i,fontStyle:r,fontVariant:s,fontWeight:o,monospace:a,pointerEvents:u,shapeRendering:c,clip:l,initializer:f}}function Cm(t,e,n,i,r,s){let o;function a(l,f,d,h,p,g){const m=l==null&&(e==="fx"||e==="fy"),{[e]:y}=h;if(!y)throw new Error(`missing scale: ${e}`);const b=y.domain();let{interval:v,ticks:w,tickFormat:_,tickSpacing:S=e==="x"?80:35}=r;if(typeof w=="string"&&QQ(y)&&(v=w,w=void 0),w===void 0&&(w=Tm(v,y.type)??V$t(y,S)),l==null){if(xc(w))l=Rr(w);else if(Rp(w))l=ZI(w,...zn(b));else if(y.interval){let E=y.interval;if(y.ticks){const[A,$]=zn(b),I=($-A)/E[$b];E=MB(E,I/w)??E,l=ZI(E,A,$)}else{l=b;const A=l.length;E=MB(E,A/w)??E,E!==y.interval&&(l=ZI(E,...zn(l)))}if(E===y.interval){const A=Math.round(l.length/w);A>1&&(l=l.filter(($,I)=>I%A===0))}}else y.ticks?l=y.ticks(w):l=b;if(!y.ticks&&l.length&&l!==b){const E=new oc(b);l=l.filter(A=>E.has(A)),l.length||Ju(`Warning: the ${e}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}e==="y"||e==="x"?f=[_c(l)]:o[e]={scale:e,value:Ot}}s==null||s.call(this,y,l,w,_,o);const x=Object.fromEntries(Object.entries(o).map(([E,A])=>[E,{...A,value:ue(l,A.value)}]));return m&&(f=g.filterFacets(l,x)),{data:l,facets:f,channels:x}}const u=Lr(r).initializer,c=t(n,Lr({...r,initializer:a},u));return n==null?(o=c.channels,c.channels={}):o={},i!==void 0&&Object.assign(c,i),c.clip===void 0&&(c.clip=!1),c}function V$t(t,e){const[n,i]=zn(t.range());return(i-n)/e}function HQ(t,e,n,i,r){return{value:aC(t,e,n,i,r)}}function aC(t,e,n,i,r){return typeof i=="function"?i:i===void 0&&e&&ur(e)?iEt(t.type,e,r)??Qd:t.tickFormat?t.tickFormat(typeof n=="number"?n:null,i):i===void 0?Qd:typeof i=="string"?(ur(t.domain())?Im:vh)(i):as(i)}function ZI(t,e,n){return t.range(e,t.offset(t.floor(n)))}const W$t={draw(t,e){t.moveTo(0,0),t.lineTo(0,e)}},G$t={draw(t,e){t.moveTo(0,0),t.lineTo(0,-e)}},Y$t={draw(t,e){t.moveTo(0,0),t.lineTo(-e,0)}},H$t={draw(t,e){t.moveTo(0,0),t.lineTo(e,0)}};function XQ(t){return t.bandwidth&&!t.interval?void 0:"tabular-nums"}function KQ(t,e,{anchor:n,label:i=e.label,labelAnchor:r,labelArrow:s}={}){if(!(i==null||i.inferred&&QQ(e)&&/^(date|time|year)$/i.test(i))){if(i=String(i),s==="auto"&&(s=(!e.bandwidth||e.interval)&&!/[↑↓→←]/.test(i)),!s)return i;if(s===!0){const o=jJ(e);o&&(s=/x$/.test(t)||r==="center"?/x$/.test(t)===o<0?"left":"right":o<0?"up":"down")}switch(s){case"left":return`← ${i}`;case"right":return`${i} →`;case"up":return n==="right"?`${i} ↑`:`↑ ${i}`;case"down":return n==="right"?`${i} ↓`:`↓ ${i}`}return i}}function JQ(t="auto"){return sn(t)?!1:typeof t=="boolean"?t:hs(t,"labelArrow",["auto","up","right","down","left"])}function QQ(t){return ur(t.domain())}function n7(t,e){if(e==null)return e;const n=t(e);if(!n)throw new Error(`scale not found: ${e}`);return n}function X$t(t,{opacity:e,...n}={}){if(!Sh(t)&&!YJ(t))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${t.type})`);return ZQ(t,n,(i,r,s,o)=>i.append("svg").attr("width",s).attr("height",o).attr("fill",r.scale).attr("fill-opacity",In(e)[1]).append("rect").attr("width","100%").attr("height","100%"))}function K$t(t,{fill:e=(c=>(c=t.hint)==null?void 0:c.fill)()!==void 0?t.hint.fill:"none",fillOpacity:n=1,stroke:i=(l=>(l=t.hint)==null?void 0:l.stroke)()!==void 0?t.hint.stroke:sn(e)?"currentColor":"none",strokeOpacity:r=1,strokeWidth:s=1.5,r:o=4.5,...a}={},u){const[f,d]=ar(e),[h,p]=ar(i),g=n7(u,f),m=n7(u,h),y=o*o*Math.PI;return n=In(n)[1],r=In(r)[1],s=In(s)[1],ZQ(t,a,(b,v,w,_)=>b.append("svg").attr("viewBox","-8 -8 16 16").attr("width",w).attr("height",_).attr("fill",f==="color"?S=>g.scale(S):d).attr("fill-opacity",n).attr("stroke",h==="color"?S=>m.scale(S):p).attr("stroke-opacity",r).attr("stroke-width",s).append("path").attr("d",S=>{const x=Vu();return t.scale(S).draw(x,y),x}))}function ZQ(t,e={},n){let{columns:i,tickFormat:r,fontVariant:s=eQ(t),swatchSize:o=15,swatchWidth:a=o,swatchHeight:u=o,marginLeft:c=0,className:l,style:f,width:d}=e;const h=RE(e);l=J6(l),r=aC(t.scale,t.domain,void 0,r);const p=ve("div",h).attr("class",`${l}-swatches ${l}-swatches-${i!=null?"columns":"wrap"}`);let g;return i!=null?(g=`:where(.${l}-swatches-columns .${l}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${l}-swatches-columns .${l}-swatch::before) {
  flex-shrink: 0;
}
:where(.${l}-swatches-columns .${l}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,p.style("columns",i).selectAll().data(t.domain).enter().append("div").attr("class",`${l}-swatch`).call(n,t,a,u).call(m=>m.append("div").attr("class",`${l}-swatch-label`).attr("title",r).text(r))):(g=`:where(.${l}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${l}-swatches-wrap .${l}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,p.selectAll().data(t.domain).enter().append("span").attr("class",`${l}-swatch`).call(n,t,a,u).append(function(){return this.ownerDocument.createTextNode(r.apply(this,arguments))})),p.call(m=>m.insert("style","*").text(`:where(.${l}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${l}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${g}`)).style("margin-left",c?`${+c}px`:null).style("width",d===void 0?null:`${+d}px`).style("font-variant",bn(s,"normal")).call(Q6,f).node()}const Rx=new Map([["symbol",K$t],["color",tZ],["opacity",Z$t]]);function J$t(t={}){for(const[e,n]of Rx){const i=t[e];if(Md(i)){const r=RE(t);let s;if(e==="symbol"){const{fill:o,stroke:a=o===void 0&&Md(t.color)?"color":void 0}=t;s={fill:o,stroke:a}}return n(RT(e,i,s),uC(r,i,t),o=>Md(t[o])?RT(o,t[o]):null)}}throw new Error("unknown legend type; no scale found")}function Q$t(t,e,n={}){return(i,r)=>{if(!Rx.has(i))throw new Error(`unknown legend type: ${i}`);if(i in t)return Rx.get(i)(t[i],uC(e,n[i],r),s=>t[s])}}function uC({className:t,...e},{label:n,ticks:i,tickFormat:r}={},s){return vEt(s,{className:t,...e},{label:n,ticks:i,tickFormat:r})}function tZ(t,{legend:e=!0,...n}){if(e===!0&&(e=t.type==="ordinal"?"swatches":"ramp"),t.domain!==void 0)switch(`${e}`.toLowerCase()){case"swatches":return X$t(t,n);case"ramp":return v$t(t,n);default:throw new Error(`unknown legend type: ${e}`)}}function Z$t({type:t,interpolate:e,...n},{legend:i=!0,color:r=Nr(0,0,0),...s}){if(!e)throw new Error(`${t} opacity scales are not supported`);if(i===!0&&(i="ramp"),`${i}`.toLowerCase()!=="ramp")throw new Error(`${i} opacity legends are not supported`);return tZ({type:t,...n,interpolate:tIt(r)},{legend:i,...s})}function tIt(t){const{r:e,g:n,b:i}=Nr(t)||Nr(0,0,0);return r=>`rgba(${e},${n},${i},${r})`}function eIt(t,e,n){const i=[];for(const[r,s]of Rx){const o=n[r];if(o!=null&&o.legend&&r in t){const a=s(t[r],uC(e,t[r],o),u=>t[u]);a!=null&&i.push(a)}}return i}const nIt={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},iIt={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1};class eZ extends Ve{constructor(e={}){const{anchor:n=null,inset:i=0,insetTop:r=i,insetRight:s=i,insetBottom:o=i,insetLeft:a=i,rx:u,ry:c}=e;super(Oy,void 0,e,n==null?nIt:iIt),this.anchor=iJ(n,"anchor",["top","right","bottom","left"]),this.insetTop=de(r),this.insetRight=de(s),this.insetBottom=de(o),this.insetLeft=de(a),this.rx=de(u),this.ry=de(c)}render(e,n,i,r,s){const{marginTop:o,marginRight:a,marginBottom:u,marginLeft:c,width:l,height:f}=r,{anchor:d,insetTop:h,insetRight:p,insetBottom:g,insetLeft:m,rx:y,ry:b}=this,v=c+m,w=l-a-p,_=o+h,S=f-u-g;return ve(d?"svg:line":"svg:rect",s).datum(0).call(un,this,r,s).call(en,this).call(Gn,this,i).call(qe,this,{}).call(d==="left"?x=>x.attr("x1",v).attr("x2",v).attr("y1",_).attr("y2",S):d==="right"?x=>x.attr("x1",w).attr("x2",w).attr("y1",_).attr("y2",S):d==="top"?x=>x.attr("x1",v).attr("x2",w).attr("y1",_).attr("y2",_):d==="bottom"?x=>x.attr("x1",v).attr("x2",w).attr("y1",S).attr("y2",S):x=>x.attr("x",v).attr("y",_).attr("width",w-v).attr("height",S-_).attr("rx",y).attr("ry",b)).node()}}function cC(t){return new eZ(t)}const t3={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},rIt=new Set(["geometry","href","src","ariaLabel","scales"]);class nZ extends Ve{constructor(e,n={}){n.tip&&(n={...n,tip:!1}),n.title===void 0&&xc(e)&&cJ(e)&&(n={...n,title:Ot});const{x:i,y:r,x1:s,x2:o,y1:a,y2:u,anchor:c,preferredAnchor:l="bottom",monospace:f,fontFamily:d=f?"ui-monospace, monospace":void 0,fontSize:h,fontStyle:p,fontVariant:g,fontWeight:m,lineHeight:y=1,lineWidth:b=20,frameAnchor:v,format:w,textAnchor:_="start",textOverflow:S,textPadding:x=8,title:E,pointerSize:A=12,pathFilter:$="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=n;super(e,{x:{value:s!=null&&o!=null?null:i,scale:"x",optional:!0},y:{value:a!=null&&u!=null?null:r,scale:"y",optional:!0},x1:{value:s,scale:"x",optional:o==null},y1:{value:a,scale:"y",optional:u==null},x2:{value:o,scale:"x",optional:s==null},y2:{value:u,scale:"y",optional:a==null},title:{value:E,optional:!0}},n,t3),this.anchor=FT(c,"anchor"),this.preferredAnchor=FT(l,"preferredAnchor"),this.frameAnchor=Mb(v),this.textAnchor=bn(_,"middle"),this.textPadding=+x,this.pointerSize=+A,this.pathFilter=Ii($),this.lineHeight=+y,this.lineWidth=+b,this.textOverflow=yQ(S),this.monospace=!!f,this.fontFamily=Ii(d),this.fontSize=de(h),this.fontStyle=Ii(p),this.fontVariant=Ii(g),this.fontWeight=Ii(m);for(const I in t3)I in this.channels&&(this[I]=t3[I]);this.splitLines=_Q(this),this.clipLine=xQ(this),this.format={...w}}render(e,n,i,r,s){const o=this,{x:a,y:u,fx:c,fy:l}=n,{ownerSVGElement:f,document:d}=s,{anchor:h,monospace:p,lineHeight:g,lineWidth:m}=this,{textPadding:y,pointerSize:b,pathFilter:v}=this,{marginTop:w,marginLeft:_}=r,{x1:S,y1:x,x2:E,y2:A,x:$=S??E,y:I=x??A}=i,k=c?c(e.fx)-_:0,T=l?l(e.fy)-w:0,[M,F]=Qa(this,r),D=ZJ(i,M),N=tQ(i,F),R=p?rC:iC,L=R(ag);let B,P;"title"in i?(B=i.channels,P=cIt):(B=uIt.call(this,i,n),P=lIt);const U=ve("svg:g",s).call(un,this,r,s).call(wQ,this).call(qe,this,{x:$&&a,y:I&&u}).call(ft=>ft.selectAll().data(e).enter().append("g").attr("transform",dt=>`translate(${Math.round(D(dt))},${Math.round(N(dt))})`).call(en,this).call(dt=>dt.append("path").attr("filter",v)).call(dt=>dt.append("text").each(function(et){const ct=fi(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");const G=P.call(o,et,e,B,n,i);if(typeof G=="string")for(const st of o.splitLines(G))H(ct,{value:o.clipLine(st)});else{const st=new Set;for(const lt of G){const{label:V=""}=lt;V&&st.has(V)||(st.add(V),H(ct,lt))}}})));function H(ft,{label:dt,value:et,color:ct,opacity:G}){dt??(dt=""),et??(et="");const st=ct!=null||G!=null;let lt,V=m*100;const[Vt]=Pg(dt,V,R,L);if(Vt>=0)dt=dt.slice(0,Vt).trimEnd()+ag,lt=et.trim(),et="";else{(dt||!et&&!st)&&(et=" "+et);const[ee]=Pg(et,V-R(dt),R,L);ee>=0&&(lt=et.trim(),et=et.slice(0,ee).trimEnd()+ag)}const mt=ft.append("tspan").attr("x",0).attr("dy",`${g}em`).text("​");dt&&mt.append("tspan").attr("font-weight","bold").text(dt),et&&mt.append(()=>d.createTextNode(et)),st&&mt.append("tspan").text(" ■").attr("fill",ct).attr("fill-opacity",G).style("user-select","none"),lt&&mt.append("title").text(lt)}function nt(){const{width:ft,height:dt}=r.facet??r;U.selectChildren().each(function(et){let{x:ct,width:G,height:st}=this.getBBox();G=Math.round(G),st=Math.round(st);let lt=h;if(lt===void 0){const mt=D(et)+k,ee=N(et)+T,oe=mt+G+b+y*2<ft,ht=mt-G-b-y*2>0,$e=ee+st+b+y*2<dt,Wr=ee-st-b-y*2>0;lt=oe&&ht?$e&&Wr?o.preferredAnchor:Wr?"bottom":"top":$e&&Wr?oe?"left":"right":(oe||ht)&&($e||Wr)?`${Wr?"bottom":"top"}-${oe?"left":"right"}`:o.preferredAnchor}const V=this.firstChild,Vt=this.lastChild;if(V.setAttribute("d",aIt(lt,b,y,G,st)),ct)for(const mt of Vt.childNodes)mt.setAttribute("x",-ct);Vt.setAttribute("y",`${+sIt(lt,Vt.childNodes.length,g).toFixed(6)}em`),Vt.setAttribute("transform",`translate(${oIt(lt,b,y,G,st)})`)}),U.attr("visibility",null)}return e.length&&(U.attr("visibility","hidden"),f.isConnected?Promise.resolve().then(nt):typeof requestAnimationFrame<"u"&&requestAnimationFrame(nt)),U.node()}}function iZ(t,{x:e,y:n,...i}={}){return i.frameAnchor===void 0&&([e,n]=Lo(e,n)),new nZ(t,{...i,x:e,y:n})}function sIt(t,e,n){return/^top(?:-|$)/.test(t)?.94-n:-.29-e*n}function oIt(t,e,n,i,r){switch(t){case"middle":return[-i/2,r/2];case"top-left":return[n,e+n];case"top":return[-i/2,e/2+n];case"top-right":return[-i-n,e+n];case"right":return[-e/2-i-n,r/2];case"bottom-left":return[n,-e-n];case"bottom":return[-i/2,-e/2-n];case"bottom-right":return[-i-n,-e-n];case"left":return[n+e/2,r/2]}}function aIt(t,e,n,i,r){const s=i+n*2,o=r+n*2;switch(t){case"middle":return`M${-s/2},${-o/2}h${s}v${o}h${-s}z`;case"top-left":return`M0,0l${e},${e}h${s-e}v${o}h${-s}z`;case"top":return`M0,0l${e/2},${e/2}h${(s-e)/2}v${o}h${-s}v${-o}h${(s-e)/2}z`;case"top-right":return`M0,0l${-e},${e}h${e-s}v${o}h${s}z`;case"right":return`M0,0l${-e/2},${-e/2}v${e/2-o/2}h${-s}v${o}h${s}v${e/2-o/2}z`;case"bottom-left":return`M0,0l${e},${-e}h${s-e}v${-o}h${-s}z`;case"bottom":return`M0,0l${e/2},${-e/2}h${(s-e)/2}v${-o}h${-s}v${o}h${(s-e)/2}z`;case"bottom-right":return`M0,0l${-e},${-e}h${e-s}v${-o}h${s}z`;case"left":return`M0,0l${e/2},${-e/2}v${e/2-o/2}h${s}v${o}h${-s}v${e/2-o/2}z`}}function uIt({channels:t},e){var r,s;const n={};let i=this.format;i=i7(i,t,"x"),i=i7(i,t,"y"),this.format=i;for(const o in i){const a=i[o];if(!(a===null||a===!1))if(o==="fx"||o==="fy")n[o]=!0;else{const u=DT(t,o);u&&(n[o]=u)}}for(const o in t){if(o in n||o in i||rIt.has(o))continue;const a=DT(t,o);a&&(n[o]=a)}this.facet&&(e.fx&&!("fx"in i)&&(n.fx=!0),e.fy&&!("fy"in i)&&(n.fy=!0));for(const o in n){const a=this.format[o];if(typeof a=="string"){const u=((r=n[o])==null?void 0:r.value)??((s=e[o])==null?void 0:s.domain())??[];this.format[o]=(ur(u)?Im:vh)(a)}else if(a===void 0||a===!0){const u=e[o];this.format[o]=u!=null&&u.bandwidth?aC(u,u.domain()):Qd}}return n}function i7(t,e,n){if(!(n in t))return t;const i=`${n}1`,r=`${n}2`;if((i in t||!(i in e))&&(r in t||!(r in e)))return t;const s=Object.entries(t),o=t[n];return s.splice(s.findIndex(([a])=>a===n)+1,0,[i,o],[r,o]),Object.fromEntries(s)}function cIt(t,e,{title:n}){return Qd(n.value[t],t)}function*lIt(t,e,n,i,r){for(const s in n){if(s==="fx"||s==="fy"){yield{label:Lx(i,n,s),value:this.format[s](e[s],t)};continue}if(s==="x1"&&"x2"in n||s==="y1"&&"y2"in n)continue;const o=n[s];if(s==="x2"&&"x1"in n)yield{label:s7(i,n,"x"),value:r7(this.format.x2,n.x1,o,t)};else if(s==="y2"&&"y1"in n)yield{label:s7(i,n,"y"),value:r7(this.format.y2,n.y1,o,t)};else{const a=o.value[t],u=o.scale;if(!tr(a)&&u==null)continue;yield{label:Lx(i,n,s),value:this.format[s](a,t),color:u==="color"?r[s][t]:null,opacity:u==="opacity"?r[s][t]:null}}}}function r7(t,e,n,i){var r;return(r=n.hint)!=null&&r.length?`${t(n.value[i]-e.value[i],i)}`:`${t(e.value[i],i)}–${t(n.value[i],i)}`}function s7(t,e,n){const i=Lx(t,e,`${n}1`,n),r=Lx(t,e,`${n}2`,n);return i===r?i:`${i}–${r}`}function Lx(t,e,n,i=n){const r=e[n],s=t[(r==null?void 0:r.scale)??n];return String((s==null?void 0:s.label)??(r==null?void 0:r.label)??i)}function lC(t={}){var L;const{facet:e,style:n,title:i,subtitle:r,caption:s,ariaLabel:o,ariaDescription:a}=t,u=J6(t.className),c=t.marks===void 0?[]:a7(t.marks);c.push(...bIt(c));const l=mIt(e,t),f=new Map;for(const B of c){const P=u7(B,l,t);P&&f.set(B,P)}const d=new Map;l&&m0(d,[l],t),m0(d,f,t);const h=a7(vIt(c,d,t));for(const B of h){const P=u7(B,l,t);P&&f.set(B,P)}c.unshift(...h);let p=s$t(d,t);if(p!==void 0){const B=l?KI(p,l):void 0;for(const U of c){if(U.facet===null||U.facet==="super")continue;const H=f.get(U);H!==void 0&&(H.facetsIndex=U.fx!=null||U.fy!=null?KI(p,H):B)}const P=new Set;for(const{facetsIndex:U}of f.values())U==null||U.forEach((H,nt)=>{(H==null?void 0:H.length)>0&&P.add(nt)});p.forEach(0<P.size&&P.size<p.length?(U,H)=>U.empty=!P.has(H):U=>U.empty=!1);for(const U of c)if(U.facet==="exclude"){const H=f.get(U);H!==void 0&&(H.facetsIndex=u$t(H.facetsIndex))}}for(const B of gn.keys())Md(t[B])&&B!=="fx"&&B!=="fy"&&d.set(B,[]);const g=new Map;for(const B of c){if(g.has(B))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:P,channels:U}=f.get(B)??{},{data:H,facets:nt,channels:ft}=B.initialize(P,U,t);fC(ft,t),g.set(B,{data:H,facets:nt,channels:ft})}const m=OT(m0(d,g,t),t),y=i$t(m,c,t);CAt(m,y);const b=jB(m),{fx:v,fy:w}=b,_=v||w?qJ(m,y):y,S=v||w?$It(b,y):y,x=RE(t),E=x.document,A=tE("svg").call(E.documentElement);let $=A;x.ownerSVGElement=A,x.className=u,x.projection=YEt(t,_),x.filterFacets=(B,P)=>KI(p,{channels:P,groups:Z6(B,P)}),x.getMarkState=B=>{const P=g.get(B),U=f.get(B);return{...P,channels:{...P.channels,...U==null?void 0:U.channels}}},x.dispatchValue=B=>{$.value!==B&&($.value=B,$.dispatchEvent(new Event("input",{bubbles:!0})))};const I=new Set;for(const[B,P]of g)if(B.initializer!=null){const U=B.facet==="super"?S:_,H=B.initializer(P.data,P.facets,P.channels,b,U,x);if(H.data!==void 0&&(P.data=H.data),H.facets!==void 0&&(P.facets=H.facets),H.channels!==void 0){const{fx:nt,fy:ft,...dt}=H.channels;gIt(dt),Object.assign(P.channels,dt);for(const et of Object.values(dt)){const{scale:ct}=et;ct!=null&&!_Et(gn.get(ct))&&(rZ(et,t),I.add(ct))}(nt!=null||ft!=null)&&f.set(B,!0)}}if(I.size){const B=new Map;m0(B,g,t,nt=>I.has(nt)),m0(d,g,t,nt=>I.has(nt));const P=AIt(OT(B,t),m),{scales:U,...H}=jB(P);Object.assign(m,P),Object.assign(b,H),Object.assign(b.scales,U)}let k,T;p!==void 0&&(k={x:v==null?void 0:v.domain(),y:w==null?void 0:w.domain()},p=o$t(p,k),T=a$t(v,w,y));for(const[B,P]of g)P.values=B.scale(P.channels,b,x);const{width:M,height:F}=y;fi(A).attr("class",u).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",M).attr("height",F).attr("viewBox",`0 0 ${M} ${F}`).attr("aria-label",o).attr("aria-description",a).call(B=>B.append("style").text(`:where(.${u}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${u} text),
:where(.${u} tspan) {
  white-space: pre;
}`)).call(Q6,n);for(const B of c){const{channels:P,values:U,facets:H}=g.get(B);if(p===void 0||B.facet==="super"){let nt=null;if(H&&(nt=H[0],nt=B.filter(nt,P,U),nt.length===0))continue;const ft=B.render(nt,b,U,S,x);if(ft==null)continue;A.appendChild(ft)}else{let nt;for(const ft of p){if(!(((L=B.facetAnchor)==null?void 0:L.call(B,p,k,ft))??!ft.empty))continue;let dt=null;if(H){const ct=f.has(B);if(dt=H[ct?ft.i:0],dt=B.filter(dt,P,U),dt.length===0)continue;!ct&&dt===H[0]&&(dt=Td(dt)),dt.fx=ft.x,dt.fy=ft.y,dt.fi=ft.i}const et=B.render(dt,b,U,_,x);if(et!=null){(nt??(nt=fi(A).append("g"))).append(()=>et).datum(ft);for(const ct of["aria-label","aria-description","aria-hidden","transform"])et.hasAttribute(ct)&&(nt.attr(ct,et.getAttribute(ct)),et.removeAttribute(ct))}}nt==null||nt.selectChildren().attr("transform",T)}}const D=eIt(m,x,t),{figure:N=i!=null||r!=null||s!=null||D.length>0}=t;N&&($=E.createElement("figure"),$.className=`${u}-figure`,$.style.maxWidth="initial",i!=null&&$.append(o7(E,i,"h2")),r!=null&&$.append(o7(E,r,"h3")),$.append(...D,A),s!=null&&$.append(fIt(E,s))),$.scale=zAt(b.scales),$.legend=Q$t(m,x,t);const R=GEt();return R>0&&fi(A).append("text").attr("x",M).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("⚠️").append("title").text(`${R.toLocaleString("en-US")} warning${R===1?"":"s"}. Please check the console.`),$}function o7(t,e,n){if(e.ownerDocument)return e;const i=t.createElement(n);return i.append(e),i}function fIt(t,e){const n=t.createElement("figcaption");return n.append(e),n}function dIt({marks:t=[],...e}={}){return lC({...e,marks:[...t,this]})}Ve.prototype.plot=dIt;function a7(t){return t.flat(1/0).filter(e=>e!=null).map(hIt)}function hIt(t){return typeof t.render=="function"?t:new pIt(t)}let pIt=class extends Ve{constructor(e){if(typeof e!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=e}render(){}};function fC(t,e){for(const n in t)rZ(t[n],e);return t}function rZ(t,e){const{scale:n,transform:i=!0}=t;if(n==null||!i)return;const{type:r,percent:s,interval:o,transform:a=s?u=>u*100:uJ(o,r)}=e[n]??{};a!=null&&(t.value=He(t.value,a),t.transform=!1)}function gIt(t){for(const e in t)EJ(e,t[e])}function m0(t,e,n,i=aEt){var r,s;for(const{channels:o}of e.values())for(const a in o){const u=o[a],{scale:c}=u;if(c!=null&&i(c))if(c==="projection"){if(!KEt(n)){const l=((r=n.x)==null?void 0:r.domain)===void 0,f=((s=n.y)==null?void 0:s.domain)===void 0;if(l||f){const[d,h]=QEt(u);l&&e3(t,"x",d),f&&e3(t,"y",h)}}}else e3(t,c,u)}return t}function e3(t,e,n){const i=t.get(e);i!==void 0?i.push(n):t.set(e,[n])}function mIt(t,e){if(t==null)return;const{x:n,y:i}=t;if(n==null&&i==null)return;const r=Rr(t.data);if(r==null)throw new Error("missing facet data");const s={};n!=null&&(s.fx=I1(r,{value:n,scale:"fx"})),i!=null&&(s.fy=I1(r,{value:i,scale:"fy"})),fC(s,e);const o=Z6(r,s);return{channels:s,groups:o,data:t.data}}function u7(t,e,n){var u;if(t.facet===null||t.facet==="super")return;const{fx:i,fy:r}=t;if(i!=null||r!=null){const c=Rr(t.data??i??r);if(c===void 0)throw new Error(`missing facet data in ${t.ariaLabel}`);if(c===null)return;const l={};return i!=null&&(l.fx=I1(c,{value:i,scale:"fx"})),r!=null&&(l.fy=I1(c,{value:r,scale:"fy"})),fC(l,n),{channels:l,groups:Z6(c,l)}}if(e===void 0)return;const{channels:s,groups:o,data:a}=e;if(t.facet!=="auto"||t.data===a)return{channels:s,groups:o};a.length>0&&(o.size>1||o.size===1&&s.fx&&s.fy&&[...o][0][1].size>1)&&((u=Rr(t.data))==null?void 0:u.length)===a.length&&Ju(`Warning: the ${t.ariaLabel} mark appears to use faceted data, but isn’t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function yIt(t,e={}){return Lr({...e,x:null,y:null},(n,i,r,s,o,a)=>a.getMarkState(t))}function bIt(t){const e=[];for(const n of t){let i=n.tip;if(i){i===!0?i={}:typeof i=="string"&&(i={pointer:i});let{pointer:r,preferredAnchor:s}=i;r=/^x$/i.test(r)?nC:/^y$/i.test(r)?Nx:eC,i=r(yIt(n,i)),i.title=null,s===void 0&&(i.preferredAnchor=r===Nx?"left":"bottom");const o=iZ(n.data,i);o.facet=n.facet,o.facetAnchor=n.facetAnchor,e.push(o)}}return e}function vIt(t,e,n){let{projection:i,x:r={},y:s={},fx:o={},fy:a={},axis:u,grid:c,facet:l={},facet:{axis:f=u,grid:d}=l,x:{axis:h=u,grid:p=h===null?null:c}=r,y:{axis:g=u,grid:m=g===null?null:c}=s,fx:{axis:y=f,grid:b=y===null?null:d}=o,fy:{axis:v=f,grid:w=v===null?null:d}=a}=n;(i||!Md(r)&&!c7("x",t))&&(h=p=null),(i||!Md(s)&&!c7("y",t))&&(g=m=null),e.has("fx")||(y=b=null),e.has("fy")||(v=w=null),h===void 0&&(h=!Qv(t,"x")),g===void 0&&(g=!Qv(t,"y")),y===void 0&&(y=!Qv(t,"fx")),v===void 0&&(v=!Qv(t,"fy")),h===!0&&(h="bottom"),g===!0&&(g="left"),y===!0&&(y=h==="top"||h===null?"bottom":"top"),v===!0&&(v=g==="right"||g===null?"left":"right");const _=[];return Jv(_,w,UQ,a),Kv(_,v,RQ,"right","left",l,a),Jv(_,b,qQ,o),Kv(_,y,LQ,"top","bottom",l,o),Jv(_,m,zQ,s),Kv(_,g,sC,"left","right",n,s),Jv(_,p,jQ,r),Kv(_,h,oC,"bottom","top",n,r),_}function Kv(t,e,n,i,r,s,o){if(!e)return;const a=wIt(e);o=_It(a?i:e,s,o);const{line:u}=o;(n===sC||n===oC)&&u&&!Lg(u)&&t.push(cC(xIt(o))),t.push(n(o)),a&&t.push(n({...o,anchor:r,label:null}))}function Jv(t,e,n,i){!e||Lg(e)||t.push(n(SIt(e,i)))}function wIt(t){return/^\s*both\s*$/i.test(t)}function _It(t,e,{line:n=e.line,ticks:i,tickSize:r,tickSpacing:s,tickPadding:o,tickFormat:a,tickRotate:u,fontVariant:c,ariaLabel:l,ariaDescription:f,label:d=e.label,labelAnchor:h,labelArrow:p=e.labelArrow,labelOffset:g}){return{anchor:t,line:n,ticks:i,tickSize:r,tickSpacing:s,tickPadding:o,tickFormat:a,tickRotate:u,fontVariant:c,ariaLabel:l,ariaDescription:f,label:d,labelAnchor:h,labelArrow:p,labelOffset:g}}function xIt(t){const{anchor:e,line:n}=t;return{anchor:e,facetAnchor:e+"-empty",stroke:n===!0?void 0:n}}function SIt(t,{stroke:e=Ib(t)?t:void 0,ticks:n=EIt(t)?t:void 0,tickSpacing:i,ariaLabel:r,ariaDescription:s}){return{stroke:e,ticks:n,tickSpacing:i,ariaLabel:r,ariaDescription:s}}function EIt(t){switch(typeof t){case"number":return!0;case"string":return!Ib(t)}return xc(t)||typeof(t==null?void 0:t.range)=="function"}function Qv(t,e){const n=`${e}-axis `;return t.some(i=>{var r;return(r=i.ariaLabel)==null?void 0:r.startsWith(n)})}function c7(t,e){for(const n of e)for(const i in n.channels){const{scale:r}=n.channels[i];if(r===t||r==="projection")return!0}return!1}function AIt(t,e){for(const n in t){const i=t[n],r=e[n];i.label===void 0&&r&&(i.label=r.label)}return t}function $It({fx:t,fy:e},n){const{marginTop:i,marginRight:r,marginBottom:s,marginLeft:o,width:a,height:u}=H6(n),c=t&&l7(t),l=e&&l7(e);return{marginTop:e?l[0]:i,marginRight:t?a-c[1]:r,marginBottom:e?u-l[1]:s,marginLeft:t?c[0]:o,inset:{marginTop:n.marginTop,marginRight:n.marginRight,marginBottom:n.marginBottom,marginLeft:n.marginLeft},width:a,height:u}}function l7(t){const e=t.domain();let n=t(e[0]),i=t(e[e.length-1]);return i<n&&([n,i]=[i,n]),[n,i+t.bandwidth()]}const IIt=new Map([["basis",xK],["basis-closed",EK],["basis-open",$K],["bundle",MK],["bump-x",zSt],["bump-y",USt],["cardinal",TK],["cardinal-closed",FK],["cardinal-open",kK],["catmull-rom",CK],["catmull-rom-closed",OK],["catmull-rom-open",LK],["linear",Mm],["linear-closed",PK],["monotone-x",jK],["monotone-y",qK],["natural",WK],["step",GK],["step-after",HK],["step-before",YK]]);function dC(t=Mm,e){if(typeof t=="function")return t;const n=IIt.get(`${t}`.toLowerCase());if(!n)throw new Error(`unknown curve: ${t}`);if(e!==void 0){if("beta"in n)return n.beta(e);if("tension"in n)return n.tension(e);if("alpha"in n)return n.alpha(e)}return n}function sZ(t=zg,e){return typeof t!="function"&&`${t}`.toLowerCase()==="auto"?zg:dC(t,e)}function zg(t){return Mm(t)}function Qc(t={y:"count"},e={}){[t,e]=mC(t,e);const{x:n,y:i}=e;return gC(Bx(n,e,Ot),null,null,i,t,Ob(e))}function Zc(t={x:"count"},e={}){[t,e]=mC(t,e);const{x:n,y:i}=e;return gC(null,Bx(i,e,Ot),n,null,t,Rb(e))}function sd(t={fill:"count"},e={}){[t,e]=mC(t,e);const{x:n,y:i}=MIt(e);return gC(n,i,null,null,t,Ob(Rb(e)))}function oZ(t,e,n={}){if((n==null?void 0:n.interval)==null)return n;const{reduce:i=q6}=n,r={filter:null};return n[e]!=null&&(r[e]=i),n[`${e}1`]!=null&&(r[`${e}1`]=i),n[`${e}2`]!=null&&(r[`${e}2`]=i),t(r,n)}function hC(t={}){return oZ(Qc,"y",Eh(t,"x"))}function pC(t={}){return oZ(Zc,"x",Eh(t,"y"))}function gC(t,e,n,i,{data:r=j6,filter:s=kx,sort:o,reverse:a,...u}={},c={}){t=f7(t),e=f7(e),u=TIt(u,c),r=lZ(r,Ot),o=o==null?void 0:uZ("sort",o,c),s=s==null?void 0:cZ("filter",s,c),n!=null&&rl(u,"x","x1","x2")&&(n=null),i!=null&&rl(u,"y","y1","y2")&&(i=null);const[l,f]=br(t),[d,h]=br(t),[p,g]=br(e),[m,y]=br(e),[b,v]=n!=null?[n,"x"]:i!=null?[i,"y"]:[],[w,_]=br(b),{x:S,y:x,z:E,fill:A,stroke:$,x1:I,x2:k,y1:T,y2:M,domain:F,cumulative:D,thresholds:N,interval:R,...L}=c,[B,P]=br(E),[U]=ar(A),[H]=ar($),[nt,ft]=br(U),[dt,et]=br(H);return{..."z"in c&&{z:B||E},..."fill"in c&&{fill:nt||A},..."stroke"in c&&{stroke:dt||$},...Ja(L,(ct,G,st)=>{const lt=Fx(ue(ct,b),st==null?void 0:st[v]),V=ue(ct,E),Vt=ue(ct,U),mt=ue(ct,H),ee=U6(u,{z:V,fill:Vt,stroke:mt}),oe=[],ht=[],$e=lt&&_([]),Wr=V&&P([]),Go=Vt&&ft([]),zct=mt&&et([]),M4=t&&f([]),Uct=t&&h([]),T4=e&&g([]),jct=e&&y([]),qct=DIt(t,e,ct);let Vct=0;for(const Ph of u)Ph.initialize(ct);o&&o.initialize(ct),s&&s.initialize(ct);for(const Ph of G){const F4=[];for(const zh of u)zh.scope("facet",Ph);o&&o.scope("facet",Ph),s&&s.scope("facet",Ph);for(const[zh,Wct]of og(Ph,ee))for(const[Gct,_v]of og(Wct,lt))for(const[Yo,cu]of qct(_v))if(ee&&(cu.z=zh),!(s&&!s.reduce(Yo,cu))){F4.push(Vct++),ht.push(r.reduceIndex(Yo,ct,cu)),lt&&$e.push(Gct),V&&Wr.push(ee===V?zh:V[(Yo.length>0?Yo:_v)[0]]),Vt&&Go.push(ee===Vt?zh:Vt[(Yo.length>0?Yo:_v)[0]]),mt&&zct.push(ee===mt?zh:mt[(Yo.length>0?Yo:_v)[0]]),M4&&(M4.push(cu.x1),Uct.push(cu.x2)),T4&&(T4.push(cu.y1),jct.push(cu.y2));for(const Yct of u)Yct.reduce(Yo,cu);o&&o.reduce(Yo,cu)}oe.push(F4)}return _J(oe,o,a),{data:ht,facets:oe}}),...!rl(u,"x")&&(l?{x1:l,x2:d,x:Tx(l,d)}:{x:S,x1:I,x2:k}),...!rl(u,"y")&&(p?{y1:p,y2:m,y:Tx(p,m)}:{y:x,y1:T,y2:M}),...w&&{[v]:w},...Object.fromEntries(u.map(({name:ct,output:G})=>[ct,G]))}}function mC({cumulative:t,domain:e,thresholds:n,interval:i,...r},s){return[r,{cumulative:t,domain:e,thresholds:n,interval:i,...s}]}function Bx(t,{cumulative:e,domain:n,thresholds:i,interval:r},s){return t={...Fm(t)},t.domain===void 0&&(t.domain=n),t.cumulative===void 0&&(t.cumulative=e),t.thresholds===void 0&&(t.thresholds=i),t.interval===void 0&&(t.interval=r),t.value===void 0&&(t.value=s),t.thresholds=aZ(t.thresholds,t.interval),t}function MIt(t){let{x:e,y:n}=t;return e=Bx(e,t),n=Bx(n,t),[e.value,n.value]=Lo(e.value,n.value),{x:e,y:n}}function f7(t){if(t==null)return;const{value:e,cumulative:n,domain:i=zn,thresholds:r}=t,s=o=>{let a=ue(o,e),u;if(ur(a)||kIt(r)){a=He(a,nJ,Float64Array);let[l,f]=typeof i=="function"?i(a):i,d=typeof r=="function"&&!Rp(r)?r(a,l,f):r;typeof d=="number"&&(d=BH(l,f,d)),Rp(d)&&(i===zn&&(l=d.floor(l),f=d.offset(d.floor(f))),d=d.range(l,d.offset(f))),u=d}else{a=$r(a);let[l,f]=typeof i=="function"?i(a):i,d=typeof r=="function"&&!Rp(r)?r(a,l,f):r;if(typeof d=="number")if(i===zn){let h=f1(l,f,d);if(isFinite(h))if(h>0){let p=Math.round(l/h),g=Math.round(f/h);p*h<=l||--p,g*h>f||++g;let m=g-p+1;d=new Float64Array(m);for(let y=0;y<m;++y)d[y]=(p+y)*h}else if(h<0){h=-h;let p=Math.round(l*h),g=Math.round(f*h);p/h<=l||--p,g/h>f||++g;let m=g-p+1;d=new Float64Array(m);for(let y=0;y<m;++y)d[y]=(p+y)/h}else d=[l];else d=[l]}else d=kl(l,f,d);else Rp(d)&&(i===zn&&(l=d.floor(l),f=d.offset(d.floor(f))),d=d.range(l,d.offset(f)));u=d}const c=[];if(u.length===1)c.push([u[0],u[0]]);else for(let l=1;l<u.length;++l)c.push([u[l-1],u[l]]);return c.bin=(n<0?NIt:n>0?CIt:yC)(c,u,a),c};return s.label=Ka(e),s}function aZ(t,e,n=d7){if(t===void 0)return e===void 0?n:Tm(e);if(typeof t=="string"){switch(t.toLowerCase()){case"freedman-diaconis":return D0t;case"scott":return lG;case"sturges":return ID;case"auto":return d7}return A6(t)}return t}function TIt(t,e){return mJ(t,e,uZ)}function uZ(t,e,n){return P6(t,e,n,cZ)}function cZ(t,e,n){return z6(t,e,n,lZ)}function lZ(t,e){return OE(t,e,FIt)}function FIt(t){switch(`${t}`.toLowerCase()){case"x":return OIt;case"x1":return LIt;case"x2":return BIt;case"y":return RIt;case"y1":return PIt;case"y2":return zIt;case"z":return xJ}throw new Error(`invalid bin reduce: ${t}`)}function d7(t,e,n){return Math.min(200,lG(t,e,n))}function kIt(t){return fEt(t)||xc(t)&&ur(t)}function DIt(t,e,n){const i=t==null?void 0:t(n),r=e==null?void 0:e(n);return i&&r?function*(s){const o=i.bin(s);for(const[a,[u,c]]of i.entries()){const l=r.bin(o[a]);for(const[f,[d,h]]of r.entries())yield[l[f],{data:n,x1:u,y1:d,x2:c,y2:h}]}}:i?function*(s){const o=i.bin(s);for(const[a,[u,c]]of i.entries())yield[o[a],{data:n,x1:u,x2:c}]}:function*(s){const o=r.bin(s);for(const[a,[u,c]]of r.entries())yield[o[a],{data:n,y1:u,y2:c}]}}function yC(t,e,n){return e=$r(e),i=>{var s;const r=t.map(()=>[]);for(const o of i)(s=r[sc(e,n[o])-1])==null||s.push(o);return r}}function CIt(t,e,n){const i=yC(t,e,n);return r=>{const s=i(r);for(let o=1,a=s.length;o<a;++o){const u=s[o-1],c=s[o];for(const l of u)c.push(l)}return s}}function NIt(t,e,n){const i=yC(t,e,n);return r=>{const s=i(r);for(let o=s.length-2;o>=0;--o){const a=s[o+1],u=s[o];for(const c of a)u.push(c)}return s}}function fZ(t,e){const n=(+t+ +e)/2;return t instanceof Date?new Date(n):n}const OIt={reduceIndex(t,e,{x1:n,x2:i}){return fZ(n,i)}},RIt={reduceIndex(t,e,{y1:n,y2:i}){return fZ(n,i)}},LIt={reduceIndex(t,e,{x1:n}){return n}},BIt={reduceIndex(t,e,{x2:n}){return n}},PIt={reduceIndex(t,e,{y1:n}){return n}},zIt={reduceIndex(t,e,{y2:n}){return n}};function bC(t={}){return rJ(t)?t:{...t,x:Ot}}function vC(t={}){return sJ(t)?t:{...t,y:Ot}}function UIt(t,e){if(e.length===1)return{data:t,facets:e};const n=t.length,i=new Uint8Array(n);let r=0;for(const a of e)for(const u of a)i[u]&&++r,i[u]=1;if(r===0)return{data:t,facets:e};t=E1(t);const s=t[tJ]=new Uint32Array(n+r);e=e.map(a=>E1(a,Uint32Array));let o=n;i.fill(0);for(const a of e)for(let u=0,c=a.length;u<c;++u){const l=a[u];i[l]?(a[u]=o,t[o]=t[l],s[o]=l,++o):s[l]=l,i[l]=1}return{data:t,facets:e}}function dZ(t={},e={}){arguments.length===1&&([t,e]=Nm(t));const{y1:n,y:i=n,x:r,...s}=e,[o,a,u,c]=Om(i,r,"y","x",t,s);return{...o,y1:n,y:a,x1:u,x2:c,x:Tx(u,c)}}function jIt(t={},e={}){arguments.length===1&&([t,e]=Nm(t));const{y1:n,y:i=n,x:r}=e,[s,o,a]=Om(i,r,"y","x",t,e);return{...s,y1:n,y:o,x:a}}function qIt(t={},e={}){arguments.length===1&&([t,e]=Nm(t));const{y1:n,y:i=n,x:r}=e,[s,o,,a]=Om(i,r,"y","x",t,e);return{...s,y1:n,y:o,x:a}}function hZ(t={},e={}){arguments.length===1&&([t,e]=Nm(t));const{x1:n,x:i=n,y:r,...s}=e,[o,a,u,c]=Om(i,r,"x","y",t,s);return{...o,x1:n,x:a,y1:u,y2:c,y:Tx(u,c)}}function VIt(t={},e={}){arguments.length===1&&([t,e]=Nm(t));const{x1:n,x:i=n,y:r}=e,[s,o,a]=Om(i,r,"x","y",t,e);return{...s,x1:n,x:o,y:a}}function WIt(t={},e={}){arguments.length===1&&([t,e]=Nm(t));const{x1:n,x:i=n,y:r}=e,[s,o,,a]=Om(i,r,"x","y",t,e);return{...s,x1:n,x:o,y:a}}function wC({x:t,x1:e,x2:n,...i}={}){return i=Eh(i,"y"),e===void 0&&n===void 0?dZ({x:t,...i}):([e,n]=oJ(t,e,n),{...i,x1:e,x2:n})}function _C({y:t,y1:e,y2:n,...i}={}){return i=Eh(i,"x"),e===void 0&&n===void 0?hZ({y:t,...i}):([e,n]=oJ(t,e,n),{...i,y1:e,y2:n})}function Nm(t){const{offset:e,order:n,reverse:i,...r}=t;return[{offset:e,order:n,reverse:i},r]}const GIt={length:!0};function Om(t,e=$6,n,i,{offset:r,order:s,reverse:o},a){if(e===null)throw new Error(`stack requires ${i}`);const u=ff(a),[c,l]=br(t),[f,d]=Zr(e),[h,p]=Zr(e);return f.hint=h.hint=GIt,r=YIt(r),s=KIt(s,r,i),[Ja(a,(g,m,y)=>{({data:g,facets:m}=UIt(g,m));const b=t==null?void 0:l(Fx(ue(g,t),y==null?void 0:y[n])),v=ue(g,e,Float64Array),w=ue(g,u),_=s&&s(g,b,v,w),S=g.length,x=d(new Float64Array(S)),E=p(new Float64Array(S)),A=[];for(const $ of m){const I=b?Array.from(bc($,k=>b[k]).values()):[$];if(_)for(const k of I)k.sort(_);for(const k of I){let T=0,M=0;o&&k.reverse();for(const F of k){const D=v[F];D<0?T=E[F]=(x[F]=T)+D:D>0?M=E[F]=(x[F]=M)+D:E[F]=x[F]=M}}A.push(I)}return r&&r(A,x,E,w),{data:g,facets:m}}),c,f,h]}function YIt(t){if(t!=null){if(typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"expand":case"normalize":return HIt;case"center":case"silhouette":return XIt;case"wiggle":return gZ}throw new Error(`unknown offset: ${t}`)}}function pZ(t,e){let n=0,i=0;for(const r of t){const s=e[r];s<n&&(n=s),s>i&&(i=s)}return[n,i]}function HIt(t,e,n){for(const i of t)for(const r of i){const[s,o]=pZ(r,n);for(const a of r){const u=1/(o-s||1);e[a]=u*(e[a]-s),n[a]=u*(n[a]-s)}}}function XIt(t,e,n){for(const i of t){for(const r of i){const[s,o]=pZ(r,n);for(const a of r){const u=(o+s)/2;e[a]-=u,n[a]-=u}}mZ(i,e,n)}yZ(t,e,n)}function gZ(t,e,n,i){for(const r of t){const s=new zd;let o=0;for(const a of r){let u=-1;const c=a.map(h=>Math.abs(n[h]-e[h])),l=a.map(h=>{u=i?i[h]:++u;const p=n[h]-e[h],g=s.has(u)?p-s.get(u):0;return s.set(u,p),g}),f=[0,...A0t(l)];for(const h of a)e[h]+=o,n[h]+=o;const d=Ls(c);d&&(o-=Ls(c,(h,p)=>(l[p]/2+f[p])*h)/d)}mZ(r,e,n)}yZ(t,e,n)}function mZ(t,e,n){const i=yi(t,r=>yi(r,s=>e[s]));for(const r of t)for(const s of r)e[s]-=i,n[s]-=i}function yZ(t,e,n){const i=t.length;if(i===1)return;const r=t.map(a=>a.flat()),s=r.map(a=>(yi(a,u=>e[u])+tn(a,u=>n[u]))/2),o=yi(s);for(let a=0;a<i;a++){const u=o-s[a];for(const c of r[a])e[c]+=u,n[c]+=u}}function KIt(t,e,n){if(t===void 0&&e===gZ)return h7(js);if(t!=null){if(typeof t=="string"){const i=t.startsWith("-"),r=i?Ix:js;switch((i?t.slice(1):t).toLowerCase()){case"value":case n:return JIt(r);case"z":return QIt(r);case"sum":return ZIt(r);case"appearance":return t3t(r);case"inside-out":return h7(r)}return p7(eJ(t))}if(typeof t=="function")return(t.length===1?p7:e3t)(t);if(Array.isArray(t))return n3t(t);throw new Error(`invalid order: ${t}`)}}function JIt(t){return(e,n,i)=>(r,s)=>t(i[r],i[s])}function QIt(t){return(e,n,i,r)=>(s,o)=>t(r[s],r[o])}function ZIt(t){return GE(t,(e,n,i,r)=>$D(_c(e),s=>Ls(s,o=>i[o]),s=>r[s]))}function t3t(t){return GE(t,(e,n,i,r)=>$D(_c(e),s=>n[MD(s,o=>i[o])],s=>r[s]))}function h7(t){return GE(t,(e,n,i,r)=>{const s=_c(e),o=$D(s,f=>n[MD(f,d=>i[d])],f=>r[f]),a=eg(s,f=>Ls(f,d=>i[d]),f=>r[f]),u=[],c=[];let l=0;for(const f of o)l<0?(l+=a.get(f),u.push(f)):(l-=a.get(f),c.push(f));return c.reverse().concat(u)})}function p7(t){return e=>{const n=ue(e,t);return(i,r)=>js(n[i],n[r])}}function e3t(t){return e=>(n,i)=>t(e[n],e[i])}function n3t(t){return GE(js,()=>t)}function GE(t,e){return(n,i,r,s)=>{if(!s)throw new Error("missing channel: z");const o=new zd(e(n,i,r,s).map((a,u)=>[a,u]));return(a,u)=>t(o.get(s[a]),o.get(s[u]))}}const i3t={ariaLabel:"area",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class YE extends Ve{constructor(e,n={}){const{x1:i,y1:r,x2:s,y2:o,z:a,curve:u,tension:c}=n;super(e,{x1:{value:i,scale:"x"},y1:{value:r,scale:"y"},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0},z:{value:ff(n),optional:!0}},n,i3t),this.z=a,this.curve=dC(u,c)}filter(e){return e}render(e,n,i,r,s){const{x1:o,y1:a,x2:u=o,y2:c=a}=i;return ve("svg:g",s).call(un,this,r,s).call(qe,this,n,0,0).call(l=>l.selectAll().data(JJ(e,[o,a,u,c],this,i)).enter().append("path").call(en,this).call(Dx,this,i).attr("d",Ab().curve(this.curve).defined(f=>f>=0).x0(f=>o[f]).y0(f=>a[f]).x1(f=>u[f]).y1(f=>c[f]))).node()}}function zT(t,e){return e===void 0?Ug(t,{x:ME,y:S1}):new YE(t,e)}function T1(t,e){const{y:n=hr,...i}=pC(e);return new YE(t,wC(bC({...i,y1:n,y2:void 0})))}function Ug(t,e){const{x:n=hr,...i}=hC(e);return new YE(t,_C(vC({...i,x1:n,x2:void 0})))}const r3t={ariaLabel:"link",fill:"none",stroke:"currentColor",strokeMiterlimit:1};class bZ extends Ve{constructor(e,n={}){const{x1:i,y1:r,x2:s,y2:o,curve:a,tension:u}=n;super(e,{x1:{value:i,scale:"x"},y1:{value:r,scale:"y"},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0}},n,r3t),this.curve=sZ(a,u),km(this,n)}project(e,n,i){this.curve!==zg&&super.project(e,n,i)}render(e,n,i,r,s){const{x1:o,y1:a,x2:u=o,y2:c=a}=i,{curve:l}=this;return ve("svg:g",s).call(un,this,r,s).call(qe,this,n).call(f=>f.selectAll().data(e).enter().append("path").call(en,this).attr("d",l===zg&&s.projection?s3t(s.projection,o,a,u,c):d=>{const h=Vu(),p=l(h);return p.lineStart(),p.point(o[d],a[d]),p.point(u[d],c[d]),p.lineEnd(),h}).call(Gn,this,i).call(Nb,this,i,s)).node()}}function s3t(t,e,n,i,r){const s=Ha(t);return e=$r(e),n=$r(n),i=$r(i),r=$r(r),o=>s({type:"LineString",coordinates:[[e[o],n[o]],[i[o],r[o]]]})}function vZ(t,{x:e,x1:n,x2:i,y:r,y1:s,y2:o,...a}={}){return[n,i]=Px(e,n,i),[s,o]=Px(r,s,o),new bZ(t,{...a,x1:n,x2:i,y1:s,y2:o})}function Px(t,e,n){if(t===void 0){if(e===void 0){if(n!==void 0)return[n]}else if(n===void 0)return[e]}else{if(e===void 0)return n===void 0?[t]:[t,n];if(n===void 0)return[t,e]}return[e,n]}const o3t={ariaLabel:"arrow",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:1,strokeWidth:1.5};class wZ extends Ve{constructor(e,n={}){const{x1:i,y1:r,x2:s,y2:o,bend:a=0,headAngle:u=60,headLength:c=8,inset:l=0,insetStart:f=l,insetEnd:d=l,sweep:h}=n;super(e,{x1:{value:i,scale:"x"},y1:{value:r,scale:"y"},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0}},n,o3t),this.bend=a===!0?22.5:Math.max(-90,Math.min(90,a)),this.headAngle=+u,this.headLength=+c,this.insetStart=+f,this.insetEnd=+d,this.sweep=a3t(h)}render(e,n,i,r,s){const{x1:o,y1:a,x2:u=o,y2:c=a,SW:l}=i,{strokeWidth:f,bend:d,headAngle:h,headLength:p,insetStart:g,insetEnd:m}=this,y=l?w=>l[w]:as(f===void 0?1:f),b=h*Ox/2,v=p/1.5;return ve("svg:g",s).call(un,this,r,s).call(qe,this,n).call(w=>w.selectAll().data(e).enter().append("path").call(en,this).attr("d",_=>{let S=o[_],x=a[_],E=u[_],A=c[_];const $=Math.hypot(E-S,A-x);if($<=g+m)return null;let I=Math.atan2(A-x,E-S);const k=Math.min(v*y(_),$/3),T=this.sweep(S,x,E,A)*d*Ox,M=Math.hypot($/Math.tan(T),$)/2;if(g||m)if(M<1e5){const nt=Math.sign(T),[ft,dt]=u3t([S,x],[E,A],M,nt);if(g&&([S,x]=g7([ft,dt,M],[S,x,g],-nt*Math.sign(g))),m){const[et,ct]=g7([ft,dt,M],[E,A,m],nt*Math.sign(m));I+=Math.atan2(ct-dt,et-ft)-Math.atan2(A-dt,E-ft),E=et,A=ct}}else{const nt=E-S,ft=A-x,dt=Math.hypot(nt,ft);g&&(S+=nt/dt*g,x+=ft/dt*g),m&&(E-=nt/dt*m,A-=ft/dt*m)}const F=I+T,D=F+b,N=F-b,R=E-k*Math.cos(D),L=A-k*Math.sin(D),B=E-k*Math.cos(N),P=A-k*Math.sin(N),U=M<1e5?`A${M},${M} 0,0,${T>0?1:0} `:"L",H=k?`M${R},${L}L${E},${A}L${B},${P}`:"";return`M${S},${x}${U}${E},${A}${H}`}).call(Gn,this,i)).node()}}function a3t(t=1){if(typeof t=="number")return as(Math.sign(t));if(typeof t=="function")return(e,n,i,r)=>Math.sign(t(e,n,i,r));switch(hs(t,"sweep",["+x","-x","+y","-y"])){case"+x":return(e,n,i)=>Ze(e,i);case"-x":return(e,n,i)=>Pd(e,i);case"+y":return(e,n,i,r)=>Ze(n,r);case"-y":return(e,n,i,r)=>Pd(n,r)}}function u3t([t,e],[n,i],r,s){const o=n-t,a=i-e,u=Math.hypot(o,a),c=s*Math.sqrt(r*r-u*u/4)/u;return[(t+n)/2-a*c,(e+i)/2+o*c]}function g7([t,e,n],[i,r,s],o){const a=i-t,u=r-e,c=Math.hypot(a,u),l=(a*a+u*u-s*s+n*n)/(2*c),f=o*Math.sqrt(n*n-l*l);return[t+(a*l+u*f)/c,e+(u*l-a*f)/c]}function c3t(t,{x:e,x1:n,x2:i,y:r,y1:s,y2:o,...a}={}){return[n,i]=Px(e,n,i),[s,o]=Px(r,s,o),new wZ(t,{...a,x1:n,x2:i,y1:s,y2:o})}class xC extends Ve{constructor(e,n,i={},r){super(e,n,i,r);const{inset:s=0,insetTop:o=s,insetRight:a=s,insetBottom:u=s,insetLeft:c=s,rx:l,ry:f}=i;this.insetTop=de(o),this.insetRight=de(a),this.insetBottom=de(u),this.insetLeft=de(c),this.rx=bn(l,"auto"),this.ry=bn(f,"auto")}render(e,n,i,r,s){const{rx:o,ry:a}=this;return ve("svg:g",s).call(un,this,r,s).call(this._transform,this,n).call(u=>u.selectAll().data(e).enter().append("rect").call(en,this).attr("x",this._x(n,i,r)).attr("width",this._width(n,i,r)).attr("y",this._y(n,i,r)).attr("height",this._height(n,i,r)).call(Ft,"rx",o).call(Ft,"ry",a).call(Gn,this,i)).node()}_x(e,{x:n},{marginLeft:i}){const{insetLeft:r}=this;return n?s=>n[s]+r:i+r}_y(e,{y:n},{marginTop:i}){const{insetTop:r}=this;return n?s=>n[s]+r:i+r}_width({x:e},{x:n},{marginRight:i,marginLeft:r,width:s}){const{insetLeft:o,insetRight:a}=this,u=n&&e?e.bandwidth():s-i-r;return Math.max(0,u-o-a)}_height({y:e},{y:n},{marginTop:i,marginBottom:r,height:s}){const{insetTop:o,insetBottom:a}=this,u=n&&e?e.bandwidth():s-i-r;return Math.max(0,u-o-a)}}const _Z={ariaLabel:"bar"};class xZ extends xC{constructor(e,n={}){const{x1:i,x2:r,y:s}=n;super(e,{x1:{value:i,scale:"x"},x2:{value:r,scale:"x"},y:{value:s,scale:"y",type:"band",optional:!0}},n,_Z)}_transform(e,n,{x:i}){e.call(qe,n,{x:i},0,0)}_x({x:e},{x1:n,x2:i},{marginLeft:r}){const{insetLeft:s}=this;return Ts(e)?r+s:o=>Math.min(n[o],i[o])+s}_width({x:e},{x1:n,x2:i},{marginRight:r,marginLeft:s,width:o}){const{insetLeft:a,insetRight:u}=this;return Ts(e)?o-r-s-a-u:c=>Math.max(0,Math.abs(i[c]-n[c])-a-u)}}class SZ extends xC{constructor(e,n={}){const{x:i,y1:r,y2:s}=n;super(e,{y1:{value:r,scale:"y"},y2:{value:s,scale:"y"},x:{value:i,scale:"x",type:"band",optional:!0}},n,_Z)}_transform(e,n,{y:i}){e.call(qe,n,{y:i},0,0)}_y({y:e},{y1:n,y2:i},{marginTop:r}){const{insetTop:s}=this;return Ts(e)?r+s:o=>Math.min(n[o],i[o])+s}_height({y:e},{y1:n,y2:i},{marginTop:r,marginBottom:s,height:o}){const{insetTop:a,insetBottom:u}=this;return Ts(e)?o-r-s-a-u:c=>Math.max(0,Math.abs(i[c]-n[c])-a-u)}}function _d(t,e={}){return TE(e)||(e={...e,y:hr,x2:Ot}),new xZ(t,wC(uQ(bC(e))))}function xd(t,e={}){return TE(e)||(e={...e,x:hr,y2:Ot}),new SZ(t,_C(cQ(vC(e))))}const l3t={ariaLabel:"cell"};class HE extends xC{constructor(e,{x:n,y:i,...r}={}){super(e,{x:{value:n,scale:"x",type:"band",optional:!0},y:{value:i,scale:"y",type:"band",optional:!0}},r,l3t)}_transform(e,n){e.call(qe,n,{},0,0)}}function Bp(t,{x:e,y:n,...i}={}){return[e,n]=Lo(e,n),new HE(t,{...i,x:e,y:n})}function f3t(t,{x:e=hr,fill:n,stroke:i,...r}={}){return n===void 0&&ar(i)[0]===void 0&&(n=Ot),new HE(t,{...r,x:e,fill:n,stroke:i})}function d3t(t,{y:e=hr,fill:n,stroke:i,...r}={}){return n===void 0&&ar(i)[0]===void 0&&(n=Ot),new HE(t,{...r,y:e,fill:n,stroke:i})}const h3t={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function SC(t){return t.sort===void 0&&t.reverse===void 0?pJ({channel:"-r"},t):t}class XE extends Ve{constructor(e,n={}){const{x:i,y:r,r:s,rotate:o,symbol:a=Ng,frameAnchor:u}=n,[c,l]=In(o,0),[f,d]=AEt(a),[h,p]=In(s,f==null?3:4.5);super(e,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},r:{value:h,scale:"r",filter:Ku,optional:!0},rotate:{value:c,optional:!0},symbol:{value:f,scale:"auto",optional:!0}},SC(n),h3t),this.r=p,this.rotate=l,this.symbol=d,this.frameAnchor=Mb(u);const{channels:g}=this,{symbol:m}=g;if(m){const{fill:y,stroke:b}=g;m.hint={fill:y?y.value===m.value?"color":"currentColor":this.fill??"currentColor",stroke:b?b.value===m.value?"color":"currentColor":this.stroke??"none"}}}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y:c,r:l,rotate:f,symbol:d}=i,{r:h,rotate:p,symbol:g}=this,[m,y]=Qa(this,r),b=g===Ng,v=l?void 0:h*h*Math.PI;return $E(h)&&(e=[]),ve("svg:g",s).call(un,this,r,s).call(qe,this,{x:u&&o,y:c&&a}).call(w=>w.selectAll().data(e).enter().append(b?"circle":"path").call(en,this).call(b?_=>{_.attr("cx",u?S=>u[S]:m).attr("cy",c?S=>c[S]:y).attr("r",l?S=>l[S]:h)}:_=>{_.attr("transform",jE`translate(${u?S=>u[S]:m},${c?S=>c[S]:y})${f?S=>` rotate(${f[S]})`:p?` rotate(${p})`:""}`).attr("d",l&&d?S=>{const x=Vu();return d[S].draw(x,l[S]*l[S]*Math.PI),x}:l?S=>{const x=Vu();return g.draw(x,l[S]*l[S]*Math.PI),x}:d?S=>{const x=Vu();return d[S].draw(x,v),x}:(()=>{const S=Vu();return g.draw(S,v),S})())}).call(Gn,this,i)).node()}}function pf(t,{x:e,y:n,...i}={}){return i.frameAnchor===void 0&&([e,n]=Lo(e,n)),new XE(t,{...i,x:e,y:n})}function p3t(t,{x:e=Ot,...n}={}){return new XE(t,fQ({...n,x:e}))}function g3t(t,{y:e=Ot,...n}={}){return new XE(t,lQ({...n,y:e}))}function m3t(t,e){return pf(t,{...e,symbol:"circle"})}function y3t(t,e){return pf(t,{...e,symbol:"hexagon"})}const b3t={ariaLabel:"line",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class KE extends Ve{constructor(e,n={}){const{x:i,y:r,z:s,curve:o,tension:a}=n;super(e,{x:{value:i,scale:"x"},y:{value:r,scale:"y"},z:{value:ff(n),optional:!0}},n,b3t),this.z=s,this.curve=sZ(o,a),km(this,n)}filter(e){return e}project(e,n,i){this.curve!==zg&&super.project(e,n,i)}render(e,n,i,r,s){const{x:o,y:a}=i,{curve:u}=this;return ve("svg:g",s).call(un,this,r,s).call(qe,this,n).call(c=>c.selectAll().data(JJ(e,[o,a],this,i)).enter().append("path").call(en,this).call(Dx,this,i).call(S$t,this,i,s).attr("d",u===zg&&s.projection?v3t(s.projection,o,a):m6().curve(u).defined(l=>l>=0).x(l=>o[l]).y(l=>a[l]))).node()}}function v3t(t,e,n){const i=Ha(t);return e=$r(e),n=$r(n),r=>{let s=[];const o=[s];for(const a of r)a===-1?(s=[],o.push(s)):s.push([e[a],n[a]]);return i({type:"MultiLineString",coordinates:o})}}function JE(t,{x:e,y:n,...i}={}){return[e,n]=Lo(e,n),new KE(t,{...i,x:e,y:n})}function F1(t,{x:e=Ot,y:n=hr,...i}={}){return new KE(t,pC({...i,x:e,y:n}))}function k1(t,{x:e=hr,y:n=Ot,...i}={}){return new KE(t,hC({...i,x:e,y:n}))}const w3t={ariaLabel:"rect"};class QE extends Ve{constructor(e,n={}){const{x1:i,y1:r,x2:s,y2:o,inset:a=0,insetTop:u=a,insetRight:c=a,insetBottom:l=a,insetLeft:f=a,rx:d,ry:h}=n;super(e,{x1:{value:i,scale:"x",type:i!=null&&s==null?"band":void 0,optional:!0},y1:{value:r,scale:"y",type:r!=null&&o==null?"band":void 0,optional:!0},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0}},n,w3t),this.insetTop=de(u),this.insetRight=de(c),this.insetBottom=de(l),this.insetLeft=de(f),this.rx=bn(d,"auto"),this.ry=bn(h,"auto")}render(e,n,i,r,s){const{x:o,y:a}=n,{x1:u,y1:c,x2:l,y2:f}=i,{marginTop:d,marginRight:h,marginBottom:p,marginLeft:g,width:m,height:y}=r,{projection:b}=s,{insetTop:v,insetRight:w,insetBottom:_,insetLeft:S,rx:x,ry:E}=this,A=(o!=null&&o.bandwidth?o.bandwidth():0)-S-w,$=(a!=null&&a.bandwidth?a.bandwidth():0)-v-_;return ve("svg:g",s).call(un,this,r,s).call(qe,this,{},0,0).call(I=>I.selectAll().data(e).enter().append("rect").call(en,this).attr("x",u&&(b||!Ts(o))?l?k=>Math.min(u[k],l[k])+S:k=>u[k]+S:g+S).attr("y",c&&(b||!Ts(a))?f?k=>Math.min(c[k],f[k])+v:k=>c[k]+v:d+v).attr("width",u&&(b||!Ts(o))?l?k=>Math.max(0,Math.abs(l[k]-u[k])+A):A:m-h-g-w-S).attr("height",c&&(b||!Ts(a))?f?k=>Math.max(0,Math.abs(c[k]-f[k])+$):$:y-d-p-v-_).call(Ft,"rx",x).call(Ft,"ry",E).call(Gn,this,i)).node()}}function EC(t,e){return new QE(t,oQ(aQ(e)))}function zx(t,e={}){return TE(e)||(e={...e,y:hr,x2:Ot,interval:1}),new QE(t,wC(aQ(bC(e))))}function Ux(t,e={}){return TE(e)||(e={...e,x:hr,y2:Ot,interval:1}),new QE(t,_C(oQ(vC(e))))}function EZ(t,e){e=x3t(e);const{x:n,y:i,color:r,size:s}=e,o=Zv(t,n),a=Zv(t,i),u=Zv(t,r),c=Zv(t,s);let{fx:l,fy:f,x:{value:d,reduce:h,zero:p,...g},y:{value:m,reduce:y,zero:b,...v},color:{value:w,color:_,reduce:S},size:{value:x,reduce:E},mark:A}=e;if(h===void 0&&(h=y==null&&d==null&&x==null&&m!=null?"count":null),y===void 0&&(y=h==null&&m==null&&x==null&&d!=null?"count":null),E===void 0&&x==null&&S==null&&h==null&&y==null&&(d==null||mn(o))&&(m==null||mn(a))&&(E="count"),p===void 0&&(p=tw(h)?!0:void 0),b===void 0&&(b=tw(y)?!0:void 0),d==null&&m==null)throw new Error("must specify x or y");if(h!=null&&m==null)throw new Error("reducing x requires y");if(y!=null&&d==null)throw new Error("reducing y requires x");A===void 0&&(A=x!=null||E!=null?"dot":tw(h)||tw(y)||S!=null?"bar":d!=null&&m!=null?mn(o)||mn(a)||h==null&&y==null&&!y0(o)&&!y0(a)?"dot":"line":d!=null||m!=null?"rule":null);let $,I,k;switch(A){case"dot":k=pf,I="stroke";break;case"line":k=o&&a||h!=null||y!=null?b||y!=null||o&&y0(o)?k1:p||h!=null||a&&y0(a)?F1:JE:o?F1:k1,I="stroke",y7(u)&&($=null);break;case"area":k=!(b||y!=null)&&(p||h!=null||a&&y0(a))?T1:Ug,I="fill",y7(u)&&($=null);break;case"rule":k=o?zl:Ul,I="stroke";break;case"bar":k=h!=null?mn(a)?m7(h)&&o&&mn(o)?Bp:_d:zx:y!=null?mn(o)?m7(y)&&a&&mn(a)?Bp:xd:Ux:S!=null||E!=null?o&&mn(o)&&a&&mn(a)?Bp:o&&mn(o)?xd:a&&mn(a)?_d:EC:o&&Lp(o)&&!(a&&Lp(a))?_d:a&&Lp(a)&&!(o&&Lp(o))?xd:Bp,I="fill";break;default:throw new Error(`invalid mark: ${A}`)}let T={fx:l,fy:f,x:o??void 0,y:a??void 0,[I]:u??_,z:$,r:c??void 0,tip:!0},M,F={[I]:S??void 0,r:E??void 0};if(h!=null&&y!=null)throw new Error("cannot reduce both x and y");return y!=null?(F.y=y,M=mn(o)?A1:Qc):h!=null?(F.x=h,M=mn(a)?$1:Zc):(S!=null||E!=null)&&(o&&a?M=mn(o)&&mn(a)?B6:mn(o)?Zc:mn(a)?Qc:sd:o?M=mn(o)?A1:Qc:a&&(M=mn(a)?$1:Zc)),(M===sd||M===Qc)&&(T.x={value:o,...g}),(M===sd||M===Zc)&&(T.y={value:a,...v}),p===void 0&&(p=o&&!(M===sd||M===Qc)&&(k===_d||k===T1||k===zx||k===Ul)),b===void 0&&(b=a&&!(M===sd||M===Zc)&&(k===xd||k===Ug||k===Ux||k===zl)),{fx:l??null,fy:f??null,x:{value:d??null,reduce:h??null,zero:!!p,...g},y:{value:m??null,reduce:y??null,zero:!!b,...v},color:{value:w??null,reduce:S??null,..._!==void 0&&{color:_}},size:{value:x??null,reduce:E??null},mark:A,markImpl:b7[k],markOptions:T,transformImpl:b7[M],transformOptions:F,colorMode:I}}function _3t(t,e){const n=EZ(t,e),{fx:i,fy:r,x:{zero:s},y:{zero:o},markOptions:a,transformOptions:u,colorMode:c}=n,l=UT[n.markImpl],f=UT[n.transformImpl],d=i!=null||r!=null?cC({strokeOpacity:.1}):null,h=[s?zl([0]):null,o?Ul([0]):null],p=l(t,f?f(u,a):a);return c==="stroke"?qs(d,h,p):qs(d,p,h)}function y0(t){let e,n;for(const i of t){if(i==null)continue;if(e===void 0){e=i;continue}const r=Math.sign(Ze(e,i));if(r){if(n!==void 0&&r!==n)return!1;e=i,n=r}}return!0}function x3t({x:t,y:e,color:n,size:i,fx:r,fy:s,mark:o}={}){return aa(t)||(t=Qh(t)),aa(e)||(e=Qh(e)),aa(n)||(n=Ib(n)?{color:n}:Qh(n)),aa(i)||(i=Qh(i)),aa(r)&&({value:r}=Qh(r)),aa(s)&&({value:s}=Qh(s)),o!=null&&(o=`${o}`.toLowerCase()),{x:t,y:e,color:n,size:i,fx:r,fy:s,mark:o}}function Zv(t,e){const n=ue(t,e.value);return n&&(n.label=Ka(e.value)),n}function Qh(t){return S3t(t)?{reduce:t}:{value:t}}function tw(t){return/^(?:distinct|count|sum|proportion)$/i.test(t)}function m7(t){return/^(?:first|last|mode)$/i.test(t)}function S3t(t){if(t==null)return!1;if(typeof t.reduceIndex=="function"||typeof t.reduce=="function"&&Ks(t)||/^p\d{2}$/i.test(t))return!0;switch(`${t}`.toLowerCase()){case"first":case"last":case"count":case"distinct":case"sum":case"proportion":case"proportion-facet":case"deviation":case"min":case"min-index":case"max":case"max-index":case"mean":case"median":case"variance":case"mode":return!0}return!1}function y7(t){return t?new oc(t).size>t.length>>1:!1}const UT={dot:pf,line:JE,lineX:F1,lineY:k1,areaX:T1,areaY:Ug,ruleX:zl,ruleY:Ul,barX:_d,barY:xd,rect:EC,rectX:zx,rectY:Ux,cell:Bp,bin:sd,binX:Qc,binY:Zc,group:B6,groupX:A1,groupY:$1},b7=Object.fromEntries(Object.entries(UT).map(([t,e])=>[e,t]));function AC(t,e={}){let{x:n,x1:i,x2:r}=e;n===void 0&&i===void 0&&r===void 0&&(e={...e,x:n=Ot});const s={};return n!=null&&(s.x=t),i!=null&&(s.x1=t),r!=null&&(s.x2=t),za(s,e)}function $C(t,e={}){let{y:n,y1:i,y2:r}=e;n===void 0&&i===void 0&&r===void 0&&(e={...e,y:n=Ot});const s={};return n!=null&&(s.y=t),i!=null&&(s.y1=t),r!=null&&(s.y2=t),za(s,e)}function za(t={},e={}){const n=ff(e),i=Object.entries(t).map(([r,s])=>{const o=aJ(r,e);if(o==null)throw new Error(`missing channel: ${r}`);const[a,u]=Zr(o);return{key:r,input:o,output:a,setOutput:u,map:E3t(s)}});return{...Ja(e,(r,s)=>{const o=ue(r,n),a=i.map(({input:c})=>ue(r,c)),u=i.map(({setOutput:c})=>c(new Array(r.length)));for(const c of s)for(const l of o?bc(c,f=>o[f]).values():[c])i.forEach(({map:f},d)=>f.mapIndex(l,a[d],u[d]));return{data:r,facets:s}}),...Object.fromEntries(i.map(({key:r,output:s})=>[r,s]))}}function E3t(t){if(t==null)throw new Error("missing map");if(typeof t.mapIndex=="function")return t;if(typeof t.map=="function"&&Ks(t))return A3t(t);if(typeof t=="function")return n3(T6(t));switch(`${t}`.toLowerCase()){case"cumsum":return I3t;case"rank":return n3((e,n)=>hG(e,i=>n[i]));case"quantile":return n3((e,n)=>$3t(e,i=>n[i]))}throw new Error(`invalid map: ${t}`)}function A3t(t){return console.warn("deprecated map interface; implement mapIndex instead."),{mapIndex:t.map.bind(t)}}function $3t(t,e){const n=JS(t,e)-1;return hG(t,e).map(i=>i/n)}function n3(t){return{mapIndex(e,n,i){const r=t(e,n);if(r.length!==e.length)throw new Error("map function returned a mismatched length");for(let s=0,o=e.length;s<o;++s)i[e[s]]=r[s]}}}const I3t={mapIndex(t,e,n){let i=0;for(const r of t)n[r]=i+=e[r]}};function M3t(t={},e){return arguments.length===1&&(e=t),AC(ZE(t),e)}function T3t(t={},e){return arguments.length===1&&(e=t),$C(ZE(t),e)}function ZE(t={}){typeof t=="number"&&(t={k:t});let{k:e,reduce:n,shift:i,anchor:r,strict:s}=t;if(r===void 0&&i!==void 0&&(r=k3t(i),Ju(`Warning: the shift option is deprecated; please use anchor "${r}" instead.`)),!((e=Math.floor(e))>0))throw new Error(`invalid k: ${e}`);return D3t(n)(e,F3t(r,e),s)}function F3t(t="middle",e){switch(`${t}`.toLowerCase()){case"middle":return e-1>>1;case"start":return 0;case"end":return e-1}throw new Error(`invalid anchor: ${t}`)}function k3t(t){switch(`${t}`.toLowerCase()){case"centered":return"middle";case"leading":return"start";case"trailing":return"end"}throw new Error(`invalid shift: ${t}`)}function D3t(t="mean"){if(typeof t=="string"){if(/^p\d{2}$/i.test(t))return ew(I6(t));switch(t.toLowerCase()){case"deviation":return ew(bm);case"max":return nw((e,n)=>tn(e,i=>n[i]));case"mean":return C3t;case"median":return ew(Ud);case"min":return nw((e,n)=>yi(e,i=>n[i]));case"mode":return nw((e,n)=>dG(e,i=>n[i]));case"sum":return AZ;case"variance":return ew(SD);case"difference":return R3t;case"ratio":return L3t;case"first":return B3t;case"last":return P3t}}if(typeof t!="function")throw new Error(`invalid reduce: ${t}`);return nw(T6(t))}function ew(t){return(e,n,i)=>i?{mapIndex(r,s,o){const a=c=>s[c]==null?NaN:+s[c];let u=0;for(let c=0;c<e-1;++c)isNaN(a(c))&&++u;for(let c=0,l=r.length-e+1;c<l;++c)isNaN(a(c+e-1))&&++u,o[r[c+n]]=u===0?t(Td(r,c,c+e),a):NaN,isNaN(a(c))&&--u}}:{mapIndex(r,s,o){const a=u=>s[u]==null?NaN:+s[u];for(let u=-n;u<0;++u)o[r[u+n]]=t(Td(r,0,u+e),a);for(let u=0,c=r.length-n;u<c;++u)o[r[u+n]]=t(Td(r,u,u+e),a)}}}function nw(t){return(e,n,i)=>i?{mapIndex(r,s,o){let a=0;for(let u=0;u<e-1;++u)a+=tr(s[r[u]]);for(let u=0,c=r.length-e+1;u<c;++u)a+=tr(s[r[u+e-1]]),a===e&&(o[r[u+n]]=t(Td(r,u,u+e),s)),a-=tr(s[r[u]])}}:{mapIndex(r,s,o){for(let a=-n;a<0;++a)o[r[a+n]]=t(Td(r,0,a+e),s);for(let a=0,u=r.length-n;a<u;++a)o[r[a+n]]=t(Td(r,a,a+e),s)}}}function AZ(t,e,n){return n?{mapIndex(i,r,s){let o=0,a=0;for(let u=0;u<t-1;++u){const c=r[i[u]];c===null||isNaN(c)?++o:a+=+c}for(let u=0,c=i.length-t+1;u<c;++u){const l=r[i[u]],f=r[i[u+t-1]];f===null||isNaN(f)?++o:a+=+f,s[i[u+e]]=o===0?a:NaN,l===null||isNaN(l)?--o:a-=+l}}}:{mapIndex(i,r,s){let o=0;const a=i.length;for(let u=0,c=Math.min(a,t-e-1);u<c;++u)o+=+r[i[u]]||0;for(let u=-e,c=a-e;u<c;++u)o+=+r[i[u+t-1]]||0,s[i[u+e]]=o,o-=+r[i[u]]||0}}}function C3t(t,e,n){if(n){const i=AZ(t,e,n);return{mapIndex(r,s,o){i.mapIndex(r,s,o);for(let a=0,u=r.length-t+1;a<u;++a)o[r[a+e]]/=t}}}else return{mapIndex(i,r,s){let o=0,a=0;const u=i.length;for(let c=0,l=Math.min(u,t-e-1);c<l;++c){let f=r[i[c]];f!==null&&!isNaN(f=+f)&&(o+=f,++a)}for(let c=-e,l=u-e;c<l;++c){let f=r[i[c+t-1]],d=r[i[c]];f!==null&&!isNaN(f=+f)&&(o+=f,++a),s[i[c+e]]=o/a,d!==null&&!isNaN(d=+d)&&(o-=d,--a)}}}}function N3t(t,e,n,i){for(let r=n+i;n<r;++n){const s=t[e[n]];if(tr(s))return s}}function O3t(t,e,n,i){for(let r=n+i-1;r>=n;--r){const s=t[e[r]];if(tr(s))return s}}function $Z(t,e,n,i){for(let r=n+i;n<r;++n){let s=t[e[n]];if(s!==null&&!isNaN(s=+s))return s}}function IZ(t,e,n,i){for(let r=n+i-1;r>=n;--r){let s=t[e[r]];if(s!==null&&!isNaN(s=+s))return s}}function R3t(t,e,n){return n?{mapIndex(i,r,s){for(let o=0,a=i.length-t;o<a;++o){const u=r[i[o]],c=r[i[o+t-1]];s[i[o+e]]=u===null||c===null?NaN:c-u}}}:{mapIndex(i,r,s){for(let o=-e,a=i.length-t+e+1;o<a;++o)s[i[o+e]]=IZ(r,i,o,t)-$Z(r,i,o,t)}}}function L3t(t,e,n){return n?{mapIndex(i,r,s){for(let o=0,a=i.length-t;o<a;++o){const u=r[i[o]],c=r[i[o+t-1]];s[i[o+e]]=u===null||c===null?NaN:c/u}}}:{mapIndex(i,r,s){for(let o=-e,a=i.length-t+e+1;o<a;++o)s[i[o+e]]=IZ(r,i,o,t)/$Z(r,i,o,t)}}}function B3t(t,e,n){return n?{mapIndex(i,r,s){for(let o=0,a=i.length-t;o<a;++o)s[i[o+e]]=r[i[o]]}}:{mapIndex(i,r,s){for(let o=-e,a=i.length-t+e+1;o<a;++o)s[i[o+e]]=N3t(r,i,o,t)}}}function P3t(t,e,n){return n?{mapIndex(i,r,s){for(let o=0,a=i.length-t;o<a;++o)s[i[o+e]]=r[i[o+t-1]]}}:{mapIndex(i,r,s){for(let o=-e,a=i.length-t+e+1;o<a;++o)s[i[o+e]]=O3t(r,i,o,t)}}}const Qu={n:20,k:2,color:"currentColor",opacity:.2,strict:!0,anchor:"end"};function z3t(t,{x:e=Ot,y:n,k:i=Qu.k,color:r=Qu.color,opacity:s=Qu.opacity,fill:o=r,fillOpacity:a=s,stroke:u=r,strokeOpacity:c,strokeWidth:l,...f}={}){return qs(sn(o)?null:T1(t,za({x1:Fd({k:-i,...f}),x2:Fd({k:i,...f})},{x1:e,x2:e,y:n,fill:o,fillOpacity:a,...f})),sn(u)?null:F1(t,za({x:Fd(f)},{x:e,y:n,stroke:u,strokeOpacity:c,strokeWidth:l,...f})))}function U3t(t,{x:e,y:n=Ot,k:i=Qu.k,color:r=Qu.color,opacity:s=Qu.opacity,fill:o=r,fillOpacity:a=s,stroke:u=r,strokeOpacity:c,strokeWidth:l,...f}={}){return qs(sn(o)?null:Ug(t,za({y1:Fd({k:-i,...f}),y2:Fd({k:i,...f})},{x:e,y1:n,y2:n,fill:o,fillOpacity:a,...f})),sn(u)?null:k1(t,za({y:Fd(f)},{x:e,y:n,stroke:u,strokeOpacity:c,strokeWidth:l,...f})))}function Fd({n:t=Qu.n,k:e=0,strict:n=Qu.strict,anchor:i=Qu.anchor}={}){return ZE({k:t,reduce:r=>pb(r)+e*(bm(r)||0),strict:n,anchor:i})}const j3t={ariaLabel:"tick",fill:null,stroke:"currentColor"};class MZ extends Ve{constructor(e,n,i){super(e,n,i,j3t),km(this,i)}render(e,n,i,r,s){return ve("svg:g",s).call(un,this,r,s).call(this._transform,this,n).call(o=>o.selectAll().data(e).enter().append("line").call(en,this).attr("x1",this._x1(n,i,r)).attr("x2",this._x2(n,i,r)).attr("y1",this._y1(n,i,r)).attr("y2",this._y2(n,i,r)).call(Gn,this,i).call(Nb,this,i,s)).node()}}class TZ extends MZ{constructor(e,n={}){const{x:i,y:r,inset:s=0,insetTop:o=s,insetBottom:a=s}=n;super(e,{x:{value:i,scale:"x"},y:{value:r,scale:"y",type:"band",optional:!0}},n),this.insetTop=de(o),this.insetBottom=de(a)}_transform(e,n,{x:i}){e.call(qe,n,{x:i},hi,0)}_x1(e,{x:n}){return i=>n[i]}_x2(e,{x:n}){return i=>n[i]}_y1({y:e},{y:n},{marginTop:i}){const{insetTop:r}=this;return n&&e?s=>n[s]+r:i+r}_y2({y:e},{y:n},{height:i,marginBottom:r}){const{insetBottom:s}=this;return n&&e?o=>n[o]+e.bandwidth()-s:i-r-s}}class FZ extends MZ{constructor(e,n={}){const{x:i,y:r,inset:s=0,insetRight:o=s,insetLeft:a=s}=n;super(e,{y:{value:r,scale:"y"},x:{value:i,scale:"x",type:"band",optional:!0}},n),this.insetRight=de(o),this.insetLeft=de(a)}_transform(e,n,{y:i}){e.call(qe,n,{y:i},0,hi)}_x1({x:e},{x:n},{marginLeft:i}){const{insetLeft:r}=this;return n&&e?s=>n[s]+r:i+r}_x2({x:e},{x:n},{width:i,marginRight:r}){const{insetRight:s}=this;return n&&e?o=>n[o]+e.bandwidth()-s:i-r-s}_y1(e,{y:n}){return i=>n[i]}_y2(e,{y:n}){return i=>n[i]}}function kZ(t,{x:e=Ot,...n}={}){return new TZ(t,{...n,x:e})}function DZ(t,{y:e=Ot,...n}={}){return new FZ(t,{...n,y:e})}function q3t(t,{x:e=Ot,y:n=null,fill:i="#ccc",fillOpacity:r,stroke:s="currentColor",strokeOpacity:o,strokeWidth:a=2,sort:u,...c}={}){const l=n!=null?$1:L6;return qs(Ul(t,l({x1:IC,x2:MC},{x:e,y:n,stroke:s,strokeOpacity:o,...c})),_d(t,l({x1:"p25",x2:"p75"},{x:e,y:n,fill:i,fillOpacity:r,...c})),kZ(t,l({x:"p50"},{x:e,y:n,stroke:s,strokeOpacity:o,strokeWidth:a,sort:u,...c})),pf(t,za({x:CZ},{x:e,y:n,z:n,stroke:s,strokeOpacity:o,...c})))}function V3t(t,{y:e=Ot,x:n=null,fill:i="#ccc",fillOpacity:r,stroke:s="currentColor",strokeOpacity:o,strokeWidth:a=2,sort:u,...c}={}){const l=n!=null?A1:L6;return qs(zl(t,l({y1:IC,y2:MC},{x:n,y:e,stroke:s,strokeOpacity:o,...c})),xd(t,l({y1:"p25",y2:"p75"},{x:n,y:e,fill:i,fillOpacity:r,...c})),DZ(t,l({y:"p50"},{x:n,y:e,stroke:s,strokeOpacity:o,strokeWidth:a,sort:u,...c})),pf(t,za({y:CZ},{x:n,y:e,z:n,stroke:s,strokeOpacity:o,...c})))}function CZ(t){const e=IC(t),n=MC(t);return t.map(i=>i<e||i>n?i:NaN)}function IC(t){const e=NZ(t)*2.5-OZ(t)*1.5;return yi(t,n=>n>=e?n:NaN)}function MC(t){const e=OZ(t)*2.5-NZ(t)*1.5;return tn(t,n=>n<=e?n:NaN)}function NZ(t){return Ra(t,.25)}function OZ(t){return Ra(t,.75)}const W3t={ariaLabel:"raster",stroke:null,pixelSize:1};function Zh(t,e){const n=+t;if(isNaN(n))throw new Error(`invalid ${e}: ${t}`);return n}function v7(t,e){const n=Math.floor(t);if(isNaN(n))throw new Error(`invalid ${e}: ${t}`);return n}class RZ extends Ve{constructor(e,n,i={},r){let{width:s,height:o,x:a,y:u,x1:c=a==null?0:void 0,y1:l=u==null?0:void 0,x2:f=a==null?s:void 0,y2:d=u==null?o:void 0,pixelSize:h=r.pixelSize,blur:p=0,interpolate:g}=i;if(s!=null&&(s=v7(s,"width")),o!=null&&(o=v7(o,"height")),c!=null&&(c=Zh(c,"x1")),l!=null&&(l=Zh(l,"y1")),f!=null&&(f=Zh(f,"x2")),d!=null&&(d=Zh(d,"y2")),a==null&&(c==null||f==null))throw new Error("missing x");if(u==null&&(l==null||d==null))throw new Error("missing y");e!=null&&s!=null&&o!=null&&(a===void 0&&c!=null&&f!=null&&(a=tMt(c,f,s)),u===void 0&&l!=null&&d!=null&&(u=eMt(l,d,s,o))),super(e,{x:{value:a,scale:"x",optional:!0},y:{value:u,scale:"y",optional:!0},x1:{value:c==null?null:[c],scale:"x",optional:!0,filter:null},y1:{value:l==null?null:[l],scale:"y",optional:!0,filter:null},x2:{value:f==null?null:[f],scale:"x",optional:!0,filter:null},y2:{value:d==null?null:[d],scale:"y",optional:!0,filter:null},...n},i,r),this.width=s,this.height=o,this.pixelSize=Zh(h,"pixelSize"),this.blur=Zh(p,"blur"),this.interpolate=a==null||u==null?null:Y3t(g)}}class LZ extends RZ{constructor(e,n={}){const{imageRendering:i}=n;if(e==null){const{fill:r,fillOpacity:s}=n;In(s)[0]!==void 0&&(n=jT("fillOpacity",n)),ar(r)[0]!==void 0&&(n=jT("fill",n))}super(e,void 0,n,W3t),this.imageRendering=bn(i,"auto")}scale(e,{color:n,...i},r){return super.scale(e,i,r)}render(e,n,i,r,s){var F;const o=n[(F=i.channels.fill)==null?void 0:F.scale]??(D=>D),{x:a,y:u}=i,{document:c}=s,[l,f,d,h]=PZ(i,r,s),p=d-l,g=h-f,{pixelSize:m,width:y=Math.round(Math.abs(p)/m),height:b=Math.round(Math.abs(g)/m)}=this,v=y*b;let{fill:w,fillOpacity:_}=i,S=0;if(this.interpolate){const D=y/p,N=b/g,R=He(a,B=>(B-l)*D,Float64Array),L=He(u,B=>(B-f)*N,Float64Array);w&&(w=this.interpolate(e,y,b,R,L,w)),_&&(_=this.interpolate(e,y,b,R,L,_))}else this.data==null&&e&&(S=e.fi*v);const x=c.createElement("canvas");x.width=y,x.height=b;const E=x.getContext("2d"),A=E.createImageData(y,b),$=A.data;let{r:I,g:k,b:T}=Nr(this.fill)??{r:0,g:0,b:0},M=(this.fillOpacity??1)*255;for(let D=0;D<v;++D){const N=D<<2;if(w){const R=o(w[D+S]);if(R==null){$[N+3]=0;continue}({r:I,g:k,b:T}=Nr(R))}_&&(M=_[D+S]*255),$[N+0]=I,$[N+1]=k,$[N+2]=T,$[N+3]=M}return this.blur>0&&y0t(A,this.blur),E.putImageData(A,0,0),ve("svg:g",s).call(un,this,r,s).call(qe,this,n).call(D=>D.append("image").attr("transform",`translate(${l},${f}) scale(${Math.sign(d-l)},${Math.sign(h-f)})`).attr("width",Math.abs(p)).attr("height",Math.abs(g)).attr("preserveAspectRatio","none").call(Ft,"image-rendering",this.imageRendering).call(en,this).attr("xlink:href",x.toDataURL())).node()}}function BZ(t,e,n){arguments.length<3&&(n=e,e=null);let{x:i,y:r,[t]:s,...o}=n;return i===void 0&&r===void 0&&hEt(e)&&(i=ME,r=S1,s===void 0&&(s=uEt)),[e,{...o,x:i,y:r,[t]:s}]}function G3t(){const[t,e]=BZ("fill",...arguments);return new LZ(t,t==null||e.fill!==void 0||e.fillOpacity!==void 0?e:{...e,fill:Ot})}function PZ({x1:t,y1:e,x2:n,y2:i},r,{projection:s}){const{width:o,height:a,marginTop:u,marginRight:c,marginBottom:l,marginLeft:f}=r;return[t&&s==null?t[0]:f,e&&s==null?e[0]:u,n&&s==null?n[0]:o-c,i&&s==null?i[0]:a-l]}function zZ({x1:t,y1:e,x2:n,y2:i},r,s,o){const a={};return t&&(a.x1=t),e&&(a.y1=e),n&&(a.x2=n),i&&(a.y2=i),PZ(V6(a,r),s,o)}function jT(t,e={}){const{[t]:n}=e;if(typeof n!="function")throw new Error(`invalid ${t}: not a function`);return Lr({...e,[t]:void 0},function(i,r,s,o,a,u){const{x:c,y:l}=o;if(!c)throw new Error("missing scale: x");if(!l)throw new Error("missing scale: y");const[f,d,h,p]=zZ(s,o,a,u),g=h-f,m=p-d,{pixelSize:y}=this,{width:b=Math.round(Math.abs(g)/y),height:v=Math.round(Math.abs(m)/y)}=e,w=new Array(b*v*(r?r.length:1)),_=g/b,S=m/v;let x=0;for(const E of r??[void 0])for(let A=.5;A<v;++A)for(let $=.5;$<b;++$,++x)w[x]=n(c.invert(f+$*_),l.invert(d+A*S),E);return{data:w,facets:r,channels:{[t]:{value:w,scale:"auto"}}}})}function Y3t(t){if(typeof t=="function")return t;if(t==null)return qT;switch(`${t}`.toLowerCase()){case"none":return qT;case"nearest":return jZ;case"barycentric":return UZ();case"random-walk":return qZ()}throw new Error(`invalid interpolate: ${t}`)}function qT(t,e,n,i,r,s){const o=new Array(e*n);for(const a of t)i[a]<0||i[a]>=e||r[a]<0||r[a]>=n||(o[Math.floor(r[a])*e+Math.floor(i[a])]=s[a]);return o}function UZ({random:t=t6(42)}={}){return(e,n,i,r,s,o)=>{const{points:a,triangles:u,hull:c}=wc.from(e,h=>r[h],h=>s[h]),l=new o.constructor(n*i).fill(NaN),f=new Uint8Array(n*i),d=Z3t(o,t);for(let h=0;h<u.length;h+=3){const p=u[h],g=u[h+1],m=u[h+2],y=a[2*p],b=a[2*g],v=a[2*m],w=a[2*p+1],_=a[2*g+1],S=a[2*m+1],x=Math.min(y,b,v),E=Math.max(y,b,v),A=Math.min(w,_,S),$=Math.max(w,_,S),I=(_-S)*(y-v)+(w-S)*(v-b);if(!I)continue;const k=o[e[p]],T=o[e[g]],M=o[e[m]];for(let F=Math.floor(x);F<E;++F)for(let D=Math.floor(A);D<$;++D){if(F<0||F>=n||D<0||D>=i)continue;const N=F+.5,R=D+.5,L=((_-S)*(N-v)+(R-S)*(v-b))/I;if(L<0)continue;const B=((S-w)*(N-v)+(R-S)*(y-v))/I;if(B<0)continue;const P=1-L-B;if(P<0)continue;const U=F+n*D;l[U]=d(k,L,T,B,M,P,F,D),f[U]=1}}return H3t(l,f,r,s,o,n,i,c,e,d),l}}function H3t(t,e,n,i,r,s,o,a,u,c){n=Float64Array.from(a,h=>n[u[h]]),i=Float64Array.from(a,h=>i[u[h]]),r=Array.from(a,h=>r[u[h]]);const l=n.length,f=Array.from({length:l},(h,p)=>K3t(p,n,i));let d=0;for(let h=0;h<o;++h){const p=h+.5;for(let g=0;g<s;++g){const m=g+s*h;if(!e[m]){const y=g+.5;for(let b=0;b<l;++b){const v=(l+d+(b%2?(b+1)/2:-b/2))%l;if(f[v](y,p)){const w=X3t(n.at(v-1),i.at(v-1),n[v],i[v],y,p);t[m]=c(r.at(v-1),w,r[v],1-w,r[v],0,g,h),d=v;break}}}}}}function X3t(t,e,n,i,r,s){const o=n-t,a=i-e,u=o*(n-r)+a*(i-s),c=o*(r-t)+a*(s-e);return u>0&&c>0?u/(u+c):+(u>c)}function b0(t,e,n,i){return t*i-n*e}function K3t(t,e,n){const i=e.length,r=e.at(t-2),s=n.at(t-2),o=e.at(t-1),a=n.at(t-1),u=e[t],c=n[t],l=e.at(t+1-i),f=n.at(t+1-i),d=o-u,h=a-c,p=r-o,g=s-a,m=u-l,y=c-f,b=Math.hypot(d,h),v=Math.hypot(p,g),w=Math.hypot(m,y);return(_,S)=>{const x=_-o,E=S-a,A=_-u,$=S-c;return b0(x,E,A,$)>-1e-6&&b0(x,E,d,h)*v-b0(x,E,p,g)*b>-1e-6&&b0(A,$,m,y)*b-b0(A,$,d,h)*w<=0}}function jZ(t,e,n,i,r,s){const o=new s.constructor(e*n),a=wc.from(t,l=>i[l],l=>r[l]);let u,c;for(let l=.5,f=0;l<n;++l){c=u;for(let d=.5;d<e;++d,++f)c=a.find(d,l,c),d===.5&&(u=c),o[f]=s[t[c]]}return o}function qZ({random:t=t6(42),minDistance:e=.5,maxSteps:n=2}={}){return(i,r,s,o,a,u)=>{const c=new u.constructor(r*s),l=wc.from(i,p=>o[p],p=>a[p]);let f,d,h;for(let p=.5,g=0;p<s;++p){d=f;for(let m=.5;m<r;++m,++g){let y=m,b=p;h=d=l.find(y,b,d),m===.5&&(f=d);let v,w=0;for(;(v=Math.hypot(o[i[h]]-y,a[i[h]]-b))>e&&w<n;){const _=t(m,p,w)*2*Math.PI;y+=Math.cos(_)*v,b+=Math.sin(_)*v,h=l.find(y,b,h),++w}c[g]=u[i[h]]}}return c}}function J3t(t,e,n,i,r,s){return e*t+i*n+s*r}function Q3t(t){return(e,n,i,r,s,o,a,u)=>{const c=t(a,u);return c<n?e:c<n+r?i:s}}function Z3t(t,e){return Lp(t)||ur(t)?J3t:Q3t(e)}function tMt(t,e,n){return{transform(i){const r=i.length,s=new Float64Array(r),o=(e-t)/n,a=t+o/2;for(let u=0;u<r;++u)s[u]=u%n*o+a;return s}}}function eMt(t,e,n,i){return{transform(r){const s=r.length,o=new Float64Array(s),a=(e-t)/i,u=t+a/2;for(let c=0;c<s;++c)o[c]=Math.floor(c/n)%i*a+u;return o}}}const w7={ariaLabel:"contour",fill:"none",stroke:"currentColor",strokeMiterlimit:1,pixelSize:2};let VZ=class extends RZ{constructor(e,{smooth:n=!0,value:i,...r}={}){const s=KJ({},r,w7);if(i===void 0){for(const a in s)if(s[a].value!=null){if(i!==void 0)throw new Error("ambiguous contour value");i=r[a],r[a]="value"}}if(i!=null){const a={transform:u=>u.map(c=>c.value),label:Ka(i)};for(const u in s)r[u]==="value"&&(r[u]=a)}if(e==null){if(i==null)throw new Error("missing contour value");r=jT("value",{value:i,...r}),i=null}else{let{interpolate:a}=r;i===void 0&&(i=Ot),a===void 0&&(r.interpolate="nearest")}super(e,{value:{value:i,optional:!0}},nMt(r),w7);const o={geometry:{value:Ot}};for(const a in this.channels){const u=this.channels[a],{scale:c}=u;c==="x"||c==="y"||a==="value"||(o[a]=u,delete this.channels[a])}this.contourChannels=o,this.smooth=!!n}filter(e,{x:n,y:i,value:r,...s},o){return super.filter(e,s,o)}render(e,n,i,r,s){const{geometry:o}=i,a=Ha();return ve("svg:g",s).call(un,this,r,s).call(qe,this,n).call(u=>{u.selectAll().data(e).enter().append("path").call(en,this).attr("d",c=>a(o[c])).call(Gn,this,i)}).node()}};function nMt({thresholds:t,interval:e,...n}){return t=aZ(t,e,ID),Lr(n,function(i,r,s,o,a,u){const[c,l,f,d]=zZ(s,o,a,u),h=f-c,p=d-l,{pixelSize:g,width:m=Math.round(Math.abs(h)/g),height:y=Math.round(Math.abs(p)/g)}=this,b=m/h,v=y/p,w=s.value.value,_=[];if(this.interpolate){const{x:$,y:I}=LE(s,o,u),k=He($,D=>(D-c)*b,Float64Array),T=He(I,D=>(D-l)*v,Float64Array),M=[s.x,s.y,s.value],F=[k,T,w];for(const D of r){const N=this.filter(D,M,F);_.push(this.interpolate(N,m,y,k,T,w))}}else if(r){const $=m*y,I=r.length;for(let k=0;k<I;++k)_.push(w.slice(k*$,k*$+$))}else _.push(w);if(this.blur>0)for(const $ of _)tG({data:$,width:m,height:y},this.blur);const S=iMt(t,w,...sMt(_));if(S===null)throw new Error(`unsupported thresholds: ${t}`);const{contour:x}=nT().size([m,y]).smooth(this.smooth),E=[],A=[];for(const $ of _)A.push(Un(E.length,E.push(...He(S,I=>x($,I)))));for(const{coordinates:$}of E)for(const I of $)for(const k of I)for(const T of k)T[0]=T[0]/b+c,T[1]=T[1]/v+l;return{data:E,facets:A,channels:SJ(this.contourChannels,E)}})}function iMt(t,e,n,i){if(typeof(t==null?void 0:t.range)=="function")return t.range(t.floor(n),i);if(typeof t=="function"&&(t=t(e,n,i)),typeof t!="number")return Rr(t);const r=kl(...aG(n,i,t),t);for(;r[r.length-1]>=i;)r.pop();for(;r[1]<n;)r.shift();return r}function rMt(){return new VZ(...BZ("value",...arguments))}function sMt(t){return[yi(t,e=>yi(e,_7)),tn(t,e=>tn(e,_7))]}function _7(t){return isFinite(t)?t:NaN}function oMt(t,e){return TC(eC,t,e)}function aMt(t,e={}){return TC(nC,t,e)}function uMt(t,e={}){return TC(Nx,t,e)}function TC(t,e,n={}){const{x:i,y:r,maxRadius:s}=n,o=t({px:i,py:r,maxRadius:s}),a=[];i!=null&&a.push(zl(e,x7("x",{...o,inset:-6},n))),r!=null&&a.push(Ul(e,x7("y",{...o,inset:-6},n))),i!=null&&a.push(Bg(e,S7("x",{...o,dy:9,frameAnchor:"bottom",lineAnchor:"top"},n))),r!=null&&a.push(Bg(e,S7("y",{...o,dx:-9,frameAnchor:"left",textAnchor:"end"},n)));for(const u of a)u.ariaLabel=`crosshair ${u.ariaLabel}`;return qs(...a)}function WZ(t,{channels:e,...n},{facet:i,facetAnchor:r,fx:s,fy:o,[t]:a,channels:u,transform:c,initializer:l}){return{...n,facet:i,facetAnchor:r,fx:s,fy:o,[t]:a,channels:{...e,...u},transform:c,initializer:cMt(t,l)}}function cMt(t,e){return e==null?e:function(n,i,{x:r,y:s,px:o,py:a,...u},...c){const{channels:{x:l,y:f,...d}={},...h}=e.call(this,n,i,{...u,x:o,y:a},...c);return{channels:{...d,...l&&{px:l,...t==="x"&&{x:l}},...f&&{py:f,...t==="y"&&{y:f}}},...h}}}function x7(t,e,n){const{color:i="currentColor",opacity:r=.2,ruleStroke:s=i,ruleStrokeOpacity:o=r,ruleStrokeWidth:a}=n;return{...WZ(t,e,n),stroke:s,strokeOpacity:o,strokeWidth:a}}function S7(t,e,n){const{color:i="currentColor",textFill:r=i,textFillOpacity:s,textStroke:o="var(--plot-background)",textStrokeOpacity:a,textStrokeWidth:u=5}=n;return{...WZ(t,e,lMt(t,n)),fill:r,fillOpacity:s,stroke:o,strokeOpacity:a,strokeWidth:u}}function lMt(t,e){return Lr(e,(n,i,r)=>{var s;return{channels:{text:{value:(s=DT(r,t))==null?void 0:s.value}}}})}const fMt={ariaLabel:"delaunay link",fill:"none",stroke:"currentColor",strokeMiterlimit:1},dMt={ariaLabel:"delaunay mesh",fill:null,stroke:"currentColor",strokeOpacity:.2},hMt={ariaLabel:"hull",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:1},pMt={ariaLabel:"voronoi",fill:"none",stroke:"currentColor",strokeMiterlimit:1},gMt={ariaLabel:"voronoi mesh",fill:null,stroke:"currentColor",strokeOpacity:.2};class mMt extends Ve{constructor(e,n={}){const{x:i,y:r,z:s,curve:o,tension:a}=n;super(e,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},z:{value:s,optional:!0}},n,fMt),this.curve=dC(o,a),km(this,n)}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y:c,z:l}=i,{curve:f}=this,[d,h]=Qa(this,r),p=u?b=>u[b]:as(d),g=c?b=>c[b]:as(h),m=this;function y(b){let v=-1;const w=[],_={};for(const M in i)_[M]=[];const S=[],x=[],E=[],A=[];function $(M,F){M=b[M],F=b[F],w.push(++v),S[v]=p(M),E[v]=g(M),x[v]=p(F),A[v]=g(F);for(const D in i)_[D].push(i[D][F])}const{halfedges:I,hull:k,triangles:T}=wc.from(b,p,g);for(let M=0;M<I.length;++M){const F=I[M];F>M&&$(T[M],T[F])}for(let M=0;M<k.length;++M)$(k[M],k[(M+1)%k.length]);fi(this).selectAll().data(w).enter().append("path").call(en,m).attr("d",M=>{const F=Vu(),D=f(F);return D.lineStart(),D.point(S[M],E[M]),D.point(x[M],A[M]),D.lineEnd(),F}).call(Gn,m,_).call(Nb,m,_,s)}return ve("svg:g",s).call(un,this,r,s).call(qe,this,{x:u&&o,y:c&&a}).call(l?b=>b.selectAll().data(bc(e,v=>l[v]).values()).enter().append("g").each(y):b=>b.datum(e).each(y)).node()}}class FC extends Ve{constructor(e,n={},i,r=({z:s})=>s){const{x:s,y:o}=n;super(e,{x:{value:s,scale:"x",optional:!0},y:{value:o,scale:"y",optional:!0},z:{value:r(n),optional:!0}},n,i)}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y:c,z:l}=i,[f,d]=Qa(this,r),h=u?y=>u[y]:as(f),p=c?y=>c[y]:as(d),g=this;function m(y){const b=wc.from(y,h,p);fi(this).append("path").datum(y[0]).call(en,g).attr("d",g._render(b,r)).call(Gn,g,i)}return ve("svg:g",s).call(un,this,r,s).call(qe,this,{x:u&&o,y:c&&a}).call(l?y=>y.selectAll().data(bc(e,b=>l[b]).values()).enter().append("g").each(m):y=>y.datum(e).each(m)).node()}}class yMt extends FC{constructor(e,n={}){super(e,n,dMt),this.fill="none"}_render(e){return e.render()}}class bMt extends FC{constructor(e,n={}){super(e,n,hMt,ff)}_render(e){return e.renderHull()}}let vMt=class extends Ve{constructor(e,n={}){const{x:i,y:r,z:s}=n;super(e,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},z:{value:s,optional:!0}},n,pMt)}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y:c,z:l}=i,[f,d]=Qa(this,r),h=u?y=>u[y]:as(f),p=c?y=>c[y]:as(d),g=this;function m(y){const b=wc.from(y,h,p),v=GZ(b,r);fi(this).selectAll().data(y).enter().append("path").call(en,g).attr("d",(w,_)=>v.renderCell(_)).call(Gn,g,i)}return ve("svg:g",s).call(un,this,r,s).call(qe,this,{x:u&&o,y:c&&a}).call(l?y=>y.selectAll().data(bc(e,b=>l[b]).values()).enter().append("g").each(m):y=>y.datum(e).each(m)).node()}};class wMt extends FC{constructor(e,n){super(e,n,gMt),this.fill="none"}_render(e,n){return GZ(e,n).render()}}function GZ(t,e){const{width:n,height:i,marginTop:r,marginRight:s,marginBottom:o,marginLeft:a}=e;return t.voronoi([a,r,n-s,i-o])}function Lb(t,e,{x:n,y:i,...r}={}){return[n,i]=Lo(n,i),new t(e,{...r,x:n,y:i})}function _Mt(t,e){return Lb(mMt,t,e)}function xMt(t,e){return Lb(yMt,t,e)}function SMt(t,e){return Lb(bMt,t,e)}function EMt(t,e){return Lb(vMt,t,e)}function AMt(t,e){return Lb(wMt,t,e)}const $Mt={ariaLabel:"density",fill:"none",stroke:"currentColor",strokeMiterlimit:1};let YZ=class extends Ve{constructor(e,{x:n,y:i,z:r,weight:s,fill:o,stroke:a,...u}={}){const c=E7(o)&&(o="currentColor",!0),l=E7(a)&&(a="currentColor",!0);super(e,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},z:{value:ff({z:r,fill:o,stroke:a}),optional:!0},weight:{value:s,optional:!0}},TMt({...u,fill:o,stroke:a},c,l),$Mt),c&&(this.fill=void 0),l&&(this.stroke=void 0),this.z=r}filter(e){return e}render(e,n,i,r,s){const{contours:o}=i,a=Ha();return ve("svg:g",s).call(un,this,r,s).call(qe,this,{}).call(u=>u.selectAll().data(e).enter().append("path").call(en,this).call(Gn,this,i).attr("d",c=>a(o[c]))).node()}};function IMt(t,{x:e,y:n,...i}={}){return[e,n]=Lo(e,n),new YZ(t,{...i,x:e,y:n})}const MMt=new Set(["x","y","z","weight"]);function TMt(t,e,n){let{bandwidth:r,thresholds:s}=t;return r=r===void 0?20:+r,s=s===void 0?20:typeof(s==null?void 0:s[Symbol.iterator])=="function"?$r(s):+s,Lr(t,function(o,a,u,c,l,f){var T;const d=u.weight?$r(u.weight.value):null,h=(T=u.z)==null?void 0:T.value,{z:p}=this,[g,m]=Qa(this,l),{width:y,height:b}=l,{x:v,y:w}=LE(u,c,f),_=Object.fromEntries(Object.entries(u).filter(([M])=>!MMt.has(M)).map(([M,F])=>[M,{...F,value:[]}])),S=e&&[],x=n&&[],E=Gvt().x(v?M=>v[M]:g).y(w?M=>w[M]:m).weight(d?M=>d[M]:1).size([y,b]).bandwidth(r),A=[];for(const M of a){const F=[];A.push(F);for(const D of h?K6(M,h,p):[M]){const N=E.contours(D);F.push([D,N])}}let $=s;if(!($ instanceof Rg)){let M=0;for(const F of A)for(const[,D]of F){const N=D.max;N>M&&(M=N)}$=Float64Array.from({length:s-1},(F,D)=>M*100*(D+1)/s)}const I=[],k=[];for(const M of A){const F=[];I.push(F);for(const[D,N]of M)for(const R of $){F.push(k.length),k.push(N(R/100)),S&&S.push(R),x&&x.push(R);for(const L in _)_[L].value.push(u[L].value[D[0]])}}return S&&S.push(0),x&&x.push(0),{data:o,facets:I,channels:{..._,...S&&{fill:{value:S,scale:"color"}},...x&&{stroke:{value:x,scale:"color"}},contours:{value:k}}}})}function E7(t){return/^density$/i.test(t)}function FMt(t,{x1:e,x2:n,y1:i,y2:r,x:s=e===void 0&&n===void 0?hr:void 0,y:o=i===void 0&&r===void 0?Ot:void 0,fill:a,positiveFill:u="#3ca951",negativeFill:c="#4269d0",fillOpacity:l=1,positiveFillOpacity:f=l,negativeFillOpacity:d=l,stroke:h,strokeOpacity:p,z:g=ar(h)[0],clip:m,tip:y,render:b,...v}={}){return[e,n]=A7(s,e,n),[i,r]=A7(o,i,r),e===n&&i===r&&(i=Pc(0)),{tip:y}=Eh({tip:y},"x"),qs(sn(u)?null:Object.assign(zT(t,{x1:e,x2:n,y1:i,y2:r,z:g,fill:u,fillOpacity:f,render:Cx(b,$7(!0)),clip:m,...v}),{ariaLabel:"positive difference"}),sn(c)?null:Object.assign(zT(t,{x1:e,x2:n,y1:i,y2:r,z:g,fill:c,fillOpacity:d,render:Cx(b,$7(!1)),clip:m,...v}),{ariaLabel:"negative difference"}),JE(t,{x:n,y:r,z:g,stroke:h,strokeOpacity:p,tip:y,clip:!0,...v}))}function A7(t,e,n){return e===void 0&&n===void 0?e=n=Pc(t):e===void 0?(n=Pc(n),e=t===void 0?n:Pc(t)):n===void 0?(e=Pc(e),n=t===void 0?e:Pc(t)):(e=Pc(e),n=Pc(n)),[e,n]}function Pc(t){let e;const{value:n,label:i=Ka(n)}=Fm(t);return{transform:r=>e||(e=ue(r,n)),label:i}}function $7(t){return(e,n,i,r,s,o)=>{const{x1:a,x2:u}=i,{height:c}=r,l=new Float32Array(a.length),f=new Float32Array(u.length);(t===jJ(n.y)<0?l:f).fill(c);const d=o(e,n,{...i,x2:a,y2:f},r,s),h=o(e,n,{...i,x1:u,y1:l},r,s),p=d.querySelector("g")??d,g=h.querySelector("g")??h;for(let m=0;p.firstChild;m+=2){const y=LT(),b=ve("svg:clipPath",s).attr("id",y).node();b.appendChild(p.firstChild),g.childNodes[m].setAttribute("clip-path",`url(#${y})`),g.insertBefore(b,g.childNodes[m])}return h}}const kMt={ariaLabel:"geo",fill:"none",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class HZ extends Ve{constructor(e,n={}){const[i,r]=In(n.r,3);super(e,{geometry:{value:n.geometry,scale:"projection"},r:{value:i,scale:"r",filter:Ku,optional:!0}},SC(n),kMt),this.r=r}render(e,n,i,r,s){const{geometry:o,r:a}=i,u=Ha(s.projection??DMt(n)),{r:c}=this;return $E(c)?e=[]:c!==void 0&&u.pointRadius(c),ve("svg:g",s).call(un,this,r,s).call(qe,this,n).call(l=>{l.selectAll().data(e).enter().append("path").call(en,this).attr("d",a?f=>u.pointRadius(a[f])(o[f]):f=>u(o[f])).call(Gn,this,i)}).node()}}function DMt({x:t,y:e}){if(t||e)return t??(t=n=>n),e??(e=n=>n),mx({point(n,i){this.stream.point(t(n),e(i))}})}function kC(t,{geometry:e=Ot,...n}={}){switch(t==null?void 0:t.type){case"FeatureCollection":t=t.features;break;case"GeometryCollection":t=t.geometries;break;case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":t=[t];break}return new HZ(t,{geometry:e,...n})}function CMt({strokeWidth:t=1.5,...e}={}){return kC({type:"Sphere"},{strokeWidth:t,...e})}function NMt({strokeOpacity:t=.1,...e}={}){return kC($2t(),{strokeOpacity:t,...e})}const Ry=.5,Ly=0;function OMt(t={fill:"count"},{binWidth:e,...n}={}){const{z:i}=n;return e=e===void 0?20:de(e),t=yJ(t,n),rl(t,"fill")&&(n.channels={...n.channels,fill:{value:[]}}),n.symbol===void 0&&(n.symbol="hexagon"),n.r===void 0&&!rl(t,"r")&&(n.r=e/2),Lr(n,(r,s,o,a,u,c)=>{let{x:l,y:f,z:d,fill:h,stroke:p,symbol:g}=o;if(l===void 0)throw new Error("missing channel: x");if(f===void 0)throw new Error("missing channel: y");({x:l,y:f}=LE(o,a,c)),d=d?d.value:ue(r,i),h=h==null?void 0:h.value,p=p==null?void 0:p.value,g=g==null?void 0:g.value;const m=U6(t,{z:d,fill:h,stroke:p,symbol:g}),y=d&&[],b=h&&[],v=p&&[],w=g&&[],_=[],S=[],x=[];let E=-1;for(const k of t)k.initialize(r);for(const k of s){const T=[];for(const M of t)M.scope("facet",k);for(const[M,F]of og(k,m))for(const{index:D,extent:N}of RMt(r,F,l,f,e)){T.push(++E),S.push(N.x),x.push(N.y),d&&y.push(m===d?M:d[D[0]]),h&&b.push(m===h?M:h[D[0]]),p&&v.push(m===p?M:p[D[0]]),g&&w.push(m===g?M:g[D[0]]);for(const R of t)R.reduce(D,N)}_.push(T)}const A=o.x.scale,$=o.y.scale,I={x:{value:S,source:a[A]?{value:He(S,a[A].invert),scale:A}:null},y:{value:x,source:a[$]?{value:He(x,a[$].invert),scale:$}:null},...d&&{z:{value:y}},...h&&{fill:{value:b,scale:"auto"}},...p&&{stroke:{value:v,scale:"auto"}},...g&&{symbol:{value:w,scale:"auto"}},...Object.fromEntries(t.map(({name:k,output:T})=>[k,{scale:"auto",label:T.label,radius:k==="r"?e/2:void 0,value:T.transform()}]))};return{data:r,facets:_,channels:I}})}function RMt(t,e,n,i,r){const s=r*(1.5/dJ),o=new Map;for(const a of e){let u=n[a],c=i[a];if(isNaN(u)||isNaN(c))continue;let l=Math.round(c=(c-Ly)/s),f=Math.round(u=(u-Ry)/r-(l&1)/2),d=c-l;if(Math.abs(d)*3>1){let g=u-f,m=f+(u<f?-1:1)/2,y=l+(c<l?-1:1),b=u-m,v=c-y;g*g+d*d>b*b+v*v&&(f=m+(l&1?1:-1)/2,l=y)}const h=`${f},${l}`;let p=o.get(h);p===void 0&&(p={index:[],extent:{data:t,x:(f+(l&1)/2)*r+Ry,y:l*s+Ly}},o.set(h,p)),p.index.push(a)}return o.values()}const LMt={ariaLabel:"hexgrid",fill:"none",stroke:"currentColor",strokeOpacity:.1};function BMt(t){return new XZ(t)}class XZ extends Ve{constructor({binWidth:e=20,clip:n=!0,...i}={}){super(Oy,void 0,{clip:n,...i},LMt),this.binWidth=de(e)}render(e,n,i,r,s){const{binWidth:o}=this,{marginTop:a,marginRight:u,marginBottom:c,marginLeft:l,width:f,height:d}=r,h=l-Ry,p=f-u-Ry,g=a-Ly,m=d-c-Ly,y=o/2,b=y*hJ,v=b/2,w=y*2,_=b*1.5,S=Math.floor(h/w),x=Math.ceil(p/w),E=Math.floor((g+v)/_),A=Math.ceil((m-v)/_)+1,$=`m0,${Oc(-b)}l${Oc(y)},${Oc(v)}v${Oc(b)}l${Oc(-y)},${Oc(v)}`;let I=$;for(let k=E;k<A;++k)for(let T=S;T<x;++T)I+=`M${Oc(T*w+(k&1)*y)},${Oc(k*_)}${$}`;return ve("svg:g",s).datum(0).call(un,this,r,s).call(qe,this,{},hi+Ry,hi+Ly).call(k=>k.append("path").call(en,this).call(Gn,this,i).attr("d",I)).node()}}function Oc(t){return Math.round(t*1e3)/1e3}const PMt={ariaLabel:"image",fill:null,stroke:null};function zMt(t){return/^\.*\//.test(t)}function UMt(t){return/^(blob|data|file|http|https):/i.test(t)}function jMt(t){return typeof t=="string"&&(zMt(t)||UMt(t))?[void 0,t]:[t,void 0]}let KZ=class extends Ve{constructor(e,n={}){let{x:i,y:r,r:s,width:o,height:a,rotate:u,src:c,preserveAspectRatio:l,crossOrigin:f,frameAnchor:d,imageRendering:h}=n;s==null&&(s=void 0),s===void 0&&o===void 0&&a===void 0?o=a=16:o===void 0&&a!==void 0?o=a:a===void 0&&o!==void 0&&(a=o);const[p,g]=jMt(c),[m,y]=In(s),[b,v]=In(o,y!==void 0?y*2:void 0),[w,_]=In(a,y!==void 0?y*2:void 0),[S,x]=In(u,0);super(e,{x:{value:i,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},r:{value:m,scale:"r",filter:Ku,optional:!0},width:{value:b,filter:Ku,optional:!0},height:{value:w,filter:Ku,optional:!0},rotate:{value:S,optional:!0},src:{value:p,optional:!0}},SC(n),PMt),this.src=g,this.width=v,this.rotate=x,this.height=_,this.r=y,this.preserveAspectRatio=bn(l,"xMidYMid"),this.crossOrigin=Ii(f),this.frameAnchor=Mb(d),this.imageRendering=bn(h,"auto")}render(e,n,i,r,s){const{x:o,y:a}=n,{x:u,y:c,width:l,height:f,r:d,rotate:h,src:p}=i,{r:g,width:m,height:y,rotate:b}=this,[v,w]=Qa(this,r);return ve("svg:g",s).call(un,this,r,s).call(qe,this,{x:u&&o,y:c&&a}).call(_=>_.selectAll().data(e).enter().append("image").call(en,this).attr("x",I7(u,l,d,v,m,g)).attr("y",I7(c,f,d,w,y,g)).attr("width",l?S=>l[S]:m!==void 0?m:d?S=>d[S]*2:g*2).attr("height",f?S=>f[S]:y!==void 0?y:d?S=>d[S]*2:g*2).attr("transform",h?S=>`rotate(${h[S]})`:b?`rotate(${b})`:null).attr("transform-origin",h||b?jE`${u?S=>u[S]:v}px ${c?S=>c[S]:w}px`:null).call(Ft,"href",p?S=>p[S]:this.src).call(Ft,"preserveAspectRatio",this.preserveAspectRatio).call(Ft,"crossorigin",this.crossOrigin).call(Ft,"image-rendering",this.imageRendering).call(Ft,"clip-path",d?S=>`circle(${d[S]}px)`:g!==void 0?`circle(${g}px)`:null).call(Gn,this,i)).node()}};function I7(t,e,n,i,r,s){return e&&t?o=>t[o]-e[o]/2:e?o=>i-e[o]/2:t&&r!==void 0?o=>t[o]-r/2:r!==void 0?i-r/2:n&&t?o=>t[o]-n[o]:n?o=>i-n[o]:t?o=>t[o]-s:i-s}function qMt(t,{x:e,y:n,...i}={}){return i.frameAnchor===void 0&&([e,n]=Lo(e,n)),new KZ(t,{...i,x:e,y:n})}function VMt(t,e,n){var i=1e-8,r=e-1,s=n-1,o=0,a,u,c,l,f,d,h,p,g,m,y;if(t<=0)return 0;if(t>=1)return 1;for(e>=1&&n>=1?(c=t<.5?t:1-t,l=Math.sqrt(-2*Math.log(c)),h=(2.30753+l*.27061)/(1+l*(.99229+l*.04481))-l,t<.5&&(h=-h),p=(h*h-3)/6,g=2/(1/(2*e-1)+1/(2*n-1)),m=h*Math.sqrt(p+g)/g-(1/(2*n-1)-1/(2*e-1))*(p+5/6-2/(3*g)),h=e/(e+n*Math.exp(2*m))):(a=Math.log(e/(e+n)),u=Math.log(n/(e+n)),l=Math.exp(e*a)/e,f=Math.exp(n*u)/n,m=l+f,t<l/m?h=Math.pow(e*m*t,1/e):h=1-Math.pow(n*m*(1-t),1/n)),y=-ug(e)-ug(n)+ug(e+n);o<10;o++){if(h===0||h===1)return h;if(d=WMt(h,e,n)-t,l=Math.exp(r*Math.log(h)+s*Math.log(1-h)+y),f=d/l,h-=l=f/(1-.5*Math.min(1,f*(r/h-s/(1-h)))),h<=0&&(h=.5*(h+l)),h>=1&&(h=.5*(h+l+1)),Math.abs(l)<i*h&&o>0)break}return h}function WMt(t,e,n){var i=t===0||t===1?0:Math.exp(ug(e+n)-ug(e)-ug(n)+e*Math.log(t)+n*Math.log(1-t));return t<0||t>1?!1:t<(e+1)/(e+n+2)?i*M7(t,e,n)/e:1-i*M7(1-t,n,e)/n}function M7(t,e,n){var i=1e-30,r=1,s=e+n,o=e+1,a=e-1,u=1,c=1-s*t/o,l,f,d,h;for(Math.abs(c)<i&&(c=i),c=1/c,h=c;r<=100&&(l=2*r,f=r*(n-r)*t/((a+l)*(e+l)),c=1+f*c,Math.abs(c)<i&&(c=i),u=1+f/u,Math.abs(u)<i&&(u=i),c=1/c,h*=c*u,f=-(e+r)*(s+r)*t/((e+l)*(o+l)),c=1+f*c,Math.abs(c)<i&&(c=i),u=1+f/u,Math.abs(u)<i&&(u=i),c=1/c,d=c*u,h*=d,!(Math.abs(d-1)<3e-7));r++);return h}function ug(t){var e=0,n=[76.18009172947146,-86.5053203294167,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],i=1.000000000190015,r,s,o;for(o=(s=r=t)+5.5,o-=(r+.5)*Math.log(o);e<6;e++)i+=n[e]/++s;return Math.log(2.506628274631*i/r)-o}function GMt(t,e){var n=VMt(2*Math.min(t,1-t),.5*e,.5);return n=Math.sqrt(e*(1-n)/n),t>.5?n:-n}const YMt={ariaLabel:"linear-regression",fill:"currentColor",fillOpacity:.1,stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class JZ extends Ve{constructor(e,n={}){const{x:i,y:r,z:s,ci:o=.95,precision:a=4}=n;if(super(e,{x:{value:i,scale:"x"},y:{value:r,scale:"y"},z:{value:ff(n),optional:!0}},n,YMt),this.z=s,this.ci=+o,this.precision=+a,!(0<=this.ci&&this.ci<1))throw new Error(`invalid ci; not in [0, 1): ${o}`);if(!(this.precision>0))throw new Error(`invalid precision: ${a}`)}render(e,n,i,r,s){const{x:o,y:a,z:u}=i,{ci:c}=this;return ve("svg:g",s).call(un,this,r,s).call(qe,this,n).call(l=>l.selectAll().data(u?K6(e,u,this.z):[e]).enter().call(f=>f.append("path").attr("fill","none").call(en,this).call(Dx,this,{...i,fill:null,fillOpacity:null}).attr("d",d=>this._renderLine(d,o,a)).call(c&&!Lg(this.fill)?d=>d.select(HMt).attr("stroke","none").call(en,this).call(Dx,this,{...i,stroke:null,strokeOpacity:null,strokeWidth:null}).attr("d",h=>this._renderBand(h,o,a)):()=>{}))).node()}}function HMt(){return this.parentNode.insertBefore(this.ownerDocument.createElementNS(jd.svg,"path"),this)}class XMt extends JZ{constructor(e,n){super(e,n)}_renderBand(e,n,i){const{ci:r,precision:s}=this,[o,a]=zn(e,l=>i[l]),u=jx(e,i,n),c=QZ(e,i,n,(1-r)/2,u);return Ab().y(l=>l).x0(l=>c(l,-1)).x1(l=>c(l,1))(Un(o,a-s/2,s).concat(a))}_renderLine(e,n,i){const[r,s]=zn(e,a=>i[a]),o=jx(e,i,n);return`M${o(r)},${r}L${o(s)},${s}`}}class KMt extends JZ{constructor(e,n){super(e,n)}_renderBand(e,n,i){const{ci:r,precision:s}=this,[o,a]=zn(e,l=>n[l]),u=jx(e,n,i),c=QZ(e,n,i,(1-r)/2,u);return Ab().x(l=>l).y0(l=>c(l,-1)).y1(l=>c(l,1))(Un(o,a-s/2,s).concat(a))}_renderLine(e,n,i){const[r,s]=zn(e,a=>n[a]),o=jx(e,n,i);return`M${r},${o(r)}L${s},${o(s)}`}}function JMt(t,{y:e=hr,x:n=Ot,stroke:i,fill:r=sn(i)?"currentColor":i,...s}={}){return new XMt(t,pC({...s,x:n,y:e,fill:r,stroke:i}))}function QMt(t,{x:e=hr,y:n=Ot,stroke:i,fill:r=sn(i)?"currentColor":i,...s}={}){return new KMt(t,hC({...s,x:e,y:n,fill:r,stroke:i}))}function jx(t,e,n){let i=0,r=0,s=0,o=0;for(const l of t){const f=e[l],d=n[l];i+=f,r+=d,s+=f*d,o+=f*f}const a=t.length,u=(a*s-i*r)/(a*o-i*i),c=(r-u*i)/a;return l=>u*l+c}function QZ(t,e,n,i,r){const s=Ls(t,l=>e[l])/t.length;let o=0,a=0;for(const l of t)o+=(e[l]-s)**2,a+=(n[l]-r(e[l]))**2;const u=Math.sqrt(a/(t.length-2)),c=GMt(i,t.length-2);return(l,f)=>{const d=r(l),h=u*Math.sqrt(1/t.length+(l-s)**2/o);return d+f*c*h}}function VT({path:t=Ot,delimiter:e,frameAnchor:n,treeLayout:i=w1,treeSort:r,treeSeparation:s,treeAnchor:o,treeFilter:a,...u}={}){o=DC(o),r=ttt(r),a!=null&&(a=GT(a)),n===void 0&&(n=o.frameAnchor);const c=ett(e),l=utt(u,GT),[f,d]=Zr(),[h,p]=Zr();return{x:f,y:h,frameAnchor:n,...Ja(u,(g,m)=>{const y=c(ue(g,t)),b=d([]),v=p([]);let w=-1;const _=[],S=[],x=vx().path(A=>y[A]),E=i();E.nodeSize&&E.nodeSize([1,1]),E.separation&&s!==void 0&&E.separation(s??$6);for(const A of l)A[qx]=A[ott]([]);for(const A of m){const $=[],I=x(A.filter(k=>y[k]!=null)).each(k=>k.data=g[k.data]);r!=null&&I.sort(r),E(I);for(const k of I.descendants())if(!(a!=null&&!a(k))){$.push(++w),_[w]=k.data,o.position(k,w,b,v);for(const T of l)T[qx][w]=T[att](k)}S.push($)}return{data:_,facets:S}}),...Object.fromEntries(l)}}function ZZ({path:t=Ot,delimiter:e,curve:n="bump-x",stroke:i="#555",strokeWidth:r=1.5,strokeOpacity:s=.5,treeLayout:o=w1,treeSort:a,treeSeparation:u,treeAnchor:c,treeFilter:l,...f}={}){c=DC(c),a=ttt(a),l!=null&&(l=F7(l)),f={curve:n,stroke:i,strokeWidth:r,strokeOpacity:s,...f};const d=ett(e),h=utt(f,F7),[p,g]=Zr(),[m,y]=Zr(),[b,v]=Zr(),[w,_]=Zr();return{x1:p,x2:m,y1:b,y2:w,...Ja(f,(S,x)=>{const E=d(ue(S,t)),A=g([]),$=y([]),I=v([]),k=_([]);let T=-1;const M=[],F=[],D=vx().path(R=>E[R]),N=o();N.nodeSize&&N.nodeSize([1,1]),N.separation&&u!==void 0&&N.separation(u??$6);for(const R of h)R[qx]=R[ott]([]);for(const R of x){const L=[],B=D(R.filter(P=>E[P]!=null)).each(P=>P.data=S[P.data]);a!=null&&B.sort(a),N(B);for(const{source:P,target:U}of B.links())if(!(l!=null&&!l(U,P))){L.push(++T),M[T]=U.data,c.position(P,T,A,I),c.position(U,T,$,k);for(const H of h)H[qx][T]=H[att](U,P)}F.push(L)}return{data:M,facets:F}}),...Object.fromEntries(h)}}function DC(t="left"){switch(`${t}`.trim().toLowerCase()){case"left":return ZMt;case"right":return tTt}throw new Error(`invalid tree anchor: ${t}`)}const ZMt={frameAnchor:"left",dx:6,position({x:t,y:e},n,i,r){i[n]=e,r[n]=-t}},tTt={frameAnchor:"right",dx:-6,position({x:t,y:e},n,i,r){i[n]=-e,r[n]=-t}};function ttt(t){return t==null||typeof t=="function"?t:`${t}`.trim().toLowerCase().startsWith("node:")?T7(GT(t)):T7(eTt(t))}function T7(t){return(e,n)=>js(t(e),t(n))}function eTt(t){return e=>{var n;return(n=e.data)==null?void 0:n[t]}}function ett(t="/"){if(t=`${t}`,t==="/")return n=>n;if(t.length!==1)throw new Error("delimiter must be exactly one character");const e=t.charCodeAt(0);return n=>n.map(i=>nTt(i,e))}const WT=92,ntt=47;function nTt(t,e){if(e===WT)throw new Error("delimiter cannot be backslash");let n=!1;for(let i=0,r=t.length;i<r;++i){switch(t.charCodeAt(i)){case WT:if(!n){n=!0;continue}break;case e:n?(t=t.slice(0,i-1)+t.slice(i),--i,--r):t=t.slice(0,i)+"/"+t.slice(i+1);break;case ntt:n?(t=t.slice(0,i)+"\\\\"+t.slice(i),i+=2,r+=2):(t=t.slice(0,i)+"\\"+t.slice(i),++i,++r);break}n=!1}return t}function iTt(t){let e=!1;for(let n=0,i=t.length;n<i;++n){switch(t.charCodeAt(n)){case WT:if(!e){e=!0;continue}case ntt:e&&(t=t.slice(0,n-1)+t.slice(n),--n,--i);break}e=!1}return t}function itt(t){return Ks(t)&&typeof t.node=="function"}function rTt(t){return Ks(t)&&typeof t.link=="function"}function GT(t){if(itt(t))return t.node;if(t=`${t}`.trim().toLowerCase(),!!t.startsWith("node:")){switch(t){case"node:name":return HT;case"node:path":return YT;case"node:internal":return rtt;case"node:external":return stt;case"node:depth":return XT;case"node:height":return KT}throw new Error(`invalid node value: ${t}`)}}function F7(t){if(itt(t))return t.node;if(rTt(t))return t.link;if(t=`${t}`.trim().toLowerCase(),!(!t.startsWith("node:")&&!t.startsWith("parent:"))){switch(t){case"parent:name":return iw(HT);case"parent:path":return iw(YT);case"parent:depth":return iw(XT);case"parent:height":return iw(KT);case"node:name":return HT;case"node:path":return YT;case"node:internal":return rtt;case"node:external":return stt;case"node:depth":return XT;case"node:height":return KT}throw new Error(`invalid link value: ${t}`)}}function YT(t){return t.id}function HT(t){return sTt(t.id)}function XT(t){return t.depth}function KT(t){return t.height}function rtt(t){return!!t.children}function stt(t){return!t.children}function iw(t){return(e,n)=>n==null?void 0:t(n)}function sTt(t){let e=t.length;for(;--e>0&&!oTt(t,e););return iTt(t.slice(e+1))}function oTt(t,e){if(t[e]==="/"){let n=0;for(;e>0&&t[--e]==="\\";)++n;if(!(n&1))return!0}return!1}const ott=2,att=3,qx=4;function utt(t,e){const n=[];for(const i in t){const r=t[i],s=e(r);s!==void 0&&n.push([i,...Zr(r),s])}return n}function ctt(t,{fill:e,stroke:n,strokeWidth:i,strokeOpacity:r,strokeLinejoin:s,strokeLinecap:o,strokeMiterlimit:a,strokeDasharray:u,strokeDashoffset:c,marker:l,markerStart:f=l,markerEnd:d=l,dot:h=sn(f)&&sn(d),text:p="node:name",textStroke:g="var(--plot-background)",title:m="node:path",dx:y,dy:b,textAnchor:v,treeLayout:w=w1,textLayout:_=w===w1||w===QD?"mirrored":"normal",tip:S,...x}={}){if(y===void 0&&(y=DC(x.treeAnchor).dx),v!==void 0)throw new Error("textAnchor is not a configurable tree option");_=hs(_,"textLayout",["mirrored","normal"]);function E(A){return Bg(t,VT({treeLayout:w,text:p,fill:e===void 0?"currentColor":e,stroke:g,dx:y,dy:b,title:m,...A,...x}))}return qs(vZ(t,ZZ({treeLayout:w,markerStart:f,markerEnd:d,stroke:n!==void 0?n:e===void 0?"node:internal":e,strokeWidth:i,strokeOpacity:r,strokeLinejoin:s,strokeLinecap:o,strokeMiterlimit:a,strokeDasharray:u,strokeDashoffset:c,...x})),h?pf(t,VT({treeLayout:w,fill:e===void 0?"node:internal":e,title:m,tip:S,...x})):null,p!=null?_==="mirrored"?[E({textAnchor:"start",treeFilter:"node:external"}),E({textAnchor:"end",treeFilter:"node:internal",dx:-y})]:E():null)}function aTt(t,e){return ctt(t,{...e,treeLayout:QD})}function uTt({geometry:t=Ot,...e}={}){return Lr({...e,x:null,y:null},(n,i,r,s,o,{projection:a})=>{const u=ue(n,t),c=u.length,l=new Float64Array(c),f=new Float64Array(c),d=Ha(a);for(let h=0;h<c;++h)[l[h],f[h]]=d.centroid(u[h]);return{data:n,facets:i,channels:{x:{value:l,scale:a==null?"x":null,source:null},y:{value:f,scale:a==null?"y":null,source:null}}}})}function cTt({geometry:t=Ot,...e}={}){let n;return{...e,x:{transform:i=>Float64Array.from(n=ue(ue(i,t),FY),([r])=>r)},y:{transform:()=>Float64Array.from(n,([,i])=>i)}}}function ltt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function lTt(t,e,n,i,r){for(var s=r+1;i<=r;){var o=i+r>>>1,a=t[o],u=n!==void 0?n(a,e):a-e;u>=0?(s=o,r=o-1):i=o+1}return s}function fTt(t,e,n,i,r){for(var s=r+1;i<=r;){var o=i+r>>>1,a=t[o],u=n!==void 0?n(a,e):a-e;u>0?(s=o,r=o-1):i=o+1}return s}function dTt(t,e,n,i,r){for(var s=i-1;i<=r;){var o=i+r>>>1,a=t[o],u=n!==void 0?n(a,e):a-e;u<0?(s=o,i=o+1):r=o-1}return s}function hTt(t,e,n,i,r){for(var s=i-1;i<=r;){var o=i+r>>>1,a=t[o],u=n!==void 0?n(a,e):a-e;u<=0?(s=o,i=o+1):r=o-1}return s}function pTt(t,e,n,i,r){for(;i<=r;){var s=i+r>>>1,o=t[s],a=n!==void 0?n(o,e):o-e;if(a===0)return s;a<=0?i=s+1:r=s-1}return-1}function v0(t,e,n,i,r,s){return typeof n=="function"?s(t,e,n,i===void 0?0:i|0,r===void 0?t.length-1:r|0):s(t,e,void 0,n===void 0?0:n|0,i===void 0?t.length-1:i|0)}var gTt={ge:function(t,e,n,i,r){return v0(t,e,n,i,r,lTt)},gt:function(t,e,n,i,r){return v0(t,e,n,i,r,fTt)},lt:function(t,e,n,i,r){return v0(t,e,n,i,r,dTt)},le:function(t,e,n,i,r){return v0(t,e,n,i,r,hTt)},eq:function(t,e,n,i,r){return v0(t,e,n,i,r,pTt)}},Vx=gTt,Pp=0,ed=1,a2=2,mTt=bTt;function CC(t,e,n,i,r){this.mid=t,this.left=e,this.right=n,this.leftPoints=i,this.rightPoints=r,this.count=(e?e.count:0)+(n?n.count:0)+i.length}var Bb=CC.prototype;function i3(t,e){t.mid=e.mid,t.left=e.left,t.right=e.right,t.leftPoints=e.leftPoints,t.rightPoints=e.rightPoints,t.count=e.count}function ftt(t,e){var n=jg(e);t.mid=n.mid,t.left=n.left,t.right=n.right,t.leftPoints=n.leftPoints,t.rightPoints=n.rightPoints,t.count=n.count}function k7(t,e){var n=t.intervals([]);n.push(e),ftt(t,n)}function D7(t,e){var n=t.intervals([]),i=n.indexOf(e);return i<0?Pp:(n.splice(i,1),ftt(t,n),ed)}Bb.intervals=function(t){return t.push.apply(t,this.leftPoints),this.left&&this.left.intervals(t),this.right&&this.right.intervals(t),t};Bb.insert=function(t){var e=this.count-this.leftPoints.length;if(this.count+=1,t[1]<this.mid)this.left?4*(this.left.count+1)>3*(e+1)?k7(this,t):this.left.insert(t):this.left=jg([t]);else if(t[0]>this.mid)this.right?4*(this.right.count+1)>3*(e+1)?k7(this,t):this.right.insert(t):this.right=jg([t]);else{var n=Vx.ge(this.leftPoints,t,NC),i=Vx.ge(this.rightPoints,t,OC);this.leftPoints.splice(n,0,t),this.rightPoints.splice(i,0,t)}};Bb.remove=function(t){var e=this.count-this.leftPoints;if(t[1]<this.mid){if(!this.left)return Pp;var n=this.right?this.right.count:0;if(4*n>3*(e-1))return D7(this,t);var i=this.left.remove(t);return i===a2?(this.left=null,this.count-=1,ed):(i===ed&&(this.count-=1),i)}else if(t[0]>this.mid){if(!this.right)return Pp;var r=this.left?this.left.count:0;if(4*r>3*(e-1))return D7(this,t);var i=this.right.remove(t);return i===a2?(this.right=null,this.count-=1,ed):(i===ed&&(this.count-=1),i)}else{if(this.count===1)return this.leftPoints[0]===t?a2:Pp;if(this.leftPoints.length===1&&this.leftPoints[0]===t){if(this.left&&this.right){for(var s=this,o=this.left;o.right;)s=o,o=o.right;if(s===this)o.right=this.right;else{var a=this.left,i=this.right;s.count-=o.count,s.right=o.left,o.left=a,o.right=i}i3(this,o),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?i3(this,this.left):i3(this,this.right);return ed}for(var a=Vx.ge(this.leftPoints,t,NC);a<this.leftPoints.length&&this.leftPoints[a][0]===t[0];++a)if(this.leftPoints[a]===t){this.count-=1,this.leftPoints.splice(a,1);for(var i=Vx.ge(this.rightPoints,t,OC);i<this.rightPoints.length&&this.rightPoints[i][1]===t[1];++i)if(this.rightPoints[i]===t)return this.rightPoints.splice(i,1),ed}return Pp}};function dtt(t,e,n){for(var i=0;i<t.length&&t[i][0]<=e;++i){var r=n(t[i]);if(r)return r}}function htt(t,e,n){for(var i=t.length-1;i>=0&&t[i][1]>=e;--i){var r=n(t[i]);if(r)return r}}function ptt(t,e){for(var n=0;n<t.length;++n){var i=e(t[n]);if(i)return i}}Bb.queryPoint=function(t,e){if(t<this.mid){if(this.left){var n=this.left.queryPoint(t,e);if(n)return n}return dtt(this.leftPoints,t,e)}else if(t>this.mid){if(this.right){var n=this.right.queryPoint(t,e);if(n)return n}return htt(this.rightPoints,t,e)}else return ptt(this.leftPoints,e)};Bb.queryInterval=function(t,e,n){if(t<this.mid&&this.left){var i=this.left.queryInterval(t,e,n);if(i)return i}if(e>this.mid&&this.right){var i=this.right.queryInterval(t,e,n);if(i)return i}return e<this.mid?dtt(this.leftPoints,e,n):t>this.mid?htt(this.rightPoints,t,n):ptt(this.leftPoints,n)};function yTt(t,e){return t-e}function NC(t,e){var n=t[0]-e[0];return n||t[1]-e[1]}function OC(t,e){var n=t[1]-e[1];return n||t[0]-e[0]}function jg(t){if(t.length===0)return null;for(var e=[],n=0;n<t.length;++n)e.push(t[n][0],t[n][1]);e.sort(yTt);for(var i=e[e.length>>1],r=[],s=[],o=[],n=0;n<t.length;++n){var a=t[n];a[1]<i?r.push(a):i<a[0]?s.push(a):o.push(a)}var u=o,c=o.slice();return u.sort(NC),c.sort(OC),new CC(i,jg(r),jg(s),u,c)}function JT(t){this.root=t}var Rm=JT.prototype;Rm.insert=function(t){this.root?this.root.insert(t):this.root=new CC(t[0],null,null,[t],[t])};Rm.remove=function(t){if(this.root){var e=this.root.remove(t);return e===a2&&(this.root=null),e!==Pp}return!1};Rm.queryPoint=function(t,e){if(this.root)return this.root.queryPoint(t,e)};Rm.queryInterval=function(t,e,n){if(t<=e&&this.root)return this.root.queryInterval(t,e,n)};Object.defineProperty(Rm,"count",{get:function(){return this.root?this.root.count:0}});Object.defineProperty(Rm,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});function bTt(t){return!t||t.length===0?new JT(null):new JT(jg(t))}const vTt=ltt(mTt),wTt=({marginLeft:t})=>[1,t],_Tt=({width:t,marginRight:e})=>[-1,t-e],xTt=({width:t,marginLeft:e,marginRight:n})=>[0,(e+t-n)/2],STt=({marginTop:t})=>[1,t],ETt=({height:t,marginBottom:e})=>[-1,t-e],ATt=({height:t,marginTop:e,marginBottom:n})=>[0,(e+t-n)/2];function gtt(t){return typeof t=="string"?{anchor:t}:t}function $Tt(t={},e={}){arguments.length===1&&([t,e]=mtt(t));let{anchor:n="left",padding:i=1,r=e.r}=gtt(t);switch(`${n}`.toLowerCase()){case"left":n=wTt;break;case"right":n=_Tt;break;case"middle":n=xTt;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return ytt("x","y",n,de(i),r,e)}function ITt(t={},e={}){arguments.length===1&&([t,e]=mtt(t));let{anchor:n="bottom",padding:i=1,r=e.r}=gtt(t);switch(`${n}`.toLowerCase()){case"top":n=STt;break;case"bottom":n=ETt;break;case"middle":n=ATt;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return ytt("y","x",n,de(i),r,e)}function mtt(t){const{anchor:e,padding:n,...i}=t,{r}=i;return[{anchor:e,padding:n,r},i]}function ytt(t,e,n,i,r,s){if(r!=null&&typeof r!="number"){let{channels:o,sort:a,reverse:u}=s;o=F6(o),(o==null?void 0:o.r)===void 0&&(s={...s,channels:{...o,r:{value:r,scale:"r"}}}),a===void 0&&u===void 0&&(s.sort={channel:"-r"})}return Lr(s,function(o,a,u,c,l,f){let{[e]:d,r:h}=u;if(!u[e])throw new Error(`missing channel: ${e}`);({[e]:d}=LE(u,c,f));const p=h?void 0:r!==void 0?de(r):this.r!==void 0?this.r:3;h&&(h=ue(h.value,c[h.scale]||Ot,Float64Array));let[g,m]=n(l);const y=g?TTt:MTt,b=new Float64Array(d.length),v=h?w=>h[w]:()=>p;for(let w of a){const _=vTt();w=w.filter(h?x=>Mx(d[x])&&Ku(h[x]):x=>Mx(d[x]));const S=new Float64Array(2*w.length+2);for(const x of w){const E=v(x),A=g?E+i:0,$=d[x]-E,I=d[x]+E;let k=2;_.queryInterval($-i,I+i,([,,M])=>{const F=b[M]-A,D=d[x]-d[M],N=i+(h?h[x]+h[M]:2*p),R=Math.sqrt(N*N-D*D);S[k++]=F-R,S[k++]=F+R});let T=S.slice(0,k);g&&(T=T.filter(M=>M>=0));t:for(const M of T.sort(y)){for(let F=0;F<k;F+=2)if(S[F]+1e-6<M&&M<S[F+1]-1e-6)continue t;b[x]=M+A;break}_.insert([$,I,x])}}g||(g=1);for(const w of a)for(const _ of w)b[_]=b[_]*g+m;return{data:o,facets:a,channels:{[t]:{value:b,source:null},[e]:{value:d,source:u[e]},...h&&{r:{value:h,source:u.r}}}}})}function MTt(t,e){return Math.abs(t)-Math.abs(e)}function TTt(t,e){return t-e}function FTt(t,e){return arguments.length===1&&({basis:t,...e}=t),AC(RC(t),e)}function kTt(t,e){return arguments.length===1&&({basis:t,...e}=t),$C(RC(t),e)}function RC(t){if(t===void 0)return C7;if(typeof t=="function")return tA(T6(t));if(/^p\d{2}$/i.test(t))return Lm(I6(t));switch(`${t}`.toLowerCase()){case"deviation":return NTt;case"first":return C7;case"last":return CTt;case"max":return OTt;case"mean":return RTt;case"median":return LTt;case"min":return BTt;case"sum":return PTt;case"extent":return DTt}throw new Error(`invalid basis: ${t}`)}function tA(t){return{mapIndex(e,n,i){const r=+t(e,n);for(const s of e)i[s]=n[s]===null?NaN:n[s]/r}}}function Lm(t){return tA((e,n)=>t(e,i=>n[i]))}const DTt={mapIndex(t,e,n){const[i,r]=zn(t,o=>e[o]),s=r-i;for(const o of t)n[o]=e[o]===null?NaN:(e[o]-i)/s}},C7=tA((t,e)=>{for(let n=0;n<t.length;++n){const i=e[t[n]];if(tr(i))return i}}),CTt=tA((t,e)=>{for(let n=t.length-1;n>=0;--n){const i=e[t[n]];if(tr(i))return i}}),NTt={mapIndex(t,e,n){const i=pb(t,s=>e[s]),r=bm(t,s=>e[s]);for(const s of t)n[s]=e[s]===null?NaN:r?(e[s]-i)/r:0}},OTt=Lm(tn),RTt=Lm(pb),LTt=Lm(Ud),BTt=Lm(yi),PTt=Lm(Ls);function zTt(t,e){return UTt("x",t,e)}function UTt(t,e,n={}){let i,r=1;if(typeof e=="number")r=e,i=(c,l)=>+c+l;else{if(typeof e=="string"){const c=e.startsWith("-")?-1:1;[e,r]=E6(e.replace(/^[+-]/,"")),r*=c}e=kE(e),i=(c,l)=>e.offset(c,l)}const s=`${t}1`,o=`${t}2`,a=za({[s]:c=>c.map(l=>i(l,r)),[o]:c=>c},n),u=a[o].transform;return a[o].transform=()=>{const c=u(),[l,f]=zn(c);return c.domain=r<0?[l,i(f,r)]:[i(l,r),f],c},a}function jTt(t,e={}){if(typeof t=="string")switch(t.toLowerCase()){case"first":return btt(e);case"last":return vtt(e)}if(typeof t=="function")return jl(null,t,e);let n,i;for(n in t){if(i!==void 0)throw new Error("ambiguous selector; multiple inputs");i=qTt(t[n])}if(i===void 0)throw new Error(`invalid selector: ${t}`);return jl(n,i,e)}function qTt(t){if(typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"min":return LC;case"max":return BC}throw new Error(`unknown selector: ${t}`)}function btt(t){return jl(null,HTt,t)}function vtt(t){return jl(null,XTt,t)}function VTt(t){return jl("x",LC,t)}function WTt(t){return jl("y",LC,t)}function GTt(t){return jl("x",BC,t)}function YTt(t){return jl("y",BC,t)}function*HTt(t){yield t[0]}function*XTt(t){yield t[t.length-1]}function*LC(t,e){yield R0t(t,n=>e[n])}function*BC(t,e){yield MD(t,n=>e[n])}function jl(t,e,n){if(t!=null){if(n[t]==null)throw new Error(`missing channel: ${t}`);t=n[t]}const i=ff(n);return Ja(n,(r,s)=>{const o=ue(r,i),a=ue(r,t),u=[];for(const c of s){const l=[];for(const f of o?bc(c,d=>o[d]).values():[c])for(const d of e(f,a))l.push(d);u.push(l)}return{data:r,facets:u}})}const r3=Object.freeze(Object.defineProperty({__proto__:null,Area:YE,Arrow:wZ,BarX:xZ,BarY:SZ,Cell:HE,Contour:VZ,Density:YZ,Dot:XE,Frame:eZ,Geo:HZ,Hexgrid:XZ,Image:KZ,Line:KE,Link:bZ,Mark:Ve,Raster:LZ,Rect:QE,RuleX:hQ,RuleY:pQ,Text:qE,TickX:TZ,TickY:FZ,Tip:nZ,Vector:VE,area:zT,areaX:T1,areaY:Ug,arrow:c3t,auto:_3t,autoSpec:EZ,axisFx:LQ,axisFy:RQ,axisX:oC,axisY:sC,barX:_d,barY:xd,bin:sd,binX:Qc,binY:Zc,bollinger:Fd,bollingerX:z3t,bollingerY:U3t,boxX:q3t,boxY:V3t,cell:Bp,cellX:f3t,cellY:d3t,centroid:uTt,circle:m3t,cluster:aTt,column:Zr,contour:rMt,crosshair:oMt,crosshairX:aMt,crosshairY:uMt,delaunayLink:_Mt,delaunayMesh:xMt,density:IMt,differenceY:FMt,dodgeX:$Tt,dodgeY:ITt,dot:pf,dotX:p3t,dotY:g3t,filter:$Et,find:UEt,formatIsoDate:XJ,formatMonth:WAt,formatWeekday:GAt,frame:cC,geo:kC,geoCentroid:cTt,graticule:NMt,gridFx:qQ,gridFy:UQ,gridX:jQ,gridY:zQ,group:B6,groupX:A1,groupY:$1,groupZ:L6,hexagon:y3t,hexbin:OMt,hexgrid:BMt,hull:SMt,identity:Ot,image:qMt,indexOf:hr,initializer:Lr,interpolateNearest:jZ,interpolateNone:qT,interpolatorBarycentric:UZ,interpolatorRandomWalk:qZ,legend:J$t,line:JE,lineX:F1,lineY:k1,linearRegressionX:JMt,linearRegressionY:QMt,link:vZ,map:za,mapX:AC,mapY:$C,marks:qs,normalize:RC,normalizeX:FTt,normalizeY:kTt,plot:lC,pointer:eC,pointerX:nC,pointerY:Nx,raster:G3t,rect:EC,rectX:zx,rectY:Ux,reverse:IEt,ruleX:zl,ruleY:Ul,scale:PAt,select:jTt,selectFirst:btt,selectLast:vtt,selectMaxX:GTt,selectMaxY:YTt,selectMinX:VTt,selectMinY:WTt,shiftX:zTt,shuffle:MEt,sort:pJ,sphere:CMt,spike:P$t,stackX:dZ,stackX1:jIt,stackX2:qIt,stackY:hZ,stackY1:VIt,stackY2:WIt,text:Bg,textX:bQ,textY:vQ,tickX:kZ,tickY:DZ,tip:iZ,transform:Ja,tree:ctt,treeLink:ZZ,treeNode:VT,valueof:ue,vector:TQ,vectorX:FQ,vectorY:kQ,voronoi:EMt,voronoiMesh:AMt,window:ZE,windowX:M3t,windowY:T3t},Symbol.toStringTag,{value:"Module"})),KTt=new Map([["style","style"],["width","width"],["height","height"],["margin","margin"],["marginLeft","marginLeft"],["marginRight","marginRight"],["marginTop","marginTop"],["marginBottom","marginBottom"],["align","align"],["aspectRatio","aspectRatio"],["axis","axis"],["inset","inset"],["grid","grid"],["label","label"],["padding","padding"],["xScale","x.type"],["xDomain","x.domain"],["xRange","x.range"],["xNice","x.nice"],["xInset","x.inset"],["xInsetLeft","x.insetLeft"],["xInsetRight","x.insetRight"],["xClamp","x.clamp"],["xRound","x.round"],["xAlign","x.align"],["xPadding","x.padding"],["xPaddingInner","x.paddingInner"],["xPaddingOuter","x.paddingOuter"],["xAxis","x.axis"],["xTicks","x.ticks"],["xTickSize","x.tickSize"],["xTickSpacing","x.tickSpacing"],["xTickPadding","x.tickPadding"],["xTickFormat","x.tickFormat"],["xTickRotate","x.tickRotate"],["xGrid","x.grid"],["xLine","x.line"],["xLabel","x.label"],["xLabelAnchor","x.labelAnchor"],["xLabelOffset","x.labelOffset"],["xFontVariant","x.fontVariant"],["xAriaLabel","x.ariaLabel"],["xAriaDescription","x.ariaDescription"],["xReverse","x.reverse"],["xZero","x.zero"],["xBase","x.base"],["xExponent","x.exponent"],["xConstant","x.constant"],["yScale","y.type"],["yDomain","y.domain"],["yRange","y.range"],["yNice","y.nice"],["yInset","y.inset"],["yInsetTop","y.insetTop"],["yInsetBottom","y.insetBottom"],["yClamp","y.clamp"],["yRound","y.round"],["yAlign","y.align"],["yPadding","y.padding"],["yPaddingInner","y.paddingInner"],["yPaddingOuter","y.paddingOuter"],["yAxis","y.axis"],["yTicks","y.ticks"],["yTickSize","y.tickSize"],["yTickSpacing","y.tickSpacing"],["yTickPadding","y.tickPadding"],["yTickFormat","y.tickFormat"],["yTickRotate","y.tickRotate"],["yGrid","y.grid"],["yLine","y.line"],["yLabel","y.label"],["yLabelAnchor","y.labelAnchor"],["yLabelOffset","y.labelOffset"],["yFontVariant","y.fontVariant"],["yAriaLabel","y.ariaLabel"],["yAriaDescription","y.ariaDescription"],["yReverse","y.reverse"],["yZero","y.zero"],["yBase","y.base"],["yExponent","y.exponent"],["yConstant","y.constant"],["facetMargin","facet.margin"],["facetMarginTop","facet.marginTop"],["facetMarginBottom","facet.marginBottom"],["facetMarginLeft","facet.marginLeft"],["facetMarginRight","facet.marginRight"],["facetGrid","facet.grid"],["facetLabel","facet.label"],["fxDomain","fx.domain"],["fxRange","fx.range"],["fxNice","fx.nice"],["fxInset","fx.inset"],["fxInsetLeft","fx.insetLeft"],["fxInsetRight","fx.insetRight"],["fxRound","fx.round"],["fxAlign","fx.align"],["fxPadding","fx.padding"],["fxPaddingInner","fx.paddingInner"],["fxPaddingOuter","fx.paddingOuter"],["fxAxis","fx.axis"],["fxTicks","fx.ticks"],["fxTickSize","fx.tickSize"],["fxTickSpacing","fx.tickSpacing"],["fxTickPadding","fx.tickPadding"],["fxTickFormat","fx.tickFormat"],["fxTickRotate","fx.tickRotate"],["fxGrid","fx.grid"],["fxLine","fx.line"],["fxLabel","fx.label"],["fxLabelAnchor","fx.labelAnchor"],["fxLabelOffset","fx.labelOffset"],["fxFontVariant","fx.fontVariant"],["fxAriaLabel","fx.ariaLabel"],["fxAriaDescription","fx.ariaDescription"],["fxReverse","fx.reverse"],["fyDomain","fy.domain"],["fyRange","fy.range"],["fyNice","fy.mice"],["fyInset","fy,inset"],["fyInsetTop","fy.insetTop"],["fyInsetBottom","fy.insetBottom"],["fyRound","fy.round"],["fyAlign","fy.align"],["fyPadding","fy.padding"],["fyPaddingInner","fy.paddingInner"],["fyPaddingOuter","fy.paddingOuter"],["fyAxis","fy.axis"],["fyTicks","fy.ticks"],["fyTickSize","fy.tickSize"],["fyTickSpacing","fy.tickSpacing"],["fyTickPadding","fy.tickPadding"],["fyTickFormat","fy.tickFormat"],["fyTickRotate","fy.tickRotate"],["fyGrid","fy.grid"],["fyLine","fy.line"],["fyLabel","fy.label"],["fyLabelAnchor","fy.labelAnchor"],["fyLabelOffset","fy.labelOffset"],["fyFontVariant","fy.fontVariant"],["fyAriaLabel","fy.ariaLabel"],["fyAriaDescription","fy.ariaDescription"],["fyReverse","fy.reverse"],["colorScale","color.type"],["colorDomain","color.domain"],["colorRange","color.range"],["colorClamp","color.clamp"],["colorN","color.n"],["colorNice","color.nice"],["colorScheme","color.scheme"],["colorInterpolate","color.interpolate"],["colorPivot","color.pivot"],["colorSymmetric","color.symmetric"],["colorLabel","color.label"],["colorReverse","color.reverse"],["colorZero","color.zero"],["colorTickFormat","color.tickFormat"],["colorBase","color.base"],["colorExponent","color.exponent"],["colorConstant","color.constant"],["opacityScale","opacity.type"],["opacityDomain","opacity.domain"],["opacityRange","opacity.range"],["opacityClamp","opacity.clamp"],["opacityNice","opacity.nice"],["opacityLabel","opacity.label"],["opacityReverse","opacity.reverse"],["opacityZero","opacity.zero"],["opacityTickFormat","opacity.tickFormat"],["opacityBase","opacity.base"],["opacityExponent","opacity.exponent"],["opacityConstant","opacity.constant"],["symbolScale","symbol.type"],["symbolDomain","symbol.domain"],["symbolRange","symbol.range"],["rScale","r.type"],["rDomain","r.domain"],["rRange","r.range"],["rClamp","r.clamp"],["rNice","r.nice"],["rZero","r.zero"],["rBase","r.base"],["rExponent","r.exponent"],["rConstant","r.constant"],["lengthScale","length.type"],["lengthDomain","length.domain"],["lengthRange","length.range"],["lengthClamp","length.clamp"],["lengthNice","length.nice"],["lengthZero","length.zero"],["lengthBase","length.base"],["lengthExponent","length.exponent"],["lengthConstant","length.constant"],["projectionType","projection.type"],["projectionParallels","projection.parallels"],["projectionPrecision","projection.precision"],["projectionRotate","projection.rotate"],["projectionDomain","projection.domain"],["projectionInset","projection.inset"],["projectionInsetLeft","projection.insetLeft"],["projectionInsetRight","projection.insetRight"],["projectionInsetTop","projection.insetTop"],["projectionInsetBottom","projection.insetBottom"],["projectionClip","projection.clip"]]);function JTt(t,e,n){for(let i=0;i<e.length;++i){const r=e[i];i===e.length-1?t[r]=n:t=t[r]||(t[r]={})}}function QTt(t,e,n){for(const i in t){const r=KTt.get(i);if(r==null)throw new Error(`Unrecognized plot attribute: ${i}`);const s=t[i];typeof s=="symbol"?n.push(i):s!==void 0&&JTt(e,r.split("."),s)}}const ZTt=new Set(["frame","hexgrid","sphere","graticule"]);async function tFt(t){const e={marks:[]},n=[],{attributes:i,marks:r}=t;QTt(i,e,n);const s=[];for(const a of r)for(const{type:u,data:c,options:l}of a.plotSpecs()){if(ZTt.has(u))e.marks.push(r3[u](l));else if(Xq(c)){const f=Object.fromEntries(Object.entries(l).map(([d,h])=>{let p=h;if(typeof h=="string")p=c.getChild(h)??h;else if(typeof h=="object"){const g=c.getChild(h.value);p=g?{value:g}:h}return[d,p]}));e.marks.push(r3[u]({length:c.numRows},f))}else e.marks.push(r3[u](c,l));s.push(a.index)}nFt(e,t);const o=lC(e);iFt(o,s),eFt(t,o,i,n);for(const a of t.interactors)await a.init(o);return o}function eFt(t,e,n,i){i.forEach(r=>{const s=n[r];if(s===JW){if(!r.endsWith("Domain"))throw new Error(`Unsupported fixed attribute: ${r}`);const o=r.slice(0,-6),a=e.scale(o);a!=null&&a.domain&&t.setAttribute(r,n[`${o}Reverse`]?a.domain.slice().reverse():a.domain)}else throw new Error(`Unrecognized symbol: ${s}`)})}function nFt(t,e){const{marks:n}=e;rw("x",t,n),rw("y",t,n),rw("fx",t,n),rw("fy",t,n)}function rw(t,e,n){const i=e[t]||{};if(i.axis===null||i.label!==void 0)return;const r=n.map(c=>{var l;return(l=c.channelField(t))==null?void 0:l.field});if(r.every(c=>c==null))return;let s,o,a;for(let c=0;c<r.length;++c){const{column:l,label:f}=r[c]||{};l===void 0&&f===void 0||(s===void 0&&o===void 0?(s=l,o=f,a=rFt(n[c].data,t)||"number"):o!==f?o=void 0:s!==l&&(s=void 0))}let u=o||s;if(u!==void 0){if((a==="number"||a==="date")&&(t==="x"||t==="y")){i.percent&&(u=`${u} (%)`);const c=(t==="x"?1:-1)*(i.reverse?-1:1);t==="x"||i.labelAnchor==="center"?u=t==="x"==c<0?`← ${u}`:`${u} →`:u=`${c<0?"↑ ":"↓ "}${u}`}e[t]={...i,label:u}}}function iFt(t,e){const n=t.querySelectorAll('g[aria-label="facet"]');if(n.length)for(const i of n)N7(i,e);else N7(t,e)}function N7(t,e){let n=-1;for(const i of t.children){const r=i.getAttribute("aria-label")||"";i.nodeName==="style"||r.includes("-axis")||r.includes("-grid")||i.setAttribute("data-index",e[++n])}}function rFt(t,e){const{columns:n}=t,i=n[e]??n[e+"1"]??n[e+"2"];if(i){for(const r of i)if(r!=null)return r instanceof Date?"date":typeof r}}const sFt={width:640,marginLeft:40,marginRight:20,marginTop:20,marginBottom:30};class oFt{constructor(e){this.attributes={...sFt},this.listeners=null,this.interactors=[],this.legends=[],this.marks=[],this.markset=null,this.element=e||document.createElement("div"),this.element.setAttribute("class","plot"),this.element.style.display="flex",this.element.value=this,this.params=new Map,this.synch=d0t()}margins(){return{left:this.getAttribute("marginLeft"),top:this.getAttribute("marginTop"),bottom:this.getAttribute("marginBottom"),right:this.getAttribute("marginRight")}}innerWidth(){const{left:e,right:n}=this.margins();return this.getAttribute("width")-e-n}innerHeight(e=400){const{top:n,bottom:i}=this.margins();let r=this.getAttribute("height");return r==null&&e!=null&&(r=e,this.setAttribute("height",r,{silent:!0})),r-n-i}pending(e){this.synch.pending(e)}update(e){return this.synch.ready(e)&&!this.pendingRender&&(this.pendingRender=!0,requestAnimationFrame(()=>this.render())),this.synch.promise}async render(){this.pendingRender=!1;const e=await tFt(this),n=this.legends.flatMap(({legend:i,include:r})=>{const s=i.init(e);return r?s:[]});this.element.replaceChildren(e,...n),this.synch.resolve()}getAttribute(e){return this.attributes[e]}setAttribute(e,n,i){var r,s;return Jq(this.attributes[e],n)?(n===void 0?delete this.attributes[e]:this.attributes[e]=n,i!=null&&i.silent||(s=(r=this.listeners)==null?void 0:r.get(e))==null||s.forEach(o=>o(e,n)),!0):!1}addAttributeListener(e,n){const i=this.listeners||(this.listeners=new Map);return i.has(e)||i.set(e,new Set),i.get(e).add(n),this}removeAttributeListener(e,n){var i,r;return(r=(i=this.listeners)==null?void 0:i.get(e))==null?void 0:r.delete(n)}addParams(e,n){const{params:i}=this;for(const r of n)i.has(r)?i.get(r).push(e):(i.set(r,[e]),r.addEventListener("value",()=>Promise.allSettled(i.get(r).map(s=>s.requestQuery()))))}addMark(e){return e.setPlot(this,this.marks.length),this.marks.push(e),this.markset=null,this}get markSet(){return this.markset||(this.markset=new Set(this.marks))}addInteractor(e){return this.interactors.push(e),this}addLegend(e,n=!0){e.setPlot(this),this.legends.push({legend:e,include:n})}}function aFt(t){return typeof t!="string"?!1:(t=t.toLowerCase().trim(),t==="none"||t==="currentcolor"||t.startsWith("url(")&&t.endsWith(")")||t.startsWith("var(")&&t.endsWith(")")||Cl(t)!==null)}const uFt=new Set(["order","sort","label","anchor","curve","tension","marker","markerStart","markerMid","markerEnd","textAnchor","lineAnchor","lineHeight","textOverflow","monospace","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","frameAnchor","strokeLinejoin","strokeLinecap","strokeMiterlimit","strokeDasharray","strokeDashoffset","mixBlendMode","shapeRendering","imageRendering","preserveAspectRatio","interpolate","crossOrigin","paintOrder","pointerEvents","target"]);function cFt(t){return uFt.has(t)}const lFt=new Set(["asterisk","circle","cross","diamond","diamond2","hexagon","plus","square","square2","star","times","triangle","triangle2","wye"]);function fFt(t){return lFt.has(`${t}`.toLowerCase())}function O7(t){return Xq(t)?dFt(t):hFt(t)}function dFt(t){const{numRows:e,numCols:n,schema:{fields:i}}=t,r={};for(let s=0;s<n;++s){const o=i[s].name;r[o]?console.warn(`Redundant column name "${o}". Skipping...`):r[o]=Aht(t.getChildAt(s))}return{numRows:e,columns:r}}function hFt(t){const e=t.length;if(typeof t[0]=="object"){const n=e?Object.keys(t[0]):[],i={};return n.length>0&&n.forEach(r=>{i[r]=t.map(s=>s[r])}),{numRows:e,columns:i}}else return{numRows:e,values:t}}const wtt=t=>t==="stroke"||t==="fill",pFt=t=>/opacity$/i.test(t),gFt=t=>t==="symbol",mFt=(t,e)=>t!=="sort"&&t!=="tip"&&e!=null&&!Array.isArray(e),s3=(t,e)=>({channel:t,field:e,as:e instanceof Sl?e.column:t}),o3=(t,e)=>({channel:t,value:e}),R7=t=>Array.isArray(t);let _tt=class extends BS{constructor(e,n,i,r={}){var c;super((c=n==null?void 0:n.options)==null?void 0:c.filterBy),this.type=e,this.reqs=r,this.source=n,R7(this.source)&&(this.data=O7(this.source));const s=this.channels=[],o=this.detail=new Set,a=this.params=new Set,u=(l,f)=>{const d=typeof f;if(l==="channels")for(const h in f)o.add(h),u(h,f[h]);else if(d==="function"&&f[h0t]){const h=f(this,l);for(const p in h)u(p,h[p])}else if(d==="string")cFt(l)||wtt(l)&&aFt(f)||gFt(l)&&fFt(f)?s.push(o3(l,f)):s.push(s3(l,zq(f)));else if(wg(f))if(Array.isArray(f.columns))s.push(s3(l,f)),a.add(f);else{const h=o3(l,f.value);s.push(h),f.addEventListener("value",p=>(h.value=p,this.update()))}else d==="object"&&mFt(l,f)?s.push(s3(l,f)):f!==void 0&&s.push(o3(l,f))};for(const l in i)u(l,i[l])}setPlot(e,n){var i;this.plot=e,this.index=n,e.addParams(this,this.params),(i=this.source)!=null&&i.table&&this.queryPending()}hasOwnData(){return this.source==null||R7(this.source)}hasFieldInfo(){return!!this._fieldInfo}channel(e){return this.channels.find(n=>n.channel===e)}channelField(e,{exact:n=!1}={}){const i=n?this.channel(e):this.channels.find(r=>r.channel.startsWith(e));return i!=null&&i.field?i:null}fields(){var s,o,a;if(this.hasOwnData())return null;const{source:{table:e},channels:n,reqs:i}=this,r=new Map;for(const{channel:u,field:c}of n){if(!c)continue;const l=((s=c.stats)==null?void 0:s.stats)||[],f=((o=c.stats)==null?void 0:o.column)??c,d=r.get(f)??r.set(f,new Set).get(f);l.forEach(h=>d.add(h)),(a=i[u])==null||a.forEach(h=>d.add(h))}return Array.from(r,([u,c])=>({table:e,column:u,stats:c}))}fieldInfo(e){var i;const n=Object.fromEntries(e.map(r=>[r.column,r]));for(const r of this.channels){const{field:s}=r;s&&Object.assign(r,n[((i=s.stats)==null?void 0:i.column)??s])}return this._fieldInfo=!0,this}query(e=[]){if(this.hasOwnData())return null;const{channels:n,source:{table:i}}=this;return bFt(n,i).where(e)}queryPending(){return this.plot.pending(this),this}queryResult(e){return this.data=O7(e),this}update(){return this.plot.update(this)}plotSpecs(){const{type:e,detail:n,channels:i}=this,{numRows:r,values:s,columns:o}=this.data||{},a={},u={};for(const f of i){const d=n.has(f.channel)?u:a;d[f.channel]=yFt(f,o)}n.size&&(a.channels=u);const c=s??(this.data?{length:r}:null);return[{type:e,data:c,options:a}]}};function yFt(t,e){const n=(e==null?void 0:e[t.as])??t.as;return Object.hasOwn(t,"value")?t.value:wtt(t.channel)?{value:n,scale:"color"}:pFt(t.channel)?{value:n,scale:"opacity"}:n}function bFt(t,e,n=[]){const i=Jn.from({source:e}),r=new Set;let s=!1;for(const o of t){const{channel:a,field:u,as:c}=o;if(!n.includes(a)){if(a==="orderby")i.orderby(o.value);else if(u){if(u.aggregate)s=!0;else{if(r.has(c))continue;r.add(c)}i.select({[c]:u})}}}return s&&i.groupby(Array.from(r)),i}function vFt(t,e){const{plot:n}=t;let i=n.getAttribute(`${e}Scale`);if(!i){const{type:s}=t.channelField(e);i=s==="date"?"time":"linear"}const r={type:i};switch(i){case"log":r.base=n.getAttribute(`${e}Base`)??10;break;case"pow":r.exponent=n.getAttribute(`${e}Exponent`)??1;break;case"symlog":r.constant=n.getAttribute(`${e}Constant`)??1;break}return Wq(r)}function wFt(t,e,n,i,r=1,s){const{field:o}=t.channelField(e);s=s??o;const{type:a,apply:u,sqlApply:c}=vFt(t,e),l=!!t.plot.getAttribute(`${e}Reverse`),[f,d]=i.map(b=>u(b)),h=c(s),p=a==="time"||a==="utc"?h:s,g=d===f?0:(n-r)/(d-f),m=g!==1?` * ${g}::DOUBLE`:"";return[l?ae`(${d} - ${h}::DOUBLE)${m}`:ae`(${h}::DOUBLE - ${f})${m}`,p]}function _Ft(t,e){if(!t)return;let n,i;const r=(s,o)=>{if(s==="BETWEEN"&&`${o.field}`===e){const{range:a}=o;a&&(n==null||a[0]<n)&&(n=a[0]),a&&(i==null||a[1]>i)&&(i=a[1])}};return Array.isArray(t)?t.forEach(s=>{var o;return(o=s.visit)==null?void 0:o.call(s,r)}):t.visit&&t.visit(r),n!=null&&i!=null&&n!==i?[n,i]:void 0}class xFt extends _tt{constructor(e,n,i){const r=e.endsWith("X")?"y":e.endsWith("Y")?"x":null,s=r?{[r]:["min","max"]}:void 0;super(e,n,i,s),this.dim=r}query(e=[]){var g;const{plot:n,dim:i,source:r}=this,{optimize:s=!0}=r.options||{},o=super.query(e);if(!i)return o;const a=i==="x"?"y":"x",u=(g=this.channelField(a,{exact:!0}))==null?void 0:g.as,{field:c,as:l,type:f,min:d,max:h}=this.channelField(i);if(s&&(f==="date"||f==="number")&&u){const m=i==="x"?n.innerWidth():n.innerHeight(),[y,b]=_Ft(e,c)||[d,h],[v]=wFt(this,i,m,[y,b],1,l),w=o.select().map(_=>_.as).filter(_=>_!==l&&_!==u);return SFt(o,v,l,u,w)}else return o.orderby(c)}}function SFt(t,e,n,i,r=[]){const s=ae`FLOOR(${e})::INTEGER`,o=a=>Jn.from(t).select(a).groupby(s,r);return Jn.union(o([{[n]:AM(n),[i]:d5(i,n)},...r]),o([{[n]:EM(n),[i]:h5(i,n)},...r]),o([{[n]:d5(n,i),[i]:AM(i)},...r]),o([{[n]:h5(n,i),[i]:EM(i)},...r])).orderby(r,n)}function EFt(t){const e=t.toLowerCase(),n=t.length;let i="";for(let r=0;r<n;++r)i+=(t[r]!==e[r]?"-":"")+e[r];return i}function AFt(t){const e={};for(const n in t)e[EFt(n)]=t[n];return e}function xtt(t){const e=t.on;let n=!0;function i(r){n=!1,r(),n=!0}return t.reset=(...r)=>{i(()=>t.clear(...r))},t.moveSilent=(...r)=>{i(()=>t.move(...r))},t.on=(...r)=>{if(r.length>1&&r[1]){const s=r[1];r[1]=(...o)=>n&&s(...o)}return e(...r)},t}function $Ft(){return xtt(Tvt())}function IFt(){return xtt(Fvt())}const L7=1e-12;function MFt(t,e){return t===e||t&&e&&Math.abs(t[0]-e[0])<L7&&Math.abs(t[1]-e[1])<L7||!1}function TFt(t,e){var i;const n=(i=t.channelField(e))==null?void 0:i.field;return(n==null?void 0:n.basis)||n}function FFt(t,e,n=1){return e.invert(n*Math.floor(t/n))}function kFt(){const t=this,e=t.getScreenCTM;let n;t.getScreenCTM=()=>t.isConnected?n=e.call(t):n}class DFt{constructor(e,{channel:n,selection:i,field:r=void 0,pixelSize:s=1,peers:o=!0,brush:a}){this.mark=e,this.channel=n,this.pixelSize=s||1,this.selection=i,this.peers=o,this.field=r||TFt(e,n),this.style=a&&AFt(a),this.brush=n==="y"?IFt():$Ft(),this.brush.on("brush end",({selection:u})=>this.publish(u))}reset(){this.value=void 0,this.g&&this.brush.reset(this.g)}activate(){this.selection.activate(this.clause(this.value||[0,1]))}publish(e){let n;e&&(n=e.map(i=>FFt(i,this.scale,this.pixelSize)).sort((i,r)=>i-r)),MFt(n,this.value)||(this.value=n,this.g.call(this.brush.moveSilent,e),this.selection.update(this.clause(n)))}clause(e){const{mark:n,pixelSize:i,field:r,scale:s}=this;return{source:this,schema:{type:"interval",pixelSize:i,scales:[s]},clients:this.peers?n.plot.markSet:new Set().add(n),value:e,predicate:e?i_(r,e):null}}init(e,n){var c;const{brush:i,channel:r,style:s}=this;this.scale=e.scale(r);const o=e.scale("x").range,a=e.scale("y").range;i.extent([[yi(o),yi(a)],[tn(o),tn(a)]]);const u=fi(e).selectAll('g[aria-label="facet"]');if(n=u.size()?u:fi(n??e),this.g=n.append("g").attr("class",`interval-${r}`).each(kFt).call(i).call(i.moveSilent,(c=this.value)==null?void 0:c.map(this.scale.apply)),s){const l=this.g.selectAll("rect.selection");for(const f in s)l.attr(f,s[f])}e.addEventListener("pointerenter",l=>{l.buttons||this.activate()})}}const CFt=t=>t&&typeof t=="object"&&!Array.isArray(t);class NFt extends BS{constructor({element:e,filterBy:n,from:i,column:r,label:s=r,format:o=l=>l,options:a,value:u,as:c}={}){var f,d,h,p;super(n),this.from=i,this.column=r,this.selection=c,this.format=o,this.element=e??document.createElement("div"),this.element.setAttribute("class","input"),this.element.value=this;const l=document.createElement("label");l.innerText=s||r,this.element.appendChild(l),this.select=document.createElement("select"),a&&(this.data=a.map(g=>CFt(g)?g:{value:g}),this.update()),u=u??((f=this.selection)==null?void 0:f.value)??((h=(d=this.data)==null?void 0:d[0])==null?void 0:h.value),((p=this.selection)==null?void 0:p.value)===void 0&&this.publish(u),this.element.appendChild(this.select),this.selection&&(this.select.addEventListener("input",()=>{this.publish(this.selectedValue()??null)}),v5(this.selection)||this.selection.addEventListener("value",g=>{g!==this.select.value&&this.selectedValue(g)}))}selectedValue(e){var n;if(arguments.length===0){const i=this.select.selectedIndex;return this.data[i].value}else{const i=(n=this.data)==null?void 0:n.findIndex(r=>r.value===e);i>=0?this.select.selectedIndex=i:this.select.value=String(e)}}reset(){this.select.selectedIndex=this.from?0:-1}publish(e){const{selection:n,column:i}=this;v5(n)?n.update({source:this,schema:{type:"point"},value:e,predicate:e!==""&&e!==void 0?Pdt(i,xM(e)):null}):My(n)&&n.update(e)}query(e=[]){const{from:n,column:i}=this;return n?Jn.from(n).select({value:i}).distinct().where(e).orderby(i):null}queryResult(e){return this.data=[{value:"",label:"All"},...e],this}update(){var r;const{data:e,format:n,select:i}=this;i.replaceChildren();for(const{value:s,label:o}of e){const a=document.createElement("option");a.setAttribute("value",s),a.innerText=o??n(s),this.select.appendChild(a)}return this.selection&&this.selectedValue(((r=this.selection)==null?void 0:r.value)??""),this}}const OFt=Ett(t=>{const e=Stt(t);return n=>n==null?"":typeof n=="number"?e(n):n instanceof Date?RFt(n):`${n}`}),Stt=Ett(t=>e=>e===0?"0":e.toLocaleString(t));OFt();Stt();function RFt(t){return XK(t,"Invalid Date")}function Ett(t){let e=null,n;return(i="en")=>i===e?n:n=t(e=i)}function Att(t,...e){var i;const n=((i=t==null?void 0:t.context)==null?void 0:i.coordinator)??K0();for(const r of e)n.connect(r)}function LFt(t,e,n){const i=new e(n);return Att(t,i),i.element}function BFt(t){return LFt(this,NFt,t)}function $tt({direction:t="vertical",wrap:e=!1},n){const i=document.createElement("div");return i.style.display="flex",i.style.flexDirection=t==="vertical"?"column":"row",i.style.flexWrap=e?e===!0?"wrap":e:"nowrap",i.style.justifyContent="flex-start",i.style.alignItems="flex-start",n.forEach(r=>i.appendChild(r)),Object.assign(i,{value:{element:i}}),i}function PFt(...t){return $tt({direction:"vertical"},t.flat())}function B7(...t){return $tt({direction:"horizontal"},t.flat())}function Itt({dim:t="width",size:e=10}){const n=document.createElement("span");return n.style.display="inline-block",n.style[t]=Number.isNaN(+e)?e:`${e}px`,Object.assign(n,{value:{element:n}})}function zFt(t){return Itt({dim:"height",size:t})}function P7(t){return Itt({dim:"width",size:t})}function Mtt(t,e,n){My(n)?(n.addEventListener("value",i=>{t.setAttribute(e,i),t.update()}),n.value!==void 0&&t.setAttribute(e,n.value)):t.setAttribute(e,n)}function UFt(t,e){return n=>{Mtt(n,t,e)}}function jFt(t){return e=>{for(const[n,i]of Object.entries(t))Mtt(e,n,i)}}function qFt(t){return jFt({xDomain:t,yDomain:t})}const Ttt=t=>e=>UFt(t,e),VFt=Ttt("width"),WFt=Ttt("height");function GFt(t,e){return{table:t,options:e}}const YFt=new Set(["frame","axisX","axisY","axisFx","axisFy","gridX","gridY","gridFx","gridFy","hexgrid","graticule","sphere"]);function HFt(t,e,n={}){arguments.length===2&&!Array.isArray(e)&&(n=e,e=YFt.has(t)?null:[{}]);const i=t.startsWith("area")||t.startsWith("line")?xFt:_tt;return XFt(i,t,e,n)}function XFt(t,e,n,i){return r=>{r.addMark(new t(e,n,i))}}const KFt=(...t)=>HFt("dot",...t);function JFt(t,e){return n=>{const i=n.marks[n.marks.length-1];n.addInteractor(new t(i,e))}}function QFt({as:t,...e}){return JFt(DFt,{...e,selection:t,channel:"x"})}function ZFt(...t){const e=new oFt;return t.flat().forEach(n=>n(e)),Att(this,...e.marks),e.update(),e.element}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var tkt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},t(e,n)};return function(e,n){t(e,n);function i(){this.constructor=e}e.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),ekt=Object.prototype.hasOwnProperty;function QT(t,e){return ekt.call(t,e)}function ZT(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var i=[];for(var r in t)QT(t,r)&&i.push(r);return i}function ts(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function tF(t){for(var e=0,n=t.length,i;e<n;){if(i=t.charCodeAt(e),i>=48&&i<=57){e++;continue}return!1}return!0}function nd(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Ftt(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function eF(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(eF(t[e]))return!0}else if(typeof t=="object"){for(var i=ZT(t),r=i.length,s=0;s<r;s++)if(eF(t[i[s]]))return!0}}return!1}function z7(t,e){var n=[t];for(var i in e){var r=typeof e[i]=="object"?JSON.stringify(e[i],null,2):e[i];typeof r<"u"&&n.push(i+": "+r)}return n.join(`
`)}var ktt=function(t){tkt(e,t);function e(n,i,r,s,o){var a=this.constructor,u=t.call(this,z7(n,{name:i,index:r,operation:s,tree:o}))||this;return u.name=i,u.index=r,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=z7(n,{name:i,index:r,operation:s,tree:o}),u}return e}(Error),vn=ktt,nkt=ts,zp={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var i=t[e];return delete t[e],{newDocument:n,removed:i}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:function(t,e,n){var i=Wx(n,this.path);i&&(i=ts(i));var r=kd(n,{op:"remove",path:this.from}).removed;return kd(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(t,e,n){var i=Wx(n,this.from);return kd(n,{op:"add",path:this.path,value:ts(i)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:D1(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},ikt={add:function(t,e,n){return tF(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var i=t.splice(e,1);return{newDocument:n,removed:i[0]}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:zp.move,copy:zp.copy,test:zp.test,_get:zp._get};function Wx(t,e){if(e=="")return t;var n={op:"_get",path:e};return kd(t,n),n.value}function kd(t,e,n,i,r,s){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):Gx(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Wx(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=D1(t,e.value),o.test===!1)throw new vn("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new vn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{i||(t=ts(t));var a=e.path||"",u=a.split("/"),c=t,l=1,f=u.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Gx;;){if(h=u[l],h&&h.indexOf("~")!=-1&&(h=Ftt(h)),r&&(h=="__proto__"||h=="prototype"&&l>0&&u[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(c[h]===void 0?d=u.slice(0,l).join("/"):l==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),l++,Array.isArray(c)){if(h==="-")h=c.length;else{if(n&&!tF(h))throw new vn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);tF(h)&&(h=~~h)}if(l>=f){if(n&&e.op==="add"&&h>c.length)throw new vn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=ikt[e.op].call(e,c,h,t);if(o.test===!1)throw new vn("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(l>=f){var o=zp[e.op].call(e,c,h,t);if(o.test===!1)throw new vn("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(c=c[h],n&&l<f&&(!c||typeof c!="object"))throw new vn("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function eA(t,e,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(e))throw new vn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(t=ts(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=kd(t,e[o],n,!0,r,o),t=s[o].newDocument;return s.newDocument=t,s}function rkt(t,e,n){var i=kd(t,e);if(i.test===!1)throw new vn("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return i.newDocument}function Gx(t,e,n,i){if(typeof t!="object"||t===null||Array.isArray(t))throw new vn("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(zp[t.op]){if(typeof t.path!="string")throw new vn("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new vn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new vn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new vn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&eF(t.value))throw new vn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var r=t.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new vn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==i)throw new vn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Dtt([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new vn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new vn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Dtt(t,e,n){try{if(!Array.isArray(t))throw new vn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)eA(ts(e),ts(t),n||!0);else{n=n||Gx;for(var i=0;i<t.length;i++)n(t[i],i,e,void 0)}}catch(r){if(r instanceof vn)return r;throw r}}function D1(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),i=Array.isArray(e),r,s,o;if(n&&i){if(s=t.length,s!=e.length)return!1;for(r=s;r--!==0;)if(!D1(t[r],e[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(r=s;r--!==0;)if(!e.hasOwnProperty(a[r]))return!1;for(r=s;r--!==0;)if(o=a[r],!D1(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}const skt=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:vn,_areEquals:D1,applyOperation:kd,applyPatch:eA,applyReducer:rkt,deepClone:nkt,getValueByPointer:Wx,validate:Dtt,validator:Gx},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var PC=new WeakMap,okt=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),akt=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function ukt(t){return PC.get(t)}function ckt(t,e){return t.observers.get(e)}function lkt(t,e){t.observers.delete(e.callback)}function fkt(t,e){e.unobserve()}function dkt(t,e){var n=[],i,r=ukt(t);if(!r)r=new okt(t),PC.set(t,r);else{var s=ckt(r,e);i=s&&s.observer}if(i)return i;if(i={},r.value=ts(t),e){i.callback=e,i.next=null;var o=function(){nF(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=t,i.unobserve=function(){nF(i),clearTimeout(i.next),lkt(r,i),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(e,new akt(e,i)),i}function nF(t,e){e===void 0&&(e=!1);var n=PC.get(t.object);zC(n.value,t.object,t.patches,"",e),t.patches.length&&eA(n.value,t.patches);var i=t.patches;return i.length>0&&(t.patches=[],t.callback&&t.callback(i)),i}function zC(t,e,n,i,r){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=ZT(e),o=ZT(t),a=!1,u=o.length-1;u>=0;u--){var c=o[u],l=t[c];if(QT(e,c)&&!(e[c]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var f=e[c];typeof l=="object"&&l!=null&&typeof f=="object"&&f!=null&&Array.isArray(l)===Array.isArray(f)?zC(l,f,n,i+"/"+nd(c),r):l!==f&&(r&&n.push({op:"test",path:i+"/"+nd(c),value:ts(l)}),n.push({op:"replace",path:i+"/"+nd(c),value:ts(f)}))}else Array.isArray(t)===Array.isArray(e)?(r&&n.push({op:"test",path:i+"/"+nd(c),value:ts(l)}),n.push({op:"remove",path:i+"/"+nd(c)}),a=!0):(r&&n.push({op:"test",path:i,value:t}),n.push({op:"replace",path:i,value:e}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var c=s[u];!QT(t,c)&&e[c]!==void 0&&n.push({op:"add",path:i+"/"+nd(c),value:ts(e[c])})}}}function hkt(t,e,n){n===void 0&&(n=!1);var i=[];return zC(t,e,i,"",n),i}const pkt=Object.freeze(Object.defineProperty({__proto__:null,compare:hkt,generate:nF,observe:dkt,unobserve:fkt},Symbol.toStringTag,{value:"Module"}));Object.assign({},skt,pkt,{JsonPatchError:ktt,deepClone:ts,escapePathComponent:nd,unescapePathComponent:Ftt});var gkt=/("(?:[^\\"]|\\.)*")|[:,]/g,mkt=function(e,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,u,c){var l,f,d,h,p,g,m,y,b,v,w,_;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),w=JSON.stringify(a,s),w===void 0)return w;if(m=r-u.length-c,w.length<=m&&(b=w.replace(gkt,function(S,x){return x||S+" "}),b.length<=m))return b;if(s!=null&&(a=JSON.parse(w),s=void 0),typeof a=="object"&&a!==null){if(y=u+i,d=[],f=0,Array.isArray(a))for(v="[",l="]",m=a.length;f<m;f++)d.push(o(a[f],y,f===m-1?0:1)||"null");else for(v="{",l="}",g=Object.keys(a),m=g.length;f<m;f++)h=g[f],p=JSON.stringify(h)+": ",_=o(a[h],y,p.length+(f===m-1?0:1)),_!==void 0&&d.push(p+_);if(d.length>0)return[v,i+d.join(`,
`+y),l].join(`
`+u)}return w}(e,"",0)};const a3=ltt(mkt);function qr(t,e,n){return t.fields=e||[],t.fname=n,t}function En(t){return t==null?null:t.fname}function Ci(t){return t==null?null:t.fields}function Ctt(t){return t.length===1?ykt(t[0]):bkt(t)}const ykt=t=>function(e){return e[t]},bkt=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function q(t){throw Error(t)}function Za(t){const e=[],n=t.length;let i=null,r=0,s="",o,a,u;t=t+"";function c(){e.push(s+t.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=t[a],u==="\\")s+=t.substring(o,a++),o=a;else if(u===i)c(),i=null,r=-1;else{if(i)continue;o===r&&u==='"'||o===r&&u==="'"?(o=a+1,i=u):u==="."&&!r?a>o?c():o=a+1:u==="["?(a>o&&c(),r=o=a+1):u==="]"&&(r||q("Access path missing open bracket: "+t),r>0&&c(),r=0,o=a+1)}return r&&q("Access path missing closing bracket: "+t),i&&q("Access path missing closing quote: "+t),a>o&&(a++,c()),e}function Vs(t,e,n){const i=Za(t);return t=i.length===1?i[0]:t,qr((n&&n.get||Ctt)(i),[t],e||t)}const Pb=Vs("id"),Li=qr(t=>t,[],"identity"),tl=qr(()=>0,[],"zero"),Bm=qr(()=>1,[],"one"),Ws=qr(()=>!0,[],"true"),zc=qr(()=>!1,[],"false");function vkt(t,e,n){const i=[e].concat([].slice.call(n));console[t].apply(console,i)}const Ntt=0,UC=1,jC=2,Ott=3,Rtt=4;function qC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vkt,i=t||Ntt;return{level(r){return arguments.length?(i=+r,this):i},error(){return i>=UC&&n(e||"error","ERROR",arguments),this},warn(){return i>=jC&&n(e||"warn","WARN",arguments),this},info(){return i>=Ott&&n(e||"log","INFO",arguments),this},debug(){return i>=Rtt&&n(e||"log","DEBUG",arguments),this}}}var W=Array.isArray;function ut(t){return t===Object(t)}const U7=t=>t!=="__proto__";function Pm(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce((i,r)=>{for(const s in r)if(s==="signals")i.signals=wkt(i.signals,r.signals);else{const o=s==="legend"?{layout:1}:s==="style"?!0:null;zm(i,s,r[s],o)}return i},{})}function zm(t,e,n,i){if(!U7(e))return;let r,s;if(ut(n)&&!W(n)){s=ut(t[e])?t[e]:t[e]={};for(r in n)i&&(i===!0||i[r])?zm(s,r,n[r]):U7(r)&&(s[r]=n[r])}else t[e]=n}function wkt(t,e){if(t==null)return e;const n={},i=[];function r(s){n[s.name]||(n[s.name]=1,i.push(s))}return e.forEach(r),t.forEach(r),i}function pe(t){return t[t.length-1]}function Ti(t){return t==null||t===""?null:+t}const Ltt=t=>e=>t*Math.exp(e),Btt=t=>e=>Math.log(t*e),Ptt=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),ztt=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,Yx=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function nA(t,e,n,i){const r=n(t[0]),s=n(pe(t)),o=(s-r)*e;return[i(r-o),i(s-o)]}function Utt(t,e){return nA(t,e,Ti,Li)}function jtt(t,e){var n=Math.sign(t[0]);return nA(t,e,Btt(n),Ltt(n))}function qtt(t,e,n){return nA(t,e,Yx(n),Yx(1/n))}function Vtt(t,e,n){return nA(t,e,Ptt(n),ztt(n))}function iA(t,e,n,i,r){const s=i(t[0]),o=i(pe(t)),a=e!=null?i(e):(s+o)/2;return[r(a+(s-a)*n),r(a+(o-a)*n)]}function VC(t,e,n){return iA(t,e,n,Ti,Li)}function WC(t,e,n){const i=Math.sign(t[0]);return iA(t,e,n,Btt(i),Ltt(i))}function Hx(t,e,n,i){return iA(t,e,n,Yx(i),Yx(1/i))}function GC(t,e,n,i){return iA(t,e,n,Ptt(i),ztt(i))}function Wtt(t){return 1+~~(new Date(t).getMonth()/3)}function Gtt(t){return 1+~~(new Date(t).getUTCMonth()/3)}function ot(t){return t!=null?W(t)?t:[t]:[]}function Ytt(t,e,n){let i=t[0],r=t[1],s;return r<i&&(s=r,r=i,i=s),s=r-i,s>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-s),i+s]}function Qt(t){return typeof t=="function"}const _kt="descending";function YC(t,e,n){n=n||{},e=ot(e)||[];const i=[],r=[],s={},o=n.comparator||xkt;return ot(t).forEach((a,u)=>{a!=null&&(i.push(e[u]===_kt?-1:1),r.push(a=Qt(a)?a:Vs(a,null,n)),(Ci(a)||[]).forEach(c=>s[c]=1))}),r.length===0?null:qr(o(r,i),Object.keys(s))}const rA=(t,e)=>(t<e||t==null)&&e!=null?-1:(t>e||e==null)&&t!=null?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e===e?-1:e!==e&&t===t?1:0),xkt=(t,e)=>t.length===1?Skt(t[0],e[0]):Ekt(t,e,t.length),Skt=(t,e)=>function(n,i){return rA(t(n),t(i))*e},Ekt=(t,e,n)=>(e.push(0),function(i,r){let s,o=0,a=-1;for(;o===0&&++a<n;)s=t[a],o=rA(s(i),s(r));return o*e[a]});function Bi(t){return Qt(t)?t:()=>t}function HC(t,e){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(e(i),n=null),t)}}function Jt(t){for(let e,n,i=1,r=arguments.length;i<r;++i){e=arguments[i];for(n in e)t[n]=e[n]}return t}function Ua(t,e){let n=0,i,r,s,o;if(t&&(i=t.length))if(e==null){for(r=t[n];n<i&&(r==null||r!==r);r=t[++n]);for(s=o=r;n<i;++n)r=t[n],r!=null&&(r<s&&(s=r),r>o&&(o=r))}else{for(r=e(t[n]);n<i&&(r==null||r!==r);r=e(t[++n]));for(s=o=r;n<i;++n)r=e(t[n]),r!=null&&(r<s&&(s=r),r>o&&(o=r))}return[s,o]}function Htt(t,e){const n=t.length;let i=-1,r,s,o,a,u;if(e==null){for(;++i<n;)if(s=t[i],s!=null&&s>=s){r=o=s;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)s=t[i],s!=null&&(r>s&&(r=s,a=i),o<s&&(o=s,u=i))}else{for(;++i<n;)if(s=e(t[i],i,t),s!=null&&s>=s){r=o=s;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)s=e(t[i],i,t),s!=null&&(r>s&&(r=s,a=i),o<s&&(o=s,u=i))}return[a,u]}const Akt=Object.prototype.hasOwnProperty;function xt(t,e){return Akt.call(t,e)}const sw={};function Um(t){let e={},n;function i(s){return xt(e,s)&&e[s]!==sw}const r={size:0,empty:0,object:e,has:i,get(s){return i(s)?e[s]:void 0},set(s,o){return i(s)||(++r.size,e[s]===sw&&--r.empty),e[s]=o,this},delete(s){return i(s)&&(--r.size,++r.empty,e[s]=sw),this},clear(){r.size=r.empty=0,r.object=e={}},test(s){return arguments.length?(n=s,r):n},clean(){const s={};let o=0;for(const a in e){const u=e[a];u!==sw&&(!n||!n(u))&&(s[a]=u,++o)}r.size=o,r.empty=0,r.object=e=s}};return t&&Object.keys(t).forEach(s=>{r.set(s,t[s])}),r}function Xtt(t,e,n,i,r,s){if(!n&&n!==0)return s;const o=+n;let a=t[0],u=pe(t),c;u<a&&(c=a,a=u,u=c),c=Math.abs(e-a);const l=Math.abs(u-e);return c<l&&c<=o?i:l<=o?r:s}function J(t,e,n){const i=t.prototype=Object.create(e.prototype);return Object.defineProperty(i,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),Jt(i,n)}function Up(t,e,n,i){let r=e[0],s=e[e.length-1],o;return r>s&&(o=r,r=s,s=o),n=n===void 0||n,i=i===void 0||i,(n?r<=t:r<t)&&(i?t<=s:t<s)}function gf(t){return typeof t=="boolean"}function gl(t){return Object.prototype.toString.call(t)==="[object Date]"}function Ktt(t){return t&&Qt(t[Symbol.iterator])}function be(t){return typeof t=="number"}function Jtt(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function at(t){return typeof t=="string"}function XC(t,e,n){t&&(t=e?ot(t).map(a=>a.replace(/\\(.)/g,"$1")):ot(t));const i=t&&t.length,r=n&&n.get||Ctt,s=a=>r(e?[a]:Za(a));let o;if(!i)o=function(){return""};else if(i===1){const a=s(t[0]);o=function(u){return""+a(u)}}else{const a=t.map(s);o=function(u){let c=""+a[0](u),l=0;for(;++l<i;)c+="|"+a[l](u);return c}}return qr(o,t,"key")}function Qtt(t,e){const n=t[0],i=pe(t),r=+e;return r?r===1?i:n+r*(i-n):n}const $kt=1e4;function Ztt(t){t=+t||$kt;let e,n,i;const r=()=>{e={},n={},i=0},s=(o,a)=>(++i>t&&(n=e,e={},i=1),e[o]=a);return r(),{clear:r,has:o=>xt(e,o)||xt(n,o),get:o=>xt(e,o)?e[o]:xt(n,o)?s(o,n[o]):void 0,set:(o,a)=>xt(e,o)?e[o]=a:s(o,a)}}function tet(t,e,n,i){const r=e.length,s=n.length;if(!s)return e;if(!r)return n;const o=i||new e.constructor(r+s);let a=0,u=0,c=0;for(;a<r&&u<s;++c)o[c]=t(e[a],n[u])>0?n[u++]:e[a++];for(;a<r;++a,++c)o[c]=e[a];for(;u<s;++u,++c)o[c]=n[u];return o}function ly(t,e){let n="";for(;--e>=0;)n+=t;return n}function eet(t,e,n,i){const r=n||" ",s=t+"",o=e-s.length;return o<=0?s:i==="left"?ly(r,o)+s:i==="center"?ly(r,~~(o/2))+s+ly(r,Math.ceil(o/2)):s+ly(r,o)}function zb(t){return t&&pe(t)-t[0]||0}function Q(t){return W(t)?"["+t.map(Q)+"]":ut(t)||at(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function KC(t){return t==null||t===""?null:!t||t==="false"||t==="0"?!1:!!t}const Ikt=t=>be(t)||gl(t)?t:Date.parse(t);function JC(t,e){return e=e||Ikt,t==null||t===""?null:e(t)}function QC(t){return t==null||t===""?null:t+""}function Mo(t){const e={},n=t.length;for(let i=0;i<n;++i)e[t[i]]=!0;return e}function net(t,e,n,i){const r=i??"…",s=t+"",o=s.length,a=Math.max(0,e-r.length);return o<=e?s:n==="left"?r+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+r+s.slice(o-~~(a/2)):s.slice(0,a)+r}function Hc(t,e,n){if(t)if(e){const i=t.length;for(let r=0;r<i;++r){const s=e(t[r]);s&&n(s,r,t)}}else t.forEach(n)}function Mkt(t){return t}function Tkt(t){if(t==null)return Mkt;var e,n,i=t.scale[0],r=t.scale[1],s=t.translate[0],o=t.translate[1];return function(a,u){u||(e=n=0);var c=2,l=a.length,f=new Array(l);for(f[0]=(e+=a[0])*i+s,f[1]=(n+=a[1])*r+o;c<l;)f[c]=a[c],++c;return f}}function Fkt(t,e){for(var n,i=t.length,r=i-e;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}function kkt(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(n){return j7(t,n)})}:j7(t,e)}function j7(t,e){var n=e.id,i=e.bbox,r=e.properties==null?{}:e.properties,s=iet(t,e);return n==null&&i==null?{type:"Feature",properties:r,geometry:s}:i==null?{type:"Feature",id:n,properties:r,geometry:s}:{type:"Feature",id:n,bbox:i,properties:r,geometry:s}}function iet(t,e){var n=Tkt(t.transform),i=t.arcs;function r(l,f){f.length&&f.pop();for(var d=i[l<0?~l:l],h=0,p=d.length;h<p;++h)f.push(n(d[h],h));l<0&&Fkt(f,p)}function s(l){return n(l)}function o(l){for(var f=[],d=0,h=l.length;d<h;++d)r(l[d],f);return f.length<2&&f.push(f[0]),f}function a(l){for(var f=o(l);f.length<4;)f.push(f[0]);return f}function u(l){return l.map(a)}function c(l){var f=l.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:l.geometries.map(c)};case"Point":d=s(l.coordinates);break;case"MultiPoint":d=l.coordinates.map(s);break;case"LineString":d=o(l.arcs);break;case"MultiLineString":d=l.arcs.map(o);break;case"Polygon":d=u(l.arcs);break;case"MultiPolygon":d=l.arcs.map(u);break;default:return null}return{type:f,coordinates:d}}return c(e)}function Dkt(t,e){var n={},i={},r={},s=[],o=-1;e.forEach(function(c,l){var f=t.arcs[c<0?~c:c],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=e[++o],e[o]=c,e[l]=d)}),e.forEach(function(c){var l=a(c),f=l[0],d=l[1],h,p;if(h=r[f])if(delete r[h.end],h.push(c),h.end=d,p=i[d]){delete i[p.start];var g=p===h?h:h.concat(p);i[g.start=h.start]=r[g.end=p.end]=g}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(c),h.start=f,p=r[f]){delete r[p.end];var m=p===h?h:p.concat(h);i[m.start=p.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[c],i[h.start=f]=r[h.end=d]=h});function a(c){var l=t.arcs[c<0?~c:c],f=l[0],d;return t.transform?(d=[0,0],l.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=l[l.length-1],c<0?[d,f]:[f,d]}function u(c,l){for(var f in c){var d=c[f];delete l[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),s.push(d)}}return u(r,i),u(i,r),e.forEach(function(c){n[c<0?~c:c]||s.push([c])}),s}function Ckt(t){return iet(t,Nkt.apply(this,arguments))}function Nkt(t,e,n){var i,r,s;if(arguments.length>1)i=Okt(t,e,n);else for(r=0,i=new Array(s=t.arcs.length);r<s;++r)i[r]=r;return{type:"MultiLineString",arcs:Dkt(t,i)}}function Okt(t,e,n){var i=[],r=[],s;function o(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:s})}function a(f){f.forEach(o)}function u(f){f.forEach(a)}function c(f){f.forEach(u)}function l(f){switch(s=f,f.type){case"GeometryCollection":f.geometries.forEach(l);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":c(f.arcs);break}}return l(e),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}const gi="year",Br="quarter",Ni="month",jn="week",Pr="date",Mi="day",ja="dayofyear",us="hours",cs="minutes",Gs="seconds",To="milliseconds",ZC=[gi,Br,Ni,jn,Pr,Mi,ja,us,cs,Gs,To],u3=ZC.reduce((t,e,n)=>(t[e]=1+n,t),{});function tN(t){const e=ot(t).slice(),n={};return e.length||q("Missing time unit."),e.forEach(r=>{xt(u3,r)?n[r]=1:q(`Invalid time unit: ${r}.`)}),(n[jn]||n[Mi]?1:0)+(n[Br]||n[Ni]||n[Pr]?1:0)+(n[ja]?1:0)>1&&q(`Incompatible time units: ${t}`),e.sort((r,s)=>u3[r]-u3[s]),e}const Rkt={[gi]:"%Y ",[Br]:"Q%q ",[Ni]:"%b ",[Pr]:"%d ",[jn]:"W%U ",[Mi]:"%a ",[ja]:"%j ",[us]:"%H:00",[cs]:"00:%M",[Gs]:":%S",[To]:".%L",[`${gi}-${Ni}`]:"%Y-%m ",[`${gi}-${Ni}-${Pr}`]:"%Y-%m-%d ",[`${us}-${cs}`]:"%H:%M"};function ret(t,e){const n=Jt({},Rkt,e),i=tN(t),r=i.length;let s="",o=0,a,u;for(o=0;o<r;)for(a=i.length;a>o;--a)if(u=i.slice(o,a).join("-"),n[u]!=null){s+=n[u],o=a;break}return s.trim()}const od=new Date;function eN(t){return od.setFullYear(t),od.setMonth(0),od.setDate(1),od.setHours(0,0,0,0),od}function set(t){return aet(new Date(t))}function oet(t){return iF(new Date(t))}function aet(t){return wo.count(eN(t.getFullYear())-1,t)}function iF(t){return Ol.count(eN(t.getFullYear())-1,t)}function rF(t){return eN(t).getDay()}function Lkt(t,e,n,i,r,s,o){if(0<=t&&t<100){const a=new Date(-1,e,n,i,r,s,o);return a.setFullYear(t),a}return new Date(t,e,n,i,r,s,o)}function uet(t){return fet(new Date(t))}function cet(t){return sF(new Date(t))}function fet(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return pl.count(e-1,t)}function sF(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return Rl.count(e-1,t)}function oF(t){return od.setTime(Date.UTC(t,0,1)),od.getUTCDay()}function Bkt(t,e,n,i,r,s,o){if(0<=t&&t<100){const a=new Date(Date.UTC(-1,e,n,i,r,s,o));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(t,e,n,i,r,s,o))}function det(t,e,n,i,r){const s=e||1,o=pe(t),a=(y,b,v)=>(v=v||y,Pkt(n[v],i[v],y===o&&s,b)),u=new Date,c=Mo(t),l=c[gi]?a(gi):Bi(2012),f=c[Ni]?a(Ni):c[Br]?a(Br):tl,d=c[jn]&&c[Mi]?a(Mi,1,jn+Mi):c[jn]?a(jn,1):c[Mi]?a(Mi,1):c[Pr]?a(Pr,1):c[ja]?a(ja,1):Bm,h=c[us]?a(us):tl,p=c[cs]?a(cs):tl,g=c[Gs]?a(Gs):tl,m=c[To]?a(To):tl;return function(y){u.setTime(+y);const b=l(u);return r(b,f(u),d(u,b),h(u),p(u),g(u),m(u))}}function Pkt(t,e,n,i){const r=n<=1?t:i?(s,o)=>i+n*Math.floor((t(s,o)-i)/n):(s,o)=>n*Math.floor(t(s,o)/n);return e?(s,o)=>e(r(s,o),o):r}function qg(t,e,n){return e+t*7-(n+6)%7}const zkt={[gi]:t=>t.getFullYear(),[Br]:t=>Math.floor(t.getMonth()/3),[Ni]:t=>t.getMonth(),[Pr]:t=>t.getDate(),[us]:t=>t.getHours(),[cs]:t=>t.getMinutes(),[Gs]:t=>t.getSeconds(),[To]:t=>t.getMilliseconds(),[ja]:t=>aet(t),[jn]:t=>iF(t),[jn+Mi]:(t,e)=>qg(iF(t),t.getDay(),rF(e)),[Mi]:(t,e)=>qg(1,t.getDay(),rF(e))},Ukt={[Br]:t=>3*t,[jn]:(t,e)=>qg(t,0,rF(e))};function het(t,e){return det(t,e||1,zkt,Ukt,Lkt)}const jkt={[gi]:t=>t.getUTCFullYear(),[Br]:t=>Math.floor(t.getUTCMonth()/3),[Ni]:t=>t.getUTCMonth(),[Pr]:t=>t.getUTCDate(),[us]:t=>t.getUTCHours(),[cs]:t=>t.getUTCMinutes(),[Gs]:t=>t.getUTCSeconds(),[To]:t=>t.getUTCMilliseconds(),[ja]:t=>fet(t),[jn]:t=>sF(t),[Mi]:(t,e)=>qg(1,t.getUTCDay(),oF(e)),[jn+Mi]:(t,e)=>qg(sF(t),t.getUTCDay(),oF(e))},qkt={[Br]:t=>3*t,[jn]:(t,e)=>qg(t,0,oF(e))};function pet(t,e){return det(t,e||1,jkt,qkt,Bkt)}const Vkt={[gi]:zs,[Br]:Kd.every(3),[Ni]:Kd,[jn]:Ol,[Pr]:wo,[Mi]:wo,[ja]:wo,[us]:Am,[cs]:Sm,[Gs]:Qr,[To]:Cg},Wkt={[gi]:Us,[Br]:Jd.every(3),[Ni]:Jd,[jn]:Rl,[Pr]:pl,[Mi]:pl,[ja]:pl,[us]:$m,[cs]:Em,[Gs]:Qr,[To]:Cg};function jm(t){return Vkt[t]}function qm(t){return Wkt[t]}function get(t,e,n){return t?t.offset(e,n):void 0}function met(t,e,n){return get(jm(t),e,n)}function yet(t,e,n){return get(qm(t),e,n)}function bet(t,e,n,i){return t?t.range(e,n,i):void 0}function vet(t,e,n,i){return bet(jm(t),e,n,i)}function wet(t,e,n,i){return bet(qm(t),e,n,i)}const fy=1e3,dy=fy*60,hy=dy*60,sA=hy*24,Gkt=sA*7,q7=sA*30,aF=sA*365,_et=[gi,Ni,Pr,us,cs,Gs,To],py=_et.slice(0,-1),gy=py.slice(0,-1),my=gy.slice(0,-1),Ykt=my.slice(0,-1),Hkt=[gi,jn],V7=[gi,Ni],xet=[gi],w0=[[py,1,fy],[py,5,5*fy],[py,15,15*fy],[py,30,30*fy],[gy,1,dy],[gy,5,5*dy],[gy,15,15*dy],[gy,30,30*dy],[my,1,hy],[my,3,3*hy],[my,6,6*hy],[my,12,12*hy],[Ykt,1,sA],[Hkt,1,Gkt],[V7,1,q7],[V7,3,3*q7],[xet,1,aF]];function Eet(t){const e=t.extent,n=t.maxbins||40,i=Math.abs(zb(e))/n;let r=bh(a=>a[2]).right(w0,i),s,o;return r===w0.length?(s=xet,o=Dl(e[0]/aF,e[1]/aF,n)):r?(r=w0[i/w0[r-1][2]<w0[r][2]/i?r-1:r],s=r[0],o=r[1]):(s=_et,o=Math.max(Dl(e[0],e[1],n),1)),{units:s,step:o}}function yy(t){const e={};return n=>e[n]||(e[n]=t(n))}function Xkt(t,e){return n=>{const i=t(n),r=i.indexOf(e);if(r<0)return i;let s=Kkt(i,r);const o=s<i.length?i.slice(s):"";for(;--s>r;)if(i[s]!=="0"){++s;break}return i.slice(0,s)+o}}function Kkt(t,e){let n=t.lastIndexOf("e"),i;if(n>0)return n;for(n=t.length;--n>e;)if(i=t.charCodeAt(n),i>=48&&i<=57)return n+1}function Aet(t){const e=yy(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(i){const r=Wd(i||",");if(r.precision==null){switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return Xkt(e(r),e(".1f")(1)[1])}else return e(r)},formatSpan(i,r,s,o){o=Wd(o??",f");const a=Dl(i,r,s),u=Math.max(Math.abs(i),Math.abs(r));let c;if(o.precision==null)switch(o.type){case"s":return isNaN(c=mY(a,u))||(o.precision=c),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(c=yY(a,u))||(o.precision=c-(o.type==="e"));break}case"f":case"%":{isNaN(c=gY(a))||(o.precision=c-(o.type==="%")*2);break}}return e(o)}}}let uF;$et();function $et(){return uF=Aet({format:vh,formatPrefix:jD})}function Iet(t){return Aet(pY(t))}function Xx(t){return arguments.length?uF=Iet(t):uF}function W7(t,e,n){n=n||{},ut(n)||q(`Invalid time multi-format specifier: ${n}`);const i=e(Gs),r=e(cs),s=e(us),o=e(Pr),a=e(jn),u=e(Ni),c=e(Br),l=e(gi),f=t(n[To]||".%L"),d=t(n[Gs]||":%S"),h=t(n[cs]||"%I:%M"),p=t(n[us]||"%I %p"),g=t(n[Pr]||n[Mi]||"%a %d"),m=t(n[jn]||"%b %d"),y=t(n[Ni]||"%B"),b=t(n[Br]||"%B"),v=t(n[gi]||"%Y");return w=>(i(w)<w?f:r(w)<w?d:s(w)<w?h:o(w)<w?p:u(w)<w?a(w)<w?g:m:l(w)<w?c(w)<w?y:b:v)(w)}function Met(t){const e=yy(t.format),n=yy(t.utcFormat);return{timeFormat:i=>at(i)?e(i):W7(e,jm,i),utcFormat:i=>at(i)?n(i):W7(n,qm,i),timeParse:yy(t.parse),utcParse:yy(t.utcParse)}}let cF;Tet();function Tet(){return cF=Met({format:bE,parse:VH,utcFormat:Im,utcParse:WH})}function Fet(t){return Met(PH(t))}function C1(t){return arguments.length?cF=Fet(t):cF}const lF=(t,e)=>Jt({},t,e);function ket(t,e){const n=t?Iet(t):Xx(),i=e?Fet(e):C1();return lF(n,i)}function nN(t,e){const n=arguments.length;return n&&n!==2&&q("defaultLocale expects either zero or two arguments."),n?lF(Xx(t),C1(e)):lF(Xx(),C1())}function Jkt(){return $et(),Tet(),nN()}const Qkt=/^(data:|([A-Za-z]+:)?\/\/)/,Zkt=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,tDt=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,G7="file://";function eDt(t,e){return n=>({options:n||{},sanitize:iDt,load:nDt,fileAccess:!!e,file:rDt(e),http:oDt(t)})}async function nDt(t,e){const n=await this.sanitize(t,e),i=n.href;return n.localFile?this.file(i):this.http(i,e)}async function iDt(t,e){e=Jt({},this.options,e);const n=this.fileAccess,i={href:null};let r,s,o;const a=Zkt.test(t.replace(tDt,""));(t==null||typeof t!="string"||!a)&&q("Sanitize failure, invalid URI: "+Q(t));const u=Qkt.test(t);return(o=e.baseURL)&&!u&&(!t.startsWith("/")&&!o.endsWith("/")&&(t="/"+t),t=o+t),s=(r=t.startsWith(G7))||e.mode==="file"||e.mode!=="http"&&!u&&n,r?t=t.slice(G7.length):t.startsWith("//")&&(e.defaultProtocol==="file"?(t=t.slice(2),s=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(i,"localFile",{value:!!s}),i.href=t,e.target&&(i.target=e.target+""),e.rel&&(i.rel=e.rel+""),e.context==="image"&&e.crossOrigin&&(i.crossOrigin=e.crossOrigin+""),i}function rDt(t){return t?e=>new Promise((n,i)=>{t.readFile(e,(r,s)=>{r?i(r):n(s)})}):sDt}async function sDt(){q("No file system access.")}function oDt(t){return t?async function(e,n){const i=Jt({},this.options.http,n),r=n&&n.response,s=await t(e,i);return s.ok?Qt(s[r])?s[r]():s.text():q(s.status+""+s.statusText)}:aDt}async function aDt(){q("No HTTP fetch method available.")}const uDt=t=>t!=null&&t===t,cDt=t=>t==="true"||t==="false"||t===!0||t===!1,lDt=t=>!Number.isNaN(Date.parse(t)),Det=t=>!Number.isNaN(+t)&&!(t instanceof Date),fDt=t=>Det(t)&&Number.isInteger(+t),fF={boolean:KC,integer:Ti,number:Ti,date:JC,string:QC,unknown:Li},ow=[cDt,fDt,Det,lDt],dDt=["boolean","integer","number","date"];function Cet(t,e){if(!t||!t.length)return"unknown";const n=t.length,i=ow.length,r=ow.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=e?t[s][e]:t[s],a=0;a<i;++a)if(r[a]&&uDt(u)&&!ow[a](u)&&(r[a]=0,++o,o===ow.length))return"string";return dDt[r.reduce((s,o)=>s===0?o:s,0)-1]}function Net(t,e){return e.reduce((n,i)=>(n[i]=Cet(t,i),n),{})}function Y7(t){const e=function(n,i){const r={delimiter:t};return iN(n,i?Jt(i,r):r)};return e.responseType="text",e}function iN(t,e){return e.header&&(t=e.header.map(Q).join(e.delimiter)+`
`+t),mwt(e.delimiter).parse(t+"")}iN.responseType="text";function hDt(t){return typeof Buffer=="function"&&Qt(Buffer.isBuffer)?Buffer.isBuffer(t):!1}function rN(t,e){const n=e&&e.property?Vs(e.property):Li;return ut(t)&&!hDt(t)?pDt(n(t),e):n(JSON.parse(t))}rN.responseType="json";function pDt(t,e){return!W(t)&&Ktt(t)&&(t=[...t]),e&&e.copy?JSON.parse(JSON.stringify(t)):t}const gDt={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function Oet(t,e){let n,i,r,s;return t=rN(t,e),e&&e.feature?(n=kkt,r=e.feature):e&&e.mesh?(n=Ckt,r=e.mesh,s=gDt[e.filter]):q("Missing TopoJSON feature or mesh parameter."),i=(i=t.objects[r])?n(t,i,s):q("Invalid TopoJSON object: "+r),i&&i.features||[i]}Oet.responseType="json";const u2={dsv:iN,csv:Y7(","),tsv:Y7("	"),json:rN,topojson:Oet};function sN(t,e){return arguments.length>1?(u2[t]=e,this):xt(u2,t)?u2[t]:null}function Ret(t){const e=sN(t);return e&&e.responseType||"text"}function Let(t,e,n,i){e=e||{};const r=sN(e.type||"json");return r||q("Unknown data format type: "+e.type),t=r(t,e),e.parse&&mDt(t,e.parse,n,i),xt(t,"columns")&&delete t.columns,t}function mDt(t,e,n,i){if(!t.length)return;const r=C1();n=n||r.timeParse,i=i||r.utcParse;let s=t.columns||Object.keys(t[0]),o,a,u,c,l,f;e==="auto"&&(e=Net(t,s)),s=Object.keys(e);const d=s.map(h=>{const p=e[h];let g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(g[0]==="utc"?i:n)(m);if(!fF[p])throw Error("Illegal format pattern: "+h+":"+p);return fF[p]});for(u=0,l=t.length,f=s.length;u<l;++u)for(o=t[u],c=0;c<f;++c)a=s[c],o[a]=d[c](o[a])}const oA=eDt(typeof fetch<"u"&&fetch,null);function aA(t){const e=t||Li,n=[],i={};return n.add=r=>{const s=e(r);return i[s]||(i[s]=1,n.push(r)),n},n.remove=r=>{const s=e(r);if(i[s]){i[s]=0;const o=n.indexOf(r);o>=0&&n.splice(o,1)}return n},n}async function c2(t,e){try{await e(t)}catch(n){t.error(n)}}const Bet=Symbol("vega_id");let yDt=1;function uA(t){return!!(t&&wt(t))}function wt(t){return t[Bet]}function Pet(t,e){return t[Bet]=e,t}function Ae(t){const e=t===Object(t)?t:{data:t};return wt(e)?e:Pet(e,yDt++)}function oN(t){return cA(t,Ae({}))}function cA(t,e){for(const n in t)e[n]=t[n];return e}function zet(t,e){return Pet(e,wt(t))}function Ah(t,e){return t?e?(n,i)=>t(n,i)||wt(e(n))-wt(e(i)):(n,i)=>t(n,i)||wt(n)-wt(i):null}function Uet(t){return t&&t.constructor===$h}function $h(){const t=[],e=[],n=[],i=[],r=[];let s=null,o=!1;return{constructor:$h,insert(a){const u=ot(a),c=u.length;for(let l=0;l<c;++l)t.push(u[l]);return this},remove(a){const u=Qt(a)?i:e,c=ot(a),l=c.length;for(let f=0;f<l;++f)u.push(c[f]);return this},modify(a,u,c){const l={field:u,value:Bi(c)};return Qt(a)?(l.filter=a,r.push(l)):(l.tuple=a,n.push(l)),this},encode(a,u){return Qt(a)?r.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return s=a,this},reflow(){return o=!0,this},pulse(a,u){const c={},l={};let f,d,h,p,g,m;for(f=0,d=u.length;f<d;++f)c[wt(u[f])]=1;for(f=0,d=e.length;f<d;++f)g=e[f],c[wt(g)]=-1;for(f=0,d=i.length;f<d;++f)p=i[f],u.forEach(b=>{p(b)&&(c[wt(b)]=-1)});for(f=0,d=t.length;f<d;++f)g=t[f],m=wt(g),c[m]?c[m]=1:a.add.push(Ae(t[f]));for(f=0,d=u.length;f<d;++f)g=u[f],c[wt(g)]<0&&a.rem.push(g);function y(b,v,w){w?b[v]=w(b):a.encode=v,o||(l[wt(b)]=b)}for(f=0,d=n.length;f<d;++f)h=n[f],g=h.tuple,p=h.field,m=c[wt(g)],m>0&&(y(g,p,h.value),a.modifies(p));for(f=0,d=r.length;f<d;++f)h=r[f],p=h.filter,u.forEach(b=>{p(b)&&c[wt(b)]>0&&y(b,h.field,h.value)}),a.modifies(h.field);if(o)a.mod=e.length||i.length?u.filter(b=>c[wt(b)]>0):u.slice();else for(m in l)a.mod.push(l[m]);return(s||s==null&&(e.length||i.length))&&a.clean(!0),a}}}const l2="_:mod:_";function lA(){Object.defineProperty(this,l2,{writable:!0,value:{}})}lA.prototype={set(t,e,n,i){const r=this,s=r[t],o=r[l2];return e!=null&&e>=0?(s[e]!==n||i)&&(s[e]=n,o[e+":"+t]=-1,o[t]=-1):(s!==n||i)&&(r[t]=n,o[t]=W(n)?1+n.length:-1),r},modified(t,e){const n=this[l2];if(arguments.length){if(W(t)){for(let i=0;i<t.length;++i)if(n[t[i]])return!0;return!1}}else{for(const i in n)if(n[i])return!0;return!1}return e!=null&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){return this[l2]={},this}};let bDt=0;const vDt="pulse",wDt=new lA,_Dt=1,xDt=2;function Ue(t,e,n,i){this.id=++bDt,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,i)}function H7(t){return function(e){const n=this.flags;return arguments.length===0?!!(n&t):(this.flags=e?n|t:n&~t,this)}}Ue.prototype={targets(){return this._targets||(this._targets=aA(Pb))},set(t){return this.value!==t?(this.value=t,1):0},skip:H7(_Dt),modified:H7(xDt),parameters(t,e,n){e=e!==!1;const i=this._argval=this._argval||new lA,r=this._argops=this._argops||[],s=[];let o,a,u,c;const l=(f,d,h)=>{h instanceof Ue?(h!==this&&(e&&h.targets().add(this),s.push(h)),r.push({op:h,name:f,index:d})):i.set(f,d,h)};for(o in t)if(a=t[o],o===vDt)ot(a).forEach(f=>{f instanceof Ue?f!==this&&(f.targets().add(this),s.push(f)):q("Pulse parameters must be operator instances.")}),this.source=a;else if(W(a))for(i.set(o,-1,Array(u=a.length)),c=0;c<u;++c)l(o,c,a[c]);else l(o,-1,a);return this.marshall().clear(),n&&(r.initonly=!0),s},marshall(t){const e=this._argval||wDt,n=this._argops;let i,r,s,o;if(n){const a=n.length;for(r=0;r<a;++r)i=n[r],s=i.op,o=s.modified()&&s.stamp===t,e.set(i.name,i.index,s.value,o);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return e},detach(){const t=this._argops;let e,n,i,r;if(t)for(e=0,n=t.length;e<n;++e)i=t[e],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){const e=this._update;if(e){const n=this.marshall(t.stamp),i=e.call(this,n,t);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return t.StopPropagation}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t}};function SDt(t,e,n,i){let r=1,s;return t instanceof Ue?s=t:t&&t.prototype instanceof Ue?s=new t:Qt(t)?s=new Ue(null,t):(r=0,s=new Ue(t,e)),this.rank(s),r&&(i=n,n=e),n&&this.connect(s,s.parameters(n,i)),this.touch(s),s}function EDt(t,e){const n=t.rank,i=e.length;for(let r=0;r<i;++r)if(n<e[r].rank){this.rerank(t);return}}let ADt=0;function fA(t,e,n){this.id=++ADt,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function Uc(t,e,n){return new fA(t,e,n)}fA.prototype={_filter:Ws,_apply:Li,targets(){return this._targets||(this._targets=aA(Pb))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),n=this._targets,i=n?n.length:0;for(let r=0;r<i;++r)n[r].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){const e=Uc(t);return this.targets().add(e),e},apply(t){const e=Uc(null,t);return this.targets().add(e),e},merge(){const t=Uc();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter(()=>{const n=Date.now();return n-e>t?(e=n,1):0})},debounce(t){const e=Uc();return this.targets().add(Uc(null,null,HC(t,n=>{const i=n.dataflow;e.receive(n),i&&i.run&&i.run()}))),e},between(t,e){let n=!1;return t.targets().add(Uc(null,null,()=>n=!0)),e.targets().add(Uc(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=Ws,this._targets=null}};function $Dt(t,e,n,i){const r=this,s=Uc(n,i),o=function(c){c.dataflow=r;try{s.receive(c)}catch(l){r.error(l)}finally{r.run()}};let a;typeof t=="string"&&typeof document<"u"?a=document.querySelectorAll(t):a=ot(t);const u=a.length;for(let c=0;c<u;++c)a[c].addEventListener(e,o);return s}function IDt(t,e){const n=this.locale();return Let(t,e,n.timeParse,n.utcParse)}function MDt(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))}async function TDt(t,e){const n=this;let i=0,r;try{r=await n.loader().load(t,{context:"dataflow",response:Ret(e&&e.type)});try{r=n.parse(r,e)}catch(s){i=-2,n.warn("Data ingestion failed",t,s)}}catch(s){i=-1,n.warn("Loading failed",t,s)}return{data:r,status:i}}async function FDt(t,e,n){const i=this,r=i._pending||kDt(i);r.requests+=1;const s=await i.request(e,n);return i.pulse(t,i.changeset().remove(Ws).insert(s.data||[])),r.done(),s}function kDt(t){let e;const n=new Promise(i=>e=i);return n.requests=0,n.done=()=>{--n.requests===0&&(t._pending=null,e(t))},t._pending=n}const DDt={skip:!0};function CDt(t,e,n,i,r){return(t instanceof Ue?ODt:NDt)(this,t,e,n,i,r),this}function NDt(t,e,n,i,r,s){const o=Jt({},s,DDt);let a,u;Qt(n)||(n=Bi(n)),i===void 0?a=c=>t.touch(n(c)):Qt(i)?(u=new Ue(null,i,r,!1),a=c=>{u.evaluate(c);const l=n(c),f=u.value;Uet(f)?t.pulse(l,f,s):t.update(l,f,o)}):a=c=>t.update(n(c),i,o),e.apply(a)}function ODt(t,e,n,i,r,s){if(i===void 0)e.targets().add(n);else{const o=s||{},a=new Ue(null,RDt(n,i),r,!1);a.modified(o.force),a.rank=e.rank,e.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),t.connect(n,[a]))}}function RDt(t,e){return e=Qt(e)?e:Bi(e),t?function(n,i){const r=e(n,i);return t.skip()||(t.skip(r!==this.value).value=r),r}:e}function LDt(t){t.rank=++this._rank}function BDt(t){const e=[t];let n,i,r;for(;e.length;)if(this.rank(n=e.pop()),i=n._targets)for(r=i.length;--r>=0;)e.push(n=i[r]),n===t&&q("Cycle detected in dataflow graph.")}const Kx={},sa=1,Xc=2,Cu=4,PDt=sa|Xc,X7=sa|Cu,tp=sa|Xc|Cu,K7=8,_0=16,J7=32,Q7=64;function ml(t,e,n){this.dataflow=t,this.stamp=e??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function c3(t,e){const n=[];return Hc(t,e,i=>n.push(i)),n}function Z7(t,e){const n={};return t.visit(e,i=>{n[wt(i)]=1}),i=>n[wt(i)]?null:i}function aw(t,e){return t?(n,i)=>t(n,i)&&e(n,i):e}ml.prototype={StopPropagation:Kx,ADD:sa,REM:Xc,MOD:Cu,ADD_REM:PDt,ADD_MOD:X7,ALL:tp,REFLOW:K7,SOURCE:_0,NO_SOURCE:J7,NO_FIELDS:Q7,fork(t){return new ml(this.dataflow).init(this,t)},clone(){const t=this.fork(tp);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(tp|_0)},addAll(){let t=this;return!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length||(t=new ml(this.dataflow).init(this),t.add=t.source,t.rem=[]),t},init(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,t.fields&&!(e&Q7)&&(n.fields=t.fields),e&sa?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),e&Xc?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),e&Cu?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),e&J7?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||tp;return e&sa&&this.add.length||e&Xc&&this.rem.length||e&Cu&&this.mod.length},reflow(t){if(t)return this.fork(tp).reflow();const e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(Cu,Z7(this,sa))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){const e=this.fields||(this.fields={});return W(t)?t.forEach(n=>e[n]=!0):e[t]=!0,this},modified(t,e){const n=this.fields;return(e||this.mod.length)&&n?arguments.length?W(t)?t.some(i=>n[i]):n[t]:!!n:!1},filter(t,e){const n=this;return t&sa&&(n.addF=aw(n.addF,e)),t&Xc&&(n.remF=aw(n.remF,e)),t&Cu&&(n.modF=aw(n.modF,e)),t&_0&&(n.srcF=aw(n.srcF,e)),n},materialize(t){t=t||tp;const e=this;return t&sa&&e.addF&&(e.add=c3(e.add,e.addF),e.addF=null),t&Xc&&e.remF&&(e.rem=c3(e.rem,e.remF),e.remF=null),t&Cu&&e.modF&&(e.mod=c3(e.mod,e.modF),e.modF=null),t&_0&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},visit(t,e){const n=this,i=e;if(t&_0)return Hc(n.source,n.srcF,i),n;t&sa&&Hc(n.add,n.addF,i),t&Xc&&Hc(n.rem,n.remF,i),t&Cu&&Hc(n.mod,n.modF,i);const r=n.source;if(t&K7&&r){const s=n.add.length+n.mod.length;s===r.length||(s?Hc(r,Z7(n,X7),i):Hc(r,n.srcF,i))}return n}};function aN(t,e,n,i){const r=this;let s=0;this.dataflow=t,this.stamp=e,this.fields=null,this.encode=i||null,this.pulses=n;for(const o of n)if(o.stamp===e){if(o.fields){const a=r.fields||(r.fields={});for(const u in o.fields)a[u]=1}o.changed(r.ADD)&&(s|=r.ADD),o.changed(r.REM)&&(s|=r.REM),o.changed(r.MOD)&&(s|=r.MOD)}this.changes=s}J(aN,ml,{fork(t){const e=new ml(this.dataflow).init(this,t&this.NO_FIELDS);return t!==void 0&&(t&e.ADD&&this.visit(e.ADD,n=>e.add.push(n)),t&e.REM&&this.visit(e.REM,n=>e.rem.push(n)),t&e.MOD&&this.visit(e.MOD,n=>e.mod.push(n))),e},changed(t){return this.changes&t},modified(t){const e=this,n=e.fields;return n&&e.changes&e.MOD?W(t)?t.some(i=>n[i]):n[t]:0},filter(){q("MultiPulse does not support filtering.")},materialize(){q("MultiPulse does not support materialization.")},visit(t,e){const n=this,i=n.pulses,r=i.length;let s=0;if(t&n.SOURCE)for(;s<r;++s)i[s].visit(t,e);else for(;s<r;++s)i[s].stamp===n.stamp&&i[s].visit(t,e);return n}});async function zDt(t,e,n){const i=this,r=[];if(i._pulse)return jet(i);if(i._pending&&await i._pending,e&&await c2(i,e),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const s=++i._clock;i._pulse=new ml(i,s,t),i._touched.forEach(l=>i._enqueue(l,!0)),i._touched=aA(Pb);let o=0,a,u,c;try{for(;i._heap.size()>0;){if(a=i._heap.pop(),a.rank!==a.qrank){i._enqueue(a,!0);continue}u=a.run(i._getPulse(a,t)),u.then?u=await u:u.async&&(r.push(u.async),u=Kx),u!==Kx&&a._targets&&a._targets.forEach(l=>i._enqueue(l)),++o}}catch(l){i._heap.clear(),c=l}if(i._input={},i._pulse=null,i.debug(`Pulse ${s}: ${o} operators`),c&&(i._postrun=[],i.error(c)),i._postrun.length){const l=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<l.length;++f)await c2(i,l[f].callback)}return n&&await c2(i,n),r.length&&Promise.all(r).then(l=>i.runAsync(null,()=>{l.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function UDt(t,e,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(i,i),this._running}function jDt(t,e,n){return this._pulse?jet(this):(this.evaluate(t,e,n),this)}function qDt(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(i){this.error(i)}}function jet(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}function VDt(t,e){const n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))}function WDt(t,e){const n=t.source,i=this._clock;return n&&W(n)?new aN(this,i,n.map(r=>r.pulse),e):this._input[t.id]||GDt(this._pulse,n&&n.pulse)}function GDt(t,e){return e&&e.stamp===t.stamp?e:(t=t.fork(),e&&e!==Kx&&(t.source=e.source),t)}const uN={skip:!1,force:!1};function YDt(t,e){const n=e||uN;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this}function HDt(t,e,n){const i=n||uN;return(t.set(e)||i.force)&&this.touch(t,i),this}function XDt(t,e,n){this.touch(t,n||uN);const i=new ml(this,this._clock+(this._pulse?0:1)),r=t.pulse&&t.pulse.source||[];return i.target=t,this._input[t.id]=e.pulse(i,r),this}function KDt(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),qet(e,0,e.length-1,t)),pop:()=>{const n=e.pop();let i;return e.length?(i=e[0],e[0]=n,JDt(e,0,t)):i=n,i}}}function qet(t,e,n,i){let r,s;const o=t[n];for(;n>e;){if(s=n-1>>1,r=t[s],i(o,r)<0){t[n]=r,n=s;continue}break}return t[n]=o}function JDt(t,e,n){const i=e,r=t.length,s=t[e];let o=(e<<1)+1,a;for(;o<r;)a=o+1,a<r&&n(t[o],t[a])>=0&&(o=a),t[e]=t[o],e=o,o=(e<<1)+1;return t[e]=s,qet(t,i,e,n)}function cg(){this.logger(qC()),this.logLevel(UC),this._clock=0,this._rank=0,this._locale=nN();try{this._loader=oA()}catch{}this._touched=aA(Pb),this._input={},this._pulse=null,this._heap=KDt((t,e)=>t.qrank-e.qrank),this._postrun=[]}function x0(t){return function(){return this._log[t].apply(this,arguments)}}cg.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:x0("error"),warn:x0("warn"),info:x0("info"),debug:x0("debug"),logLevel:x0("level"),cleanThreshold:1e4,add:SDt,connect:EDt,rank:LDt,rerank:BDt,pulse:XDt,touch:YDt,update:HDt,changeset:$h,ingest:MDt,parse:IDt,preload:FDt,request:TDt,events:$Dt,on:CDt,evaluate:zDt,run:jDt,runAsync:UDt,runAfter:qDt,_enqueue:VDt,_getPulse:WDt};function z(t,e){Ue.call(this,t,null,e)}J(z,Ue,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?this.skip(!1):e=this.evaluate(t),e=e||t,e.then?e=e.then(n=>this.pulse=n):e!==t.StopPropagation&&(this.pulse=e),e},evaluate(t){const e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},transform(){}});const Vg={};function Vet(t){const e=Wet(t);return e&&e.Definition||null}function Wet(t){return t=t&&t.toLowerCase(),xt(Vg,t)?Vg[t]:null}function*Get(t,e){if(e==null)for(let n of t)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of t)i=e(i,++n,t),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function cN(t,e,n){const i=Float64Array.from(Get(t,n));return i.sort(Ze),e.map(r=>cG(i,r))}function lN(t,e){return cN(t,[.25,.5,.75],e)}function fN(t,e){const n=t.length,i=bm(t,e),r=lN(t,e),s=(r[2]-r[0])/1.34;return 1.06*(Math.min(i,s)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function Yet(t){const e=t.maxbins||20,n=t.base||10,i=Math.log(n),r=t.divide||[5,2];let s=t.extent[0],o=t.extent[1],a,u,c,l,f,d;const h=t.span||o-s||Math.abs(s)||1;if(t.step)a=t.step;else if(t.steps){for(l=h/e,f=0,d=t.steps.length;f<d&&t.steps[f]<l;++f);a=t.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(e)/i),c=t.minstep||0,a=Math.max(c,Math.pow(n,Math.round(Math.log(h)/i)-u));Math.ceil(h/a)>e;)a*=n;for(f=0,d=r.length;f<d;++f)l=a/r[f],l>=c&&h/l<=e&&(a=l)}l=Math.log(a);const p=l>=0?0:~~(-l/i)+1,g=Math.pow(n,-p-1);return(t.nice||t.nice===void 0)&&(l=Math.floor(s/a+g)*a,s=s<l?l-a:l,o=Math.ceil(o/a)*a),{start:s,stop:o===s?s+a:o,step:a}}var Ys=Math.random;function QDt(t){Ys=t}function Het(t,e,n,i){if(!t.length)return[void 0,void 0];const r=Float64Array.from(Get(t,i)),s=r.length,o=e;let a,u,c,l;for(c=0,l=Array(o);c<o;++c){for(a=0,u=0;u<s;++u)a+=r[~~(Ys()*s)];l[c]=a/s}return l.sort(Ze),[Ra(l,n/2),Ra(l,1-n/2)]}function Xet(t,e,n,i){i=i||(d=>d);const r=t.length,s=new Float64Array(r);let o=0,a=1,u=i(t[0]),c=u,l=u+e,f;for(;a<r;++a){if(f=i(t[a]),f>=l){for(c=(u+c)/2;o<a;++o)s[o]=c;l=f+e,u=f}c=f}for(c=(u+c)/2;o<a;++o)s[o]=c;return n?ZDt(s,e+e/4):s}function ZDt(t,e){const n=t.length;let i=0,r=1,s,o;for(;t[i]===t[r];)++r;for(;r<n;){for(s=r+1;t[r]===t[s];)++s;if(t[r]-t[r-1]<e){for(o=r+(i+s-r-r>>1);o<r;)t[o++]=t[r];for(;o>r;)t[o--]=t[i]}i=r,r=s}return t}function t6t(t){return function(){return t=(1103515245*t+12345)%2147483647,t/2147483647}}function e6t(t,e){e==null&&(e=t,t=0);let n,i,r;const s={min(o){return arguments.length?(n=o||0,r=i-n,s):n},max(o){return arguments.length?(i=o||0,r=i-n,s):i},sample(){return n+Math.floor(r*Ys())},pdf(o){return o===Math.floor(o)&&o>=n&&o<i?1/r:0},cdf(o){const a=Math.floor(o);return a<n?0:a>=i?1:(a-n+1)/r},icdf(o){return o>=0&&o<=1?n-1+Math.floor(o*r):NaN}};return s.min(t).max(e)}const Ket=Math.sqrt(2*Math.PI),n6t=Math.SQRT2;let S0=NaN;function dA(t,e){t=t||0,e=e??1;let n=0,i=0,r,s;if(S0===S0)n=S0,S0=NaN;else{do n=Ys()*2-1,i=Ys()*2-1,r=n*n+i*i;while(r===0||r>1);s=Math.sqrt(-2*Math.log(r)/r),n*=s,S0=i*s}return t+n*e}function dN(t,e,n){n=n??1;const i=(t-(e||0))/n;return Math.exp(-.5*i*i)/(n*Ket)}function hA(t,e,n){e=e||0,n=n??1;const i=(t-e)/n,r=Math.abs(i);let s;if(r>37)s=0;else{const o=Math.exp(-r*r/2);let a;r<7.07106781186547?(a=.0352624965998911*r+.700383064443688,a=a*r+6.37396220353165,a=a*r+33.912866078383,a=a*r+112.079291497871,a=a*r+221.213596169931,a=a*r+220.206867912376,s=o*a,a=.0883883476483184*r+1.75566716318264,a=a*r+16.064177579207,a=a*r+86.7807322029461,a=a*r+296.564248779674,a=a*r+637.333633378831,a=a*r+793.826512519948,a=a*r+440.413735824752,s=s/a):(a=r+.65,a=r+4/a,a=r+3/a,a=r+2/a,a=r+1/a,s=o/a/2.506628274631)}return i>0?1-s:s}function pA(t,e,n){return t<0||t>1?NaN:(e||0)+(n??1)*n6t*i6t(2*t-1)}function i6t(t){let e=-Math.log((1-t)*(1+t)),n;return e<6.25?(e-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*e,n=128584807152564e-32+n*e,n=11157877678025181e-33+n*e,n=-1333171662854621e-31+n*e,n=20972767875968562e-33+n*e,n=6637638134358324e-30+n*e,n=-4054566272975207e-29+n*e,n=-8151934197605472e-29+n*e,n=26335093153082323e-28+n*e,n=-12975133253453532e-27+n*e,n=-5415412054294628e-26+n*e,n=10512122733215323e-25+n*e,n=-4112633980346984e-24+n*e,n=-29070369957882005e-24+n*e,n=42347877827932404e-23+n*e,n=-13654692000834679e-22+n*e,n=-13882523362786469e-21+n*e,n=.00018673420803405714+n*e,n=-.000740702534166267+n*e,n=-.006033670871430149+n*e,n=.24015818242558962+n*e,n=1.6536545626831027+n*e):e<16?(e=Math.sqrt(e)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*e,n=-27517406297064545e-23+n*e,n=18239629214389228e-24+n*e,n=15027403968909828e-22+n*e,n=-4013867526981546e-21+n*e,n=29234449089955446e-22+n*e,n=12475304481671779e-21+n*e,n=-47318229009055734e-21+n*e,n=6828485145957318e-20+n*e,n=24031110387097894e-21+n*e,n=-.0003550375203628475+n*e,n=.0009532893797373805+n*e,n=-.0016882755560235047+n*e,n=.002491442096107851+n*e,n=-.003751208507569241+n*e,n=.005370914553590064+n*e,n=1.0052589676941592+n*e,n=3.0838856104922208+n*e):Number.isFinite(e)?(e=Math.sqrt(e)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*e,n=15076572693500548e-25+n*e,n=-3789465440126737e-24+n*e,n=761570120807834e-23+n*e,n=-1496002662714924e-23+n*e,n=2914795345090108e-23+n*e,n=-6771199775845234e-23+n*e,n=22900482228026655e-23+n*e,n=-99298272942317e-20+n*e,n=4526062597223154e-21+n*e,n=-1968177810553167e-20+n*e,n=7599527703001776e-20+n*e,n=-.00021503011930044477+n*e,n=-.00013871931833623122+n*e,n=1.0103004648645344+n*e,n=4.849906401408584+n*e):n=1/0,n*t}function hN(t,e){let n,i;const r={mean(s){return arguments.length?(n=s||0,r):n},stdev(s){return arguments.length?(i=s??1,r):i},sample:()=>dA(n,i),pdf:s=>dN(s,n,i),cdf:s=>hA(s,n,i),icdf:s=>pA(s,n,i)};return r.mean(t).stdev(e)}function pN(t,e){const n=hN();let i=0;const r={data(s){return arguments.length?(t=s,i=s?s.length:0,r.bandwidth(e)):t},bandwidth(s){return arguments.length?(e=s,!e&&t&&(e=fN(t)),r):e},sample(){return t[~~(Ys()*i)]+e*n.sample()},pdf(s){let o=0,a=0;for(;a<i;++a)o+=n.pdf((s-t[a])/e);return o/e/i},cdf(s){let o=0,a=0;for(;a<i;++a)o+=n.cdf((s-t[a])/e);return o/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(t)}function gN(t,e){return t=t||0,e=e??1,Math.exp(t+dA()*e)}function mN(t,e,n){if(t<=0)return 0;e=e||0,n=n??1;const i=(Math.log(t)-e)/n;return Math.exp(-.5*i*i)/(n*Ket*t)}function yN(t,e,n){return hA(Math.log(t),e,n)}function bN(t,e,n){return Math.exp(pA(t,e,n))}function Jet(t,e){let n,i;const r={mean(s){return arguments.length?(n=s||0,r):n},stdev(s){return arguments.length?(i=s??1,r):i},sample:()=>gN(n,i),pdf:s=>mN(s,n,i),cdf:s=>yN(s,n,i),icdf:s=>bN(s,n,i)};return r.mean(t).stdev(e)}function Qet(t,e){let n=0,i;function r(o){const a=[];let u=0,c;for(c=0;c<n;++c)u+=a[c]=o[c]==null?1:+o[c];for(c=0;c<n;++c)a[c]/=u;return a}const s={weights(o){return arguments.length?(i=r(e=o||[]),s):e},distributions(o){return arguments.length?(o?(n=o.length,t=o):(n=0,t=[]),s.weights(e)):t},sample(){const o=Ys();let a=t[n-1],u=i[0],c=0;for(;c<n-1;u+=i[++c])if(o<u){a=t[c];break}return a.sample()},pdf(o){let a=0,u=0;for(;u<n;++u)a+=i[u]*t[u].pdf(o);return a},cdf(o){let a=0,u=0;for(;u<n;++u)a+=i[u]*t[u].cdf(o);return a},icdf(){throw Error("Mixture icdf not supported.")}};return s.distributions(t).weights(e)}function vN(t,e){return e==null&&(e=t??1,t=0),t+(e-t)*Ys()}function wN(t,e,n){return n==null&&(n=e??1,e=0),t>=e&&t<=n?1/(n-e):0}function _N(t,e,n){return n==null&&(n=e??1,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function xN(t,e,n){return n==null&&(n=e??1,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function Zet(t,e){let n,i;const r={min(s){return arguments.length?(n=s||0,r):n},max(s){return arguments.length?(i=s??1,r):i},sample:()=>vN(n,i),pdf:s=>wN(s,n,i),cdf:s=>_N(s,n,i),icdf:s=>xN(s,n,i)};return e==null&&(e=t??1,t=0),r.min(t).max(e)}function SN(t,e,n){let i=0,r=0;for(const s of t){const o=n(s);e(s)==null||o==null||isNaN(o)||(i+=(o-i)/++r)}return{coef:[i],predict:()=>i,rSquared:0}}function Ub(t,e,n,i){const r=i-t*t,s=Math.abs(r)<1e-24?0:(n-t*e)/r;return[e-s*t,s]}function gA(t,e,n,i){t=t.filter(h=>{let p=e(h),g=n(h);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),i&&t.sort((h,p)=>e(h)-e(p));const r=t.length,s=new Float64Array(r),o=new Float64Array(r);let a=0,u=0,c=0,l,f,d;for(d of t)s[a]=l=+e(d),o[a]=f=+n(d),++a,u+=(l-u)/a,c+=(f-c)/a;for(a=0;a<r;++a)s[a]-=u,o[a]-=c;return[s,o,u,c]}function jb(t,e,n,i){let r=-1,s,o;for(const a of t)s=e(a),o=n(a),s!=null&&(s=+s)>=s&&o!=null&&(o=+o)>=o&&i(s,o,++r)}function Vm(t,e,n,i,r){let s=0,o=0;return jb(t,e,n,(a,u)=>{const c=u-r(a),l=u-i;s+=c*c,o+=l*l}),1-s/o}function EN(t,e,n){let i=0,r=0,s=0,o=0,a=0;jb(t,e,n,(l,f)=>{++a,i+=(l-i)/a,r+=(f-r)/a,s+=(l*f-s)/a,o+=(l*l-o)/a});const u=Ub(i,r,s,o),c=l=>u[0]+u[1]*l;return{coef:u,predict:c,rSquared:Vm(t,e,n,r,c)}}function tnt(t,e,n){let i=0,r=0,s=0,o=0,a=0;jb(t,e,n,(l,f)=>{++a,l=Math.log(l),i+=(l-i)/a,r+=(f-r)/a,s+=(l*f-s)/a,o+=(l*l-o)/a});const u=Ub(i,r,s,o),c=l=>u[0]+u[1]*Math.log(l);return{coef:u,predict:c,rSquared:Vm(t,e,n,r,c)}}function ent(t,e,n){const[i,r,s,o]=gA(t,e,n);let a=0,u=0,c=0,l=0,f=0,d,h,p;jb(t,e,n,(b,v)=>{d=i[f++],h=Math.log(v),p=d*v,a+=(v*h-a)/f,u+=(p-u)/f,c+=(p*h-c)/f,l+=(d*p-l)/f});const[g,m]=Ub(u/o,a/o,c/o,l/o),y=b=>Math.exp(g+m*(b-s));return{coef:[Math.exp(g-m*s),m],predict:y,rSquared:Vm(t,e,n,o,y)}}function nnt(t,e,n){let i=0,r=0,s=0,o=0,a=0,u=0;jb(t,e,n,(f,d)=>{const h=Math.log(f),p=Math.log(d);++u,i+=(h-i)/u,r+=(p-r)/u,s+=(h*p-s)/u,o+=(h*h-o)/u,a+=(d-a)/u});const c=Ub(i,r,s,o),l=f=>c[0]*Math.pow(f,c[1]);return c[0]=Math.exp(c[0]),{coef:c,predict:l,rSquared:Vm(t,e,n,a,l)}}function AN(t,e,n){const[i,r,s,o]=gA(t,e,n),a=i.length;let u=0,c=0,l=0,f=0,d=0,h,p,g,m;for(h=0;h<a;)p=i[h],g=r[h++],m=p*p,u+=(m-u)/h,c+=(m*p-c)/h,l+=(m*m-l)/h,f+=(p*g-f)/h,d+=(m*g-d)/h;const y=l-u*u,b=u*y-c*c,v=(d*u-f*c)/b,w=(f*y-d*c)/b,_=-v*u,S=x=>(x=x-s,v*x*x+w*x+_+o);return{coef:[_-w*s+v*s*s+o,w-2*v*s,v],predict:S,rSquared:Vm(t,e,n,o,S)}}function int(t,e,n,i){if(i===0)return SN(t,e,n);if(i===1)return EN(t,e,n);if(i===2)return AN(t,e,n);const[r,s,o,a]=gA(t,e,n),u=r.length,c=[],l=[],f=i+1;let d,h,p,g,m;for(d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],d)*s[p];for(c.push(g),m=new Float64Array(f),h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],d+h);m[h]=g}l.push(m)}l.push(c);const y=s6t(l),b=v=>{v-=o;let w=a+y[0]+y[1]*v+y[2]*v*v;for(d=3;d<f;++d)w+=y[d]*Math.pow(v,d);return w};return{coef:r6t(f,y,-o,a),predict:b,rSquared:Vm(t,e,n,a,b)}}function r6t(t,e,n,i){const r=Array(t);let s,o,a,u;for(s=0;s<t;++s)r[s]=0;for(s=t-1;s>=0;--s)for(a=e[s],u=1,r[s]+=a,o=1;o<=s;++o)u*=(s+1-o)/o,r[s-o]+=a*Math.pow(n,o)*u;return r[0]+=i,r}function s6t(t){const e=t.length-1,n=[];let i,r,s,o,a;for(i=0;i<e;++i){for(o=i,r=i+1;r<e;++r)Math.abs(t[i][r])>Math.abs(t[i][o])&&(o=r);for(s=i;s<e+1;++s)a=t[s][i],t[s][i]=t[s][o],t[s][o]=a;for(r=i+1;r<e;++r)for(s=e;s>=i;s--)t[s][r]-=t[s][i]*t[i][r]/t[i][i]}for(r=e-1;r>=0;--r){for(a=0,s=r+1;s<e;++s)a+=t[s][r]*n[s];n[r]=(t[e][r]-a)/t[r][r]}return n}const t9=2,e9=1e-12;function rnt(t,e,n,i){const[r,s,o,a]=gA(t,e,n,!0),u=r.length,c=Math.max(2,~~(i*u)),l=new Float64Array(u),f=new Float64Array(u),d=new Float64Array(u).fill(1);for(let h=-1;++h<=t9;){const p=[0,c-1];for(let m=0;m<u;++m){const y=r[m],b=p[0],v=p[1],w=y-r[b]>r[v]-y?b:v;let _=0,S=0,x=0,E=0,A=0;const $=1/Math.abs(r[w]-y||1);for(let T=b;T<=v;++T){const M=r[T],F=s[T],D=o6t(Math.abs(y-M)*$)*d[T],N=M*D;_+=D,S+=N,x+=F*D,E+=F*N,A+=M*N}const[I,k]=Ub(S/_,x/_,E/_,A/_);l[m]=I+k*y,f[m]=Math.abs(s[m]-l[m]),a6t(r,m+1,p)}if(h===t9)break;const g=Ud(f);if(Math.abs(g)<e9)break;for(let m=0,y,b;m<u;++m)y=f[m]/(6*g),d[m]=y>=1?e9:(b=1-y*y)*b}return u6t(r,l,o,a)}function o6t(t){return(t=1-t*t*t)*t*t}function a6t(t,e,n){const i=t[e];let r=n[0],s=n[1]+1;if(!(s>=t.length))for(;e>r&&t[s]-i<=i-t[r];)n[0]=++r,n[1]=s,++s}function u6t(t,e,n,i){const r=t.length,s=[];let o=0,a=0,u=[],c;for(;o<r;++o)c=t[o]+n,u[0]===c?u[1]+=(e[o]-u[1])/++a:(a=0,u[1]+=i,u=[c,e[o]],s.push(u));return u[1]+=i,s}const c6t=.5*Math.PI/180;function mA(t,e,n,i){n=n||25,i=Math.max(n,i||200);const r=g=>[g,t(g)],s=e[0],o=e[1],a=o-s,u=a/i,c=[r(s)],l=[];if(n===i){for(let g=1;g<i;++g)c.push(r(s+g/n*a));return c.push(r(o)),c}else{l.push(r(o));for(let g=n;--g>0;)l.push(r(s+g/n*a))}let f=c[0],d=l[l.length-1];const h=1/a,p=l6t(f[1],l);for(;d;){const g=r((f[0]+d[0])/2);g[0]-f[0]>=u&&f6t(f,g,d,h,p)>c6t?l.push(g):(f=d,c.push(d),l.pop()),d=l[l.length-1]}return c}function l6t(t,e){let n=t,i=t;const r=e.length;for(let s=0;s<r;++s){const o=e[s][1];o<n&&(n=o),o>i&&(i=o)}return 1/(i-n)}function f6t(t,e,n,i,r){const s=Math.atan2(r*(n[1]-t[1]),i*(n[0]-t[0])),o=Math.atan2(r*(e[1]-t[1]),i*(e[0]-t[0]));return Math.abs(s-o)}function d6t(t){return e=>{const n=t.length;let i=1,r=String(t[0](e));for(;i<n;++i)r+="|"+t[i](e);return r}}function dF(t){return!t||!t.length?function(){return""}:t.length===1?t[0]:d6t(t)}function snt(t,e,n){return n||t+(e?"_"+e:"")}const l3=()=>{},h6t={init:l3,add:l3,rem:l3,idx:0},N1={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.valid?t.sum:void 0,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||t.min===void 0)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||t.max===void 0)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(t,e)=>{t.exp=0,t.exp_r=e},value:t=>t.valid?t.exp*(1-t.exp_r)/(1-t.exp_r**t.valid):void 0,add:(t,e)=>t.exp=t.exp_r*t.exp+e,rem:(t,e)=>t.exp=(t.exp-e/t.exp_r**(t.valid-1))/t.exp_r},exponentialb:{value:t=>t.valid?t.exp*(1-t.exp_r):void 0,req:["exponential"],idx:1}},qb=Object.keys(N1).filter(t=>t!=="__count__");function p6t(t,e){return(n,i)=>Jt({name:t,aggregate_param:i,out:n||t},h6t,e)}[...qb,"__count__"].forEach(t=>{N1[t]=p6t(t,N1[t])});function ont(t,e,n){return N1[t](n,e)}function ant(t,e){return t.idx-e.idx}function g6t(t){const e={};t.forEach(i=>e[i.name]=i);const n=i=>{i.req&&i.req.forEach(r=>{e[r]||n(e[r]=N1[r]())})};return t.forEach(n),Object.values(e).sort(ant)}function m6t(){this.valid=0,this.missing=0,this._ops.forEach(t=>t.aggregate_param==null?t.init(this):t.init(this,t.aggregate_param))}function y6t(t,e){if(t==null||t===""){++this.missing;return}t===t&&(++this.valid,this._ops.forEach(n=>n.add(this,t,e)))}function b6t(t,e){if(t==null||t===""){--this.missing;return}t===t&&(--this.valid,this._ops.forEach(n=>n.rem(this,t,e)))}function v6t(t){return this._out.forEach(e=>t[e.out]=e.value(this)),t}function unt(t,e){const n=e||Li,i=g6t(t),r=t.slice().sort(ant);function s(o){this._ops=i,this._out=r,this.cell=o,this.init()}return s.prototype.init=m6t,s.prototype.add=y6t,s.prototype.rem=b6t,s.prototype.set=v6t,s.prototype.get=n,s.fields=t.map(o=>o.out),s}function $N(t){this._key=t?Vs(t):wt,this.reset()}const vi=$N.prototype;vi.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};vi.add=function(t){this._add.push(t)};vi.rem=function(t){this._rem.push(t)};vi.values=function(){if(this._get=null,this._rem.length===0)return this._add;const t=this._add,e=this._rem,n=this._key,i=t.length,r=e.length,s=Array(i-r),o={};let a,u,c;for(a=0;a<r;++a)o[n(e[a])]=1;for(a=0,u=0;a<i;++a)o[n(c=t[a])]?o[n(c)]=0:s[u++]=c;return this._rem=[],this._add=s};vi.distinct=function(t){const e=this.values(),n={};let i=e.length,r=0,s;for(;--i>=0;)s=t(e[i])+"",xt(n,s)||(n[s]=1,++r);return r};vi.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),n=Htt(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext};vi.argmin=function(t){return this.extent(t)[0]||{}};vi.argmax=function(t){return this.extent(t)[1]||{}};vi.min=function(t){const e=this.extent(t)[0];return e!=null?t(e):void 0};vi.max=function(t){const e=this.extent(t)[1];return e!=null?t(e):void 0};vi.quartile=function(t){return(this._get!==t||!this._q)&&(this._q=lN(this.values(),t),this._get=t),this._q};vi.q1=function(t){return this.quartile(t)[0]};vi.q2=function(t){return this.quartile(t)[1]};vi.q3=function(t){return this.quartile(t)[2]};vi.ci=function(t){return(this._get!==t||!this._ci)&&(this._ci=Het(this.values(),1e3,.05,t),this._get=t),this._ci};vi.ci0=function(t){return this.ci(t)[0]};vi.ci1=function(t){return this.ci(t)[1]};function ql(t){z.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}ql.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:qb},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};J(ql,z,{transform(t,e){const n=this,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.modified();return n.stamp=i.stamp,n.value&&(r||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(t):Object.create(null),e.visit(e.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(t),e.visit(e.REM,s=>n.rem(s)),e.visit(e.ADD,s=>n.add(s))),i.modifies(n._outputs),n._drop=t.drop!==!1,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const t=this,e=t.value,n=t._dnames,i=n.map(()=>({})),r=n.length;function s(a){let u,c,l,f;for(u in a)for(l=a[u].tuple,c=0;c<r;++c)i[c][f=l[n[c]]]=f}s(t._prev),s(e);function o(a,u,c){const l=n[c],f=i[c++];for(const d in f){const h=a?a+"|"+d:d;u[l]=f[d],c<r?o(h,u,c):e[h]||t.cell(h,u)}}o("",{},0)},init(t){const e=this._inputs=[],n=this._outputs=[],i={};function r(b){const v=ot(Ci(b)),w=v.length;let _=0,S;for(;_<w;++_)i[S=v[_]]||(i[S]=1,e.push(S))}this._dims=ot(t.groupby),this._dnames=this._dims.map(b=>{const v=En(b);return r(b),n.push(v),v}),this.cellkey=t.key?t.key:dF(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=t.fields||[null],o=t.ops||["count"],a=t.aggregate_params||[null],u=t.as||[],c=s.length,l={};let f,d,h,p,g,m,y;for(c!==o.length&&q("Unmatched number of fields and aggregate ops."),y=0;y<c;++y){if(f=s[y],d=o[y],h=a[y]||null,f==null&&d!=="count"&&q("Null aggregate field specified."),g=En(f),m=snt(d,g,u[y]),n.push(m),d==="count"){this._counts.push(m);continue}p=l[g],p||(r(f),p=l[g]=[],p.field=f,this._measures.push(p)),d!=="count"&&(this._countOnly=!1),p.push(ont(d,h,m))}return this._measures=this._measures.map(b=>unt(b,b.field)),Object.create(null)},cellkey:dF(),cell(t,e){let n=this.value[t];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},newcell(t,e){const n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,r=i.length;n.agg=Array(r);for(let s=0;s<r;++s)n.agg[s]=new i[s](n)}return n.store&&(n.data=new $N),n},newtuple(t,e){const n=this._dnames,i=this._dims,r=i.length,s={};for(let o=0;o<r;++o)s[n[o]]=i[o](t);return e?zet(e.tuple,s):Ae(s)},clean(){const t=this.value;for(const e in t)t[e].num===0&&delete t[e]},add(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(t);const i=n.agg;for(let r=0,s=i.length;r<s;++r)i[r].add(i[r].get(t),t)},rem(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(t);const i=n.agg;for(let r=0,s=i.length;r<s;++r)i[r].rem(i[r].get(t),t)},celltuple(t){const e=t.tuple,n=this._counts;t.store&&t.data.values();for(let i=0,r=n.length;i<r;++i)e[n[i]]=t.num;if(!this._countOnly){const i=t.agg;for(let r=0,s=i.length;r<s;++r)i[r].set(e)}return e},changes(t){const e=this._adds,n=this._mods,i=this._prev,r=this._drop,s=t.add,o=t.rem,a=t.mod;let u,c,l,f;if(i)for(c in i)u=i[c],(!r||u.num)&&o.push(u.tuple);for(l=0,f=this._alen;l<f;++l)s.push(this.celltuple(e[l])),e[l]=null;for(l=0,f=this._mlen;l<f;++l)u=n[l],(u.num===0&&r?o:a).push(this.celltuple(u)),n[l]=null;return this._alen=this._mlen=0,this._prev=null,t}});const w6t=1e-14;function IN(t){z.call(this,null,t)}IN.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};J(IN,z,{transform(t,e){const n=t.interval!==!1,i=this._bins(t),r=i.start,s=i.step,o=t.as||["bin0","bin1"],a=o[0],u=o[1];let c;return t.modified()?(e=e.reflow(!0),c=e.SOURCE):c=e.modified(Ci(t.field))?e.ADD_MOD:e.ADD,e.visit(c,n?l=>{const f=i(l);l[a]=f,l[u]=f==null?null:r+s*(1+(f-r)/s)}:l=>l[a]=i(l)),e.modifies(n?o:a)},_bins(t){if(this.value&&!t.modified())return this.value;const e=t.field,n=Yet(t),i=n.step;let r=n.start,s=r+Math.ceil((n.stop-r)/i)*i,o,a;(o=t.anchor)!=null&&(a=o-(r+i*Math.floor((o-r)/i)),r+=a,s+=a);const u=function(c){let l=Ti(e(c));return l==null?null:l<r?-1/0:l>s?1/0:(l=Math.max(r,Math.min(l,s-i)),r+i*Math.floor(w6t+(l-r)/i))};return u.start=r,u.stop=n.stop,u.step=i,this.value=qr(u,Ci(e),t.name||"bin_"+En(e))}});function cnt(t,e,n){const i=t;let r=e||[],s=n||[],o={},a=0;return{add:u=>s.push(u),remove:u=>o[i(u)]=++a,size:()=>r.length,data:(u,c)=>(a&&(r=r.filter(l=>!o[i(l)]),o={},a=0),c&&u&&r.sort(u),s.length&&(r=u?tet(u,r,s.sort(u)):r.concat(s),s=[]),r)}}function MN(t){z.call(this,[],t)}MN.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};J(MN,z,{transform(t,e){const n=e.fork(e.ALL),i=cnt(wt,this.value,n.materialize(n.ADD).add),r=t.sort,s=e.changed()||r&&(t.modified("sort")||e.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(s),this.value=n.source=i.data(Ah(r),s),e.source&&e.source.root&&(this.value.root=e.source.root),n}});function lnt(t){Ue.call(this,null,_6t,t)}J(lnt,Ue);function _6t(t){return this.value&&!t.modified()?this.value:YC(t.fields,t.orders)}function TN(t){z.call(this,null,t)}TN.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function x6t(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase();break}return t.match(n)}J(TN,z,{transform(t,e){const n=f=>d=>{for(var h=x6t(a(d),t.case,s)||[],p,g=0,m=h.length;g<m;++g)o.test(p=h[g])||f(p)},i=this._parameterCheck(t,e),r=this._counts,s=this._match,o=this._stop,a=t.field,u=t.as||["text","count"],c=n(f=>r[f]=1+(r[f]||0)),l=n(f=>r[f]-=1);return i?e.visit(e.SOURCE,c):(e.visit(e.ADD,c),e.visit(e.REM,l)),this._finish(e,u)},_parameterCheck(t,e){let n=!1;return(t.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),(t.modified("pattern")||!this._match)&&(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(t,e){const n=this._counts,i=this._tuples||(this._tuples={}),r=e[0],s=e[1],o=t.fork(t.NO_SOURCE|t.NO_FIELDS);let a,u,c;for(a in n)u=i[a],c=n[a]||0,!u&&c?(i[a]=u=Ae({}),u[r]=a,u[s]=c,o.add.push(u)):c===0?(u&&o.rem.push(u),n[a]=null,i[a]=null):u[s]!==c&&(u[s]=c,o.mod.push(u));return o.modifies(e)}});function FN(t){z.call(this,null,t)}FN.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};J(FN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.as||["a","b"],r=i[0],s=i[1],o=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let a=this.value;return o?(a&&(n.rem=a),a=e.materialize(e.SOURCE).source,n.add=this.value=S6t(a,r,s,t.filter||Ws)):n.mod=a,n.source=this.value,n.modifies(i)}});function S6t(t,e,n,i){for(var r=[],s={},o=t.length,a=0,u,c;a<o;++a)for(s[e]=c=t[a],u=0;u<o;++u)s[n]=t[u],i(s)&&(r.push(Ae(s)),s={},s[e]=c);return r}const n9={kde:pN,mixture:Qet,normal:hN,lognormal:Jet,uniform:Zet},E6t="distributions",i9="function",A6t="field";function fnt(t,e){const n=t[i9];xt(n9,n)||q("Unknown distribution function: "+n);const i=n9[n]();for(const r in t)r===A6t?i.data((t.from||e()).map(t[r])):r===E6t?i[r](t[r].map(s=>fnt(s,e))):typeof i[r]===i9&&i[r](t[r]);return i}function kN(t){z.call(this,null,t)}const dnt=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],$6t={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:dnt},{name:"weights",type:"number",array:!0}]};kN.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:dnt.concat($6t)},{name:"as",type:"string",array:!0,default:["value","density"]}]};J(kN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=fnt(t.distribution,I6t(e)),r=t.steps||t.minsteps||25,s=t.steps||t.maxsteps||200;let o=t.method||"pdf";o!=="pdf"&&o!=="cdf"&&q("Invalid density method: "+o),!t.extent&&!i.data&&q("Missing density extent parameter."),o=i[o];const a=t.as||["value","density"],u=t.extent||Ua(i.data()),c=mA(o,u,r,s).map(l=>{const f={};return f[a[0]]=l[0],f[a[1]]=l[1],Ae(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});function I6t(t){return()=>t.materialize(t.SOURCE).source}function hnt(t,e){return t?t.map((n,i)=>e[i]||En(n)):null}function DN(t,e,n){const i=[],r=f=>f(u);let s,o,a,u,c,l;if(e==null)i.push(t.map(n));else for(s={},o=0,a=t.length;o<a;++o)u=t[o],c=e.map(r),l=s[c],l||(s[c]=l=[],l.dims=c,i.push(l)),l.push(n(u));return i}const pnt="bin";function CN(t){z.call(this,null,t)}CN.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:pnt}]};const M6t=(t,e)=>zb(Ua(t,e))/30;J(CN,z,{transform(t,e){if(this.value&&!(t.modified()||e.changed()))return e;const n=e.materialize(e.SOURCE).source,i=DN(e.source,t.groupby,Li),r=t.smooth||!1,s=t.field,o=t.step||M6t(n,s),a=Ah((p,g)=>s(p)-s(g)),u=t.as||pnt,c=i.length;let l=1/0,f=-1/0,d=0,h;for(;d<c;++d){const p=i[d].sort(a);h=-1;for(const g of Xet(p,o,r,s))g<l&&(l=g),g>f&&(f=g),p[++h][u]=g}return this.value={start:l,stop:f,step:o},e.reflow(!0).modifies(u)}});function gnt(t){Ue.call(this,null,T6t,t),this.modified(!0)}J(gnt,Ue);function T6t(t){const e=t.expr;return this.value&&!t.modified("expr")?this.value:qr(n=>e(n,t),Ci(e),En(e))}function NN(t){z.call(this,[void 0,void 0],t)}NN.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};J(NN,z,{transform(t,e){const n=this.value,i=t.field,r=e.changed()||e.modified(i.fields)||t.modified("field");let s=n[0],o=n[1];if((r||s==null)&&(s=1/0,o=-1/0),e.visit(r?e.SOURCE:e.ADD,a=>{const u=Ti(i(a));u!=null&&(u<s&&(s=u),u>o&&(o=u))}),!Number.isFinite(s)||!Number.isFinite(o)){let a=En(i);a&&(a=` for field "${a}"`),e.dataflow.warn(`Infinite extent${a}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]}});function ON(t,e){Ue.call(this,t),this.parent=e,this.count=0}J(ON,Ue,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}});function yA(t){z.call(this,{},t),this._keys=Um();const e=this._targets=[];e.active=0,e.forEach=n=>{for(let i=0,r=e.active;i<r;++i)n(e[i],i,e)}}J(yA,z,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,i){const r=this.value;let s=xt(r,t)&&r[t],o,a;return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=i||(a=this._group[t])&&a.tuple,o=n.dataflow,s=new ON(n.fork(n.NO_SOURCE),this),o.add(s).connect(e(o,t,a)),r[t]=s,this.activate(s)),s},clean(){const t=this.value;let e=0;for(const n in t)if(t[n].count===0){const i=t[n].detachSubflow;i&&i(),delete t[n],++e}if(e){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(t){const e=this._targets,n=e.length,i=t?t.length:0;let r=0;for(;r<i;++r)e[r]=t[r];for(;r<n&&e[r]!=null;++r)e[r]=null;e.active=i},transform(t,e){const n=e.dataflow,i=t.key,r=t.subflow,s=this._keys,o=t.modified("key"),a=u=>this.subflow(u,r,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,u=>{const c=wt(u),l=s.get(c);l!==void 0&&(s.delete(c),a(l).rem(u))}),e.visit(e.ADD,u=>{const c=i(u);s.set(wt(u),c),a(c).add(u)}),o||e.modified(i.fields)?e.visit(e.MOD,u=>{const c=wt(u),l=s.get(c),f=i(u);l===f?a(f).mod(u):(s.set(c,f),a(l).rem(u),a(f).add(u))}):e.changed(e.MOD)&&e.visit(e.MOD,u=>{a(s.get(wt(u))).mod(u)}),o&&e.visit(e.REFLOW,u=>{const c=wt(u),l=s.get(c),f=i(u);l!==f&&(s.set(c,f),a(l).rem(u),a(f).add(u))}),e.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),e}});function mnt(t){Ue.call(this,null,F6t,t)}J(mnt,Ue);function F6t(t){return this.value&&!t.modified()?this.value:W(t.name)?ot(t.name).map(e=>Vs(e)):Vs(t.name,t.as)}function RN(t){z.call(this,Um(),t)}RN.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};J(RN,z,{transform(t,e){const n=e.dataflow,i=this.value,r=e.fork(),s=r.add,o=r.rem,a=r.mod,u=t.expr;let c=!0;e.visit(e.REM,f=>{const d=wt(f);i.has(d)?i.delete(d):o.push(f)}),e.visit(e.ADD,f=>{u(f,t)?s.push(f):i.set(wt(f),1)});function l(f){const d=wt(f),h=u(f,t),p=i.get(d);h&&p?(i.delete(d),s.push(f)):!h&&!p?(i.set(d,1),o.push(f)):c&&h&&!p&&a.push(f)}return e.visit(e.MOD,l),t.modified()&&(c=!1,e.visit(e.REFLOW,l)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}});function LN(t){z.call(this,[],t)}LN.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};J(LN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=hnt(i,t.as||[]),s=t.index||null,o=r.length;return n.rem=this.value,e.visit(e.SOURCE,a=>{const u=i.map(p=>p(a)),c=u.reduce((p,g)=>Math.max(p,g.length),0);let l=0,f,d,h;for(;l<c;++l){for(d=oN(a),f=0;f<o;++f)d[r[f]]=(h=u[f][l])==null?null:h;s&&(d[s]=l),n.add.push(d)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(r)}});function BN(t){z.call(this,[],t)}BN.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};J(BN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=i.map(En),s=t.as||["key","value"],o=s[0],a=s[1],u=i.length;return n.rem=this.value,e.visit(e.SOURCE,c=>{for(let l=0,f;l<u;++l)f=oN(c),f[o]=r[l],f[a]=i[l](c),n.add.push(f)}),this.value=n.source=n.add,n.modifies(s)}});function PN(t){z.call(this,null,t)}PN.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};J(PN,z,{transform(t,e){const n=t.expr,i=t.as,r=t.modified(),s=t.initonly?e.ADD:r?e.SOURCE:e.modified(n.fields)||e.modified(i)?e.ADD_MOD:e.ADD;return r&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(i),e.visit(s,o=>o[i]=n(o,t))}});function ynt(t){z.call(this,[],t)}J(ynt,z,{transform(t,e){const n=e.fork(e.ALL),i=t.generator;let r=this.value,s=t.size-r.length,o,a,u;if(s>0){for(o=[];--s>=0;)o.push(u=Ae(i(t))),r.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else a=r.slice(0,-s),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,r=r.slice(-s);return n.source=this.value=r,n}});const uw={value:"value",median:Ud,mean:pb,min:yi,max:tn},k6t=[];function zN(t){z.call(this,[],t)}zN.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function D6t(t){var e=t.method||uw.value,n;if(uw[e]==null)q("Unrecognized imputation method: "+e);else return e===uw.value?(n=t.value!==void 0?t.value:0,()=>n):uw[e]}function C6t(t){const e=t.field;return n=>n?e(n):NaN}J(zN,z,{transform(t,e){var n=e.fork(e.ALL),i=D6t(t),r=C6t(t),s=En(t.field),o=En(t.key),a=(t.groupby||[]).map(En),u=N6t(e.source,t.groupby,t.key,t.keyvals),c=[],l=this.value,f=u.domain.length,d,h,p,g,m,y,b,v,w,_;for(m=0,v=u.length;m<v;++m)for(d=u[m],p=d.values,h=NaN,b=0;b<f;++b)if(d[b]==null){for(g=u.domain[b],_={_impute:!0},y=0,w=p.length;y<w;++y)_[a[y]]=p[y];_[o]=g,_[s]=Number.isNaN(h)?h=i(d,r):h,c.push(Ae(_))}return c.length&&(n.add=n.materialize(n.ADD).add.concat(c)),l.length&&(n.rem=n.materialize(n.REM).rem.concat(l)),this.value=c,n}});function N6t(t,e,n,i){var r=y=>y(m),s=[],o=i?i.slice():[],a={},u={},c,l,f,d,h,p,g,m;for(o.forEach((y,b)=>a[y]=b+1),d=0,g=t.length;d<g;++d)m=t[d],p=n(m),h=a[p]||(a[p]=o.push(p)),l=(c=e?e.map(r):k6t)+"",(f=u[l])||(f=u[l]=[],s.push(f),f.values=c),f[h-1]=m;return s.domain=o,s}function UN(t){ql.call(this,t)}UN.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:qb},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};J(UN,ql,{transform(t,e){const n=this,i=t.modified();let r;return n.value&&(i||e.modified(n._inputs,!0))?(r=n.value=i?n.init(t):{},e.visit(e.SOURCE,s=>n.add(s))):(r=n.value=n.value||this.init(t),e.visit(e.REM,s=>n.rem(s)),e.visit(e.ADD,s=>n.add(s))),n.changes(),e.visit(e.SOURCE,s=>{Jt(s,r[n.cellkey(s)].tuple)}),e.reflow(i).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(t[n]),t[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(e[n]),e[n]=null;this._alen=this._mlen=0}});function jN(t){z.call(this,null,t)}jN.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};J(jN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=DN(i,t.groupby,t.field),s=(t.groupby||[]).map(En),o=t.bandwidth,a=t.cumulative?"cdf":"pdf",u=t.as||["value","density"],c=[];let l=t.extent,f=t.steps||t.minsteps||25,d=t.steps||t.maxsteps||200;a!=="pdf"&&a!=="cdf"&&q("Invalid density method: "+a),t.resolve==="shared"&&(l||(l=Ua(i,t.field)),f=d=t.steps||d),r.forEach(h=>{const p=pN(h,o)[a],g=t.counts?h.length:1,m=l||Ua(h);mA(p,m,f,d).forEach(y=>{const b={};for(let v=0;v<s.length;++v)b[s[v]]=h.dims[v];b[u[0]]=y[0],b[u[1]]=y[1]*g,c.push(Ae(b))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});function bnt(t){Ue.call(this,null,O6t,t)}J(bnt,Ue);function O6t(t){return this.value&&!t.modified()?this.value:XC(t.fields,t.flat)}function vnt(t){z.call(this,[],t),this._pending=null}J(vnt,z,{transform(t,e){const n=e.dataflow;return this._pending?f3(this,e,this._pending):R6t(t)?e.StopPropagation:t.values?f3(this,e,n.parse(t.values,t.format)):t.async?{async:n.request(t.url,t.format).then(r=>(this._pending=ot(r.data),s=>s.touch(this)))}:n.request(t.url,t.format).then(i=>f3(this,e,ot(i.data)))}});function R6t(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}function f3(t,e,n){n.forEach(Ae);const i=e.fork(e.NO_FIELDS&e.NO_SOURCE);return i.rem=t.value,t.value=i.source=i.add=n,t._pending=null,i.rem.length&&i.clean(!0),i}function qN(t){z.call(this,{},t)}qN.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};J(qN,z,{transform(t,e){const n=t.fields,i=t.index,r=t.values,s=t.default==null?null:t.default,o=t.modified(),a=n.length;let u=o?e.SOURCE:e.ADD,c=e,l=t.as,f,d,h;return r?(d=r.length,a>1&&!l&&q('Multi-field lookup requires explicit "as" parameter.'),l&&l.length!==a*d&&q('The "as" parameter has too few output field names.'),l=l||r.map(En),f=function(p){for(var g=0,m=0,y,b;g<a;++g)if(b=i.get(n[g](p)),b==null)for(y=0;y<d;++y,++m)p[l[m]]=s;else for(y=0;y<d;++y,++m)p[l[m]]=r[y](b)}):(l||q("Missing output field names."),f=function(p){for(var g=0,m;g<a;++g)m=i.get(n[g](p)),p[l[g]]=m??s}),o?c=e.reflow(!0):(h=n.some(p=>e.modified(p.fields)),u|=h?e.MOD:0),e.visit(u,f),c.modifies(l)}});function wnt(t){Ue.call(this,null,L6t,t)}J(wnt,Ue);function L6t(t){if(this.value&&!t.modified())return this.value;const e=t.extents,n=e.length;let i=1/0,r=-1/0,s,o;for(s=0;s<n;++s)o=e[s],o[0]<i&&(i=o[0]),o[1]>r&&(r=o[1]);return[i,r]}function _nt(t){Ue.call(this,null,B6t,t)}J(_nt,Ue);function B6t(t){return this.value&&!t.modified()?this.value:t.values.reduce((e,n)=>e.concat(n),[])}function xnt(t){z.call(this,null,t)}J(xnt,z,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function VN(t){ql.call(this,t)}VN.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:qb,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};J(VN,ql,{_transform:ql.prototype.transform,transform(t,e){return this._transform(P6t(t,e),e)}});function P6t(t,e){const n=t.field,i=t.value,r=(t.op==="count"?"__count__":t.op)||"sum",s=Ci(n).concat(Ci(i)),o=U6t(n,t.limit||0,e);return e.changed()&&t.set("__pivot__",null,null,!0),{key:t.key,groupby:t.groupby,ops:o.map(()=>r),fields:o.map(a=>z6t(a,n,i,s)),as:o.map(a=>a+""),modified:t.modified.bind(t)}}function z6t(t,e,n,i){return qr(r=>e(r)===t?n(r):NaN,i,t+"")}function U6t(t,e,n){const i={},r=[];return n.visit(n.SOURCE,s=>{const o=t(s);i[o]||(i[o]=1,r.push(o))}),r.sort(rA),e?r.slice(0,e):r}function Snt(t){yA.call(this,t)}J(Snt,yA,{transform(t,e){const n=t.subflow,i=t.field,r=s=>this.subflow(wt(s),n,e,s);return(t.modified("field")||i&&e.modified(Ci(i)))&&q("PreFacet does not support field modification."),this.initTargets(),i?(e.visit(e.MOD,s=>{const o=r(s);i(s).forEach(a=>o.mod(a))}),e.visit(e.ADD,s=>{const o=r(s);i(s).forEach(a=>o.add(Ae(a)))}),e.visit(e.REM,s=>{const o=r(s);i(s).forEach(a=>o.rem(a))})):(e.visit(e.MOD,s=>r(s).mod(s)),e.visit(e.ADD,s=>r(s).add(s)),e.visit(e.REM,s=>r(s).rem(s))),e.clean()&&e.runAfter(()=>this.clean()),e}});function WN(t){z.call(this,null,t)}WN.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};J(WN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=hnt(t.fields,t.as||[]),s=i?(a,u)=>j6t(a,u,i,r):cA;let o;return this.value?o=this.value:(e=e.addAll(),o=this.value={}),e.visit(e.REM,a=>{const u=wt(a);n.rem.push(o[u]),o[u]=null}),e.visit(e.ADD,a=>{const u=s(a,Ae({}));o[wt(a)]=u,n.add.push(u)}),e.visit(e.MOD,a=>{n.mod.push(s(a,o[wt(a)]))}),n}});function j6t(t,e,n,i){for(let r=0,s=n.length;r<s;++r)e[i[r]]=n[r](t);return e}function Ent(t){z.call(this,null,t)}J(Ent,z,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function GN(t){z.call(this,null,t)}GN.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const q6t=1e-14;J(GN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return n.source=this.value,n;const r=e.materialize(e.SOURCE).source,s=DN(r,t.groupby,t.field),o=(t.groupby||[]).map(En),a=[],u=t.step||.01,c=t.probs||Un(u/2,1-q6t,u),l=c.length;return s.forEach(f=>{const d=cN(f,c);for(let h=0;h<l;++h){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[i[0]]=c[h],p[i[1]]=d[h],a.push(Ae(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function Ant(t){z.call(this,null,t)}J(Ant,z,{transform(t,e){let n,i;return this.value?i=this.value:(n=e=e.addAll(),i=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,r=>{const s=wt(r);n.rem.push(i[s]),i[s]=null}),e.visit(e.ADD,r=>{const s=oN(r);i[wt(r)]=s,n.add.push(s)}),e.visit(e.MOD,r=>{const s=i[wt(r)];for(const o in r)s[o]=r[o],n.modifies(o);n.mod.push(s)})),n}});function YN(t){z.call(this,[],t),this.count=0}YN.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};J(YN,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.modified("size"),r=t.size,s=this.value.reduce((l,f)=>(l[wt(f)]=1,l),{});let o=this.value,a=this.count,u=0;function c(l){let f,d;o.length<r?o.push(l):(d=~~((a+1)*Ys()),d<o.length&&d>=u&&(f=o[d],s[wt(f)]&&n.rem.push(f),o[d]=l)),++a}if(e.rem.length&&(e.visit(e.REM,l=>{const f=wt(l);s[f]&&(s[f]=-1,n.rem.push(l)),--a}),o=o.filter(l=>s[wt(l)]!==-1)),(e.rem.length||i)&&o.length<r&&e.source&&(u=a=o.length,e.visit(e.SOURCE,l=>{s[wt(l)]||c(l)}),u=-1),i&&o.length>r){const l=o.length-r;for(let f=0;f<l;++f)s[wt(o[f])]=-1,n.rem.push(o[f]);o=o.slice(l)}return e.mod.length&&e.visit(e.MOD,l=>{s[wt(l)]&&n.mod.push(l)}),e.add.length&&e.visit(e.ADD,c),(e.add.length||u<0)&&(n.add=o.filter(l=>!s[wt(l)])),this.count=a,this.value=n.source=o,n}});function HN(t){z.call(this,null,t)}HN.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};J(HN,z,{transform(t,e){if(this.value&&!t.modified())return;const n=e.materialize().fork(e.MOD),i=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=Un(t.start,t.stop,t.step||1).map(r=>{const s={};return s[i]=r,Ae(s)}),n.add=e.add.concat(this.value),n}});function $nt(t){z.call(this,null,t),this.modified(!0)}J($nt,z,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function XN(t){z.call(this,null,t)}const Int=["unit0","unit1"];XN.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:ZC,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Int}]};J(XN,z,{transform(t,e){const n=t.field,i=t.interval!==!1,r=t.timezone==="utc",s=this._floor(t,e),o=(r?qm:jm)(s.unit).offset,a=t.as||Int,u=a[0],c=a[1],l=s.step;let f=s.start||1/0,d=s.stop||-1/0,h=e.ADD;return(t.modified()||e.changed(e.REM)||e.modified(Ci(n)))&&(e=e.reflow(!0),h=e.SOURCE,f=1/0,d=-1/0),e.visit(h,p=>{const g=n(p);let m,y;g==null?(p[u]=null,i&&(p[c]=null)):(p[u]=m=y=s(g),i&&(p[c]=y=o(m,l)),m<f&&(f=m),y>d&&(d=y))}),s.start=f,s.stop=d,e.modifies(i?a:u)},_floor(t,e){const n=t.timezone==="utc",{units:i,step:r}=t.units?{units:t.units,step:t.step||1}:Eet({extent:t.extent||Ua(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),s=tN(i),o=this.value||{},a=(n?pet:het)(s,r);return a.unit=pe(s),a.units=s,a.step=r,a.start=o.start,a.stop=o.stop,this.value=a}});function Mnt(t){z.call(this,Um(),t)}J(Mnt,z,{transform(t,e){const n=e.dataflow,i=t.field,r=this.value,s=a=>r.set(i(a),a);let o=!0;return t.modified("field")||e.modified(i.fields)?(r.clear(),e.visit(e.SOURCE,s)):e.changed()?(e.visit(e.REM,a=>r.delete(i(a))),e.visit(e.ADD,s)):o=!1,this.modified(o),r.empty>n.cleanThreshold&&n.runAfter(r.clean),e.fork()}});function Tnt(t){z.call(this,null,t)}J(Tnt,z,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(Ah(t.sort)):e.source).map(t.field))}});function V6t(t,e,n,i){const r=O1[t](e,n);return{init:r.init||tl,update:function(s,o){o[i]=r.next(s)}}}const O1={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?++t:t}}},percent_rank:function(){const t=O1.rank(),e=t.next;return{init:t.init,next:n=>(e(n)-1)/(n.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const n=e.data,i=e.compare;let r=e.index;if(t<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;t=r}return(1+t)/n.length}}},ntile:function(t,e){e=+e,e>0||q("ntile num must be greater than zero.");const n=O1.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(e*i(r))}},lag:function(t,e){return e=+e||1,{next:n=>{const i=n.index-e;return i>=0?t(n.data[i]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{const i=n.index+e,r=n.data;return i<r.length?t(r[i]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return e=+e,e>0||q("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(e-1);return i<n.i1?t(n.data[i]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{const i=t(n.data[n.index]);return i!=null?e=i:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:i=>{const r=i.data;return i.index<=n?e:(n=W6t(t,r,i.index))<0?(n=r.length,e=null):e=t(r[n])}}}};function W6t(t,e,n){for(let i=e.length;n<i;++n)if(t(e[n])!=null)return n;return-1}const G6t=Object.keys(O1);function Fnt(t){const e=ot(t.ops),n=ot(t.fields),i=ot(t.params),r=ot(t.aggregate_params),s=ot(t.as),o=this.outputs=[],a=this.windows=[],u={},c={},l=[],f=[];let d=!0;function h(p){ot(Ci(p)).forEach(g=>u[g]=1)}h(t.sort),e.forEach((p,g)=>{const m=n[g],y=i[g],b=r[g]||null,v=En(m),w=snt(p,v,s[g]);if(h(m),o.push(w),xt(O1,p))a.push(V6t(p,m,y,w));else{if(m==null&&p!=="count"&&q("Null aggregate field specified."),p==="count"){l.push(w);return}d=!1;let _=c[v];_||(_=c[v]=[],_.field=m,f.push(_)),_.push(ont(p,b,w))}}),(l.length||f.length)&&(this.cell=Y6t(f,l,d)),this.inputs=Object.keys(u)}const knt=Fnt.prototype;knt.init=function(){this.windows.forEach(t=>t.init()),this.cell&&this.cell.init()};knt.update=function(t,e){const n=this.cell,i=this.windows,r=t.data,s=i&&i.length;let o;if(n){for(o=t.p0;o<t.i0;++o)n.rem(r[o]);for(o=t.p1;o<t.i1;++o)n.add(r[o]);n.set(e)}for(o=0;o<s;++o)i[o].update(t,e)};function Y6t(t,e,n){t=t.map(u=>unt(u,u.field));const i={num:0,agg:null,store:!1,count:e};if(!n)for(var r=t.length,s=i.agg=Array(r),o=0;o<r;++o)s[o]=new t[o](i);if(i.store)var a=i.data=new $N;return i.add=function(u){if(i.num+=1,!n){a&&a.add(u);for(let c=0;c<r;++c)s[c].add(s[c].get(u),u)}},i.rem=function(u){if(i.num-=1,!n){a&&a.rem(u);for(let c=0;c<r;++c)s[c].rem(s[c].get(u),u)}},i.set=function(u){let c,l;for(a&&a.values(),c=0,l=e.length;c<l;++c)u[e[c]]=i.num;if(!n)for(c=0,l=s.length;c<l;++c)s[c].set(u)},i.init=function(){i.num=0,a&&a.reset();for(let u=0;u<r;++u)s[u].init()},i}function KN(t){z.call(this,{},t),this._mlen=0,this._mods=[]}KN.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:G6t.concat(qb)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};J(KN,z,{transform(t,e){this.stamp=e.stamp;const n=t.modified(),i=Ah(t.sort),r=dF(t.groupby),s=a=>this.group(r(a));let o=this.state;(!o||n)&&(o=this.state=new Fnt(t)),n||e.modified(o.inputs)?(this.value={},e.visit(e.SOURCE,a=>s(a).add(a))):(e.visit(e.REM,a=>s(a).remove(a)),e.visit(e.ADD,a=>s(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)H6t(this._mods[a],o,i,t);return this._mlen=0,this._mods=[],e.reflow(n).modifies(o.outputs)},group(t){let e=this.value[t];return e||(e=this.value[t]=cnt(wt),e.stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}});function H6t(t,e,n,i){const r=i.sort,s=r&&!i.ignorePeers,o=i.frame||[null,0],a=t.data(n),u=a.length,c=s?bh(r):null,l={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:r||Bi(-1)};e.init();for(let f=0;f<u;++f)X6t(l,o,f,u),s&&K6t(l,c),e.update(l,a[f])}function X6t(t,e,n,i){t.p0=t.i0,t.p1=t.i1,t.i0=e[0]==null?0:Math.max(0,n-Math.abs(e[0])),t.i1=e[1]==null?i:Math.min(i,n+Math.abs(e[1])+1),t.index=n}function K6t(t,e){const n=t.i0,i=t.i1-1,r=t.compare,s=t.data,o=s.length-1;n>0&&!r(s[n],s[n-1])&&(t.i0=e.left(s,s[n])),i<o&&!r(s[i],s[i+1])&&(t.i1=e.right(s,s[i]))}const J6t=Object.freeze(Object.defineProperty({__proto__:null,aggregate:ql,bin:IN,collect:MN,compare:lnt,countpattern:TN,cross:FN,density:kN,dotbin:CN,expression:gnt,extent:NN,facet:yA,field:mnt,filter:RN,flatten:LN,fold:BN,formula:PN,generate:ynt,impute:zN,joinaggregate:UN,kde:jN,key:bnt,load:vnt,lookup:qN,multiextent:wnt,multivalues:_nt,params:xnt,pivot:VN,prefacet:Snt,project:WN,proxy:Ent,quantile:GN,relay:Ant,sample:YN,sequence:HN,sieve:$nt,subflow:ON,timeunit:XN,tupleindex:Mnt,values:Tnt,window:KN},Symbol.toStringTag,{value:"Module"}));function yl(t,e){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}const Q6t=()=>typeof Image<"u"?Image:null;function JN(t,e,n){const i=t-e+n*2;return t?i>0?i:1:0}const Z6t="identity",Wg="linear",lc="log",Vb="pow",Wb="sqrt",bA="symlog",Zd="time",th="utc",$a="sequential",Wm="diverging",Gg="quantile",vA="quantize",wA="threshold",QN="ordinal",hF="point",Dnt="band",ZN="bin-ordinal",Yn="continuous",Gb="discrete",Yb="discretizing",Js="interpolating",tO="temporal";function tCt(t){return function(e){let n=e[0],i=e[1],r;return i<n&&(r=n,n=i,i=r),[t.invert(n),t.invert(i)]}}function eCt(t){return function(e){const n=t.range();let i=e[0],r=e[1],s=-1,o,a,u,c;for(r<i&&(a=i,i=r,r=a),u=0,c=n.length;u<c;++u)n[u]>=i&&n[u]<=r&&(s<0&&(s=u),o=u);if(!(s<0))return i=t.invertExtent(n[s]),r=t.invertExtent(n[o]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]]}}function eO(){const t=xb().unknown(void 0),e=t.domain,n=t.range;let i=[0,1],r,s,o=!1,a=0,u=0,c=.5;delete t.unknown;function l(){const f=e().length,d=i[1]<i[0],h=i[1-d],p=JN(f,a,u);let g=i[d-0];r=(h-g)/(p||1),o&&(r=Math.floor(r)),g+=(h-g-r*(f-a))*c,s=r*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=Un(f).map(y=>g+r*y);return n(d?m.reverse():m)}return t.domain=function(f){return arguments.length?(e(f),l()):e()},t.range=function(f){return arguments.length?(i=[+f[0],+f[1]],l()):i.slice()},t.rangeRound=function(f){return i=[+f[0],+f[1]],o=!0,l()},t.bandwidth=function(){return s},t.step=function(){return r},t.round=function(f){return arguments.length?(o=!!f,l()):o},t.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,l()):a},t.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),l()):a},t.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),l()):u},t.align=function(f){return arguments.length?(c=Math.max(0,Math.min(1,f)),l()):c},t.invertRange=function(f){if(f[0]==null||f[1]==null)return;const d=i[1]<i[0],h=d?n().reverse():n(),p=h.length-1;let g=+f[0],m=+f[1],y,b,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<h[0]||g>i[1-d])))return y=Math.max(0,sc(h,g)-1),b=g===m?y:sc(h,m)-1,g-h[y]>s+1e-10&&++y,d&&(v=y,y=p-b,b=p-v),y>b?void 0:e().slice(y,b+1)},t.invert=function(f){const d=t.invertRange([f,f]);return d&&d[0]},t.copy=function(){return eO().domain(e()).range(i).round(o).paddingInner(a).paddingOuter(u).align(c)},l()}function Cnt(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return Cnt(e())},t}function nCt(){return Cnt(eO().paddingInner(1))}var iCt=Array.prototype.map;function rCt(t){return iCt.call(t,Ti)}const sCt=Array.prototype.slice;function Nnt(){let t=[],e=[];function n(i){return i==null||i!==i?void 0:e[(sc(t,i)-1)%e.length]}return n.domain=function(i){return arguments.length?(t=rCt(i),n):t.slice()},n.range=function(i){return arguments.length?(e=sCt.call(i),n):e.slice()},n.tickFormat=function(i,r){return $H(t[0],pe(t),i??10,r)},n.copy=function(){return Nnt().domain(n.domain()).range(n.range())},n}const Jx=new Map,Ont=Symbol("vega_scale");function Rnt(t){return t[Ont]=!0,t}function oCt(t){return t&&t[Ont]===!0}function aCt(t,e,n){const i=function(){const s=e();return s.invertRange||(s.invertRange=s.invert?tCt(s):s.invertExtent?eCt(s):void 0),s.type=t,Rnt(s)};return i.metadata=Mo(ot(n)),i}function xe(t,e,n){return arguments.length>1?(Jx.set(t,aCt(t,e,n)),this):Lnt(t)?Jx.get(t):void 0}xe(Z6t,e6);xe(Wg,gE,Yn);xe(lc,i6,[Yn,lc]);xe(Vb,mE,Yn);xe(Wb,lxt,Yn);xe(bA,s6,Yn);xe(Zd,GH,[Yn,tO]);xe(th,YH,[Yn,tO]);xe($a,f6,[Yn,Js]);xe(`${$a}-${Wg}`,f6,[Yn,Js]);xe(`${$a}-${lc}`,HH,[Yn,Js,lc]);xe(`${$a}-${Vb}`,d6,[Yn,Js]);xe(`${$a}-${Wb}`,mSt,[Yn,Js]);xe(`${$a}-${bA}`,XH,[Yn,Js]);xe(`${Wm}-${Wg}`,h6,[Yn,Js]);xe(`${Wm}-${lc}`,p6,[Yn,Js,lc]);xe(`${Wm}-${Vb}`,_E,[Yn,Js]);xe(`${Wm}-${Wb}`,ySt,[Yn,Js]);xe(`${Wm}-${bA}`,g6,[Yn,Js]);xe(Gg,a6,[Yb,Gg]);xe(vA,MH,Yb);xe(wA,u6,Yb);xe(ZN,Nnt,[Gb,Yb]);xe(QN,xb,Gb);xe(Dnt,eO,Gb);xe(hF,nCt,Gb);function Lnt(t){return Jx.has(t)}function Ih(t,e){const n=Jx.get(t);return n&&n.metadata[e]}function nO(t){return Ih(t,Yn)}function Yg(t){return Ih(t,Gb)}function pF(t){return Ih(t,Yb)}function Bnt(t){return Ih(t,lc)}function uCt(t){return Ih(t,tO)}function Pnt(t){return Ih(t,Js)}function znt(t){return Ih(t,Gg)}const cCt=["clamp","base","constant","exponent"];function Unt(t,e){const n=e[0],i=pe(e)-n;return function(r){return t(n+r*i)}}function _A(t,e,n){return _m(iO(e||"rgb",n),t)}function jnt(t,e){const n=new Array(e),i=e+1;for(let r=0;r<e;)n[r]=t(++r/i);return n}function qnt(t,e,n){const i=n-e;let r,s,o;return!i||!Number.isFinite(i)?Bi(.5):(r=(s=t.type).indexOf("-"),s=r<0?s:s.slice(r+1),o=xe(s)().domain([e,n]).range([0,1]),cCt.forEach(a=>t[a]?o[a](t[a]()):0),o)}function iO(t,e){const n=ubt[lCt(t)];return e!=null&&n&&n.gamma?n.gamma(e):n}function lCt(t){return"interpolate"+t.toLowerCase().split("-").map(e=>e[0].toUpperCase()+e.slice(1)).join("")}const fCt={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},dCt={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Vnt(t){const e=t.length/6|0,n=new Array(e);for(let i=0;i<e;)n[i]="#"+t.slice(i*6,++i*6);return n}function Wnt(t,e){for(const n in t)rO(n,e(t[n]))}const r9={};Wnt(dCt,Vnt);Wnt(fCt,t=>_A(Vnt(t)));function rO(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(r9[t]=e,this):r9[t]}const f2="symbol",hCt="discrete",pCt="gradient",gCt=t=>W(t)?t.map(e=>String(e)):String(t),mCt=(t,e)=>t[1]-e[1],yCt=(t,e)=>e[1]-t[1];function sO(t,e,n){let i;return be(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),n!=null&&(e=Math.min(e,Math.floor(zb(t.domain())/n||1)+1))),ut(e)&&(i=e.step,e=e.interval),at(e)&&(e=t.type===Zd?jm(e):t.type==th?qm(e):q("Only time and utc scales accept interval strings."),i&&(e=e.every(i))),e}function Gnt(t,e,n){let i=t.range(),r=i[0],s=pe(i),o=mCt;if(r>s&&(i=s,s=r,r=i,o=yCt),r=Math.floor(r),s=Math.ceil(s),e=e.map(a=>[a,t(a)]).filter(a=>r<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&e.length>1){const a=[e[0],pe(e)];for(;e.length>n&&e.length>=3;)e=e.filter((u,c)=>!(c%2));e.length<3&&(e=a)}return e}function oO(t,e){return t.bins?Gnt(t,t.bins):t.ticks?t.ticks(e):t.domain()}function Ynt(t,e,n,i,r,s){const o=e.type;let a=gCt;if(o===Zd||r===Zd)a=t.timeFormat(i);else if(o===th||r===th)a=t.utcFormat(i);else if(Bnt(o)){const u=t.formatFloat(i);if(s||e.bins)a=u;else{const c=Hnt(e,n,!1);a=l=>c(l)?u(l):""}}else if(e.tickFormat){const u=e.domain();a=t.formatSpan(u[0],u[u.length-1],n,i)}else i&&(a=t.format(i));return a}function Hnt(t,e,n){const i=oO(t,e),r=t.base(),s=Math.log(r),o=Math.max(1,r*e/i.length),a=u=>{let c=u/Math.pow(r,Math.round(Math.log(u)/s));return c*r<r-.5&&(c*=r),c<=o};return n?i.filter(a):a}const gF={[Gg]:"quantiles",[vA]:"thresholds",[wA]:"domain"},Xnt={[Gg]:"quantiles",[vA]:"domain"};function Knt(t,e){return t.bins?wCt(t.bins):t.type===lc?Hnt(t,e,!0):gF[t.type]?vCt(t[gF[t.type]]()):oO(t,e)}function bCt(t,e,n){const i=e[Xnt[e.type]](),r=i.length;let s=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o)s=Math.min(s,i[o]-i[o-1]);return t.formatSpan(0,s,3*10,n)}function vCt(t){const e=[-1/0].concat(t);return e.max=1/0,e}function wCt(t){const e=t.slice(0,-1);return e.max=pe(t),e}const _Ct=t=>gF[t.type]||t.bins;function Jnt(t,e,n,i,r,s,o){const a=Xnt[e.type]&&s!==Zd&&s!==th?bCt(t,e,r):Ynt(t,e,n,r,s,o);return i===f2&&_Ct(e)?xCt(a):i===hCt?SCt(a):ECt(a)}const xCt=t=>(e,n,i)=>{const r=s9(i[n+1],s9(i.max,1/0)),s=o9(e,t),o=o9(r,t);return s&&o?s+" – "+o:o?"< "+o:"≥ "+s},s9=(t,e)=>t??e,SCt=t=>(e,n)=>n?t(e):null,ECt=t=>e=>t(e),o9=(t,e)=>Number.isFinite(t)?e(t):null;function ACt(t){const e=t.domain(),n=e.length-1;let i=+e[0],r=+pe(e),s=r-i;if(t.type===wA){const o=n?s/n:.1;i-=o,r+=o,s=r-i}return o=>(o-i)/s}function $Ct(t,e,n,i){const r=i||e.type;return at(n)&&uCt(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===Zd?t.timeFormat("%A, %d %B %Y, %X"):!n&&r===th?t.utcFormat("%A, %d %B %Y, %X UTC"):Jnt(t,e,5,null,n,i,!0)}function Qnt(t,e,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=$Ct(t,e,n.format,n.formatType);if(pF(e.type)){const s=Knt(e).slice(1).map(r),o=s.length;return`${o} boundar${o===1?"y":"ies"}: ${s.join(", ")}`}else if(Yg(e.type)){const s=e.domain(),o=s.length,a=o>i?s.slice(0,i-2).map(r).join(", ")+", ending with "+s.slice(-1).map(r):s.map(r).join(", ");return`${o} value${o===1?"":"s"}: ${a}`}else{const s=e.domain();return`values from ${r(s[0])} to ${r(pe(s))}`}}let Znt=0;function ICt(){Znt=0}const Qx="p_";function aO(t){return t&&t.gradient}function tit(t,e,n){const i=t.gradient;let r=t.id,s=i==="radial"?Qx:"";return r||(r=t.id="gradient_"+Znt++,i==="radial"?(t.x1=Xo(t.x1,.5),t.y1=Xo(t.y1,.5),t.r1=Xo(t.r1,0),t.x2=Xo(t.x2,.5),t.y2=Xo(t.y2,.5),t.r2=Xo(t.r2,.5),s=Qx):(t.x1=Xo(t.x1,0),t.y1=Xo(t.y1,0),t.x2=Xo(t.x2,1),t.y2=Xo(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+s+r+")"}function Xo(t,e){return t??e}function eit(t,e){var n=[],i;return i={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:n,stop:function(r,s){return n.push({offset:r,color:s}),i}}}const a9={basis:{curve:xK},"basis-closed":{curve:EK},"basis-open":{curve:$K},bundle:{curve:MK,tension:"beta",value:.85},cardinal:{curve:TK,tension:"tension",value:0},"cardinal-open":{curve:kK,tension:"tension",value:0},"cardinal-closed":{curve:FK,tension:"tension",value:0},"catmull-rom":{curve:CK,tension:"alpha",value:.5},"catmull-rom-closed":{curve:OK,tension:"alpha",value:.5},"catmull-rom-open":{curve:LK,tension:"alpha",value:.5},linear:{curve:Mm},"linear-closed":{curve:PK},monotone:{horizontal:qK,vertical:jK},natural:{curve:WK},step:{curve:GK},"step-after":{curve:HK},"step-before":{curve:YK}};function uO(t,e,n){var i=xt(a9,t)&&a9[t],r=null;return i&&(r=i.curve||i[e||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}const MCt={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},TCt=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,FCt=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,kCt=/^((\s+,?\s*)|(,\s*))/,DCt=/^[01]/;function Hg(t){const e=[];return(t.match(TCt)||[]).forEach(i=>{let r=i[0];const s=r.toLowerCase(),o=MCt[s],a=CCt(s,o,i.slice(1).trim()),u=a.length;if(u<o||u&&u%o!==0)throw Error("Invalid SVG path, incorrect parameter count");if(e.push([r,...a.slice(0,o)]),u!==o){s==="m"&&(r=r==="M"?"L":"l");for(let c=o;c<u;c+=o)e.push([r,...a.slice(c,c+o)])}}),e}function CCt(t,e,n){const i=[];for(let r=0;e&&r<n.length;)for(let s=0;s<e;++s){const o=t==="a"&&(s===3||s===4)?DCt:FCt,a=n.slice(r).match(o);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");r+=a[0].length,i.push(+a[0]);const u=n.slice(r).match(kCt);u!==null&&(r+=u[0].length)}return i}const Vl=Math.PI/180,NCt=1e-14,ad=Math.PI/2,wa=Math.PI*2,ep=Math.sqrt(3)/2;var d3={},h3={},nit=[].join;function OCt(t,e,n,i,r,s,o,a,u){const c=nit.call(arguments);if(d3[c])return d3[c];const l=o*Vl,f=Math.sin(l),d=Math.cos(l);n=Math.abs(n),i=Math.abs(i);const h=d*(a-t)*.5+f*(u-e)*.5,p=d*(u-e)*.5-f*(a-t)*.5;let g=h*h/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);const m=d/n,y=f/n,b=-f/i,v=d/i,w=m*a+y*u,_=b*a+v*u,S=m*t+y*e,x=b*t+v*e;let A=1/((S-w)*(S-w)+(x-_)*(x-_))-.25;A<0&&(A=0);let $=Math.sqrt(A);s==r&&($=-$);const I=.5*(w+S)-$*(x-_),k=.5*(_+x)+$*(S-w),T=Math.atan2(_-k,w-I);let F=Math.atan2(x-k,S-I)-T;F<0&&s===1?F+=wa:F>0&&s===0&&(F-=wa);const D=Math.ceil(Math.abs(F/(ad+.001))),N=[];for(let R=0;R<D;++R){const L=T+R*F/D,B=T+(R+1)*F/D;N[R]=[I,k,L,B,n,i,f,d]}return d3[c]=N}function RCt(t){const e=nit.call(t);if(h3[e])return h3[e];var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7];const l=c*o,f=-u*a,d=u*o,h=c*a,p=Math.cos(r),g=Math.sin(r),m=Math.cos(s),y=Math.sin(s),b=.5*(s-r),v=Math.sin(b*.5),w=8/3*v*v/Math.sin(b),_=n+p-w*g,S=i+g+w*p,x=n+m,E=i+y,A=x+w*y,$=E-w*m;return h3[e]=[l*_+f*S,d*_+h*S,l*A+f*$,d*A+h*$,l*x+f*E,d*x+h*E]}const ys=["l",0,0,0,0,0,0,0];function LCt(t,e,n){const i=ys[0]=t[0];if(i==="a"||i==="A")ys[1]=e*t[1],ys[2]=n*t[2],ys[3]=t[3],ys[4]=t[4],ys[5]=t[5],ys[6]=e*t[6],ys[7]=n*t[7];else if(i==="h"||i==="H")ys[1]=e*t[1];else if(i==="v"||i==="V")ys[1]=n*t[1];else for(var r=1,s=t.length;r<s;++r)ys[r]=(r%2==1?e:n)*t[r];return ys}function R1(t,e,n,i,r,s){var o,a=null,u=0,c=0,l=0,f=0,d,h,p,g,m=0,y=0;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),s==null&&(s=r),t.beginPath&&t.beginPath();for(var b=0,v=e.length;b<v;++b){switch(o=e[b],(r!==1||s!==1)&&(o=LCt(o,r,s)),o[0]){case"l":u+=o[1],c+=o[2],t.lineTo(u+n,c+i);break;case"L":u=o[1],c=o[2],t.lineTo(u+n,c+i);break;case"h":u+=o[1],t.lineTo(u+n,c+i);break;case"H":u=o[1],t.lineTo(u+n,c+i);break;case"v":c+=o[1],t.lineTo(u+n,c+i);break;case"V":c=o[1],t.lineTo(u+n,c+i);break;case"m":u+=o[1],c+=o[2],m=u,y=c,t.moveTo(u+n,c+i);break;case"M":u=o[1],c=o[2],m=u,y=c,t.moveTo(u+n,c+i);break;case"c":d=u+o[5],h=c+o[6],l=u+o[3],f=c+o[4],t.bezierCurveTo(u+o[1]+n,c+o[2]+i,l+n,f+i,d+n,h+i),u=d,c=h;break;case"C":u=o[5],c=o[6],l=o[3],f=o[4],t.bezierCurveTo(o[1]+n,o[2]+i,l+n,f+i,u+n,c+i);break;case"s":d=u+o[3],h=c+o[4],l=2*u-l,f=2*c-f,t.bezierCurveTo(l+n,f+i,u+o[1]+n,c+o[2]+i,d+n,h+i),l=u+o[1],f=c+o[2],u=d,c=h;break;case"S":d=o[3],h=o[4],l=2*u-l,f=2*c-f,t.bezierCurveTo(l+n,f+i,o[1]+n,o[2]+i,d+n,h+i),u=d,c=h,l=o[1],f=o[2];break;case"q":d=u+o[3],h=c+o[4],l=u+o[1],f=c+o[2],t.quadraticCurveTo(l+n,f+i,d+n,h+i),u=d,c=h;break;case"Q":d=o[3],h=o[4],t.quadraticCurveTo(o[1]+n,o[2]+i,d+n,h+i),u=d,c=h,l=o[1],f=o[2];break;case"t":d=u+o[1],h=c+o[2],a[0].match(/[QqTt]/)===null?(l=u,f=c):a[0]==="t"?(l=2*u-p,f=2*c-g):a[0]==="q"&&(l=2*u-l,f=2*c-f),p=l,g=f,t.quadraticCurveTo(l+n,f+i,d+n,h+i),u=d,c=h,l=u+o[1],f=c+o[2];break;case"T":d=o[1],h=o[2],l=2*u-l,f=2*c-f,t.quadraticCurveTo(l+n,f+i,d+n,h+i),u=d,c=h;break;case"a":u9(t,u+n,c+i,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+c+i]),u+=o[6],c+=o[7];break;case"A":u9(t,u+n,c+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),u=o[6],c=o[7];break;case"z":case"Z":u=m,c=y,t.closePath();break}a=o}}function u9(t,e,n,i){const r=OCt(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n);for(let s=0;s<r.length;++s){const o=RCt(r[s]);t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const c9=.5773502691896257,l9={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,wa)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i),t.lineTo(-n,i),t.lineTo(-i,i),t.lineTo(-i,n),t.lineTo(i,n),t.lineTo(i,i),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(i,-i),t.lineTo(i,-n),t.lineTo(-i,-n),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/7,r=n/2.5,s=n/8;t.moveTo(-i,n),t.lineTo(i,n),t.lineTo(i,-s),t.lineTo(r,-s),t.lineTo(0,-n),t.lineTo(-r,-s),t.lineTo(-i,-s),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,i=ep*n,r=i-n*c9,s=n/4;t.moveTo(0,-i-r),t.lineTo(-s,i-r),t.lineTo(s,i-r),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,i=ep*n,r=i-n*c9;t.moveTo(0,-i-r),t.lineTo(-n,i-r),t.lineTo(n,i-r),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=ep*n;t.moveTo(0,-i),t.lineTo(-n,i),t.lineTo(n,i),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=ep*n;t.moveTo(0,i),t.lineTo(-n,-i),t.lineTo(n,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=ep*n;t.moveTo(i,0),t.lineTo(-i,-n),t.lineTo(-i,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=ep*n;t.moveTo(-i,0),t.lineTo(i,-n),t.lineTo(i,n),t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function iit(t){return xt(l9,t)?l9[t]:BCt(t)}var p3={};function BCt(t){if(!xt(p3,t)){const e=Hg(t);p3[t]={draw:function(n,i){R1(n,e,0,0,Math.sqrt(i)/2)}}}return p3[t]}const Rc=.448084975506;function PCt(t){return t.x}function zCt(t){return t.y}function UCt(t){return t.width}function jCt(t){return t.height}function mu(t){return typeof t=="function"?t:()=>+t}function cw(t,e,n){return Math.max(e,Math.min(t,n))}function rit(){var t=PCt,e=zCt,n=UCt,i=jCt,r=mu(0),s=r,o=r,a=r,u=null;function c(l,f,d){var h,p=f??+t.call(this,l),g=d??+e.call(this,l),m=+n.call(this,l),y=+i.call(this,l),b=Math.min(m,y)/2,v=cw(+r.call(this,l),0,b),w=cw(+s.call(this,l),0,b),_=cw(+o.call(this,l),0,b),S=cw(+a.call(this,l),0,b);if(u||(u=h=cE()),v<=0&&w<=0&&_<=0&&S<=0)u.rect(p,g,m,y);else{var x=p+m,E=g+y;u.moveTo(p+v,g),u.lineTo(x-w,g),u.bezierCurveTo(x-Rc*w,g,x,g+Rc*w,x,g+w),u.lineTo(x,E-S),u.bezierCurveTo(x,E-Rc*S,x-Rc*S,E,x-S,E),u.lineTo(p+_,E),u.bezierCurveTo(p+Rc*_,E,p,E-Rc*_,p,E-_),u.lineTo(p,g+v),u.bezierCurveTo(p,g+Rc*v,p+Rc*v,g,p+v,g),u.closePath()}if(h)return u=null,h+""||null}return c.x=function(l){return arguments.length?(t=mu(l),c):t},c.y=function(l){return arguments.length?(e=mu(l),c):e},c.width=function(l){return arguments.length?(n=mu(l),c):n},c.height=function(l){return arguments.length?(i=mu(l),c):i},c.cornerRadius=function(l,f,d,h){return arguments.length?(r=mu(l),s=f!=null?mu(f):r,a=d!=null?mu(d):r,o=h!=null?mu(h):s,c):r},c.context=function(l){return arguments.length?(u=l??null,c):u},c}function sit(){var t,e,n,i,r=null,s,o,a,u;function c(f,d,h){const p=h/2;if(s){var g=a-d,m=f-o;if(g||m){var y=Math.hypot(g,m),b=(g/=y)*u,v=(m/=y)*u,w=Math.atan2(m,g);r.moveTo(o-b,a-v),r.lineTo(f-g*p,d-m*p),r.arc(f,d,p,w-Math.PI,w),r.lineTo(o+b,a+v),r.arc(o,a,u,w,w+Math.PI)}else r.arc(f,d,p,0,wa);r.closePath()}else s=1;o=f,a=d,u=p}function l(f){var d,h=f.length,p,g=!1,m;for(r==null&&(r=m=cE()),d=0;d<=h;++d)!(d<h&&i(p=f[d],d,f))===g&&(g=!g)&&(s=0),g&&c(+t(p,d,f),+e(p,d,f),+n(p,d,f));if(m)return r=null,m+""||null}return l.x=function(f){return arguments.length?(t=f,l):t},l.y=function(f){return arguments.length?(e=f,l):e},l.size=function(f){return arguments.length?(n=f,l):n},l.defined=function(f){return arguments.length?(i=f,l):i},l.context=function(f){return arguments.length?(f==null?r=null:r=f,l):r},l}function Hb(t,e){return t??e}const Xb=t=>t.x||0,Kb=t=>t.y||0,qCt=t=>t.width||0,VCt=t=>t.height||0,WCt=t=>(t.x||0)+(t.width||0),GCt=t=>(t.y||0)+(t.height||0),YCt=t=>t.startAngle||0,HCt=t=>t.endAngle||0,XCt=t=>t.padAngle||0,KCt=t=>t.innerRadius||0,JCt=t=>t.outerRadius||0,QCt=t=>t.cornerRadius||0,ZCt=t=>Hb(t.cornerRadiusTopLeft,t.cornerRadius)||0,tNt=t=>Hb(t.cornerRadiusTopRight,t.cornerRadius)||0,eNt=t=>Hb(t.cornerRadiusBottomRight,t.cornerRadius)||0,nNt=t=>Hb(t.cornerRadiusBottomLeft,t.cornerRadius)||0,iNt=t=>Hb(t.size,64),rNt=t=>t.size||1,xA=t=>t.defined!==!1,sNt=t=>iit(t.shape||"circle"),oNt=PSt().startAngle(YCt).endAngle(HCt).padAngle(XCt).innerRadius(KCt).outerRadius(JCt).cornerRadius(QCt),aNt=Ab().x(Xb).y1(Kb).y0(GCt).defined(xA),uNt=Ab().y(Kb).x1(Xb).x0(WCt).defined(xA),cNt=m6().x(Xb).y(Kb).defined(xA),lNt=rit().x(Xb).y(Kb).width(qCt).height(VCt).cornerRadius(ZCt,tNt,eNt,nNt),fNt=JSt().type(sNt).size(iNt),dNt=sit().x(Xb).y(Kb).defined(xA).size(rNt);function cO(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function hNt(t,e){return oNt.context(t)(e)}function pNt(t,e){const n=e[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?uNt:aNt).curve(uO(i,n.orient,n.tension)).context(t)(e)}function gNt(t,e){const n=e[0],i=n.interpolate||"linear";return cNt.curve(uO(i,n.orient,n.tension)).context(t)(e)}function Gm(t,e,n,i){return lNt.context(t)(e,n,i)}function mNt(t,e){return(e.mark.shape||e.shape).context(t)(e)}function yNt(t,e){return fNt.context(t)(e)}function bNt(t,e){return dNt.context(t)(e)}var oit=1;function ait(){oit=1}function lO(t,e,n){var i=e.clip,r=t._defs,s=e.clip_id||(e.clip_id="clip"+oit++),o=r.clipping[s]||(r.clipping[s]={id:s});return Qt(i)?o.path=i(null):cO(n)?o.path=Gm(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function On(t){this.clear(),t&&this.union(t)}On.prototype={clone(){return new On(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){const i=this.rotatedPoints(t,e,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(t,e,n){var{x1:i,y1:r,x2:s,y2:o}=this,a=Math.cos(t),u=Math.sin(t),c=e-e*a+n*u,l=n-e*u-n*a;return[a*i-u*r+c,u*i+a*r+l,a*i-u*o+c,u*i+a*o+l,a*s-u*r+c,u*s+a*r+l,a*s-u*o+c,u*s+a*o+l]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function SA(t){this.mark=t,this.bounds=this.bounds||new On}function EA(t){SA.call(this,t),this.items=this.items||[]}J(EA,SA);function fO(t){this._pending=0,this._loader=t||oA()}function f9(t){t._pending+=1}function E0(t){t._pending-=1}fO.prototype={pending(){return this._pending},sanitizeURL(t){const e=this;return f9(e),e._loader.sanitize(t,{context:"href"}).then(n=>(E0(e),n)).catch(()=>(E0(e),null))},loadImage(t){const e=this,n=Q6t();return f9(e),e._loader.sanitize(t,{context:"image"}).then(i=>{const r=i.href;if(!r||!n)throw{url:r};const s=new n,o=xt(i,"crossOrigin")?i.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>E0(e),s.onerror=()=>E0(e),s.src=r,s}).catch(i=>(E0(e),{complete:!1,width:0,height:0,src:i&&i.url||""}))},ready(){const t=this;return new Promise(e=>{function n(i){t.pending()?setTimeout(()=>{n(!0)},10):e(i)}n(!1)})}};function Ec(t,e,n){if(e.stroke&&e.opacity!==0&&e.strokeOpacity!==0){const i=e.strokeWidth!=null?+e.strokeWidth:1;t.expand(i+(n?vNt(e,i):0))}return t}function vNt(t,e){return t.strokeJoin&&t.strokeJoin!=="miter"?0:e}const wNt=wa-1e-8;let AA,d2,h2,Sd,mF,p2,yF,bF;const sl=(t,e)=>AA.add(t,e),g2=(t,e)=>sl(d2=t,h2=e),d9=t=>sl(t,AA.y1),h9=t=>sl(AA.x1,t),ud=(t,e)=>mF*t+yF*e,cd=(t,e)=>p2*t+bF*e,g3=(t,e)=>sl(ud(t,e),cd(t,e)),m3=(t,e)=>g2(ud(t,e),cd(t,e));function Jb(t,e){return AA=t,e?(Sd=e*Vl,mF=bF=Math.cos(Sd),p2=Math.sin(Sd),yF=-p2):(mF=bF=1,Sd=p2=yF=0),_Nt}const _Nt={beginPath(){},closePath(){},moveTo:m3,lineTo:m3,rect(t,e,n,i){Sd?(g3(t+n,e),g3(t+n,e+i),g3(t,e+i),m3(t,e)):(sl(t+n,e+i),g2(t,e))},quadraticCurveTo(t,e,n,i){const r=ud(t,e),s=cd(t,e),o=ud(n,i),a=cd(n,i);p9(d2,r,o,d9),p9(h2,s,a,h9),g2(o,a)},bezierCurveTo(t,e,n,i,r,s){const o=ud(t,e),a=cd(t,e),u=ud(n,i),c=cd(n,i),l=ud(r,s),f=cd(r,s);g9(d2,o,u,l,d9),g9(h2,a,c,f,h9),g2(l,f)},arc(t,e,n,i,r,s){if(i+=Sd,r+=Sd,d2=n*Math.cos(r)+t,h2=n*Math.sin(r)+e,Math.abs(r-i)>wNt)sl(t-n,e-n),sl(t+n,e+n);else{const o=c=>sl(n*Math.cos(c)+t,n*Math.sin(c)+e);let a,u;if(o(i),o(r),r!==i)if(i=i%wa,i<0&&(i+=wa),r=r%wa,r<0&&(r+=wa),r<i&&(s=!s,a=i,i=r,r=a),s)for(r-=wa,a=i-i%ad,u=0;u<4&&a>r;++u,a-=ad)o(a);else for(a=i-i%ad+ad,u=0;u<4&&a<r;++u,a=a+ad)o(a)}}};function p9(t,e,n,i){const r=(t-e)/(t+n-2*e);0<r&&r<1&&i(t+(e-t)*r)}function g9(t,e,n,i,r){const s=i-t+3*e-3*n,o=t+n-2*e,a=t-e;let u=0,c=0,l;Math.abs(s)>NCt?(l=o*o+a*s,l>=0&&(l=Math.sqrt(l),u=(-o+l)/s,c=(-o-l)/s)):u=.5*a/o,0<u&&u<1&&r(m9(u,t,e,n,i)),0<c&&c<1&&r(m9(c,t,e,n,i))}function m9(t,e,n,i,r){const s=1-t,o=s*s,a=t*t;return o*s*e+3*o*t*n+3*s*a*i+a*t*r}var bl=(bl=yl(1,1))?bl.getContext("2d"):null;const vF=new On;function dO(t){return function(e,n){if(!bl)return!0;t(bl,e),vF.clear().union(e.bounds).intersect(n).round();const{x1:i,y1:r,x2:s,y2:o}=vF;for(let a=r;a<=o;++a)for(let u=i;u<=s;++u)if(bl.isPointInPath(u,a))return!0;return!1}}function hO(t,e){return e.contains(t.x||0,t.y||0)}function uit(t,e){const n=t.x||0,i=t.y||0,r=t.width||0,s=t.height||0;return e.intersects(vF.set(n,i,n+r,i+s))}function cit(t,e){const n=t.x||0,i=t.y||0,r=t.x2!=null?t.x2:n,s=t.y2!=null?t.y2:i;return jp(e,n,i,r,s)}function jp(t,e,n,i,r){const{x1:s,y1:o,x2:a,y2:u}=t,c=i-e,l=r-n;let f=0,d=1,h,p,g,m;for(m=0;m<4;++m){if(m===0&&(h=-c,p=-(s-e)),m===1&&(h=c,p=a-e),m===2&&(h=-l,p=-(o-n)),m===3&&(h=l,p=u-n),Math.abs(h)<1e-10&&p<0)return!1;if(g=p/h,h<0){if(g>d)return!1;g>f&&(f=g)}else if(h>0){if(g<f)return!1;g<d&&(d=g)}}return!0}function Xg(t,e){t.globalCompositeOperation=e.blend||"source-over"}function no(t,e){return t??e}function y9(t,e){const n=e.length;for(let i=0;i<n;++i)t.addColorStop(e[i].offset,e[i].color);return t}function xNt(t,e,n){const i=n.width(),r=n.height();let s;if(e.gradient==="radial")s=t.createRadialGradient(n.x1+no(e.x1,.5)*i,n.y1+no(e.y1,.5)*r,Math.max(i,r)*no(e.r1,0),n.x1+no(e.x2,.5)*i,n.y1+no(e.y2,.5)*r,Math.max(i,r)*no(e.r2,.5));else{const o=no(e.x1,0),a=no(e.y1,0),u=no(e.x2,1),c=no(e.y2,0);if(o===u||a===c||i===r)s=t.createLinearGradient(n.x1+o*i,n.y1+a*r,n.x1+u*i,n.y1+c*r);else{const l=yl(Math.ceil(i),Math.ceil(r)),f=l.getContext("2d");return f.scale(i,r),f.fillStyle=y9(f.createLinearGradient(o,a,u,c),e.stops),f.fillRect(0,0,i,r),t.createPattern(l,"no-repeat")}}return y9(s,e.stops)}function lit(t,e,n){return aO(n)?xNt(t,n,e.bounds):n}function Zx(t,e,n){return n*=e.fillOpacity==null?1:e.fillOpacity,n>0?(t.globalAlpha=n,t.fillStyle=lit(t,e,e.fill),!0):!1}var SNt=[];function Kg(t,e,n){var i=(i=e.strokeWidth)!=null?i:1;return i<=0?!1:(n*=e.strokeOpacity==null?1:e.strokeOpacity,n>0?(t.globalAlpha=n,t.strokeStyle=lit(t,e,e.stroke),t.lineWidth=i,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||SNt),t.lineDashOffset=e.strokeDashOffset||0),!0):!1)}function ENt(t,e){return t.zindex-e.zindex||t.index-e.index}function pO(t){if(!t.zdirty)return t.zitems;var e=t.items,n=[],i,r,s;for(r=0,s=e.length;r<s;++r)i=e[r],i.index=r,i.zindex&&n.push(i);return t.zdirty=!1,t.zitems=n.sort(ENt)}function Fo(t,e){var n=t.items,i,r;if(!n||!n.length)return;const s=pO(t);if(s&&s.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||e(n[i]);n=s}for(i=0,r=n.length;i<r;++i)e(n[i])}function tS(t,e){var n=t.items,i,r;if(!n||!n.length)return null;const s=pO(t);for(s&&s.length&&(n=s),r=n.length;--r>=0;)if(i=e(n[r]))return i;if(n===s){for(n=t.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=e(n[r])))return i}return null}function gO(t){return function(e,n,i){Fo(n,r=>{(!i||i.intersects(r.bounds))&&fit(t,e,r,r)})}}function ANt(t){return function(e,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&fit(t,e,n.items[0],n.items)}}function fit(t,e,n,i){var r=n.opacity==null?1:n.opacity;r!==0&&(t(e,i)||(Xg(e,n),n.fill&&Zx(e,n,r)&&e.fill(),n.stroke&&Kg(e,n,r)&&e.stroke()))}function $A(t){return t=t||Ws,function(e,n,i,r,s,o){return i*=e.pixelRatio,r*=e.pixelRatio,tS(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&t(e,a,i,r,s,o))return a})}}function Qb(t,e){return function(n,i,r,s){var o=Array.isArray(i)?i[0]:i,a=e??o.fill,u=o.stroke&&n.isPointInStroke,c,l;return u&&(c=o.strokeWidth,l=o.strokeCap,n.lineWidth=c??1,n.lineCap=l??"butt"),t(n,i)?!1:a&&n.isPointInPath(r,s)||u&&n.isPointInStroke(r,s)}}function mO(t){return $A(Qb(t))}function Dd(t,e){return"translate("+t+","+e+")"}function yO(t){return"rotate("+t+")"}function $Nt(t,e){return"scale("+t+","+e+")"}function dit(t){return Dd(t.x||0,t.y||0)}function INt(t){return Dd(t.x||0,t.y||0)+(t.angle?" "+yO(t.angle):"")}function MNt(t){return Dd(t.x||0,t.y||0)+(t.angle?" "+yO(t.angle):"")+(t.scaleX||t.scaleY?" "+$Nt(t.scaleX||1,t.scaleY||1):"")}function bO(t,e,n){function i(o,a){o("transform",INt(a)),o("d",e(null,a))}function r(o,a){return e(Jb(o,a.angle),a),Ec(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,c=a.y||0,l=a.angle||0;o.translate(u,c),l&&o.rotate(l*=Vl),o.beginPath(),e(o,a),l&&o.rotate(-l),o.translate(-u,-c)}return{type:t,tag:"path",nested:!1,attr:i,bound:r,draw:gO(s),pick:mO(s),isect:n||dO(s)}}var TNt=bO("arc",hNt);function FNt(t,e){for(var n=t[0].orient==="horizontal"?e[1]:e[0],i=t[0].orient==="horizontal"?"y":"x",r=t.length,s=1/0,o,a;--r>=0;)t[r].defined!==!1&&(a=Math.abs(t[r][i]-n),a<s&&(s=a,o=t[r]));return o}function kNt(t,e){for(var n=Math.pow(t[0].strokeWidth||1,2),i=t.length,r,s,o;--i>=0;)if(t[i].defined!==!1&&(r=t[i].x-e[0],s=t[i].y-e[1],o=r*r+s*s,o<n))return t[i];return null}function DNt(t,e){for(var n=t.length,i,r,s;--n>=0;)if(t[n].defined!==!1&&(i=t[n].x-e[0],r=t[n].y-e[1],s=i*i+r*r,i=t[n].size||1,s<i*i))return t[n];return null}function vO(t,e,n){function i(u,c){var l=c.mark.items;l.length&&u("d",e(null,l))}function r(u,c){var l=c.items;return l.length===0?u:(e(Jb(u),l),Ec(u,l[0]))}function s(u,c){u.beginPath(),e(u,c)}const o=Qb(s);function a(u,c,l,f,d,h){var p=c.items,g=c.bounds;return!p||!p.length||g&&!g.contains(d,h)?null:(l*=u.pixelRatio,f*=u.pixelRatio,o(u,p,l,f)?p[0]:null)}return{type:t,tag:"path",nested:!0,attr:i,bound:r,draw:ANt(s),pick:a,isect:hO,tip:n}}var CNt=vO("area",pNt,FNt);function NNt(t,e){var n=e.clip;t.save(),Qt(n)?(t.beginPath(),n(t),t.clip()):hit(t,e.group)}function hit(t,e){t.beginPath(),cO(e)?Gm(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function pit(t){const e=no(t.strokeWidth,1);return t.strokeOffset!=null?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function ONt(t,e){t("transform",dit(e))}function git(t,e){const n=pit(e);t("d",Gm(null,e,n,n))}function RNt(t,e){t("class","background"),t("aria-hidden",!0),git(t,e)}function LNt(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?git(t,e):t("d","")}function BNt(t,e,n){const i=e.clip?lO(n,e,e):null;t("clip-path",i)}function PNt(t,e){if(!e.clip&&e.items){const n=e.items,i=n.length;for(let r=0;r<i;++r)t.union(n[r].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Ec(t,e),t.translate(e.x||0,e.y||0)}function L1(t,e,n,i){const r=pit(e);t.beginPath(),Gm(t,e,(n||0)+r,(i||0)+r)}const zNt=Qb(L1),UNt=Qb(L1,!1),jNt=Qb(L1,!0);function qNt(t,e,n,i){Fo(e,r=>{const s=r.x||0,o=r.y||0,a=r.strokeForeground,u=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&u&&(L1(t,r,s,o),Xg(t,r),r.fill&&Zx(t,r,u)&&t.fill(),r.stroke&&!a&&Kg(t,r,u)&&t.stroke()),t.save(),t.translate(s,o),r.clip&&hit(t,r),n&&n.translate(-s,-o),Fo(r,c=>{(c.marktype==="group"||i==null||i.includes(c.marktype))&&this.draw(t,c,n,i)}),n&&n.translate(s,o),t.restore(),a&&r.stroke&&u&&(L1(t,r,s,o),Xg(t,r),Kg(t,r,u)&&t.stroke())})}function VNt(t,e,n,i,r,s){if(e.bounds&&!e.bounds.contains(r,s)||!e.items)return null;const o=n*t.pixelRatio,a=i*t.pixelRatio;return tS(e,u=>{let c,l,f;const d=u.bounds;if(d&&!d.contains(r,s))return;l=u.x||0,f=u.y||0;const h=l+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(r<l||r>h||s<f||s>p))return;if(t.save(),t.translate(l,f),l=r-l,f=s-f,g&&cO(u)&&!jNt(t,u,o,a))return t.restore(),null;const m=u.strokeForeground,y=e.interactive!==!1;return y&&m&&u.stroke&&UNt(t,u,o,a)?(t.restore(),u):(c=tS(u,b=>WNt(b,l,f)?this.pick(b,n,i,l,f):null),!c&&y&&(u.fill||!m&&u.stroke)&&zNt(t,u,o,a)&&(c=u),t.restore(),c||null)})}function WNt(t,e,n){return(t.interactive!==!1||t.marktype==="group")&&t.bounds&&t.bounds.contains(e,n)}var GNt={type:"group",tag:"g",nested:!1,attr:ONt,bound:PNt,draw:qNt,pick:VNt,isect:uit,content:BNt,background:RNt,foreground:LNt},B1={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function wO(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then(i=>{t.image=i,t.image.url=t.url})),n}function _O(t,e){return t.width!=null?t.width:!e||!e.width?0:t.aspect!==!1&&t.height?t.height*e.width/e.height:e.width}function xO(t,e){return t.height!=null?t.height:!e||!e.height?0:t.aspect!==!1&&t.width?t.width*e.height/e.width:e.height}function IA(t,e){return t==="center"?e/2:t==="right"?e:0}function MA(t,e){return t==="middle"?e/2:t==="bottom"?e:0}function YNt(t,e,n){const i=wO(e,n),r=_O(e,i),s=xO(e,i),o=(e.x||0)-IA(e.align,r),a=(e.y||0)-MA(e.baseline,s),u=!i.src&&i.toDataURL?i.toDataURL():i.src||"";t("href",u,B1["xmlns:xlink"],"xlink:href"),t("transform",Dd(o,a)),t("width",r),t("height",s),t("preserveAspectRatio",e.aspect===!1?"none":"xMidYMid")}function HNt(t,e){const n=e.image,i=_O(e,n),r=xO(e,n),s=(e.x||0)-IA(e.align,i),o=(e.y||0)-MA(e.baseline,r);return t.set(s,o,s+i,o+r)}function XNt(t,e,n){Fo(e,i=>{if(n&&!n.intersects(i.bounds))return;const r=wO(i,this);let s=_O(i,r),o=xO(i,r);if(s===0||o===0)return;let a=(i.x||0)-IA(i.align,s),u=(i.y||0)-MA(i.baseline,o),c,l,f,d;i.aspect!==!1&&(l=r.width/r.height,f=i.width/i.height,l===l&&f===f&&l!==f&&(f<l?(d=s/l,u+=(o-d)/2,o=d):(d=o*l,a+=(s-d)/2,s=d))),(r.complete||r.toDataURL)&&(Xg(t,i),t.globalAlpha=(c=i.opacity)!=null?c:1,t.imageSmoothingEnabled=i.smooth!==!1,t.drawImage(r,a,u,s,o))})}var KNt={type:"image",tag:"image",nested:!1,attr:YNt,bound:HNt,draw:XNt,pick:$A(),isect:Ws,get:wO,xOffset:IA,yOffset:MA},JNt=vO("line",gNt,kNt);function QNt(t,e){var n=e.scaleX||1,i=e.scaleY||1;(n!==1||i!==1)&&t("vector-effect","non-scaling-stroke"),t("transform",MNt(e)),t("d",e.path)}function m2(t,e){var n=e.path;if(n==null)return!0;var i=e.x||0,r=e.y||0,s=e.scaleX||1,o=e.scaleY||1,a=(e.angle||0)*Vl,u=e.pathCache;(!u||u.path!==n)&&((e.pathCache=u=Hg(n)).path=n),a&&t.rotate&&t.translate?(t.translate(i,r),t.rotate(a),R1(t,u,0,0,s,o),t.rotate(-a),t.translate(-i,-r)):R1(t,u,i,r,s,o)}function ZNt(t,e){return m2(Jb(t,e.angle),e)?t.set(0,0,0,0):Ec(t,e,!0)}var tOt={type:"path",tag:"path",nested:!1,attr:QNt,bound:ZNt,draw:gO(m2),pick:mO(m2),isect:dO(m2)};function eOt(t,e){t("d",Gm(null,e))}function nOt(t,e){var n,i;return Ec(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)}function b9(t,e){t.beginPath(),Gm(t,e)}var iOt={type:"rect",tag:"path",nested:!1,attr:eOt,bound:nOt,draw:gO(b9),pick:mO(b9),isect:uit};function rOt(t,e){t("transform",dit(e)),t("x2",e.x2!=null?e.x2-(e.x||0):0),t("y2",e.y2!=null?e.y2-(e.y||0):0)}function sOt(t,e){var n,i;return Ec(t.set(n=e.x||0,i=e.y||0,e.x2!=null?e.x2:n,e.y2!=null?e.y2:i),e)}function mit(t,e,n){var i,r,s,o;return e.stroke&&Kg(t,e,n)?(i=e.x||0,r=e.y||0,s=e.x2!=null?e.x2:i,o=e.y2!=null?e.y2:r,t.beginPath(),t.moveTo(i,r),t.lineTo(s,o),!0):!1}function oOt(t,e,n){Fo(e,i=>{if(!(n&&!n.intersects(i.bounds))){var r=i.opacity==null?1:i.opacity;r&&mit(t,i,r)&&(Xg(t,i),t.stroke())}})}function aOt(t,e,n,i){return t.isPointInStroke?mit(t,e,1)&&t.isPointInStroke(n,i):!1}var uOt={type:"rule",tag:"line",nested:!1,attr:rOt,bound:sOt,draw:oOt,pick:$A(aOt),isect:cit},cOt=bO("shape",mNt),lOt=bO("symbol",yNt,hO);const v9=Ztt();var is={height:tu,measureWidth:SO,estimateWidth:eS,width:eS,canvas:yit};yit(!0);function yit(t){is.width=t&&bl?SO:eS}function eS(t,e){return bit(Gl(t,e),tu(t))}function bit(t,e){return~~(.8*t.length*e)}function SO(t,e){return tu(t)<=0||!(e=Gl(t,e))?0:vit(e,TA(t))}function vit(t,e){const n=`(${e}) ${t}`;let i=v9.get(n);return i===void 0&&(bl.font=e,i=bl.measureText(t).width,v9.set(n,i)),i}function tu(t){return t.fontSize!=null?+t.fontSize||0:11}function Wl(t){return t.lineHeight!=null?t.lineHeight:tu(t)+2}function fOt(t){return W(t)?t.length>1?t:t[0]:t}function Zb(t){return fOt(t.lineBreak&&t.text&&!W(t.text)?t.text.split(t.lineBreak):t.text)}function EO(t){const e=Zb(t);return(W(e)?e.length-1:0)*Wl(t)}function Gl(t,e){const n=e==null?"":(e+"").trim();return t.limit>0&&n.length?hOt(t,n):n}function dOt(t){if(is.width===SO){const e=TA(t);return n=>vit(n,e)}else if(is.width===eS){const e=tu(t);return n=>bit(n,e)}else return e=>is.width(t,e)}function hOt(t,e){var n=+t.limit,i=dOt(t);if(i(e)<n)return e;var r=t.ellipsis||"…",s=t.dir==="rtl",o=0,a=e.length,u;if(n-=i(r),s){for(;o<a;)u=o+a>>>1,i(e.slice(u))>n?o=u+1:a=u;return r+e.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),i(e.slice(0,u))<n?o=u:a=u-1;return e.slice(0,o)+r}}function tv(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function TA(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+tu(t)+"px "+tv(t,e)}function AO(t){var e=t.baseline,n=tu(t);return Math.round(e==="top"?.79*n:e==="middle"?.3*n:e==="bottom"?-.21*n:e==="line-top"?.29*n+.5*Wl(t):e==="line-bottom"?.29*n-.5*Wl(t):0)}const pOt={left:"start",center:"middle",right:"end"},By=new On;function FA(t){var e=t.x||0,n=t.y||0,i=t.radius||0,r;return i&&(r=(t.theta||0)-ad,e+=i*Math.cos(r),n+=i*Math.sin(r)),By.x1=e,By.y1=n,By}function gOt(t,e){var n=e.dx||0,i=(e.dy||0)+AO(e),r=FA(e),s=r.x1,o=r.y1,a=e.angle||0,u;t("text-anchor",pOt[e.align]||"start"),a?(u=Dd(s,o)+" "+yO(a),(n||i)&&(u+=" "+Dd(n,i))):u=Dd(s+n,o+i),t("transform",u)}function $O(t,e,n){var i=is.height(e),r=e.align,s=FA(e),o=s.x1,a=s.y1,u=e.dx||0,c=(e.dy||0)+AO(e)-Math.round(.8*i),l=Zb(e),f;if(W(l)?(i+=Wl(e)*(l.length-1),f=l.reduce((d,h)=>Math.max(d,is.width(e,h)),0)):f=is.width(e,l),r==="center"?u-=f/2:r==="right"&&(u-=f),t.set(u+=o,c+=a,u+f,c+i),e.angle&&!n)t.rotate(e.angle*Vl,o,a);else if(n===2)return t.rotatedPoints(e.angle*Vl,o,a);return t}function mOt(t,e,n){Fo(e,i=>{var r=i.opacity==null?1:i.opacity,s,o,a,u,c,l,f;if(!(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(t.font=TA(i),t.textAlign=i.align||"left",s=FA(i),o=s.x1,a=s.y1,i.angle&&(t.save(),t.translate(o,a),t.rotate(i.angle*Vl),o=a=0),o+=i.dx||0,a+=(i.dy||0)+AO(i),l=Zb(i),Xg(t,i),W(l))for(c=Wl(i),u=0;u<l.length;++u)f=Gl(i,l[u]),i.fill&&Zx(t,i,r)&&t.fillText(f,o,a),i.stroke&&Kg(t,i,r)&&t.strokeText(f,o,a),a+=c;else f=Gl(i,l),i.fill&&Zx(t,i,r)&&t.fillText(f,o,a),i.stroke&&Kg(t,i,r)&&t.strokeText(f,o,a);i.angle&&t.restore()}})}function yOt(t,e,n,i,r,s){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=FA(e),a=o.x1,u=o.y1,c=$O(By,e,1),l=-e.angle*Vl,f=Math.cos(l),d=Math.sin(l),h=f*r-d*s+(a-f*a+d*u),p=d*r+f*s+(u-d*a-f*u);return c.contains(h,p)}function bOt(t,e){const n=$O(By,t,2);return jp(e,n[0],n[1],n[2],n[3])||jp(e,n[0],n[1],n[4],n[5])||jp(e,n[4],n[5],n[6],n[7])||jp(e,n[2],n[3],n[6],n[7])}var vOt={type:"text",tag:"text",nested:!1,attr:gOt,bound:$O,draw:mOt,pick:$A(yOt),isect:bOt},wOt=vO("trail",bNt,DNt),ls={arc:TNt,area:CNt,group:GNt,image:KNt,line:JNt,path:tOt,rect:iOt,rule:uOt,shape:cOt,symbol:lOt,text:vOt,trail:wOt};function wF(t,e,n){var i=ls[t.mark.marktype],r=e||i.bound;return i.nested&&(t=t.mark),r(t.bounds||(t.bounds=new On),t,n)}var w9={mark:null};function wit(t,e,n){var i=ls[t.marktype],r=i.bound,s=t.items,o=s&&s.length,a,u,c,l;if(i.nested)return o?c=s[0]:(w9.mark=t,c=w9),l=wF(c,r,n),e=e&&e.union(l)||l,e;if(e=e||t.bounds&&t.bounds.clear()||new On,o)for(a=0,u=s.length;a<u;++a)e.union(wF(s[a],r,n));return t.bounds=e}const _Ot=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function _it(t,e){return JSON.stringify(t,_Ot,e)}function xit(t){const e=typeof t=="string"?JSON.parse(t):t;return Sit(e)}function Sit(t){var e=t.marktype,n=t.items,i,r,s;if(n)for(r=0,s=n.length;r<s;++r)i=e?"mark":"group",n[r][i]=t,n[r].zindex&&(n[r][i].zdirty=!0),(e||i)==="group"&&Sit(n[r]);return e&&wit(t),t}function IO(t){arguments.length?this.root=xit(t):(this.root=Eit({marktype:"group",name:"root",role:"frame"}),this.root.items=[new EA(this.root)])}IO.prototype={toJSON(t){return _it(this.root,t||0)},mark(t,e,n){e=e||this.root.items[0];const i=Eit(t,e);return e.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}};function Eit(t,e){const n={bounds:new On,clip:!!t.clip,group:e,interactive:t.interactive!==!1,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return t.aria!=null&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function ol(t,e,n){return!t&&typeof document<"u"&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function MO(t,e){e=e.toLowerCase();for(var n=t.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===e)return n[i]}function Pn(t,e,n,i){var r=t.childNodes[e],s;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(s=r||null,r=ol(t.ownerDocument,n,i),t.insertBefore(r,s)),r}function Es(t,e){for(var n=t.childNodes,i=n.length;i>e;)t.removeChild(n[--i]);return t}function Ait(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function kA(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function xOt(t,e,n,i){var r=t&&t.mark,s,o;if(r&&(s=ls[r.marktype]).tip){for(o=kA(e,n),o[0]-=i[0],o[1]-=i[1];t=t.mark.group;)o[0]-=t.x||0,o[1]-=t.y||0;t=s.tip(r.items,o)}return t}function Yl(t,e){this._active=null,this._handlers={},this._loader=t||oA(),this._tooltip=e||SOt}function SOt(t,e,n,i){t.element().setAttribute("title",i||"")}Yl.prototype={initialize(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},scene(t){return arguments.length?(this._scene=t,this):this._scene},on(){},off(){},_handlerIndex(t,e,n){for(let i=t?t.length:0;--i>=0;)if(t[i].type===e&&(!n||t[i].handler===n))return i;return-1},handlers(t){const e=this._handlers,n=[];if(t)n.push(...e[this.eventName(t)]);else for(const i in e)n.push(...e[i]);return n},eventName(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)},handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(t.type,t),s=ol(null,"a");for(const o in i)s.setAttribute(o,i[o]);s.dispatchEvent(r)}).catch(()=>{})},handleTooltip(t,e,n){if(e&&e.tooltip!=null){e=xOt(e,t,this.canvas(),this._origin);const i=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,i)}},getItemBoundingClientRect(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),i=this._origin,r=t.bounds,s=r.width(),o=r.height();let a=r.x1+i[0]+n.left,u=r.y1+i[1]+n.top;for(;t.mark&&(t=t.mark.group);)a+=t.x||0,u+=t.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function ps(t){this._el=null,this._bgcolor=null,this._loader=new fO(t)}ps.prototype={initialize(t,e,n,i,r){return this._el=t,this.resize(e,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(t){return arguments.length===0?this._bgcolor:(this._bgcolor=t,this)},resize(t,e,n,i){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(t,e){const n=this;return n._call=function(){n._render(t,e)},n._call(),n._call=null,n},_render(){},renderAsync(t,e){const n=this.render(t,e);return this._ready?this._ready.then(()=>n):Promise.resolve(n)},_load(t,e){var n=this,i=n._loader[t](e);if(!n._ready){const r=n._call;n._ready=n._loader.ready().then(s=>{s&&r(),n._ready=null})}return i},sanitizeURL(t){return this._load("sanitizeURL",t)},loadImage(t){return this._load("loadImage",t)}};const EOt="keydown",AOt="keypress",$Ot="keyup",$it="dragenter",y2="dragleave",Iit="dragover",_F="pointerdown",IOt="pointerup",nS="pointermove",Py="pointerout",Mit="pointerover",xF="mousedown",MOt="mouseup",Tit="mousemove",SF="mouseout",Fit="mouseover",iS="click",TOt="dblclick",FOt="wheel",kit="mousewheel",rS="touchstart",sS="touchmove",oS="touchend",kOt=[EOt,AOt,$Ot,$it,y2,Iit,_F,IOt,nS,Py,Mit,xF,MOt,Tit,SF,Fit,iS,TOt,FOt,kit,rS,sS,oS],EF=nS,P1=Py,AF=iS;function Hl(t,e){Yl.call(this,t,e),this._down=null,this._touch=null,this._first=!0,this._events={}}const DOt=t=>t===rS||t===sS||t===oS?[rS,sS,oS]:[t];function _9(t,e){DOt(e).forEach(n=>COt(t,n))}function COt(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?i=>t[e](i):i=>t.fire(e,i)))}function by(t,e,n){e.forEach(i=>t.fire(i,n))}function x9(t,e,n){return function(i){const r=this._active,s=this.pickEvent(i);s===r?by(this,t,i):((!r||!r.exit)&&by(this,n,i),this._active=s,by(this,e,i),by(this,t,i))}}function S9(t){return function(e){by(this,t,e),this._active=null}}J(Hl,Yl,{initialize(t,e,n){return this._canvas=t&&MO(t,"canvas"),[iS,xF,_F,nS,Py,y2].forEach(i=>_9(this,i)),Yl.prototype.initialize.call(this,t,e,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:kOt,DOMMouseScroll(t){this.fire(kit,t)},pointermove:x9([nS,Tit],[Mit,Fit],[Py,SF]),dragover:x9([Iit],[$it],[y2]),pointerout:S9([Py,SF]),dragleave:S9([y2]),pointerdown(t){this._down=this._active,this.fire(_F,t)},mousedown(t){this._down=this._active,this.fire(xF,t)},click(t){this._down===this._active&&(this.fire(iS,t),this._down=null)},touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(rS,t,!0)},touchmove(t){this.fire(sS,t,!0)},touchend(t){this.fire(oS,t,!0),this._touch=null},fire(t,e,n){const i=n?this._touch:this._active,r=this._handlers[t];if(e.vegaType=t,t===AF&&i&&i.href?this.handleHref(e,i,i.href):(t===EF||t===P1)&&this.handleTooltip(e,i,t!==P1),r)for(let s=0,o=r.length;s<o;++s)r[s].handler.call(this._obj,e,i)},on(t,e){const n=this.eventName(t),i=this._handlers;return this._handlerIndex(i[n],t,e)<0&&(_9(this,t),(i[n]||(i[n]=[])).push({type:t,handler:e})),this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&i.splice(r,1),this},pickEvent(t){const e=kA(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},pick(t,e,n,i,r){const s=this.context();return ls[t.marktype].pick.call(this,s,t,e,n,i,r)}});function NOt(){return typeof window<"u"&&window.devicePixelRatio||1}function OOt(t,e,n,i,r,s){const o=typeof HTMLElement<"u"&&t instanceof HTMLElement&&t.parentNode!=null,a=t.getContext("2d"),u=o?NOt():r;t.width=e*u,t.height=n*u;for(const c in s)a[c]=s[c];return o&&u!==1&&(t.style.width=e+"px",t.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*i[0],u*i[1]),t}function z1(t){ps.call(this,t),this._options={},this._redraw=!1,this._dirty=new On,this._tempb=new On}const E9=ps.prototype,ROt=(t,e,n)=>new On().set(0,0,e,n).translate(-t[0],-t[1]);function LOt(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-(n[0]%1),-(n[1]%1)),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}J(z1,ps,{initialize(t,e,n,i,r,s){return this._options=s||{},this._canvas=this._options.externalContext?null:yl(1,1,this._options.type),t&&this._canvas&&(Es(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),E9.initialize.call(this,t,e,n,i,r)},resize(t,e,n,i){if(E9.resize.call(this,t,e,n,i),this._canvas)OOt(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||q("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(t){const e=this._tempb.clear().union(t.bounds);let n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)},_render(t,e){const n=this.context(),i=this._origin,r=this._width,s=this._height,o=this._dirty,a=ROt(i,r,s);n.save();const u=this._redraw||o.empty()?(this._redraw=!1,a.expand(1)):LOt(n,a.intersect(o),i);return this.clear(-i[0],-i[1],r,s),this.draw(n,t,u,e),n.restore(),o.clear(),this},draw(t,e,n,i){if(e.marktype!=="group"&&i!=null&&!i.includes(e.marktype))return;const r=ls[e.marktype];e.clip&&NNt(t,e),r.draw.call(this,t,e,n,i),e.clip&&t.restore()},clear(t,e,n,i){const r=this._options,s=this.context();r.type!=="pdf"&&!r.externalContext&&s.clearRect(t,e,n,i),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(t,e,n,i))}});function TO(t,e){Yl.call(this,t,e);const n=this;n._hrefHandler=$F(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=$F(n,(i,r)=>{n.handleTooltip(i,r,i.type!==P1)})}const $F=(t,e)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,e.call(t._obj,n,i)};J(TO,Yl,{initialize(t,e,n){let i=this._svg;return i&&(i.removeEventListener(AF,this._hrefHandler),i.removeEventListener(EF,this._tooltipHandler),i.removeEventListener(P1,this._tooltipHandler)),this._svg=i=t&&MO(t,"svg"),i&&(i.addEventListener(AF,this._hrefHandler),i.addEventListener(EF,this._tooltipHandler),i.addEventListener(P1,this._tooltipHandler)),Yl.prototype.initialize.call(this,t,e,n)},canvas(){return this._svg},on(t,e){const n=this.eventName(t),i=this._handlers;if(this._handlerIndex(i[n],t,e)<0){const s={type:t,handler:e,listener:$F(this,e)};(i[n]||(i[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const Dit="aria-hidden",FO="aria-label",kO="role",DO="aria-roledescription",Cit="graphics-object",CO="graphics-symbol",Nit=(t,e,n)=>({[kO]:t,[DO]:e,[FO]:n||void 0}),BOt=Mo(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),A9={axis:{desc:"axis",caption:UOt},legend:{desc:"legend",caption:jOt},"title-text":{desc:"title",caption:t=>`Title text '${I9(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${I9(t)}'`}},$9={ariaRole:kO,ariaRoleDescription:DO,description:FO};function Oit(t,e){const n=e.aria===!1;if(t(Dit,n||void 0),n||e.description==null)for(const i in $9)t($9[i],void 0);else{const i=e.mark.marktype;t(FO,e.description),t(kO,e.ariaRole||(i==="group"?Cit:CO)),t(DO,e.ariaRoleDescription||`${i} mark`)}}function Rit(t){return t.aria===!1?{[Dit]:!0}:BOt[t.role]?null:A9[t.role]?zOt(t,A9[t.role]):POt(t)}function POt(t){const e=t.marktype,n=e==="group"||e==="text"||t.items.some(i=>i.description!=null&&i.aria!==!1);return Nit(n?Cit:CO,`${e} mark container`,t.description)}function zOt(t,e){try{const n=t.items[0],i=e.caption||(()=>"");return Nit(e.role||CO,e.desc,n.description||i(n))}catch{return null}}function I9(t){return ot(t.text).join(" ")}function UOt(t){const e=t.datum,n=t.orient,i=e.title?Lit(t):null,r=t.context,s=r.scales[e.scale].value,o=r.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(i?` titled '${i}'`:"")+` for a ${Yg(a)?"discrete":a} scale with ${Qnt(o,s,t)}`}function jOt(t){const e=t.datum,n=e.title?Lit(t):null,i=`${e.type||""} legend`.trim(),r=e.scales,s=Object.keys(r),o=t.context,a=o.scales[r[s[0]]].value,u=o.dataflow.locale();return VOt(i)+(n?` titled '${n}'`:"")+` for ${qOt(s)} with ${Qnt(u,a,t)}`}function Lit(t){try{return ot(pe(t.items).items[0].text).join(" ")}catch{return null}}function qOt(t){return t=t.map(e=>e+(e==="fill"||e==="stroke"?" color":"")),t.length<2?t[0]:t.slice(0,-1).join(", ")+" and "+pe(t)}function VOt(t){return t.length?t[0].toUpperCase()+t.slice(1):t}const Bit=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),WOt=t=>Bit(t).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function NO(){let t="",e="",n="";const i=[],r=()=>e=n="",s=u=>{e&&(t+=`${e}>${n}`,r()),i.push(u)},o=(u,c)=>(c!=null&&(e+=` ${u}="${WOt(c)}"`),a),a={open(u){s(u),e="<"+u;for(var c=arguments.length,l=new Array(c>1?c-1:0),f=1;f<c;f++)l[f-1]=arguments[f];for(const d of l)for(const h in d)o(h,d[h]);return a},close(){const u=i.pop();return e?t+=e+(n?`>${n}</${u}>`:"/>"):t+=`</${u}>`,r(),a},attr:o,text:u=>(n+=Bit(u),a),toString:()=>t};return a}const Pit=t=>zit(NO(),t)+"";function zit(t,e){if(t.open(e.tagName),e.hasAttributes()){const n=e.attributes,i=n.length;for(let r=0;r<i;++r)t.attr(n[r].name,n[r].value)}if(e.hasChildNodes()){const n=e.childNodes;for(const i of n)i.nodeType===3?t.text(i.nodeValue):zit(t,i)}return t.close()}const aS={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},uS={blend:"mix-blend-mode"},Uit={fill:"none","stroke-miterlimit":10},A0=0,M9="http://www.w3.org/2000/xmlns/",Bn=B1.xmlns;function DA(t){ps.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const y3=ps.prototype;J(DA,ps,{initialize(t,e,n,i,r){return this._defs={},this._clearDefs(),t&&(this._svg=Pn(t,0,"svg",Bn),this._svg.setAttributeNS(M9,"xmlns",Bn),this._svg.setAttributeNS(M9,"xmlns:xlink",B1["xmlns:xlink"]),this._svg.setAttribute("version",B1.version),this._svg.setAttribute("class","marks"),Es(t,1),this._root=Pn(this._svg,A0,"g",Bn),al(this._root,Uit),Es(this._svg,A0+1)),this.background(this._bgcolor),y3.initialize.call(this,t,e,n,i,r)},background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),y3.background.apply(this,arguments)},resize(t,e,n,i){return y3.resize.call(this,t,e,n,i),this._svg&&(al(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const t=this._svg,e=this._bgcolor;if(!t)return null;let n;e&&(t.removeAttribute("style"),n=Pn(t,A0,"rect",Bn),al(n,{width:this._width,height:this._height,fill:e}));const i=Pit(t);return e&&(t.removeChild(n),this._svg.style.setProperty("background-color",e)),i},_render(t,e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t,void 0,e),Es(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const e=++this._dirtyID;let n,i,r,s,o,a,u;for(o=0,a=t.length;o<a;++o)if(n=t[o],i=n.mark,i.marktype!==r&&(r=i.marktype,s=ls[r]),i.zdirty&&i.dirty!==e&&(this._dirtyAll=!1,T9(n,e),i.items.forEach(c=>{c.dirty=e})),!i.zdirty){if(n.exit){s.nested&&i.items.length?(u=i.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?i.items[0]:n,n._update!==e&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,T9(n,e)):this._update(s,n._svg,n),n._update=e)}return!this._dirtyAll},mark(t,e,n,i){if(!this.isDirty(e))return e._svg;const r=this._svg,s=e.marktype,o=ls[s],a=e.interactive===!1?"none":null,u=o.tag==="g",c=F9(e,t,n,"g",r);if(s!=="group"&&i!=null&&!i.includes(s))return Es(c,0),e._svg;c.setAttribute("class",Ait(e));const l=Rit(e);for(const p in l)Ui(c,p,l[p]);u||Ui(c,"pointer-events",a),Ui(c,"clip-path",e.clip?lO(this,e,e.group):null);let f=null,d=0;const h=p=>{const g=this.isDirty(p),m=F9(p,c,f,o.tag,r);g&&(this._update(o,m,p),u&&HOt(this,m,p,i)),f=m,++d};return o.nested?e.items.length&&h(e.items[0]):Fo(e,h),Es(c,d),c},_update(t,e,n){Yu=e,$i=e.__values__,Oit(zy,n),t.attr(zy,n,this);const i=KOt[t.type];i&&i.call(this,t,e,n),Yu&&this.style(Yu,n)},style(t,e){if(e!=null){for(const n in aS){let i=n==="font"?tv(e):e[n];if(i===$i[n])continue;const r=aS[n];i==null?t.removeAttribute(r):(aO(i)&&(i=tit(i,this._defs.gradient,jit())),t.setAttribute(r,i+"")),$i[n]=i}for(const n in uS)b2(t,uS[n],e[n])}},defs(){const t=this._svg,e=this._defs;let n=e.el,i=0;for(const r in e.gradient)n||(e.el=n=Pn(t,A0+1,"defs",Bn)),i=GOt(n,e.gradient[r],i);for(const r in e.clipping)n||(e.el=n=Pn(t,A0+1,"defs",Bn)),i=YOt(n,e.clipping[r],i);n&&(i===0?(t.removeChild(n),e.el=null):Es(n,i))},_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}});function T9(t,e){for(;t&&t.dirty!==e;t=t.mark.group)if(t.dirty=e,t.mark&&t.mark.dirty!==e)t.mark.dirty=e;else return}function GOt(t,e,n){let i,r,s;if(e.gradient==="radial"){let o=Pn(t,n++,"pattern",Bn);al(o,{id:Qx+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=Pn(o,0,"rect",Bn),al(o,{width:1,height:1,fill:`url(${jit()}#${e.id})`}),t=Pn(t,n++,"radialGradient",Bn),al(t,{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else t=Pn(t,n++,"linearGradient",Bn),al(t,{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(i=0,r=e.stops.length;i<r;++i)s=Pn(t,i,"stop",Bn),s.setAttribute("offset",e.stops[i].offset),s.setAttribute("stop-color",e.stops[i].color);return Es(t,i),n}function YOt(t,e,n){let i;return t=Pn(t,n,"clipPath",Bn),t.setAttribute("id",e.id),e.path?(i=Pn(t,0,"path",Bn),i.setAttribute("d",e.path)):(i=Pn(t,0,"rect",Bn),al(i,{x:0,y:0,width:e.width,height:e.height})),Es(t,1),n+1}function HOt(t,e,n,i){e=e.lastChild.previousSibling;let r,s=0;Fo(n,o=>{r=t.mark(e,o,r,i),++s}),Es(e,1+s)}function F9(t,e,n,i,r){let s=t._svg,o;if(!s&&(o=e.ownerDocument,s=ol(o,i,Bn),t._svg=s,t.mark&&(s.__data__=t,s.__values__={fill:"default"},i==="g"))){const a=ol(o,"path",Bn);s.appendChild(a),a.__data__=t;const u=ol(o,"g",Bn);s.appendChild(u),u.__data__=t;const c=ol(o,"path",Bn);s.appendChild(c),c.__data__=t,c.__values__={fill:"default"}}return(s.ownerSVGElement!==r||XOt(s,n))&&e.insertBefore(s,n?n.nextSibling:e.firstChild),s}function XOt(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}let Yu=null,$i=null;const KOt={group(t,e,n){const i=Yu=e.childNodes[2];$i=i.__values__,t.foreground(zy,n,this),$i=e.__values__,Yu=e.childNodes[1],t.content(zy,n,this);const r=Yu=e.childNodes[0];t.background(zy,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==$i.events&&(Ui(i,"pointer-events",s),Ui(r,"pointer-events",s),$i.events=s),n.strokeForeground&&n.stroke){const o=n.fill;Ui(i,"display",null),this.style(r,n),Ui(r,"stroke",null),o&&(n.fill=null),$i=i.__values__,this.style(i,n),o&&(n.fill=o),Yu=null}else Ui(i,"display","none")},image(t,e,n){n.smooth===!1?(b2(e,"image-rendering","optimizeSpeed"),b2(e,"image-rendering","pixelated")):b2(e,"image-rendering",null)},text(t,e,n){const i=Zb(n);let r,s,o,a;W(i)?(s=i.map(u=>Gl(n,u)),r=s.join(`
`),r!==$i.text&&(Es(e,0),o=e.ownerDocument,a=Wl(n),s.forEach((u,c)=>{const l=ol(o,"tspan",Bn);l.__data__=n,l.textContent=u,c&&(l.setAttribute("x",0),l.setAttribute("dy",a)),e.appendChild(l)}),$i.text=r)):(s=Gl(n,i),s!==$i.text&&(e.textContent=s,$i.text=s)),Ui(e,"font-family",tv(n)),Ui(e,"font-size",tu(n)+"px"),Ui(e,"font-style",n.fontStyle),Ui(e,"font-variant",n.fontVariant),Ui(e,"font-weight",n.fontWeight)}};function zy(t,e,n){e!==$i[t]&&(n?JOt(Yu,t,e,n):Ui(Yu,t,e),$i[t]=e)}function b2(t,e,n){n!==$i[e]&&(n==null?t.style.removeProperty(e):t.style.setProperty(e,n+""),$i[e]=n)}function al(t,e){for(const n in e)Ui(t,n,e[n])}function Ui(t,e,n){n!=null?t.setAttribute(e,n):t.removeAttribute(e)}function JOt(t,e,n,i){n!=null?t.setAttributeNS(i,e,n):t.removeAttributeNS(i,e)}function jit(){let t;return typeof window>"u"?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function OO(t){ps.call(this,t),this._text=null,this._defs={gradient:{},clipping:{}}}J(OO,ps,{svg(){return this._text},_render(t){const e=NO();e.open("svg",Jt({},B1,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",Uit,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this},mark(t,e){const n=ls[e.marktype],i=n.tag,r=[Oit,n.attr];t.open("g",{class:Ait(e),"clip-path":e.clip?lO(this,e,e.group):null},Rit(e),{"pointer-events":i!=="g"&&e.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&t.open("a",a),t.open(i,this.attr(e,o,r,i!=="g"?i:null)),i==="text"){const u=Zb(o);if(W(u)){const c={x:0,dy:Wl(o)};for(let l=0;l<u.length;++l)t.open("tspan",l?c:null).text(Gl(o,u[l])).close()}else t.text(Gl(o,u))}else if(i==="g"){const u=o.strokeForeground,c=o.fill,l=o.stroke;u&&l&&(o.stroke=null),t.open("path",this.attr(e,o,n.background,"bgrect")).close(),t.open("g",this.attr(e,o,n.content)),Fo(o,f=>this.mark(t,f)),t.close(),u&&l?(c&&(o.fill=null),o.stroke=l,t.open("path",this.attr(e,o,n.foreground,"bgrect")).close(),c&&(o.fill=c)):t.open("path",this.attr(e,o,n.foreground,"bgfore")).close()}t.close(),a&&t.close()};return n.nested?e.items&&e.items.length&&s(e.items[0]):Fo(e,s),t.close()},href(t){const e=t.href;let n;if(e){if(n=this._hrefs&&this._hrefs[e])return n;this.sanitizeURL(e).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[e]=i})}return null},attr(t,e,n,i){const r={},s=(o,a,u,c)=>{r[c||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,e,this)):n(s,e,this),i&&QOt(r,e,t,i,this._defs),r},defs(t){const e=this._defs.gradient,n=this._defs.clipping;if(Object.keys(e).length+Object.keys(n).length!==0){t.open("defs");for(const r in e){const s=e[r],o=s.stops;s.gradient==="radial"?(t.open("pattern",{id:Qx+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),t.close(),t.open("radialGradient",{id:r,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):t.open("linearGradient",{id:r,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)t.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();t.close()}for(const r in n){const s=n[r];t.open("clipPath",{id:r}),s.path?t.open("path",{d:s.path}).close():t.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),t.close()}t.close()}}});function QOt(t,e,n,i,r){let s;if(e==null||(i==="bgrect"&&n.interactive===!1&&(t["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(t["pointer-events"]="none"),t.display="none",e.fill!==null)))return t;i==="image"&&e.smooth===!1&&(s=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),i==="text"&&(t["font-family"]=tv(e),t["font-size"]=tu(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const o in aS){let a=e[o];const u=aS[o];a==="transparent"&&(u==="fill"||u==="stroke")||a!=null&&(aO(a)&&(a=tit(a,r.gradient,"")),t[u]=a)}for(const o in uS){const a=e[o];a!=null&&(s=s||[],s.push(`${uS[o]}: ${a};`))}return s&&(t.style=s.join(" ")),t}const ao={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function ZOt(t){ao.svgMarkTypes=t.svgMarkTypes??["text"],ao.svgOnTop=t.svgOnTop??!0,ao.debug=t.debug??!1}function cS(t){ps.call(this,t),this._svgRenderer=new DA(t),this._canvasRenderer=new z1(t)}const k9=ps.prototype;J(cS,ps,{initialize(t,e,n,i,r){this._root_el=Pn(t,0,"div");const s=Pn(this._root_el,0,"div"),o=Pn(this._root_el,1,"div");return this._root_el.style.position="relative",ao.debug||(s.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.height="100%",o.style.width="100%"),this._svgEl=ao.svgOnTop?o:s,this._canvasEl=ao.svgOnTop?s:o,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,e,n,i,r),this._svgRenderer.initialize(this._svgEl,e,n,i,r),k9.initialize.call(this,t,e,n,i,r)},dirty(t){return ao.svgMarkTypes.includes(t.mark.marktype)?this._svgRenderer.dirty(t):this._canvasRenderer.dirty(t),this},_render(t,e){const i=(e??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(r=>!ao.svgMarkTypes.includes(r));this._svgRenderer.render(t,ao.svgMarkTypes),this._canvasRenderer.render(t,i)},resize(t,e,n,i){return k9.resize.call(this,t,e,n,i),this._svgRenderer.resize(t,e,n,i),this._canvasRenderer.resize(t,e,n,i),this},background(t){return ao.svgOnTop?this._canvasRenderer.background(t):this._svgRenderer.background(t),this}});function RO(t,e){Hl.call(this,t,e)}J(RO,Hl,{initialize(t,e,n){const i=Pn(Pn(t,0,"div"),ao.svgOnTop?0:1,"div");return Hl.prototype.initialize.call(this,i,e,n)}});const qit="canvas",Vit="hybrid",Wit="png",Git="svg",Yit="none",ul={Canvas:qit,PNG:Wit,SVG:Git,Hybrid:Vit,None:Yit},eh={};eh[qit]=eh[Wit]={renderer:z1,headless:z1,handler:Hl};eh[Git]={renderer:DA,headless:OO,handler:TO};eh[Vit]={renderer:cS,headless:cS,handler:RO};eh[Yit]={};function CA(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(eh[t]=e,this):eh[t]}function Hit(t,e,n){const i=[],r=new On().union(e),s=t.marktype;return s?Xit(t,r,n,i):s==="group"?Kit(t,r,n,i):q("Intersect scene must be mark node or group item.")}function Xit(t,e,n,i){if(tRt(t,e,n)){const r=t.items,s=t.marktype,o=r.length;let a=0;if(s==="group")for(;a<o;++a)Kit(r[a],e,n,i);else for(const u=ls[s].isect;a<o;++a){const c=r[a];Jit(c,e,u)&&i.push(c)}}return i}function tRt(t,e,n){return t.bounds&&e.intersects(t.bounds)&&(t.marktype==="group"||t.interactive!==!1&&(!n||n(t)))}function Kit(t,e,n,i){n&&n(t.mark)&&Jit(t,e,ls.group.isect)&&i.push(t);const r=t.items,s=r&&r.length;if(s){const o=t.x||0,a=t.y||0;e.translate(-o,-a);for(let u=0;u<s;++u)Xit(r[u],e,n,i);e.translate(o,a)}return i}function Jit(t,e,n){const i=t.bounds;return e.encloses(i)||e.intersects(i)&&n(t,e)}const b3=new On;function Qit(t){const e=t.clip;if(Qt(e))e(Jb(b3.clear()));else if(e)b3.set(0,0,t.group.width,t.group.height);else return;t.bounds.intersect(b3)}const eRt=1e-9;function LO(t,e,n){return t===e?!0:n==="path"?Zit(t,e):t instanceof Date&&e instanceof Date?+t==+e:be(t)&&be(e)?Math.abs(t-e)<=eRt:!t||!e||!ut(t)&&!ut(e)?t==e:nRt(t,e)}function Zit(t,e){return LO(Hg(t),Hg(e))}function nRt(t,e){var n=Object.keys(t),i=Object.keys(e),r,s;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),s=n.length-1;s>=0;s--)if(n[s]!=i[s])return!1;for(s=n.length-1;s>=0;s--)if(r=n[s],!LO(t[r],e[r],r))return!1;return typeof t==typeof e}function iRt(){ait(),ICt()}const Jg="top",ho="left",go="right",Xl="bottom",rRt="top-left",sRt="top-right",oRt="bottom-left",aRt="bottom-right",BO="start",IF="middle",qi="end",uRt="x",cRt="y",NA="group",PO="axis",zO="title",lRt="frame",fRt="scope",UO="legend",trt="row-header",ert="row-footer",nrt="row-title",irt="column-header",rrt="column-footer",srt="column-title",dRt="padding",hRt="symbol",ort="fit",art="fit-x",urt="fit-y",pRt="pad",jO="none",lw="all",MF="each",qO="flush",cl="column",ll="row";function crt(t){z.call(this,null,t)}J(crt,z,{transform(t,e){const n=e.dataflow,i=t.mark,r=i.marktype,s=ls[r],o=s.bound;let a=i.bounds,u;if(s.nested)i.items.length&&n.dirty(i.items[0]),a=fw(i,o),i.items.forEach(c=>{c.bounds.clear().union(a)});else if(r===NA||t.modified())switch(e.visit(e.MOD,c=>n.dirty(c)),a.clear(),i.items.forEach(c=>a.union(fw(c,o))),i.role){case PO:case UO:case zO:e.reflow()}else u=e.changed(e.REM),e.visit(e.ADD,c=>{a.union(fw(c,o))}),e.visit(e.MOD,c=>{u=u||a.alignsWith(c.bounds),n.dirty(c),a.union(fw(c,o))}),u&&(a.clear(),i.items.forEach(c=>a.union(c.bounds)));return Qit(i),e.modifies("bounds")}});function fw(t,e,n){return e(t.bounds.clear(),t,n)}const D9=":vega_identifier:";function VO(t){z.call(this,0,t)}VO.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};J(VO,z,{transform(t,e){const n=gRt(e.dataflow),i=t.as;let r=n.value;return e.visit(e.ADD,s=>s[i]=s[i]||++r),n.set(this.value=r),e}});function gRt(t){return t._signals[D9]||(t._signals[D9]=t.add(0))}function lrt(t){z.call(this,null,t)}J(lrt,z,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,mRt(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const i=n.marktype===NA?EA:SA;return e.visit(e.ADD,r=>i.call(r,n)),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});function mRt(t){const e=t.groups,n=t.parent;return e&&e.size===1?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}function frt(t){z.call(this,null,t)}const C9={parity:t=>t.filter((e,n)=>n%2?e.opacity=0:1),greedy:(t,e)=>{let n;return t.filter((i,r)=>!r||!drt(n.bounds,i.bounds,e)?(n=i,1):i.opacity=0)}},drt=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),N9=(t,e)=>{for(var n=1,i=t.length,r=t[0].bounds,s;n<i;r=s,++n)if(drt(r,s=t[n].bounds,e))return!0},yRt=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},bRt=(t,e,n)=>{var i=t.range(),r=new On;return e===Jg||e===Xl?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),s=>r.encloses(s.bounds)},O9=t=>(t.forEach(e=>e.opacity=1),t),R9=(t,e)=>t.reflow(e.modified()).modifies("opacity");J(frt,z,{transform(t,e){const n=C9[t.method]||C9.parity,i=t.separation||0;let r=e.materialize(e.SOURCE).source,s,o;if(!r||!r.length)return;if(!t.method)return t.modified("method")&&(O9(r),e=R9(e,t)),e;if(r=r.filter(yRt),!r.length)return;if(t.sort&&(r=r.slice().sort(t.sort)),s=O9(r),e=R9(e,t),s.length>=3&&N9(s,i)){do s=n(s,i);while(s.length>=3&&N9(s,i));s.length<3&&!pe(r).opacity&&(s.length>1&&(pe(s).opacity=0),pe(r).opacity=1)}t.boundScale&&t.boundTolerance>=0&&(o=bRt(t.boundScale,t.boundOrient,+t.boundTolerance),r.forEach(u=>{o(u)||(u.opacity=0)}));const a=s[0].mark.bounds.clear();return r.forEach(u=>{u.opacity&&a.union(u.bounds)}),e}});function hrt(t){z.call(this,null,t)}J(hrt,z,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,i=>n.dirty(i)),e.fields&&e.fields.zindex){const i=e.source&&e.source[0];i&&(i.mark.zdirty=!0)}}});const Ai=new On;function qp(t,e,n){return t[e]===n?0:(t[e]=n,1)}function vRt(t){var e=t.items[0].orient;return e===ho||e===go}function wRt(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}function _Rt(t,e,n,i){var r=e.items[0],s=r.datum,o=r.translate!=null?r.translate:.5,a=r.orient,u=wRt(s),c=r.range,l=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,p=s.title&&r.items[u[2]].items[0],g=r.titlePadding,m=r.bounds,y=p&&EO(p),b=0,v=0,w,_;switch(Ai.clear().union(m),m.clear(),(w=u[0])>-1&&m.union(r.items[w].bounds),(w=u[1])>-1&&m.union(r.items[w].bounds),a){case Jg:b=f||0,v=-l,_=Math.max(d,Math.min(h,-m.y1)),m.add(0,-_).add(c,0),p&&dw(t,p,_,g,y,0,-1,m);break;case ho:b=-l,v=f||0,_=Math.max(d,Math.min(h,-m.x1)),m.add(-_,0).add(0,c),p&&dw(t,p,_,g,y,1,-1,m);break;case go:b=n+l,v=f||0,_=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(_,c),p&&dw(t,p,_,g,y,1,1,m);break;case Xl:b=f||0,v=i+l,_=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(c,_),p&&dw(t,p,_,g,0,0,1,m);break;default:b=r.x,v=r.y}return Ec(m.translate(b,v),r),qp(r,"x",b+o)|qp(r,"y",v+o)&&(r.bounds=Ai,t.dirty(r),r.bounds=m,t.dirty(r)),r.mark.bounds.clear().union(m)}function dw(t,e,n,i,r,s,o,a){const u=e.bounds;if(e.auto){const c=o*(n+r+i);let l=0,f=0;t.dirty(e),s?l=(e.x||0)-(e.x=c):f=(e.y||0)-(e.y=c),e.mark.bounds.clear().union(u.translate(-l,-f)),t.dirty(e)}a.union(u)}const L9=(t,e)=>Math.floor(Math.min(t,e)),B9=(t,e)=>Math.ceil(Math.max(t,e));function xRt(t){var e=t.items,n=e.length,i=0,r,s;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(r=e[i],s=r.items,r.marktype===NA)switch(r.role){case PO:case UO:case zO:break;case trt:o.rowheaders.push(...s);break;case ert:o.rowfooters.push(...s);break;case irt:o.colheaders.push(...s);break;case rrt:o.colfooters.push(...s);break;case nrt:o.rowtitle=s[0];break;case srt:o.coltitle=s[0];break;default:o.marks.push(...s)}return o}function SRt(t){return new On().set(0,0,t.width||0,t.height||0)}function ERt(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function rn(t,e,n){const i=ut(t)?t[e]:t;return i??(n!==void 0?n:0)}function P9(t){return t<0?Math.ceil(-t):0}function prt(t,e,n){var i=!n.nodirty,r=n.bounds===qO?SRt:ERt,s=Ai.set(0,0,0,0),o=rn(n.align,cl),a=rn(n.align,ll),u=rn(n.padding,cl),c=rn(n.padding,ll),l=n.columns||e.length,f=l<=0?1:Math.ceil(e.length/l),d=e.length,h=Array(d),p=Array(l),g=0,m=Array(d),y=Array(f),b=0,v=Array(d),w=Array(d),_=Array(d),S,x,E,A,$,I,k,T,M,F,D;for(x=0;x<l;++x)p[x]=0;for(x=0;x<f;++x)y[x]=0;for(x=0;x<d;++x)I=e[x],$=_[x]=r(I),I.x=I.x||0,v[x]=0,I.y=I.y||0,w[x]=0,E=x%l,A=~~(x/l),g=Math.max(g,k=Math.ceil($.x2)),b=Math.max(b,T=Math.ceil($.y2)),p[E]=Math.max(p[E],k),y[A]=Math.max(y[A],T),h[x]=u+P9($.x1),m[x]=c+P9($.y1),i&&t.dirty(e[x]);for(x=0;x<d;++x)x%l===0&&(h[x]=0),x<l&&(m[x]=0);if(o===MF)for(E=1;E<l;++E){for(D=0,x=E;x<d;x+=l)D<h[x]&&(D=h[x]);for(x=E;x<d;x+=l)h[x]=D+p[E-1]}else if(o===lw){for(D=0,x=0;x<d;++x)x%l&&D<h[x]&&(D=h[x]);for(x=0;x<d;++x)x%l&&(h[x]=D+g)}else for(o=!1,E=1;E<l;++E)for(x=E;x<d;x+=l)h[x]+=p[E-1];if(a===MF)for(A=1;A<f;++A){for(D=0,x=A*l,S=x+l;x<S;++x)D<m[x]&&(D=m[x]);for(x=A*l;x<S;++x)m[x]=D+y[A-1]}else if(a===lw){for(D=0,x=l;x<d;++x)D<m[x]&&(D=m[x]);for(x=l;x<d;++x)m[x]=D+b}else for(a=!1,A=1;A<f;++A)for(x=A*l,S=x+l;x<S;++x)m[x]+=y[A-1];for(M=0,x=0;x<d;++x)M=h[x]+(x%l?M:0),v[x]+=M-e[x].x;for(E=0;E<l;++E)for(F=0,x=E;x<d;x+=l)F+=m[x],w[x]+=F-e[x].y;if(o&&rn(n.center,cl)&&f>1)for(x=0;x<d;++x)$=o===lw?g:p[x%l],M=$-_[x].x2-e[x].x-v[x],M>0&&(v[x]+=M/2);if(a&&rn(n.center,ll)&&l!==1)for(x=0;x<d;++x)$=a===lw?b:y[~~(x/l)],F=$-_[x].y2-e[x].y-w[x],F>0&&(w[x]+=F/2);for(x=0;x<d;++x)s.union(_[x].translate(v[x],w[x]));switch(M=rn(n.anchor,uRt),F=rn(n.anchor,cRt),rn(n.anchor,cl)){case qi:M-=s.width();break;case IF:M-=s.width()/2}switch(rn(n.anchor,ll)){case qi:F-=s.height();break;case IF:F-=s.height()/2}for(M=Math.round(M),F=Math.round(F),s.clear(),x=0;x<d;++x)e[x].mark.bounds.clear();for(x=0;x<d;++x)I=e[x],I.x+=v[x]+=M,I.y+=w[x]+=F,s.union(I.mark.bounds.union(I.bounds.translate(v[x],w[x]))),i&&t.dirty(I);return s}function ARt(t,e,n){var i=xRt(e),r=i.marks,s=n.bounds===qO?$Rt:IRt,o=n.offset,a=n.columns||r.length,u=a<=0?1:Math.ceil(r.length/a),c=u*a,l,f,d,h,p,g,m;const y=prt(t,r,n);y.empty()&&y.set(0,0,0,0),i.rowheaders&&(g=rn(n.headerBand,ll,null),l=hw(t,i.rowheaders,r,a,u,-rn(o,"rowHeader"),L9,0,s,"x1",0,a,1,g)),i.colheaders&&(g=rn(n.headerBand,cl,null),f=hw(t,i.colheaders,r,a,a,-rn(o,"columnHeader"),L9,1,s,"y1",0,1,a,g)),i.rowfooters&&(g=rn(n.footerBand,ll,null),d=hw(t,i.rowfooters,r,a,u,rn(o,"rowFooter"),B9,0,s,"x2",a-1,a,1,g)),i.colfooters&&(g=rn(n.footerBand,cl,null),h=hw(t,i.colfooters,r,a,a,rn(o,"columnFooter"),B9,1,s,"y2",c-a,1,a,g)),i.rowtitle&&(p=rn(n.titleAnchor,ll),m=rn(o,"rowTitle"),m=p===qi?d+m:l-m,g=rn(n.titleBand,ll,.5),z9(t,i.rowtitle,m,0,y,g)),i.coltitle&&(p=rn(n.titleAnchor,cl),m=rn(o,"columnTitle"),m=p===qi?h+m:f-m,g=rn(n.titleBand,cl,.5),z9(t,i.coltitle,m,1,y,g))}function $Rt(t,e){return e==="x1"?t.x||0:e==="y1"?t.y||0:e==="x2"?(t.x||0)+(t.width||0):e==="y2"?(t.y||0)+(t.height||0):void 0}function IRt(t,e){return t.bounds[e]}function hw(t,e,n,i,r,s,o,a,u,c,l,f,d,h){var p=n.length,g=0,m=0,y,b,v,w,_,S,x,E,A;if(!p)return g;for(y=l;y<p;y+=f)n[y]&&(g=o(g,u(n[y],c)));if(!e.length)return g;for(e.length>r&&(t.warn("Grid headers exceed limit: "+r),e=e.slice(0,r)),g+=s,b=0,w=e.length;b<w;++b)t.dirty(e[b]),e[b].mark.bounds.clear();for(y=l,b=0,w=e.length;b<w;++b,y+=f){for(S=e[b],_=S.mark.bounds,v=y;v>=0&&(x=n[v])==null;v-=d);a?(E=h==null?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),A=g):(E=g,A=h==null?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),_.union(S.bounds.translate(E-(S.x||0),A-(S.y||0))),S.x=E,S.y=A,t.dirty(S),m=o(m,_[c])}return m}function z9(t,e,n,i,r,s){if(e){t.dirty(e);var o=n,a=n;i?o=Math.round(r.x1+s*r.width()):a=Math.round(r.y1+s*r.height()),e.bounds.translate(o-(e.x||0),a-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=o,e.y=a,t.dirty(e)}}function MRt(t,e){const n=t[e]||{};return(i,r)=>n[i]!=null?n[i]:t[i]!=null?t[i]:r}function TRt(t,e){let n=-1/0;return t.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-1/0?n:e}function FRt(t,e,n,i,r,s,o){const a=MRt(n,e),u=TRt(t,a("offset",0)),c=a("anchor",BO),l=c===qi?1:c===IF?.5:0,f={align:MF,bounds:a("bounds",qO),columns:a("direction")==="vertical"?1:t.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(e){case ho:f.anchor={x:Math.floor(i.x1)-u,column:qi,y:l*(o||i.height()+2*i.y1),row:c};break;case go:f.anchor={x:Math.ceil(i.x2)+u,y:l*(o||i.height()+2*i.y1),row:c};break;case Jg:f.anchor={y:Math.floor(r.y1)-u,row:qi,x:l*(s||r.width()+2*r.x1),column:c};break;case Xl:f.anchor={y:Math.ceil(r.y2)+u,x:l*(s||r.width()+2*r.x1),column:c};break;case rRt:f.anchor={x:u,y:u};break;case sRt:f.anchor={x:s-u,y:u,column:qi};break;case oRt:f.anchor={x:u,y:o-u,row:qi};break;case aRt:f.anchor={x:s-u,y:o-u,column:qi,row:qi};break}return f}function kRt(t,e){var n=e.items[0],i=n.datum,r=n.orient,s=n.bounds,o=n.x,a=n.y,u,c;return n._bounds?n._bounds.clear().union(s):n._bounds=s.clone(),s.clear(),CRt(t,n,n.items[0].items[0]),s=DRt(n,s),u=2*n.padding,c=2*n.padding,s.empty()||(u=Math.ceil(s.width()+u),c=Math.ceil(s.height()+c)),i.type===hRt&&NRt(n.items[0].items[0].items[0].items),r!==jO&&(n.x=o=0,n.y=a=0),n.width=u,n.height=c,Ec(s.set(o,a,o+u,a+c),n),n.mark.bounds.clear().union(s),n}function DRt(t,e){return t.items.forEach(n=>e.union(n.bounds)),e.x1=t.padding,e.y1=t.padding,e}function CRt(t,e,n){var i=e.padding,r=i-n.x,s=i-n.y;if(!e.datum.title)(r||s)&&$0(t,n,r,s);else{var o=e.items[1].items[0],a=o.anchor,u=e.titlePadding||0,c=i-o.x,l=i-o.y;switch(o.orient){case ho:r+=Math.ceil(o.bounds.width())+u;break;case go:case Xl:break;default:s+=o.bounds.height()+u}switch((r||s)&&$0(t,n,r,s),o.orient){case ho:l+=np(e,n,o,a,1,1);break;case go:c+=np(e,n,o,qi,0,0)+u,l+=np(e,n,o,a,1,1);break;case Xl:c+=np(e,n,o,a,0,0),l+=np(e,n,o,qi,-1,0,1)+u;break;default:c+=np(e,n,o,a,0,0)}(c||l)&&$0(t,o,c,l),(c=Math.round(o.bounds.x1-i))<0&&($0(t,n,-c,0),$0(t,o,-c,0))}}function np(t,e,n,i,r,s,o){const a=t.datum.type!=="symbol",u=n.datum.vgrad,c=a&&(s||!u)&&!o?e.items[0]:e,l=c.bounds[r?"y2":"x2"]-t.padding,f=u&&s?l:0,d=u&&s?0:l,h=r<=0?0:EO(n);return Math.round(i===BO?f:i===qi?d-h:.5*(l-h))}function $0(t,e,n,i){e.x+=n,e.y+=i,e.bounds.translate(n,i),e.mark.bounds.translate(n,i),t.dirty(e)}function NRt(t){const e=t.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});t.forEach(n=>{n.width=e[n.column],n.height=n.bounds.y2-n.y})}function ORt(t,e,n,i,r){var s=e.items[0],o=s.frame,a=s.orient,u=s.anchor,c=s.offset,l=s.padding,f=s.items[0].items[0],d=s.items[1]&&s.items[1].items[0],h=a===ho||a===go?i:n,p=0,g=0,m=0,y=0,b=0,v;if(o!==NA?a===ho?(p=r.y2,h=r.y1):a===go?(p=r.y1,h=r.y2):(p=r.x1,h=r.x2):a===ho&&(p=i,h=0),v=u===BO?p:u===qi?h:(p+h)/2,d&&d.text){switch(a){case Jg:case Xl:b=f.bounds.height()+l;break;case ho:y=f.bounds.width()+l;break;case go:y=-f.bounds.width()-l;break}Ai.clear().union(d.bounds),Ai.translate(y-(d.x||0),b-(d.y||0)),qp(d,"x",y)|qp(d,"y",b)&&(t.dirty(d),d.bounds.clear().union(Ai),d.mark.bounds.clear().union(Ai),t.dirty(d)),Ai.clear().union(d.bounds)}else Ai.clear();switch(Ai.union(f.bounds),a){case Jg:g=v,m=r.y1-Ai.height()-c;break;case ho:g=r.x1-Ai.width()-c,m=v;break;case go:g=r.x2+Ai.width()+c,m=v;break;case Xl:g=v,m=r.y2+c;break;default:g=s.x,m=s.y}return qp(s,"x",g)|qp(s,"y",m)&&(Ai.translate(g,m),t.dirty(s),s.bounds.clear().union(Ai),e.bounds.clear().union(Ai),t.dirty(s)),s.bounds}function grt(t){z.call(this,null,t)}J(grt,z,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach(i=>{t.layout&&ARt(n,i,t.layout),LRt(n,i,t)}),RRt(t.mark.group)?e.reflow():e}});function RRt(t){return t&&t.mark.role!=="legend-entry"}function LRt(t,e,n){var i=e.items,r=Math.max(0,e.width||0),s=Math.max(0,e.height||0),o=new On().set(0,0,r,s),a=o.clone(),u=o.clone(),c=[],l,f,d,h,p,g;for(p=0,g=i.length;p<g;++p)switch(f=i[p],f.role){case PO:h=vRt(f)?a:u,h.union(_Rt(t,f,r,s));break;case zO:l=f;break;case UO:c.push(kRt(t,f));break;case lRt:case fRt:case trt:case ert:case nrt:case irt:case rrt:case srt:a.union(f.bounds),u.union(f.bounds);break;default:o.union(f.bounds)}if(c.length){const m={};c.forEach(y=>{d=y.orient||go,d!==jO&&(m[d]||(m[d]=[])).push(y)});for(const y in m){const b=m[y];prt(t,b,FRt(b,y,n.legends,a,u,r,s))}c.forEach(y=>{const b=y.bounds;if(b.equals(y._bounds)||(y.bounds=y._bounds,t.dirty(y),y.bounds=b,t.dirty(y)),n.autosize&&(n.autosize.type===ort||n.autosize.type===art||n.autosize.type===urt))switch(y.orient){case ho:case go:o.add(b.x1,0).add(b.x2,0);break;case Jg:case Xl:o.add(0,b.y1).add(0,b.y2)}else o.union(b)})}o.union(a).union(u),l&&o.union(ORt(t,l,r,s,o)),e.clip&&o.set(0,0,e.width||0,e.height||0),BRt(t,e,o,n)}function BRt(t,e,n,i){const r=i.autosize||{},s=r.type;if(t._autosize<1||!s)return;let o=t._width,a=t._height,u=Math.max(0,e.width||0),c=Math.max(0,Math.ceil(-n.x1)),l=Math.max(0,e.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-l));if(r.contains===dRt){const p=t.padding();o-=p.left+p.right,a-=p.top+p.bottom}s===jO?(c=0,f=0,u=o,l=a):s===ort?(u=Math.max(0,o-c-d),l=Math.max(0,a-f-h)):s===art?(u=Math.max(0,o-c-d),a=l+f+h):s===urt?(o=u+c+d,l=Math.max(0,a-f-h)):s===pRt&&(o=u+c+d,a=l+f+h),t._resizeView(o,a,u,l,[c,f],r.resize)}const PRt=Object.freeze(Object.defineProperty({__proto__:null,bound:crt,identifier:VO,mark:lrt,overlap:frt,render:hrt,viewlayout:grt},Symbol.toStringTag,{value:"Module"}));function mrt(t){z.call(this,null,t)}J(mrt,z,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,s=t.scale,o=t.count==null?t.values?t.values.length:10:t.count,a=sO(s,o,t.minstep),u=t.format||Ynt(n,s,a,t.formatSpecifier,t.formatType,!!t.values),c=t.values?Gnt(s,t.values,a):oO(s,a);return r&&(i.rem=r),r=c.map((l,f)=>Ae({index:f/(c.length-1||1),value:l,label:u(l)})),t.extra&&r.length&&r.push(Ae({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}});function yrt(t){z.call(this,null,t)}function zRt(){return Ae({})}function URt(t){const e=Um().test(n=>n.exit);return e.lookup=n=>e.get(t(n)),e}J(yrt,z,{transform(t,e){var n=e.dataflow,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.item||zRt,s=t.key||wt,o=this.value;return W(i.encode)&&(i.encode=null),o&&(t.modified("key")||e.modified(s))&&q("DataJoin does not support modified key function or fields."),o||(e=e.addAll(),this.value=o=URt(s)),e.visit(e.ADD,a=>{const u=s(a);let c=o.get(u);c?c.exit?(o.empty--,i.add.push(c)):i.mod.push(c):(c=r(a),o.set(u,c),i.add.push(c)),c.datum=a,c.exit=!1}),e.visit(e.MOD,a=>{const u=s(a),c=o.get(u);c&&(c.datum=a,i.mod.push(c))}),e.visit(e.REM,a=>{const u=s(a),c=o.get(u);a===c.datum&&!c.exit&&(i.rem.push(c),c.exit=!0,++o.empty)}),e.changed(e.ADD_MOD)&&i.modifies("datum"),(e.clean()||t.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i}});function brt(t){z.call(this,null,t)}J(brt,z,{transform(t,e){var n=e.fork(e.ADD_REM),i=t.mod||!1,r=t.encoders,s=e.encode;if(W(s))if(n.changed()||s.every(f=>r[f]))s=s[0],n.encode=null;else return e.StopPropagation;var o=s==="enter",a=r.update||zc,u=r.enter||zc,c=r.exit||zc,l=(s&&!o?r[s]:a)||zc;if(e.changed(e.ADD)&&(e.visit(e.ADD,f=>{u(f,t),a(f,t)}),n.modifies(u.output),n.modifies(a.output),l!==zc&&l!==a&&(e.visit(e.ADD,f=>{l(f,t)}),n.modifies(l.output))),e.changed(e.REM)&&c!==zc&&(e.visit(e.REM,f=>{c(f,t)}),n.modifies(c.output)),o||l!==zc){const f=e.MOD|(t.modified()?e.REFLOW:0);o?(e.visit(f,d=>{const h=u(d,t)||i;(l(d,t)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(u.output)):e.visit(f,d=>{(l(d,t)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(l.output)}return n.changed()?n:e.StopPropagation}});function vrt(t){z.call(this,[],t)}J(vrt,z,{transform(t,e){if(this.value!=null&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,s=t.type||f2,o=t.scale,a=+t.limit,u=sO(o,t.count==null?5:t.count,t.minstep),c=!!t.values||s===f2,l=t.format||Jnt(n,o,u,s,t.formatSpecifier,t.formatType,c),f=t.values||Knt(o,u),d,h,p,g,m;return r&&(i.rem=r),s===f2?(a&&f.length>a?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,a-1),m=!0):r=f,Qt(p=t.size)?(!t.values&&o(r[0])===0&&(r=r.slice(1)),g=r.reduce((y,b)=>Math.max(y,p(b,t)),0)):p=Bi(g=p||8),r=r.map((y,b)=>Ae({index:b,label:l(y,b,r),value:y,offset:g,size:p(y,t)})),m&&(m=f[r.length],r.push(Ae({index:r.length,label:`…${f.length-r.length} entries`,value:m,offset:g,size:p(m,t)})))):s===pCt?(d=o.domain(),h=qnt(o,d[0],pe(d)),f.length<3&&!t.values&&d[0]!==pe(d)&&(f=[d[0],pe(d)]),r=f.map((y,b)=>Ae({index:b,label:l(y,b,f),value:y,perc:h(y)}))):(p=f.length-1,h=ACt(o),r=f.map((y,b)=>Ae({index:b,label:l(y,b,f),value:y,perc:b?h(y):0,perc2:b===p?1:h(f[b+1])}))),i.source=r,i.add=r,this.value=r,i}});const jRt=t=>t.source.x,qRt=t=>t.source.y,VRt=t=>t.target.x,WRt=t=>t.target.y;function WO(t){z.call(this,{},t)}WO.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};J(WO,z,{transform(t,e){var n=t.sourceX||jRt,i=t.sourceY||qRt,r=t.targetX||VRt,s=t.targetY||WRt,o=t.as||"path",a=t.orient||"vertical",u=t.shape||"line",c=U9.get(u+"-"+a)||U9.get(u);return c||q("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,l=>{l[o]=c(n(l),i(l),r(l),s(l))}),e.reflow(t.modified()).modifies(o)}});const wrt=(t,e,n,i)=>"M"+t+","+e+"L"+n+","+i,GRt=(t,e,n,i)=>wrt(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),_rt=(t,e,n,i)=>{var r=n-t,s=i-e,o=Math.hypot(r,s)/2,a=180*Math.atan2(s,r)/Math.PI;return"M"+t+","+e+"A"+o+","+o+" "+a+" 0 1 "+n+","+i},YRt=(t,e,n,i)=>_rt(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),xrt=(t,e,n,i)=>{const r=n-t,s=i-e,o=.2*(r+s),a=.2*(s-r);return"M"+t+","+e+"C"+(t+o)+","+(e+a)+" "+(n+a)+","+(i-o)+" "+n+","+i},HRt=(t,e,n,i)=>xrt(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),XRt=(t,e,n,i)=>"M"+t+","+e+"V"+i+"H"+n,KRt=(t,e,n,i)=>"M"+t+","+e+"H"+n+"V"+i,JRt=(t,e,n,i)=>{const r=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n),u=Math.abs(n-t)>Math.PI?n<=t:n>t;return"M"+e*r+","+e*s+"A"+e+","+e+" 0 0,"+(u?1:0)+" "+e*o+","+e*a+"L"+i*o+","+i*a},QRt=(t,e,n,i)=>{const r=(t+n)/2;return"M"+t+","+e+"C"+r+","+e+" "+r+","+i+" "+n+","+i},ZRt=(t,e,n,i)=>{const r=(e+i)/2;return"M"+t+","+e+"C"+t+","+r+" "+n+","+r+" "+n+","+i},t8t=(t,e,n,i)=>{const r=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n),u=(e+i)/2;return"M"+e*r+","+e*s+"C"+u*r+","+u*s+" "+u*o+","+u*a+" "+i*o+","+i*a},U9=Um({line:wrt,"line-radial":GRt,arc:_rt,"arc-radial":YRt,curve:xrt,"curve-radial":HRt,"orthogonal-horizontal":XRt,"orthogonal-vertical":KRt,"orthogonal-radial":JRt,"diagonal-horizontal":QRt,"diagonal-vertical":ZRt,"diagonal-radial":t8t});function GO(t){z.call(this,null,t)}GO.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};J(GO,z,{transform(t,e){var n=t.as||["startAngle","endAngle"],i=n[0],r=n[1],s=t.field||Bm,o=t.startAngle||0,a=t.endAngle!=null?t.endAngle:2*Math.PI,u=e.source,c=u.map(s),l=c.length,f=o,d=(a-o)/Ls(c),h=Un(l),p,g,m;for(t.sort&&h.sort((y,b)=>c[y]-c[b]),p=0;p<l;++p)m=c[h[p]],g=u[h[p]],g[i]=f,g[r]=f+=m*d;return this.value=c,e.reflow(t.modified()).modifies(n)}});const e8t=5;function n8t(t){const e=t.type;return!t.bins&&(e===Wg||e===Vb||e===Wb)}function Srt(t){return nO(t)&&t!==$a}const i8t=Mo(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Ert(t){z.call(this,null,t),this.modified(!0)}J(Ert,z,{transform(t,e){var n=e.dataflow,i=this.value,r=r8t(t);(!i||r!==i.type)&&(this.value=i=xe(r)());for(r in t)if(!i8t[r]){if(r==="padding"&&Srt(i.type))continue;Qt(i[r])?i[r](t[r]):n.warn("Unsupported scale property: "+r)}return l8t(i,t,c8t(i,t,o8t(i,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function r8t(t){var e=t.type,n="",i;return e===$a?$a+"-"+Wg:(s8t(t)&&(i=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(t.domainMid!=null):0,n=i===2?$a+"-":i===3?Wm+"-":""),(n+e||Wg).toLowerCase())}function s8t(t){const e=t.type;return nO(e)&&e!==Zd&&e!==th&&(t.scheme||t.range&&t.range.length&&t.range.every(at))}function o8t(t,e,n){const i=a8t(t,e.domainRaw,n);if(i>-1)return i;var r=e.domain,s=t.type,o=e.zero||e.zero===void 0&&n8t(t),a,u;if(!r)return 0;if(Srt(s)&&e.padding&&r[0]!==pe(r)&&(r=u8t(s,r,e.range,e.padding,e.exponent,e.constant)),(o||e.domainMin!=null||e.domainMax!=null||e.domainMid!=null)&&(a=(r=r.slice()).length-1||1,o&&(r[0]>0&&(r[0]=0),r[a]<0&&(r[a]=0)),e.domainMin!=null&&(r[0]=e.domainMin),e.domainMax!=null&&(r[a]=e.domainMax),e.domainMid!=null)){u=e.domainMid;const c=u>r[a]?a+1:u<r[0]?0:a;c!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),r.splice(c,0,u)}return t.domain(Art(s,r,n)),s===QN&&t.unknown(e.domainImplicit?wx:void 0),e.nice&&t.nice&&t.nice(e.nice!==!0&&sO(t,e.nice)||null),r.length}function a8t(t,e,n){return e?(t.domain(Art(t.type,e,n)),e.length):-1}function u8t(t,e,n,i,r,s){var o=Math.abs(pe(n)-n[0]),a=o/(o-2*i),u=t===lc?WC(e,null,a):t===Wb?Hx(e,null,a,.5):t===Vb?Hx(e,null,a,r||1):t===bA?GC(e,null,a,s||1):VC(e,null,a);return e=e.slice(),e[0]=u[0],e[e.length-1]=u[1],e}function Art(t,e,n){if(Bnt(t)){var i=Math.abs(e.reduce((r,s)=>r+(s<0?-1:s>0?1:0),0));i!==e.length&&n.warn("Log scale domain includes zero: "+Q(e))}return e}function c8t(t,e,n){let i=e.bins;if(i&&!W(i)){const r=t.domain(),s=r[0],o=pe(r),a=i.step;let u=i.start==null?s:i.start,c=i.stop==null?o:i.stop;a||q("Scale bins parameter missing step property."),u<s&&(u=a*Math.ceil(s/a)),c>o&&(c=a*Math.floor(o/a)),i=Un(u,c+a/2,a)}return i?t.bins=i:t.bins&&delete t.bins,t.type===ZN&&(i?!e.domain&&!e.domainRaw&&(t.domain(i),n=i.length):t.bins=t.domain()),n}function l8t(t,e,n){var i=t.type,r=e.round||!1,s=e.range;if(e.rangeStep!=null)s=f8t(i,e,n);else if(e.scheme&&(s=d8t(i,e,n),Qt(s))){if(t.interpolator)return t.interpolator(s);q(`Scale type ${i} does not support interpolating color schemes.`)}if(s&&Pnt(i))return t.interpolator(_A(TF(s,e.reverse),e.interpolate,e.interpolateGamma));s&&e.interpolate&&t.interpolate?t.interpolate(iO(e.interpolate,e.interpolateGamma)):Qt(t.round)?t.round(r):Qt(t.rangeRound)&&t.interpolate(r?wm:vc),s&&t.range(TF(s,e.reverse))}function f8t(t,e,n){t!==Dnt&&t!==hF&&q("Only band and point scales support rangeStep.");var i=(e.paddingOuter!=null?e.paddingOuter:e.padding)||0,r=t===hF?1:(e.paddingInner!=null?e.paddingInner:e.padding)||0;return[0,e.rangeStep*JN(n,r,i)]}function d8t(t,e,n){var i=e.schemeExtent,r,s;return W(e.scheme)?s=_A(e.scheme,e.interpolate,e.interpolateGamma):(r=e.scheme.toLowerCase(),s=rO(r),s||q(`Unrecognized scheme name: ${e.scheme}`)),n=t===wA?n+1:t===ZN?n-1:t===Gg||t===vA?+e.schemeCount||e8t:n,Pnt(t)?j9(s,i,e.reverse):Qt(s)?jnt(j9(s,i),n):t===QN?s:s.slice(0,n)}function j9(t,e,n){return Qt(t)&&(e||n)?Unt(t,TF(e||[0,1],n)):t}function TF(t,e){return e?t.slice().reverse():t}function $rt(t){z.call(this,null,t)}J($rt,z,{transform(t,e){const n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(Ah(t.sort)),this.modified(n),e}});const q9="zero",Irt="center",Mrt="normalize",Trt=["y0","y1"];function YO(t){z.call(this,null,t)}YO.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:q9,values:[q9,Irt,Mrt]},{name:"as",type:"string",array:!0,length:2,default:Trt}]};J(YO,z,{transform(t,e){var n=t.as||Trt,i=n[0],r=n[1],s=Ah(t.sort),o=t.field||Bm,a=t.offset===Irt?h8t:t.offset===Mrt?p8t:g8t,u,c,l,f;for(u=m8t(e.source,t.groupby,s,o),c=0,l=u.length,f=u.max;c<l;++c)a(u[c],f,o,i,r);return e.reflow(t.modified()).modifies(n)}});function h8t(t,e,n,i,r){for(var s=(e-t.sum)/2,o=t.length,a=0,u;a<o;++a)u=t[a],u[i]=s,u[r]=s+=Math.abs(n(u))}function p8t(t,e,n,i,r){for(var s=1/t.sum,o=0,a=t.length,u=0,c=0,l;u<a;++u)l=t[u],l[i]=o,l[r]=o=s*(c+=Math.abs(n(l)))}function g8t(t,e,n,i,r){for(var s=0,o=0,a=t.length,u=0,c,l;u<a;++u)l=t[u],c=+n(l),c<0?(l[i]=o,l[r]=o+=c):(l[i]=s,l[r]=s+=c)}function m8t(t,e,n,i){var r=[],s=g=>g(l),o,a,u,c,l,f,d,h,p;if(e==null)r.push(t.slice());else for(o={},a=0,u=t.length;a<u;++a)l=t[a],f=e.map(s),d=o[f],d||(o[f]=d=[],r.push(d)),d.push(l);for(f=0,p=0,c=r.length;f<c;++f){for(d=r[f],a=0,h=0,u=d.length;a<u;++a)h+=Math.abs(i(d[a]));d.sum=h,h>p&&(p=h),n&&d.sort(n)}return r.max=p,r}const y8t=Object.freeze(Object.defineProperty({__proto__:null,axisticks:mrt,datajoin:yrt,encode:brt,legendentries:vrt,linkpath:WO,pie:GO,scale:Ert,sortitems:$rt,stack:YO},Symbol.toStringTag,{value:"Module"}));var b8t=Math.abs,FF=Math.cos,lS=Math.sin,v8t=1e-6,Frt=Math.PI,kF=Frt/2,V9=w8t(2);function W9(t){return t>1?kF:t<-1?-kF:Math.asin(t)}function w8t(t){return t>0?Math.sqrt(t):0}function _8t(t,e){var n=t*lS(e),i=30,r;do e-=r=(e+lS(e)-n)/(1+FF(e));while(b8t(r)>v8t&&--i>0);return e/2}function x8t(t,e,n){function i(r,s){return[t*r*FF(s=_8t(n,s)),e*lS(s)]}return i.invert=function(r,s){return s=W9(s/e),[r/(t*FF(s)),W9((2*s+lS(2*s))/n)]},i}var S8t=x8t(V9/kF,V9,Frt);function E8t(){return Xa(S8t).scale(169.529)}const A8t=Ha(),DF=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function $8t(t,e){return function n(){const i=e();return i.type=t,i.path=Ha().projection(i),i.copy=i.copy||function(){const r=n();return DF.forEach(s=>{i[s]&&r[s](i[s]())}),r.path.pointRadius(i.path.pointRadius()),r},Rnt(i)}}function HO(t,e){if(!t||typeof t!="string")throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(fS[t]=$8t(t,e),this):fS[t]||null}function krt(t){return t&&t.path||A8t}const fS={albers:JD,albersusa:HY,azimuthalequalarea:JY,azimuthalequidistant:ZY,conicconformal:nH,conicequalarea:v1,conicequidistant:rH,equalEarth:oH,equirectangular:iH,gnomonic:uH,identity:K2t,mercator:tH,mollweide:E8t,naturalEarth1:J2t,orthographic:fH,stereographic:hH,transversemercator:gH};for(const t in fS)HO(t,fS[t]);function I8t(){}const yu=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Drt(){var t=1,e=1,n=a;function i(u,c){return c.map(l=>r(u,l))}function r(u,c){var l=[],f=[];return s(u,c,d=>{n(d,u,c),M8t(d)>0?l.push([d]):f.push(d)}),f.forEach(d=>{for(var h=0,p=l.length,g;h<p;++h)if(T8t((g=l[h])[0],d)!==-1){g.push(d);return}}),{type:"MultiPolygon",value:c,coordinates:l}}function s(u,c,l){var f=new Array,d=new Array,h,p,g,m,y,b;for(h=p=-1,m=u[0]>=c,yu[m<<1].forEach(v);++h<t-1;)g=m,m=u[h+1]>=c,yu[g|m<<1].forEach(v);for(yu[m<<0].forEach(v);++p<e-1;){for(h=-1,m=u[p*t+t]>=c,y=u[p*t]>=c,yu[m<<1|y<<2].forEach(v);++h<t-1;)g=m,m=u[p*t+t+h+1]>=c,b=y,y=u[p*t+h+1]>=c,yu[g|m<<1|y<<2|b<<3].forEach(v);yu[m|y<<3].forEach(v)}for(h=-1,y=u[p*t]>=c,yu[y<<2].forEach(v);++h<t-1;)b=y,y=u[p*t+h+1]>=c,yu[y<<2|b<<3].forEach(v);yu[y<<3].forEach(v);function v(w){var _=[w[0][0]+h,w[0][1]+p],S=[w[1][0]+h,w[1][1]+p],x=o(_),E=o(S),A,$;(A=d[x])?($=f[E])?(delete d[A.end],delete f[$.start],A===$?(A.ring.push(S),l(A.ring)):f[A.start]=d[$.end]={start:A.start,end:$.end,ring:A.ring.concat($.ring)}):(delete d[A.end],A.ring.push(S),d[A.end=E]=A):(A=f[E])?($=d[x])?(delete f[A.start],delete d[$.end],A===$?(A.ring.push(S),l(A.ring)):f[$.start]=d[A.end]={start:$.start,end:A.end,ring:$.ring.concat(A.ring)}):(delete f[A.start],A.ring.unshift(_),f[A.start=x]=A):f[x]=d[E]={start:x,end:E,ring:[_,S]}}}function o(u){return u[0]*2+u[1]*(t+1)*4}function a(u,c,l){u.forEach(f=>{var d=f[0],h=f[1],p=d|0,g=h|0,m,y=c[g*t+p];d>0&&d<t&&p===d&&(m=c[g*t+p-1],f[0]=d+(l-m)/(y-m)-.5),h>0&&h<e&&g===h&&(m=c[(g-1)*t+p],f[1]=h+(l-m)/(y-m)-.5)})}return i.contour=r,i.size=function(u){if(!arguments.length)return[t,e];var c=Math.floor(u[0]),l=Math.floor(u[1]);return c>=0&&l>=0||q("invalid size"),t=c,e=l,i},i.smooth=function(u){return arguments.length?(n=u?a:I8t,i):n===a},i}function M8t(t){for(var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}function T8t(t,e){for(var n=-1,i=e.length,r;++n<i;)if(r=F8t(t,e[n]))return r;return 0}function F8t(t,e){for(var n=e[0],i=e[1],r=-1,s=0,o=t.length,a=o-1;s<o;a=s++){var u=t[s],c=u[0],l=u[1],f=t[a],d=f[0],h=f[1];if(k8t(u,f,e))return 0;l>i!=h>i&&n<(d-c)*(i-l)/(h-l)+c&&(r=-r)}return r}function k8t(t,e,n){var i;return D8t(t,e,n)&&C8t(t[i=+(t[0]===e[0])],n[i],e[i])}function D8t(t,e,n){return(e[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(e[1]-t[1])}function C8t(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}function Crt(t,e,n){return function(i){var r=Ua(i),s=n?Math.min(r[0],0):r[0],o=r[1],a=o-s,u=e?Dl(s,o,t):a/(t+1);return Un(s+u,o,u)}}function XO(t){z.call(this,null,t)}XO.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};J(XO,z,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,r=t.field||Li,s=Drt().smooth(t.smooth!==!1),o=t.thresholds||N8t(i,r,t),a=t.as===null?null:t.as||"contour",u=[];return i.forEach(c=>{const l=r(c),f=s.size([l.width,l.height])(l.values,W(o)?o:o(l.values));O8t(f,l,c,t),f.forEach(d=>{u.push(cA(c,Ae(a!=null?{[a]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function N8t(t,e,n){const i=Crt(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(t.map(r=>tn(e(r).values)))}function O8t(t,e,n,i){let r=i.scale||e.scale,s=i.translate||e.translate;if(Qt(r)&&(r=r(n,i)),Qt(s)&&(s=s(n,i)),(r===1||r==null)&&!s)return;const o=(be(r)?r:r[0])||1,a=(be(r)?r:r[1])||1,u=s&&s[0]||0,c=s&&s[1]||0;t.forEach(Nrt(e,o,a,u,c))}function Nrt(t,e,n,i,r){const s=t.x1||0,o=t.y1||0,a=e*n<0;function u(f){f.forEach(c)}function c(f){a&&f.reverse(),f.forEach(l)}function l(f){f[0]=(f[0]-s)*e+i,f[1]=(f[1]-o)*n+r}return function(f){return f.coordinates.forEach(u),f}}function G9(t,e,n){const i=t>=0?t:fN(e,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function v3(t){return Qt(t)?t:Bi(+t)}function Ort(){var t=u=>u[0],e=u=>u[1],n=Bm,i=[-1,-1],r=960,s=500,o=2;function a(u,c){const l=G9(i[0],u,t)>>o,f=G9(i[1],u,e)>>o,d=l?l+2:0,h=f?f+2:0,p=2*d+(r>>o),g=2*h+(s>>o),m=new Float32Array(p*g),y=new Float32Array(p*g);let b=m;u.forEach(w=>{const _=d+(+t(w)>>o),S=h+(+e(w)>>o);_>=0&&_<p&&S>=0&&S<g&&(m[_+S*p]+=+n(w))}),l>0&&f>0?(ip(p,g,m,y,l),rp(p,g,y,m,f),ip(p,g,m,y,l),rp(p,g,y,m,f),ip(p,g,m,y,l),rp(p,g,y,m,f)):l>0?(ip(p,g,m,y,l),ip(p,g,y,m,l),ip(p,g,m,y,l),b=y):f>0&&(rp(p,g,m,y,f),rp(p,g,y,m,f),rp(p,g,m,y,f),b=y);const v=c?Math.pow(2,-2*o):1/Ls(b);for(let w=0,_=p*g;w<_;++w)b[w]*=v;return{values:b,scale:1<<o,width:p,height:g,x1:d,y1:h,x2:d+(r>>o),y2:h+(s>>o)}}return a.x=function(u){return arguments.length?(t=v3(u),a):t},a.y=function(u){return arguments.length?(e=v3(u),a):e},a.weight=function(u){return arguments.length?(n=v3(u),a):n},a.size=function(u){if(!arguments.length)return[r,s];var c=+u[0],l=+u[1];return c>=0&&l>=0||q("invalid size"),r=c,s=l,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||q("invalid cell size"),o=Math.floor(Math.log(u)/Math.LN2),a):1<<o},a.bandwidth=function(u){return arguments.length?(u=ot(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&q("invalid bandwidth"),i=u,a):i},a}function ip(t,e,n,i,r){const s=(r<<1)+1;for(let o=0;o<e;++o)for(let a=0,u=0;a<t+r;++a)a<t&&(u+=n[a+o*t]),a>=r&&(a>=s&&(u-=n[a-s+o*t]),i[a-r+o*t]=u/Math.min(a+1,t-1+s-a,s))}function rp(t,e,n,i,r){const s=(r<<1)+1;for(let o=0;o<t;++o)for(let a=0,u=0;a<e+r;++a)a<e&&(u+=n[o+a*t]),a>=r&&(a>=s&&(u-=n[o+(a-s)*t]),i[o+(a-r)*t]=u/Math.min(a+1,e-1+s-a,s))}function KO(t){z.call(this,null,t)}KO.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const R8t=["x","y","weight","size","cellSize","bandwidth"];function Rrt(t,e){return R8t.forEach(n=>e[n]!=null?t[n](e[n]):0),t}J(KO,z,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,r=L8t(i,t.groupby),s=(t.groupby||[]).map(En),o=Rrt(Ort(),t),a=t.as||"grid",u=[];function c(l,f){for(let d=0;d<s.length;++d)l[s[d]]=f[d];return l}return u=r.map(l=>Ae(c({[a]:o(l,t.counts)},l.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function L8t(t,e){var n=[],i=l=>l(a),r,s,o,a,u,c;if(e==null)n.push(t);else for(r={},s=0,o=t.length;s<o;++s)a=t[s],u=e.map(i),c=r[u],c||(r[u]=c=[],c.dims=u,n.push(c)),c.push(a);return n}function JO(t){z.call(this,null,t)}JO.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};J(JO,z,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=Drt().smooth(t.smooth!==!1),r=t.values,s=t.thresholds||Crt(t.count||10,t.nice,!!r),o=t.size,a,u;return r||(r=e.materialize(e.SOURCE).source,a=Rrt(Ort(),t)(r,!0),u=Nrt(a,a.scale||1,a.scale||1,0,0),o=[a.width,a.height],r=a.values),s=W(s)?s:s(r),r=i.size(o)(r,s),u&&r.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(Ae),n}});const CF="Feature",QO="FeatureCollection",B8t="MultiPoint";function ZO(t){z.call(this,null,t)}ZO.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};J(ZO,z,{transform(t,e){var n=this._features,i=this._points,r=t.fields,s=r&&r[0],o=r&&r[1],a=t.geojson||!r&&Li,u=e.ADD,c;c=t.modified()||e.changed(e.REM)||e.modified(Ci(a))||s&&e.modified(Ci(s))||o&&e.modified(Ci(o)),(!this.value||c)&&(u=e.SOURCE,this._features=n=[],this._points=i=[]),a&&e.visit(u,l=>n.push(a(l))),s&&o&&(e.visit(u,l=>{var f=s(l),d=o(l);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:CF,geometry:{type:B8t,coordinates:i}})),this.value={type:QO,features:n}}});function tR(t){z.call(this,null,t)}tR.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};J(tR,z,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.field||Li,s=t.as||"path",o=n.SOURCE;!i||t.modified()?(this.value=i=krt(t.projection),n.materialize().reflow()):o=r===Li||e.modified(r.fields)?n.ADD_MOD:n.ADD;const a=P8t(i,t.pointRadius);return n.visit(o,u=>u[s]=i(r(u))),i.pointRadius(a),n.modifies(s)}});function P8t(t,e){const n=t.pointRadius();return t.context(null),e!=null&&t.pointRadius(e),n}function eR(t){z.call(this,null,t)}eR.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};J(eR,z,{transform(t,e){var n=t.projection,i=t.fields[0],r=t.fields[1],s=t.as||["x","y"],o=s[0],a=s[1],u;function c(l){const f=n([i(l),r(l)]);f?(l[o]=f[0],l[a]=f[1]):(l[o]=void 0,l[a]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,c):(u=e.modified(i.fields)||e.modified(r.fields),e.visit(u?e.ADD_MOD:e.ADD,c)),e.modifies(s)}});function nR(t){z.call(this,null,t)}nR.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};J(nR,z,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.as||"shape",s=n.ADD;return(!i||t.modified())&&(this.value=i=z8t(krt(t.projection),t.field||Vs("datum"),t.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,o=>o[r]=i),n.modifies(r)}});function z8t(t,e,n){const i=n==null?r=>t(e(r)):r=>{var s=t.pointRadius(),o=t.pointRadius(n)(e(r));return t.pointRadius(s),o};return i.context=r=>(t.context(r),i),i}function iR(t){z.call(this,[],t),this.generator=OY()}iR.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};J(iR,z,{transform(t,e){var n=this.value,i=this.generator,r;if(!n.length||t.modified())for(const s in t)Qt(i[s])&&i[s](t[s]);return r=i(),n.length?e.mod.push(zet(n[0],r)):e.add.push(Ae(r)),n[0]=r,e}});function rR(t){z.call(this,null,t)}rR.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};J(rR,z,{transform(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,i=t.resolve==="shared",r=t.field||Li,s=j8t(t.opacity,t),o=U8t(t.color,t),a=t.as||"image",u={$x:0,$y:0,$value:0,$max:i?tn(n.map(c=>tn(r(c).values))):0};return n.forEach(c=>{const l=r(c),f=Jt({},c,u);i||(f.$max=tn(l.values||[])),c[a]=q8t(l,f,o.dep?o:Bi(o(f)),s.dep?s:Bi(s(f)))}),e.reflow(!0).modifies(a)}});function U8t(t,e){let n;return Qt(t)?(n=i=>Nr(t(i,e)),n.dep=Lrt(t)):n=Bi(Nr(t||"#888")),n}function j8t(t,e){let n;return Qt(t)?(n=i=>t(i,e),n.dep=Lrt(t)):t?n=Bi(t):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function Lrt(t){if(!Qt(t))return!1;const e=Mo(Ci(t));return e.$x||e.$y||e.$value||e.$max}function q8t(t,e,n,i){const r=t.width,s=t.height,o=t.x1||0,a=t.y1||0,u=t.x2||r,c=t.y2||s,l=t.values,f=l?m=>l[m]:tl,d=yl(u-o,c-a),h=d.getContext("2d"),p=h.getImageData(0,0,u-o,c-a),g=p.data;for(let m=a,y=0;m<c;++m){e.$y=m-a;for(let b=o,v=m*r;b<u;++b,y+=4){e.$x=b-o,e.$value=f(b+v);const w=n(e);g[y+0]=w.r,g[y+1]=w.g,g[y+2]=w.b,g[y+3]=~~(255*i(e))}}return h.putImageData(p,0,0),d}function Brt(t){z.call(this,null,t),this.modified(!0)}J(Brt,z,{transform(t,e){let n=this.value;return!n||t.modified("type")?(this.value=n=W8t(t.type),DF.forEach(i=>{t[i]!=null&&Y9(n,i,t[i])})):DF.forEach(i=>{t.modified(i)&&Y9(n,i,t[i])}),t.pointRadius!=null&&n.path.pointRadius(t.pointRadius),t.fit&&V8t(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function V8t(t,e){const n=G8t(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}function W8t(t){const e=HO((t||"mercator").toLowerCase());return e||q("Unrecognized projection type: "+t),e()}function Y9(t,e,n){Qt(t[e])&&t[e](n)}function G8t(t){return t=ot(t),t.length===1?t[0]:{type:QO,features:t.reduce((e,n)=>e.concat(Y8t(n)),[])}}function Y8t(t){return t.type===QO?t.features:ot(t).filter(e=>e!=null).map(e=>e.type===CF?e:{type:CF,geometry:e})}const H8t=Object.freeze(Object.defineProperty({__proto__:null,contour:JO,geojson:ZO,geopath:tR,geopoint:eR,geoshape:nR,graticule:iR,heatmap:rR,isocontour:XO,kde2d:KO,projection:Brt},Symbol.toStringTag,{value:"Module"})),H9={center:ywt,collide:Rwt,nbody:Ywt,link:Bwt,x:Hwt,y:Xwt},vy="forces",NF=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],X8t=["static","iterations"],Prt=["x","y","vx","vy"];function sR(t){z.call(this,null,t)}sR.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Prt}]};J(sR,z,{transform(t,e){var n=this.value,i=e.changed(e.ADD_REM),r=t.modified(NF),s=t.iterations||300;if(n?(i&&(e.modifies("index"),n.nodes(e.source)),(r||e.changed(e.MOD))&&zrt(n,t,0,e)):(this.value=n=J8t(e.source,t),n.on("tick",K8t(e.dataflow,this)),t.static||(i=!0,n.tick()),e.modifies("index")),r||i||t.modified(X8t)||e.changed()&&t.restart){if(n.alpha(Math.max(n.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),t.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return e.StopPropagation}return this.finish(t,e)},finish(t,e){const n=e.dataflow;for(let a=this._argops,u=0,c=a.length,l;u<c;++u)if(l=a[u],!(l.name!==vy||l.op._argval.force!=="link")){for(var i=l.op._argops,r=0,s=i.length,o;r<s;++r)if(i[r].name==="links"&&(o=i[r].op.source)){n.pulse(o,n.changeset().reflow());break}}return e.reflow(t.modified()).modifies(Prt)}});function K8t(t,e){return()=>t.touch(e).run()}function J8t(t,e){const n=Gwt(t),i=n.stop,r=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,r()),n.stop=()=>(s=!0,i()),zrt(n,e,!0).on("end",()=>s=!0)}function zrt(t,e,n,i){var r=ot(e.forces),s,o,a,u;for(s=0,o=NF.length;s<o;++s)a=NF[s],a!==vy&&e.modified(a)&&t[a](e[a]);for(s=0,o=r.length;s<o;++s)u=vy+s,a=n||e.modified(vy,s)?Z8t(r[s]):i&&Q8t(r[s],i)?t.force(u):null,a&&t.force(u,a);for(o=t.numForces||0;s<o;++s)t.force(vy+s,null);return t.numForces=r.length,t}function Q8t(t,e){var n,i;for(n in t)if(Qt(i=t[n])&&e.modified(Ci(i)))return 1;return 0}function Z8t(t){var e,n;xt(H9,t.force)||q("Unrecognized force: "+t.force),e=H9[t.force]();for(n in t)Qt(e[n])&&t4t(e[n],t[n],t);return e}function t4t(t,e,n){t(Qt(e)?i=>e(i,n):e)}const e4t=Object.freeze(Object.defineProperty({__proto__:null,force:sR},Symbol.toStringTag,{value:"Module"}));function OF(t,e,n){const i={};return t.each(r=>{const s=r.data;n(s)&&(i[e(s)]=r)}),t.lookup=i,t}function oR(t){z.call(this,null,t)}oR.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const n4t=t=>t.values;J(oR,z,{transform(t,e){e.source||q("Nest transform requires an upstream data source.");var n=t.generate,i=t.modified(),r=e.clone(),s=this.value;return(!s||i||e.changed())&&(s&&s.each(o=>{o.children&&uA(o.data)&&r.rem.push(o.data)}),this.value=s=ZD({values:ot(t.keys).reduce((o,a)=>(o.key(a),o),i4t()).entries(r.source)},n4t),n&&s.each(o=>{o.children&&(o=Ae(o.data),r.add.push(o),r.source.push(o))}),OF(s,wt,wt)),r.source.root=s,r}});function i4t(){const t=[],e={entries:r=>i(n(r,0),0),key:r=>(t.push(r),e)};function n(r,s){if(s>=t.length)return r;const o=r.length,a=t[s++],u={},c={};let l=-1,f,d,h;for(;++l<o;)f=a(d=r[l])+"",(h=u[f])?h.push(d):u[f]=[d];for(f in u)c[f]=n(u[f],s);return c}function i(r,s){if(++s>t.length)return r;const o=[];for(const a in r)o.push({key:a,values:i(r[a],s)});return o}return e}function Ac(t){z.call(this,null,t)}const r4t=(t,e)=>t.parent===e.parent?1:2;J(Ac,z,{transform(t,e){(!e.source||!e.source.root)&&q(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(t.method),i=this.fields,r=e.source.root,s=t.as||i;t.field?r.sum(t.field):r.count(),t.sort&&r.sort(Ah(t.sort,o=>o.data)),s4t(n,this.params,t),n.separation&&n.separation(t.separation!==!1?r4t:Bm);try{this.value=n(r)}catch(o){q(o)}return r.each(o=>o4t(o,i,s)),e.reflow(t.modified()).modifies(s).modifies("leaf")}});function s4t(t,e,n){for(let i,r=0,s=e.length;r<s;++r)i=e[r],i in n&&t[i](n[i])}function o4t(t,e,n){const i=t.data,r=e.length-1;for(let s=0;s<r;++s)i[n[s]]=t[e[s]];i[n[r]]=t.children?t.children.length:0}const RF=["x","y","r","depth","children"];function aR(t){Ac.call(this,t)}aR.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:RF.length,default:RF}]};J(aR,Ac,{layout:O_t,params:["radius","size","padding"],fields:RF});const LF=["x0","y0","x1","y1","depth","children"];function uR(t){Ac.call(this,t)}uR.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:LF.length,default:LF}]};J(uR,Ac,{layout:R_t,params:["size","round","padding"],fields:LF});function cR(t){z.call(this,null,t)}cR.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};J(cR,z,{transform(t,e){e.source||q("Stratify transform requires an upstream data source.");let n=this.value;const i=t.modified(),r=e.fork(e.ALL).materialize(e.SOURCE),s=!n||i||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return r.source=r.source.slice(),s&&(n=r.source.length?OF(vx().id(t.key).parentId(t.parentKey)(r.source),t.key,Ws):OF(vx()([{}]),t.key,t.key)),r.source.root=this.value=n,r}});const X9={tidy:w1,cluster:QD},BF=["x","y","depth","children"];function lR(t){Ac.call(this,t)}lR.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:BF.length,default:BF}]};J(lR,Ac,{layout(t){const e=t||"tidy";if(xt(X9,e))return X9[e]();q("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:BF});function fR(t){z.call(this,[],t)}fR.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};J(fR,z,{transform(t,e){const n=this.value,i=e.source&&e.source.root,r=e.fork(e.NO_SOURCE),s={};return i||q("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(r.rem=n,e.visit(e.SOURCE,o=>s[wt(o)]=1),i.each(o=>{const a=o.data,u=o.parent&&o.parent.data;u&&s[wt(a)]&&s[wt(u)]&&r.add.push(Ae({source:u,target:a}))}),this.value=r.add):e.changed(e.MOD)&&(e.visit(e.MOD,o=>s[wt(o)]=1),n.forEach(o=>{(s[wt(o.source)]||s[wt(o.target)])&&r.mod.push(o)})),r}});const K9={binary:Y_t,dice:_b,slice:dE,slicedice:H_t,squarify:SH,resquarify:X_t},PF=["x0","y0","x1","y1","depth","children"];function dR(t){Ac.call(this,t)}dR.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:PF.length,default:PF}]};J(dR,Ac,{layout(){const t=G_t();return t.ratio=e=>{const n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=e=>{xt(K9,e)?t.tile(K9[e]):q("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:PF});const a4t=Object.freeze(Object.defineProperty({__proto__:null,nest:oR,pack:aR,partition:uR,stratify:cR,tree:lR,treelinks:fR,treemap:dR},Symbol.toStringTag,{value:"Module"})),w3=4278190080;function u4t(t,e){const n=t.bitmap();return(e||[]).forEach(i=>n.set(t(i.boundary[0]),t(i.boundary[3]))),[n,void 0]}function c4t(t,e,n,i,r){const s=t.width,o=t.height,a=i||r,u=yl(s,o).getContext("2d"),c=yl(s,o).getContext("2d"),l=a&&yl(s,o).getContext("2d");n.forEach(E=>v2(u,E,!1)),v2(c,e,!1),a&&v2(l,e,!0);const f=_3(u,s,o),d=_3(c,s,o),h=a&&_3(l,s,o),p=t.bitmap(),g=a&&t.bitmap();let m,y,b,v,w,_,S,x;for(y=0;y<o;++y)for(m=0;m<s;++m)w=y*s+m,_=f[w]&w3,x=d[w]&w3,S=a&&h[w]&w3,(_||S||x)&&(b=t(m),v=t(y),!r&&(_||x)&&p.set(b,v),a&&(_||S)&&g.set(b,v));return[p,g]}function _3(t,e,n){return new Uint32Array(t.getImageData(0,0,e,n).data.buffer)}function v2(t,e,n){if(!e.length)return;const i=e[0].mark.marktype;i==="group"?e.forEach(r=>{r.items.forEach(s=>v2(t,s.items,n))}):ls[i].draw(t,{items:n?e.map(l4t):e})}function l4t(t){const e=cA(t,{});return e.stroke&&e.strokeOpacity!==0||e.fill&&e.fillOpacity!==0?{...e,strokeOpacity:1,stroke:"#000",fillOpacity:0}:e}const bu=5,zi=31,U1=32,Kc=new Uint32Array(U1+1),lo=new Uint32Array(U1+1);lo[0]=0;Kc[0]=~lo[0];for(let t=1;t<=U1;++t)lo[t]=lo[t-1]<<1|1,Kc[t]=~lo[t];function f4t(t,e){const n=new Uint32Array(~~((t*e+U1)/U1));function i(s,o){n[s]|=o}function r(s,o){n[s]&=o}return{array:n,get:(s,o)=>{const a=o*t+s;return n[a>>>bu]&1<<(a&zi)},set:(s,o)=>{const a=o*t+s;i(a>>>bu,1<<(a&zi))},clear:(s,o)=>{const a=o*t+s;r(a>>>bu,~(1<<(a&zi)))},getRange:(s,o,a,u)=>{let c=u,l,f,d,h;for(;c>=o;--c)if(l=c*t+s,f=c*t+a,d=l>>>bu,h=f>>>bu,d===h){if(n[d]&Kc[l&zi]&lo[(f&zi)+1])return!0}else{if(n[d]&Kc[l&zi]||n[h]&lo[(f&zi)+1])return!0;for(let p=d+1;p<h;++p)if(n[p])return!0}return!1},setRange:(s,o,a,u)=>{let c,l,f,d,h;for(;o<=u;++o)if(c=o*t+s,l=o*t+a,f=c>>>bu,d=l>>>bu,f===d)i(f,Kc[c&zi]&lo[(l&zi)+1]);else for(i(f,Kc[c&zi]),i(d,lo[(l&zi)+1]),h=f+1;h<d;++h)i(h,4294967295)},clearRange:(s,o,a,u)=>{let c,l,f,d,h;for(;o<=u;++o)if(c=o*t+s,l=o*t+a,f=c>>>bu,d=l>>>bu,f===d)r(f,lo[c&zi]|Kc[(l&zi)+1]);else for(r(f,lo[c&zi]),r(d,Kc[(l&zi)+1]),h=f+1;h<d;++h)r(h,0)},outOfBounds:(s,o,a,u)=>s<0||o<0||u>=e||a>=t}}function d4t(t,e,n){const i=Math.max(1,Math.sqrt(t*e/1e6)),r=~~((t+2*n+i)/i),s=~~((e+2*n+i)/i),o=a=>~~((a+n)/i);return o.invert=a=>a*i-n,o.bitmap=()=>f4t(r,s),o.ratio=i,o.padding=n,o.width=t,o.height=e,o}function h4t(t,e,n,i){const r=t.width,s=t.height;return function(o){const a=o.datum.datum.items[i].items,u=a.length,c=o.datum.fontSize,l=is.width(o.datum,o.datum.text);let f=0,d,h,p,g,m,y,b;for(let v=0;v<u;++v)d=a[v].x,p=a[v].y,h=a[v].x2===void 0?d:a[v].x2,g=a[v].y2===void 0?p:a[v].y2,m=(d+h)/2,y=(p+g)/2,b=Math.abs(h-d+g-p),b>=f&&(f=b,o.x=m,o.y=y);return m=l/2,y=c/2,d=o.x-m,h=o.x+m,p=o.y-y,g=o.y+y,o.align="center",d<0&&h<=r?o.align="left":0<=d&&r<h&&(o.align="right"),o.baseline="middle",p<0&&g<=s?o.baseline="top":0<=p&&s<g&&(o.baseline="bottom"),!0}}function dS(t,e,n,i,r,s){let o=n/2;return t-o<0||t+o>r||e-(o=i/2)<0||e+o>s}function fl(t,e,n,i,r,s,o,a){const u=r*s/(i*2),c=t(e-u),l=t(e+u),f=t(n-(s=s/2)),d=t(n+s);return o.outOfBounds(c,f,l,d)||o.getRange(c,f,l,d)||a&&a.getRange(c,f,l,d)}function p4t(t,e,n,i){const r=t.width,s=t.height,o=e[0],a=e[1];function u(c,l,f,d,h){const p=t.invert(c),g=t.invert(l);let m=f,y=s,b;if(!dS(p,g,d,h,r,s)&&!fl(t,p,g,h,d,m,o,a)&&!fl(t,p,g,h,d,h,o,null)){for(;y-m>=1;)b=(m+y)/2,fl(t,p,g,h,d,b,o,a)?y=b:m=b;if(m>f)return[p,g,m,!0]}}return function(c){const l=c.datum.datum.items[i].items,f=l.length,d=c.datum.fontSize,h=is.width(c.datum,c.datum.text);let p=n?d:0,g=!1,m=!1,y=0,b,v,w,_,S,x,E,A,$,I,k,T,M,F,D,N,R;for(let L=0;L<f;++L){for(b=l[L].x,w=l[L].y,v=l[L].x2===void 0?b:l[L].x2,_=l[L].y2===void 0?w:l[L].y2,b>v&&(R=b,b=v,v=R),w>_&&(R=w,w=_,_=R),$=t(b),k=t(v),I=~~(($+k)/2),T=t(w),F=t(_),M=~~((T+F)/2),E=I;E>=$;--E)for(A=M;A>=T;--A)N=u(E,A,p,h,d),N&&([c.x,c.y,p,g]=N);for(E=I;E<=k;++E)for(A=M;A<=F;++A)N=u(E,A,p,h,d),N&&([c.x,c.y,p,g]=N);!g&&!n&&(D=Math.abs(v-b+_-w),S=(b+v)/2,x=(w+_)/2,D>=y&&!dS(S,x,h,d,r,s)&&!fl(t,S,x,d,h,d,o,null)&&(y=D,c.x=S,c.y=x,m=!0))}return g||m?(S=h/2,x=d/2,o.setRange(t(c.x-S),t(c.y-x),t(c.x+S),t(c.y+x)),c.align="center",c.baseline="middle",!0):!1}}const g4t=[-1,-1,1,1],m4t=[-1,1,-1,1];function y4t(t,e,n,i){const r=t.width,s=t.height,o=e[0],a=e[1],u=t.bitmap();return function(c){const l=c.datum.datum.items[i].items,f=l.length,d=c.datum.fontSize,h=is.width(c.datum,c.datum.text),p=[];let g=n?d:0,m=!1,y=!1,b=0,v,w,_,S,x,E,A,$,I,k,T,M;for(let F=0;F<f;++F){for(v=l[F].x,_=l[F].y,w=l[F].x2===void 0?v:l[F].x2,S=l[F].y2===void 0?_:l[F].y2,p.push([t((v+w)/2),t((_+S)/2)]);p.length;)if([A,$]=p.pop(),!(o.get(A,$)||a.get(A,$)||u.get(A,$))){u.set(A,$);for(let D=0;D<4;++D)x=A+g4t[D],E=$+m4t[D],u.outOfBounds(x,E,x,E)||p.push([x,E]);if(x=t.invert(A),E=t.invert($),I=g,k=s,!dS(x,E,h,d,r,s)&&!fl(t,x,E,d,h,I,o,a)&&!fl(t,x,E,d,h,d,o,null)){for(;k-I>=1;)T=(I+k)/2,fl(t,x,E,d,h,T,o,a)?k=T:I=T;I>g&&(c.x=x,c.y=E,g=I,m=!0)}}!m&&!n&&(M=Math.abs(w-v+S-_),x=(v+w)/2,E=(_+S)/2,M>=b&&!dS(x,E,h,d,r,s)&&!fl(t,x,E,d,h,d,o,null)&&(b=M,c.x=x,c.y=E,y=!0))}return m||y?(x=h/2,E=d/2,o.setRange(t(c.x-x),t(c.y-E),t(c.x+x),t(c.y+E)),c.align="center",c.baseline="middle",!0):!1}}const b4t=["right","center","left"],v4t=["bottom","middle","top"];function w4t(t,e,n,i){const r=t.width,s=t.height,o=e[0],a=e[1],u=i.length;return function(c){const l=c.boundary,f=c.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>r||l[3]>s)return!1;let d=c.textWidth??0,h,p,g,m,y,b,v,w,_,S,x,E,A,$,I;for(let k=0;k<u;++k){if(h=(n[k]&3)-1,p=(n[k]>>>2&3)-1,g=h===0&&p===0||i[k]<0,m=h&&p?Math.SQRT1_2:1,y=i[k]<0?-1:1,b=l[1+h]+i[k]*h*m,x=l[4+p]+y*f*p/2+i[k]*p*m,w=x-f/2,_=x+f/2,E=t(b),$=t(w),I=t(_),!d)if(J9(E,E,$,I,o,a,b,b,w,_,l,g))d=is.width(c.datum,c.datum.text);else continue;if(S=b+y*d*h/2,b=S-d/2,v=S+d/2,E=t(b),A=t(v),J9(E,A,$,I,o,a,b,v,w,_,l,g))return c.x=h?h*y<0?v:b:S,c.y=p?p*y<0?_:w:x,c.align=b4t[h*y+1],c.baseline=v4t[p*y+1],o.setRange(E,$,A,I),!0}return!1}}function J9(t,e,n,i,r,s,o,a,u,c,l,f){return!(r.outOfBounds(t,n,e,i)||(f&&s||r).getRange(t,n,e,i))}const x3=0,S3=4,E3=8,A3=0,$3=1,I3=2,_4t={"top-left":x3+A3,top:x3+$3,"top-right":x3+I3,left:S3+A3,middle:S3+$3,right:S3+I3,"bottom-left":E3+A3,bottom:E3+$3,"bottom-right":E3+I3},x4t={naive:h4t,"reduced-search":p4t,floodfill:y4t};function S4t(t,e,n,i,r,s,o,a,u,c,l){if(!t.length)return t;const f=Math.max(i.length,r.length),d=E4t(i,f),h=A4t(r,f),p=$4t(t[0].datum),g=p==="group"&&t[0].datum.items[u].marktype,m=g==="area",y=I4t(p,g,a,u),b=c===null||c===1/0,v=m&&l==="naive";let w=-1,_=-1;const S=t.map($=>{const I=b?is.width($,$.text):void 0;return w=Math.max(w,I),_=Math.max(_,$.fontSize),{datum:$,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y($),textWidth:I}});c=c===null||c===1/0?Math.max(w,_)+Math.max(...i):c;const x=d4t(e[0],e[1],c);let E;if(!v){n&&S.sort((k,T)=>n(k.datum,T.datum));let $=!1;for(let k=0;k<h.length&&!$;++k)$=h[k]===5||d[k]<0;const I=(p&&o||m)&&t.map(k=>k.datum);E=s.length||I?c4t(x,I||[],s,$,m):u4t(x,o&&S)}const A=m?x4t[l](x,E,o,u):w4t(x,E,h,d);return S.forEach($=>$.opacity=+A($)),S}function E4t(t,e){const n=new Float64Array(e),i=t.length;for(let r=0;r<i;++r)n[r]=t[r]||0;for(let r=i;r<e;++r)n[r]=n[i-1];return n}function A4t(t,e){const n=new Int8Array(e),i=t.length;for(let r=0;r<i;++r)n[r]|=_4t[t[r]];for(let r=i;r<e;++r)n[r]=n[i-1];return n}function $4t(t){return t&&t.mark&&t.mark.marktype}function I4t(t,e,n,i){const r=s=>[s.x,s.x,s.x,s.y,s.y,s.y];return t?t==="line"||t==="area"?s=>r(s.datum):e==="line"?s=>{const o=s.datum.items[i].items;return r(o.length?o[n==="start"?0:o.length-1]:{x:NaN,y:NaN})}:s=>{const o=s.datum.bounds;return[o.x1,(o.x1+o.x2)/2,o.x2,o.y1,(o.y1+o.y2)/2,o.y2]}:r}const zF=["x","y","opacity","align","baseline"],Urt=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function hR(t){z.call(this,null,t)}hR.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Urt},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:zF.length,default:zF}]};J(hR,z,{transform(t,e){function n(s){const o=t[s];return Qt(o)&&e.modified(o.fields)}const i=t.modified();if(!(i||e.changed(e.ADD_REM)||n("sort")))return;(!t.size||t.size.length!==2)&&q("Size parameter should be specified as a [width, height] array.");const r=t.as||zF;return S4t(e.materialize(e.SOURCE).source||[],t.size,t.sort,ot(t.offset==null?1:t.offset),ot(t.anchor||Urt),t.avoidMarks||[],t.avoidBaseMark!==!1,t.lineAnchor||"end",t.markIndex||0,t.padding===void 0?0:t.padding,t.method||"naive").forEach(s=>{const o=s.datum;o[r[0]]=s.x,o[r[1]]=s.y,o[r[2]]=s.opacity,o[r[3]]=s.align,o[r[4]]=s.baseline}),e.reflow(i).modifies(r)}});const M4t=Object.freeze(Object.defineProperty({__proto__:null,label:hR},Symbol.toStringTag,{value:"Module"}));function jrt(t,e){var n=[],i=function(l){return l(a)},r,s,o,a,u,c;if(e==null)n.push(t);else for(r={},s=0,o=t.length;s<o;++s)a=t[s],u=e.map(i),c=r[u],c||(r[u]=c=[],c.dims=u,n.push(c)),c.push(a);return n}function pR(t){z.call(this,null,t)}pR.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};J(pR,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=jrt(i,t.groupby),s=(t.groupby||[]).map(En),o=s.length,a=t.as||[En(t.x),En(t.y)],u=[];r.forEach(c=>{rnt(c,t.x,t.y,t.bandwidth||.3).forEach(l=>{const f={};for(let d=0;d<o;++d)f[s[d]]=c.dims[d];f[a[0]]=l[0],f[a[1]]=l[1],u.push(Ae(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const UF={constant:SN,linear:EN,log:tnt,exp:ent,pow:nnt,quad:AN,poly:int},T4t=(t,e)=>t==="poly"?e:t==="quad"?2:1;function gR(t){z.call(this,null,t)}gR.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(UF)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};J(gR,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=jrt(i,t.groupby),s=(t.groupby||[]).map(En),o=t.method||"linear",a=t.order==null?3:t.order,u=T4t(o,a),c=t.as||[En(t.x),En(t.y)],l=UF[o],f=[];let d=t.extent;xt(UF,o)||q("Invalid regression method: "+o),d!=null&&o==="log"&&d[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(h=>{if(h.length<=u){e.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=l(h,t.x,t.y,a);if(t.params){f.push(Ae({keys:h.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=d||Ua(h,t.x),y=b=>{const v={};for(let w=0;w<s.length;++w)v[s[w]]=h.dims[w];v[c[0]]=b[0],v[c[1]]=b[1],f.push(Ae(v))};o==="linear"||o==="constant"?m.forEach(b=>y([b,g.predict(b)])):mA(g.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const F4t=Object.freeze(Object.defineProperty({__proto__:null,loess:pR,regression:gR},Symbol.toStringTag,{value:"Module"}));function mR(t){z.call(this,null,t)}mR.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const k4t=[-1e5,-1e5,1e5,1e5];J(mR,z,{transform(t,e){const n=t.as||"path",i=e.source;if(!i||!i.length)return e;let r=t.size;r=r?[0,0,r[0],r[1]]:(r=t.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:k4t;const s=this.value=wc.from(i,t.x,t.y).voronoi(r);for(let o=0,a=i.length;o<a;++o){const u=s.cellPolygon(o);i[o][n]=u&&!C4t(u)?D4t(u):null}return e.reflow(t.modified()).modifies(n)}});function D4t(t){const e=t[0][0],n=t[0][1];let i=t.length-1;for(;t[i][0]===e&&t[i][1]===n;--i);return"M"+t.slice(0,i+1).join("L")+"Z"}function C4t(t){return t.length===2&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]}const N4t=Object.freeze(Object.defineProperty({__proto__:null,voronoi:mR},Symbol.toStringTag,{value:"Module"}));var M3=Math.PI/180,wy=64,w2=2048;function O4t(){var t=[256,256],e,n,i,r,s,o,a,u=qrt,c=[],l=Math.random,f={};f.layout=function(){for(var p=d(yl()),g=U4t((t[0]>>5)*t[1]),m=null,y=c.length,b=-1,v=[],w=c.map(S=>({text:e(S),font:n(S),style:r(S),weight:s(S),rotate:o(S),size:~~(i(S)+1e-14),padding:a(S),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:S})).sort((S,x)=>x.size-S.size);++b<y;){var _=w[b];_.x=t[0]*(l()+.5)>>1,_.y=t[1]*(l()+.5)>>1,R4t(p,_,w,b),_.hasText&&h(g,_,m)&&(v.push(_),m?B4t(m,_):m=[{x:_.x+_.x0,y:_.y+_.y0},{x:_.x+_.x1,y:_.y+_.y1}],_.x-=t[0]>>1,_.y-=t[1]>>1)}return v};function d(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(wy<<5)/g,p.height=w2/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function h(p,g,m){for(var y=g.x,b=g.y,v=Math.sqrt(t[0]*t[0]+t[1]*t[1]),w=u(t),_=l()<.5?1:-1,S=-_,x,E,A;(x=w(S+=_))&&(E=~~x[0],A=~~x[1],!(Math.min(Math.abs(E),Math.abs(A))>=v));)if(g.x=y+E,g.y=b+A,!(g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>t[0]||g.y+g.y1>t[1])&&(!m||!L4t(g,p,t[0]))&&(!m||P4t(g,m))){for(var $=g.sprite,I=g.width>>5,k=t[0]>>5,T=g.x-(I<<4),M=T&127,F=32-M,D=g.y1-g.y0,N=(g.y+g.y0)*k+(T>>5),R,L=0;L<D;L++){R=0;for(var B=0;B<=I;B++)p[N+B]|=R<<F|(B<I?(R=$[L*I+B])>>>M:0);N+=k}return g.sprite=null,!0}return!1}return f.words=function(p){return arguments.length?(c=p,f):c},f.size=function(p){return arguments.length?(t=[+p[0],+p[1]],f):t},f.font=function(p){return arguments.length?(n=Tf(p),f):n},f.fontStyle=function(p){return arguments.length?(r=Tf(p),f):r},f.fontWeight=function(p){return arguments.length?(s=Tf(p),f):s},f.rotate=function(p){return arguments.length?(o=Tf(p),f):o},f.text=function(p){return arguments.length?(e=Tf(p),f):e},f.spiral=function(p){return arguments.length?(u=j4t[p]||p,f):u},f.fontSize=function(p){return arguments.length?(i=Tf(p),f):i},f.padding=function(p){return arguments.length?(a=Tf(p),f):a},f.random=function(p){return arguments.length?(l=p,f):l},f}function R4t(t,e,n,i){if(!e.sprite){var r=t.context,s=t.ratio;r.clearRect(0,0,(wy<<5)/s,w2/s);var o=0,a=0,u=0,c=n.length,l,f,d,h,p;for(--i;++i<c;){if(e=n[i],r.save(),r.font=e.style+" "+e.weight+" "+~~((e.size+1)/s)+"px "+e.font,l=r.measureText(e.text+"m").width*s,d=e.size<<1,e.rotate){var g=Math.sin(e.rotate*M3),m=Math.cos(e.rotate*M3),y=l*m,b=l*g,v=d*m,w=d*g;l=Math.max(Math.abs(y+w),Math.abs(y-w))+31>>5<<5,d=~~Math.max(Math.abs(b+v),Math.abs(b-v))}else l=l+31>>5<<5;if(d>u&&(u=d),o+l>=wy<<5&&(o=0,a+=u,u=0),a+d>=w2)break;r.translate((o+(l>>1))/s,(a+(d>>1))/s),e.rotate&&r.rotate(e.rotate*M3),r.fillText(e.text,0,0),e.padding&&(r.lineWidth=2*e.padding,r.strokeText(e.text,0,0)),r.restore(),e.width=l,e.height=d,e.xoff=o,e.yoff=a,e.x1=l>>1,e.y1=d>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,o+=l}for(var _=r.getImageData(0,0,(wy<<5)/s,w2/s).data,S=[];--i>=0;)if(e=n[i],!!e.hasText){for(l=e.width,f=l>>5,d=e.y1-e.y0,h=0;h<d*f;h++)S[h]=0;if(o=e.xoff,o==null)return;a=e.yoff;var x=0,E=-1;for(p=0;p<d;p++){for(h=0;h<l;h++){var A=f*p+(h>>5),$=_[(a+p)*(wy<<5)+(o+h)<<2]?1<<31-h%32:0;S[A]|=$,x|=$}x?E=p:(e.y0++,d--,p--,a++)}e.y1=e.y0+E,e.sprite=S.slice(0,(e.y1-e.y0)*f)}}}function L4t(t,e,n){n>>=5;for(var i=t.sprite,r=t.width>>5,s=t.x-(r<<4),o=s&127,a=32-o,u=t.y1-t.y0,c=(t.y+t.y0)*n+(s>>5),l,f=0;f<u;f++){l=0;for(var d=0;d<=r;d++)if((l<<a|(d<r?(l=i[f*r+d])>>>o:0))&e[c+d])return!0;c+=n}return!1}function B4t(t,e){var n=t[0],i=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>i.x&&(i.x=e.x+e.x1),e.y+e.y1>i.y&&(i.y=e.y+e.y1)}function P4t(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function qrt(t){var e=t[0]/t[1];return function(n){return[e*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function z4t(t){var e=4,n=e*t[0]/t[1],i=0,r=0;return function(s){var o=s<0?-1:1;switch(Math.sqrt(1+4*o*s)-o&3){case 0:i+=n;break;case 1:r+=e;break;case 2:i-=n;break;default:r-=e;break}return[i,r]}}function U4t(t){for(var e=[],n=-1;++n<t;)e[n]=0;return e}function Tf(t){return typeof t=="function"?t:function(){return t}}var j4t={archimedean:qrt,rectangular:z4t};const Vrt=["x","y","font","fontSize","fontStyle","fontWeight","angle"],q4t=["text","font","rotate","fontSize","fontStyle","fontWeight"];function yR(t){z.call(this,O4t(),t)}yR.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Vrt}]};J(yR,z,{transform(t,e){t.size&&!(t.size[0]&&t.size[1])&&q("Wordcloud size dimensions must be non-zero.");function n(p){const g=t[p];return Qt(g)&&e.modified(g.fields)}const i=t.modified();if(!(i||e.changed(e.ADD_REM)||q4t.some(n)))return;const r=e.materialize(e.SOURCE).source,s=this.value,o=t.as||Vrt;let a=t.fontSize||14,u;if(Qt(a)?u=t.fontSizeRange:a=Bi(a),u){const p=a,g=xe("sqrt")().domain(Ua(r,p)).range(u);a=m=>g(p(m))}r.forEach(p=>{p[o[0]]=NaN,p[o[1]]=NaN,p[o[3]]=0});const c=s.words(r).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(a).random(Ys).layout(),l=s.size(),f=l[0]>>1,d=l[1]>>1,h=c.length;for(let p=0,g,m;p<h;++p)g=c[p],m=g.datum,m[o[0]]=g.x+f,m[o[1]]=g.y+d,m[o[2]]=g.font,m[o[3]]=g.size,m[o[4]]=g.style,m[o[5]]=g.weight,m[o[6]]=g.rotate;return e.reflow(i).modifies(o)}});const V4t=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:yR},Symbol.toStringTag,{value:"Module"})),W4t=t=>new Uint8Array(t),G4t=t=>new Uint16Array(t),Uy=t=>new Uint32Array(t);function Y4t(){let t=8,e=[],n=Uy(0),i=pw(0,t),r=pw(0,t);return{data:()=>e,seen:()=>n=H4t(n,e.length),add(s){for(let o=0,a=e.length,u=s.length,c;o<u;++o)c=s[o],c._index=a++,e.push(c)},remove(s,o){const a=e.length,u=Array(a-s),c=e;let l,f,d;for(f=0;!o[f]&&f<a;++f)u[f]=e[f],c[f]=f;for(d=f;f<a;++f)l=e[f],o[f]?c[f]=-1:(c[f]=d,i[d]=i[f],r[d]=r[f],u[d]=l,l._index=d++),i[f]=0;return e=u,c},size:()=>e.length,curr:()=>i,prev:()=>r,reset:s=>r[s]=i[s],all:()=>t<257?255:t<65537?65535:4294967295,set(s,o){i[s]|=o},clear(s,o){i[s]&=~o},resize(s,o){const a=i.length;(s>a||o>t)&&(t=Math.max(o,t),i=pw(s,t,i),r=pw(s,t))}}}function H4t(t,e,n){return t.length>=e?t:(n=n||new t.constructor(e),n.set(t),n)}function pw(t,e,n){const i=(e<257?W4t:e<65537?G4t:Uy)(t);return n&&i.set(n),i}function Q9(t,e,n){const i=1<<e;return{one:i,zero:~i,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(r,s){const o=this,a=o.bisect(o.range,r.value),u=r.index,c=a[0],l=a[1],f=u.length;let d;for(d=0;d<c;++d)s[u[d]]|=i;for(d=l;d<f;++d)s[u[d]]|=i;return o}}}function Z9(){let t=Uy(0),e=[],n=0;function i(a,u,c){if(!u.length)return[];const l=n,f=u.length,d=Uy(f);let h=Array(f),p,g,m;for(m=0;m<f;++m)h[m]=a(u[m]),d[m]=m;if(h=X4t(h,d),l)p=e,g=t,e=Array(l+f),t=Uy(l+f),K4t(c,p,g,l,h,d,f,e,t);else{if(c>0)for(m=0;m<f;++m)d[m]+=c;e=h,t=d}return n=l+f,{index:d,value:h}}function r(a,u){const c=n;let l,f,d;for(f=0;!u[t[f]]&&f<c;++f);for(d=f;f<c;++f)u[l=t[f]]||(t[d]=l,e[d]=e[f],++d);n=c-a}function s(a){for(let u=0,c=n;u<c;++u)t[u]=a[t[u]]}function o(a,u){let c;return u?c=u.length:(u=e,c=n),[m0t(u,a[0],0,c),sc(u,a[1],0,c)]}return{insert:i,remove:r,bisect:o,reindex:s,index:()=>t,size:()=>n}}function X4t(t,e){return t.sort.call(e,(n,i)=>{const r=t[n],s=t[i];return r<s?-1:r>s?1:0}),oG(t,e)}function K4t(t,e,n,i,r,s,o,a,u){let c=0,l=0,f;for(f=0;c<i&&l<o;++f)e[c]<r[l]?(a[f]=e[c],u[f]=n[c++]):(a[f]=r[l],u[f]=s[l++]+t);for(;c<i;++c,++f)a[f]=e[c],u[f]=n[c];for(;l<o;++l,++f)a[f]=r[l],u[f]=s[l]+t}function bR(t){z.call(this,Y4t(),t),this._indices=null,this._dims=null}bR.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};J(bR,z,{transform(t,e){if(this._dims){var n=t.modified("fields")||t.fields.some(i=>e.modified(i.fields));return n?this.reinit(t,e):this.eval(t,e)}else return this.init(t,e)},init(t,e){const n=t.fields,i=t.query,r=this._indices={},s=this._dims=[],o=i.length;let a=0,u,c;for(;a<o;++a)u=n[a].fname,c=r[u]||(r[u]=Z9()),s.push(Q9(c,a,i[a]));return this.eval(t,e)},reinit(t,e){const n=e.materialize().fork(),i=t.fields,r=t.query,s=this._indices,o=this._dims,a=this.value,u=a.curr(),c=a.prev(),l=a.all(),f=n.rem=n.add,d=n.mod,h=r.length,p={};let g,m,y,b,v,w,_,S,x;if(c.set(u),e.rem.length&&(v=this.remove(t,e,n)),e.add.length&&a.add(e.add),e.mod.length)for(w={},b=e.mod,_=0,S=b.length;_<S;++_)w[b[_]._index]=1;for(_=0;_<h;++_)x=i[_],(!o[_]||t.modified("fields",_)||e.modified(x.fields))&&(y=x.fname,(g=p[y])||(s[y]=m=Z9(),p[y]=g=m.insert(x,e.source,0)),o[_]=Q9(m,_,r[_]).onAdd(g,u));for(_=0,S=a.data().length;_<S;++_)v[_]||(c[_]!==u[_]?f.push(_):w[_]&&u[_]!==l&&d.push(_));return a.mask=(1<<h)-1,n},eval(t,e){const n=e.materialize().fork(),i=this._dims.length;let r=0;return e.rem.length&&(this.remove(t,e,n),r|=(1<<i)-1),t.modified("query")&&!t.modified("fields")&&(r|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),r|=(1<<i)-1),e.mod.length&&(this.modify(e,n),r|=(1<<i)-1),this.value.mask=r,n},insert(t,e,n){const i=e.add,r=this.value,s=this._dims,o=this._indices,a=t.fields,u={},c=n.add,l=r.size()+i.length,f=s.length;let d=r.size(),h,p,g;r.resize(l,f),r.add(i);const m=r.curr(),y=r.prev(),b=r.all();for(h=0;h<f;++h)p=a[h].fname,g=u[p]||(u[p]=o[p].insert(a[h],i,d)),s[h].onAdd(g,m);for(;d<l;++d)y[d]=b,m[d]!==b&&c.push(d)},modify(t,e){const n=e.mod,i=this.value,r=i.curr(),s=i.all(),o=t.mod;let a,u,c;for(a=0,u=o.length;a<u;++a)c=o[a]._index,r[c]!==s&&n.push(c)},remove(t,e,n){const i=this._indices,r=this.value,s=r.curr(),o=r.prev(),a=r.all(),u={},c=n.rem,l=e.rem;let f,d,h,p;for(f=0,d=l.length;f<d;++f)h=l[f]._index,u[h]=1,o[h]=p=s[h],s[h]=a,p!==a&&c.push(h);for(h in i)i[h].remove(d,u);return this.reindex(e,d,u),u},reindex(t,e,n){const i=this._indices,r=this.value;t.runAfter(()=>{const s=r.remove(e,n);for(const o in i)i[o].reindex(s)})},update(t,e,n){const i=this._dims,r=t.query,s=e.stamp,o=i.length;let a=0,u,c;for(n.filters=0,c=0;c<o;++c)t.modified("query",c)&&(u=c,++a);if(a===1)a=i[u].one,this.incrementOne(i[u],r[u],n.add,n.rem);else for(c=0,a=0;c<o;++c)t.modified("query",c)&&(a|=i[c].one,this.incrementAll(i[c],r[c],s,n.add),n.rem=n.add);return a},incrementAll(t,e,n,i){const r=this.value,s=r.seen(),o=r.curr(),a=r.prev(),u=t.index(),c=t.bisect(t.range),l=t.bisect(e),f=l[0],d=l[1],h=c[0],p=c[1],g=t.one;let m,y,b;if(f<h)for(m=f,y=Math.min(h,d);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,i.push(b)),o[b]^=g;else if(f>h)for(m=h,y=Math.min(f,p);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,i.push(b)),o[b]^=g;if(d>p)for(m=Math.max(f,p),y=d;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,i.push(b)),o[b]^=g;else if(d<p)for(m=Math.max(h,d),y=p;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,i.push(b)),o[b]^=g;t.range=e.slice()},incrementOne(t,e,n,i){const r=this.value,s=r.curr(),o=t.index(),a=t.bisect(t.range),u=t.bisect(e),c=u[0],l=u[1],f=a[0],d=a[1],h=t.one;let p,g,m;if(c<f)for(p=c,g=Math.min(f,l);p<g;++p)m=o[p],s[m]^=h,n.push(m);else if(c>f)for(p=f,g=Math.min(c,d);p<g;++p)m=o[p],s[m]^=h,i.push(m);if(l>d)for(p=Math.max(c,d),g=l;p<g;++p)m=o[p],s[m]^=h,n.push(m);else if(l<d)for(p=Math.max(f,l),g=d;p<g;++p)m=o[p],s[m]^=h,i.push(m);t.range=e.slice()}});function vR(t){z.call(this,null,t)}vR.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};J(vR,z,{transform(t,e){const n=~(t.ignore||0),i=t.filter,r=i.mask;if(!(r&n))return e.StopPropagation;const s=e.fork(e.ALL),o=i.data(),a=i.curr(),u=i.prev(),c=l=>a[l]&n?null:o[l];return s.filter(s.MOD,c),r&r-1?(s.filter(s.ADD,l=>{const f=a[l]&n;return!f&&f^u[l]&n?o[l]:null}),s.filter(s.REM,l=>{const f=a[l]&n;return f&&!(f^(f^u[l]&n))?o[l]:null})):(s.filter(s.ADD,c),s.filter(s.REM,l=>(a[l]&n)===r?o[l]:null)),s.filter(s.SOURCE,l=>c(l._index))}});const J4t=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:bR,resolvefilter:vR},Symbol.toStringTag,{value:"Module"})),Q4t="RawCode",nh="Literal",Z4t="Property",t5t="Identifier",e5t="ArrayExpression",n5t="BinaryExpression",Wrt="CallExpression",i5t="ConditionalExpression",r5t="LogicalExpression",s5t="MemberExpression",o5t="ObjectExpression",a5t="UnaryExpression";function Bo(t){this.type=t}Bo.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=u5t(this),n=0,i=e.length;n<i;++n)if(e[n].visit(t))return 1};function u5t(t){switch(t.type){case e5t:return t.elements;case n5t:case r5t:return[t.left,t.right];case Wrt:return[t.callee].concat(t.arguments);case i5t:return[t.test,t.consequent,t.alternate];case s5t:return[t.object,t.property];case o5t:return t.properties;case Z4t:return[t.key,t.value];case a5t:return[t.argument];case t5t:case nh:case Q4t:default:return[]}}var eu,pt,j,Oi,Ne,OA=1,ev=2,ih=3,mf=4,RA=5,Mh=6,wr=7,nv=8,c5t=9;eu={};eu[OA]="Boolean";eu[ev]="<end>";eu[ih]="Identifier";eu[mf]="Keyword";eu[RA]="Null";eu[Mh]="Numeric";eu[wr]="Punctuator";eu[nv]="String";eu[c5t]="RegularExpression";var l5t="ArrayExpression",f5t="BinaryExpression",d5t="CallExpression",h5t="ConditionalExpression",Grt="Identifier",p5t="Literal",g5t="LogicalExpression",m5t="MemberExpression",y5t="ObjectExpression",b5t="Property",v5t="UnaryExpression",ei="Unexpected token %0",w5t="Unexpected number",_5t="Unexpected string",x5t="Unexpected identifier",S5t="Unexpected reserved word",E5t="Unexpected end of input",jF="Invalid regular expression",T3="Invalid regular expression: missing /",Yrt="Octal literals are not allowed in strict mode.",A5t="Duplicate data property in object literal not allowed in strict mode",pi="ILLEGAL",j1="Disabled.",$5t=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),I5t=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function LA(t,e){if(!t)throw new Error("ASSERT: "+e)}function Lu(t){return t>=48&&t<=57}function wR(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function jy(t){return"01234567".indexOf(t)>=0}function M5t(t){return t===32||t===9||t===11||t===12||t===160||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function q1(t){return t===10||t===13||t===8232||t===8233}function iv(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t===92||t>=128&&$5t.test(String.fromCharCode(t))}function hS(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t===92||t>=128&&I5t.test(String.fromCharCode(t))}const T5t={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Hrt(){for(;j<Oi;){const t=pt.charCodeAt(j);if(M5t(t)||q1(t))++j;else break}}function qF(t){var e,n,i,r=0;for(n=t==="u"?4:2,e=0;e<n;++e)j<Oi&&wR(pt[j])?(i=pt[j++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):we({},ei,pi);return String.fromCharCode(r)}function F5t(){var t,e,n,i;for(t=pt[j],e=0,t==="}"&&we({},ei,pi);j<Oi&&(t=pt[j++],!!wR(t));)e=e*16+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||t!=="}")&&we({},ei,pi),e<=65535?String.fromCharCode(e):(n=(e-65536>>10)+55296,i=(e-65536&1023)+56320,String.fromCharCode(n,i))}function Xrt(){var t,e;for(t=pt.charCodeAt(j++),e=String.fromCharCode(t),t===92&&(pt.charCodeAt(j)!==117&&we({},ei,pi),++j,t=qF("u"),(!t||t==="\\"||!iv(t.charCodeAt(0)))&&we({},ei,pi),e=t);j<Oi&&(t=pt.charCodeAt(j),!!hS(t));)++j,e+=String.fromCharCode(t),t===92&&(e=e.substr(0,e.length-1),pt.charCodeAt(j)!==117&&we({},ei,pi),++j,t=qF("u"),(!t||t==="\\"||!hS(t.charCodeAt(0)))&&we({},ei,pi),e+=t);return e}function k5t(){var t,e;for(t=j++;j<Oi;){if(e=pt.charCodeAt(j),e===92)return j=t,Xrt();if(hS(e))++j;else break}return pt.slice(t,j)}function D5t(){var t,e,n;return t=j,e=pt.charCodeAt(j)===92?Xrt():k5t(),e.length===1?n=ih:T5t.hasOwnProperty(e)?n=mf:e==="null"?n=RA:e==="true"||e==="false"?n=OA:n=ih,{type:n,value:e,start:t,end:j}}function F3(){var t=j,e=pt.charCodeAt(j),n,i=pt[j],r,s,o;switch(e){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++j,{type:wr,value:String.fromCharCode(e),start:t,end:j};default:if(n=pt.charCodeAt(j+1),n===61)switch(e){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return j+=2,{type:wr,value:String.fromCharCode(e)+String.fromCharCode(n),start:t,end:j};case 33:case 61:return j+=2,pt.charCodeAt(j)===61&&++j,{type:wr,value:pt.slice(t,j),start:t,end:j}}}if(o=pt.substr(j,4),o===">>>=")return j+=4,{type:wr,value:o,start:t,end:j};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return j+=3,{type:wr,value:s,start:t,end:j};if(r=s.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return j+=2,{type:wr,value:r,start:t,end:j};if(r==="//"&&we({},ei,pi),"<>=!+-*%&|^/".indexOf(i)>=0)return++j,{type:wr,value:i,start:t,end:j};we({},ei,pi)}function C5t(t){let e="";for(;j<Oi&&wR(pt[j]);)e+=pt[j++];return e.length===0&&we({},ei,pi),iv(pt.charCodeAt(j))&&we({},ei,pi),{type:Mh,value:parseInt("0x"+e,16),start:t,end:j}}function N5t(t){let e="0"+pt[j++];for(;j<Oi&&jy(pt[j]);)e+=pt[j++];return(iv(pt.charCodeAt(j))||Lu(pt.charCodeAt(j)))&&we({},ei,pi),{type:Mh,value:parseInt(e,8),octal:!0,start:t,end:j}}function tP(){var t,e,n;if(n=pt[j],LA(Lu(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),e=j,t="",n!=="."){if(t=pt[j++],n=pt[j],t==="0"){if(n==="x"||n==="X")return++j,C5t(e);if(jy(n))return N5t(e);n&&Lu(n.charCodeAt(0))&&we({},ei,pi)}for(;Lu(pt.charCodeAt(j));)t+=pt[j++];n=pt[j]}if(n==="."){for(t+=pt[j++];Lu(pt.charCodeAt(j));)t+=pt[j++];n=pt[j]}if(n==="e"||n==="E")if(t+=pt[j++],n=pt[j],(n==="+"||n==="-")&&(t+=pt[j++]),Lu(pt.charCodeAt(j)))for(;Lu(pt.charCodeAt(j));)t+=pt[j++];else we({},ei,pi);return iv(pt.charCodeAt(j))&&we({},ei,pi),{type:Mh,value:parseFloat(t),start:e,end:j}}function O5t(){var t="",e,n,i,r,s=!1;for(e=pt[j],LA(e==="'"||e==='"',"String literal must starts with a quote"),n=j,++j;j<Oi;)if(i=pt[j++],i===e){e="";break}else if(i==="\\")if(i=pt[j++],!i||!q1(i.charCodeAt(0)))switch(i){case"u":case"x":pt[j]==="{"?(++j,t+=F5t()):t+=qF(i);break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:jy(i)?(r="01234567".indexOf(i),r!==0&&(s=!0),j<Oi&&jy(pt[j])&&(s=!0,r=r*8+"01234567".indexOf(pt[j++]),"0123".indexOf(i)>=0&&j<Oi&&jy(pt[j])&&(r=r*8+"01234567".indexOf(pt[j++]))),t+=String.fromCharCode(r)):t+=i;break}else i==="\r"&&pt[j]===`
`&&++j;else{if(q1(i.charCodeAt(0)))break;t+=i}return e!==""&&we({},ei,pi),{type:nv,value:t,octal:s,start:n,end:j}}function R5t(t,e){let n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";we({},jF)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{we({},jF)}try{return new RegExp(t,e)}catch{return null}}function L5t(){var t,e,n,i,r;for(t=pt[j],LA(t==="/","Regular expression literal must start with a slash"),e=pt[j++],n=!1,i=!1;j<Oi;)if(t=pt[j++],e+=t,t==="\\")t=pt[j++],q1(t.charCodeAt(0))&&we({},T3),e+=t;else if(q1(t.charCodeAt(0)))we({},T3);else if(n)t==="]"&&(n=!1);else if(t==="/"){i=!0;break}else t==="["&&(n=!0);return i||we({},T3),r=e.substr(1,e.length-2),{value:r,literal:e}}function B5t(){var t,e,n;for(e="",n="";j<Oi&&(t=pt[j],!!hS(t.charCodeAt(0)));)++j,t==="\\"&&j<Oi?we({},ei,pi):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&we({},jF,n),{value:n,literal:e}}function P5t(){var t,e,n,i;return Ne=null,Hrt(),t=j,e=L5t(),n=B5t(),i=R5t(e.value,n.value),{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:j}}function z5t(t){return t.type===ih||t.type===mf||t.type===OA||t.type===RA}function Krt(){if(Hrt(),j>=Oi)return{type:ev,start:j,end:j};const t=pt.charCodeAt(j);return iv(t)?D5t():t===40||t===41||t===59?F3():t===39||t===34?O5t():t===46?Lu(pt.charCodeAt(j+1))?tP():F3():Lu(t)?tP():F3()}function Er(){const t=Ne;return j=t.end,Ne=Krt(),j=t.end,t}function Jrt(){const t=j;Ne=Krt(),j=t}function U5t(t){const e=new Bo(l5t);return e.elements=t,e}function eP(t,e,n){const i=new Bo(t==="||"||t==="&&"?g5t:f5t);return i.operator=t,i.left=e,i.right=n,i}function j5t(t,e){const n=new Bo(d5t);return n.callee=t,n.arguments=e,n}function q5t(t,e,n){const i=new Bo(h5t);return i.test=t,i.consequent=e,i.alternate=n,i}function _R(t){const e=new Bo(Grt);return e.name=t,e}function _y(t){const e=new Bo(p5t);return e.value=t.value,e.raw=pt.slice(t.start,t.end),t.regex&&(e.raw==="//"&&(e.raw="/(?:)/"),e.regex=t.regex),e}function nP(t,e,n){const i=new Bo(m5t);return i.computed=t==="[",i.object=e,i.property=n,i.computed||(n.member=!0),i}function V5t(t){const e=new Bo(y5t);return e.properties=t,e}function iP(t,e,n){const i=new Bo(b5t);return i.key=e,i.value=n,i.kind=t,i}function W5t(t,e){const n=new Bo(v5t);return n.operator=t,n.argument=e,n.prefix=!0,n}function we(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,(s,o)=>(LA(o<i.length,"Message reference must be in range"),i[o]));throw n=new Error(r),n.index=j,n.description=r,n}function BA(t){t.type===ev&&we(t,E5t),t.type===Mh&&we(t,w5t),t.type===nv&&we(t,_5t),t.type===ih&&we(t,x5t),t.type===mf&&we(t,S5t),we(t,ei,t.value)}function Ri(t){const e=Er();(e.type!==wr||e.value!==t)&&BA(e)}function Ke(t){return Ne.type===wr&&Ne.value===t}function k3(t){return Ne.type===mf&&Ne.value===t}function G5t(){const t=[];for(j=Ne.start,Ri("[");!Ke("]");)Ke(",")?(Er(),t.push(null)):(t.push(rh()),Ke("]")||Ri(","));return Er(),U5t(t)}function rP(){j=Ne.start;const t=Er();return t.type===nv||t.type===Mh?(t.octal&&we(t,Yrt),_y(t)):_R(t.value)}function Y5t(){var t,e,n,i;if(j=Ne.start,t=Ne,t.type===ih)return n=rP(),Ri(":"),i=rh(),iP("init",n,i);if(t.type===ev||t.type===wr)BA(t);else return e=rP(),Ri(":"),i=rh(),iP("init",e,i)}function H5t(){var t=[],e,n,i,r={},s=String;for(j=Ne.start,Ri("{");!Ke("}");)e=Y5t(),e.key.type===Grt?n=e.key.name:n=s(e.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?we({},A5t):r[i]=!0,t.push(e),Ke("}")||Ri(",");return Ri("}"),V5t(t)}function X5t(){Ri("(");const t=xR();return Ri(")"),t}const K5t={if:1};function J5t(){var t,e,n;if(Ke("("))return X5t();if(Ke("["))return G5t();if(Ke("{"))return H5t();if(t=Ne.type,j=Ne.start,t===ih||K5t[Ne.value])n=_R(Er().value);else if(t===nv||t===Mh)Ne.octal&&we(Ne,Yrt),n=_y(Er());else{if(t===mf)throw new Error(j1);t===OA?(e=Er(),e.value=e.value==="true",n=_y(e)):t===RA?(e=Er(),e.value=null,n=_y(e)):Ke("/")||Ke("/=")?(n=_y(P5t()),Jrt()):BA(Er())}return n}function Q5t(){const t=[];if(Ri("("),!Ke(")"))for(;j<Oi&&(t.push(rh()),!Ke(")"));)Ri(",");return Ri(")"),t}function Z5t(){j=Ne.start;const t=Er();return z5t(t)||BA(t),_R(t.value)}function tLt(){return Ri("."),Z5t()}function eLt(){Ri("[");const t=xR();return Ri("]"),t}function nLt(){var t,e,n;for(t=J5t();;)if(Ke("."))n=tLt(),t=nP(".",t,n);else if(Ke("("))e=Q5t(),t=j5t(t,e);else if(Ke("["))n=eLt(),t=nP("[",t,n);else break;return t}function sP(){const t=nLt();if(Ne.type===wr&&(Ke("++")||Ke("--")))throw new Error(j1);return t}function _2(){var t,e;if(Ne.type!==wr&&Ne.type!==mf)e=sP();else{if(Ke("++")||Ke("--"))throw new Error(j1);if(Ke("+")||Ke("-")||Ke("~")||Ke("!"))t=Er(),e=_2(),e=W5t(t.value,e);else{if(k3("delete")||k3("void")||k3("typeof"))throw new Error(j1);e=sP()}}return e}function oP(t){let e=0;if(t.type!==wr&&t.type!==mf)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11;break}return e}function iLt(){var t,e,n,i,r,s,o,a,u,c;if(t=Ne,u=_2(),i=Ne,r=oP(i),r===0)return u;for(i.prec=r,Er(),e=[t,Ne],o=_2(),s=[u,i,o];(r=oP(Ne))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),e.pop(),n=eP(a,u,o),s.push(n);i=Er(),i.prec=r,s.push(i),e.push(Ne),n=_2(),s.push(n)}for(c=s.length-1,n=s[c],e.pop();c>1;)e.pop(),n=eP(s[c-1].value,s[c-2],n),c-=2;return n}function rh(){var t,e,n;return t=iLt(),Ke("?")&&(Er(),e=rh(),Ri(":"),n=rh(),t=q5t(t,e,n)),t}function xR(){const t=rh();if(Ke(","))throw new Error(j1);return t}function SR(t){pt=t,j=0,Oi=pt.length,Ne=null,Jrt();const e=xR();if(Ne.type!==ev)throw new Error("Unexpect token after expression.");return e}var Qrt={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Zrt(t){function e(o,a,u,c){let l=t(a[0]);return u&&(l=u+"("+l+")",u.lastIndexOf("new ",0)===0&&(l="("+l+")")),l+"."+o+(c<0?"":c===0?"()":"("+a.slice(1).map(t).join(",")+")")}function n(o,a,u){return c=>e(o,c,a,u)}const i="new Date",r="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&q("Missing arguments to clamp function."),o.length>3&&q("Too many arguments to clamp function.");const a=o.map(t);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&q("Missing arguments to if function."),o.length>3&&q("Too many arguments to if function.");const a=o.map(t);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function rLt(t){const e=t&&t.length-1;return e&&(t[0]==='"'&&t[e]==='"'||t[0]==="'"&&t[e]==="'")?t.slice(1,-1):t}function tst(t){t=t||{};const e=t.allowed?Mo(t.allowed):{},n=t.forbidden?Mo(t.forbidden):{},i=t.constants||Qrt,r=(t.functions||Zrt)(f),s=t.globalvar,o=t.fieldvar,a=Qt(s)?s:p=>`${s}["${p}"]`;let u={},c={},l=0;function f(p){if(at(p))return p;const g=d[p.type];return g==null&&q("Unsupported type: "+p.type),g(p)}const d={Literal:p=>p.raw,Identifier:p=>{const g=p.name;return l>0?g:xt(n,g)?q("Illegal identifier: "+g):xt(i,g)?i[g]:xt(e,g)?g:(u[g]=1,a(g))},MemberExpression:p=>{const g=!p.computed,m=f(p.object);g&&(l+=1);const y=f(p.property);return m===o&&(c[rLt(y)]=1),g&&(l-=1),m+(g?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&q("Illegal callee type: "+p.callee.type);const g=p.callee.name,m=p.arguments,y=xt(r,g)&&r[g];return y||q("Unrecognized function: "+g),Qt(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{l+=1;const g=f(p.key);return l-=1,g+":"+f(p.value)}};function h(p){const g={code:f(p),globals:Object.keys(u),fields:Object.keys(c)};return u={},c={},g}return h.functions=r,h.constants=i,h}const aP=Symbol("vega_selection_getter");function est(t){return(!t.getter||!t.getter[aP])&&(t.getter=Vs(t.field),t.getter[aP]=!0),t.getter}const ER="intersect",uP="union",sLt="vlMulti",oLt="vlPoint",cP="or",aLt="and",ua="_vgsid_",V1=Vs(ua),uLt="E",cLt="R",lLt="R-E",fLt="R-LE",dLt="R-RE",pS="index:unit";function lP(t,e){for(var n=e.fields,i=e.values,r=n.length,s=0,o,a;s<r;++s)if(a=n[s],o=est(a)(t),gl(o)&&(o=Ti(o)),gl(i[s])&&(i[s]=Ti(i[s])),W(i[s])&&gl(i[s][0])&&(i[s]=i[s].map(Ti)),a.type===uLt){if(W(i[s])?i[s].indexOf(o)<0:o!==i[s])return!1}else if(a.type===cLt){if(!Up(o,i[s]))return!1}else if(a.type===dLt){if(!Up(o,i[s],!0,!1))return!1}else if(a.type===lLt){if(!Up(o,i[s],!1,!1))return!1}else if(a.type===fLt&&!Up(o,i[s],!1,!0))return!1;return!0}function hLt(t,e,n){for(var i=this.context.data[t],r=i?i.values.value:[],s=i?i[pS]&&i[pS].value:void 0,o=n===ER,a=r.length,u=0,c,l,f,d,h;u<a;++u)if(c=r[u],s&&o){if(l=l||{},f=l[d=c.unit]||0,f===-1)continue;if(h=lP(e,c),l[d]=h?-1:++f,h&&s.size===1)return!0;if(!h&&f===s.get(d).count)return!1}else if(h=lP(e,c),o^h)return h;return a&&o}const nst=bh(V1),pLt=nst.left,gLt=nst.right;function mLt(t,e,n){const i=this.context.data[t],r=i?i.values.value:[],s=i?i[pS]&&i[pS].value:void 0,o=n===ER,a=V1(e),u=pLt(r,a);if(u===r.length||V1(r[u])!==a)return!1;if(s&&o){if(s.size===1)return!0;if(gLt(r,a)-u<s.size)return!1}return!0}function yLt(t,e){return t.map(n=>Jt(e.fields?{values:e.fields.map(i=>est(i)(n.datum))}:{[ua]:V1(n.datum)},e))}function bLt(t,e,n,i){for(var r=this.context.data[t],s=r?r.values.value:[],o={},a={},u={},c,l,f,d,h,p,g,m,y,b,v=s.length,w=0,_,S;w<v;++w)if(c=s[w],d=c.unit,l=c.fields,f=c.values,l&&f){for(_=0,S=l.length;_<S;++_)h=l[_],g=o[h.field]||(o[h.field]={}),m=g[d]||(g[d]=[]),u[h.field]=y=h.type.charAt(0),b=D3[`${y}_union`],g[d]=b(m,ot(f[_]));n&&(m=a[d]||(a[d]=[]),m.push(ot(f).reduce((x,E,A)=>(x[l[A].field]=E,x),{})))}else h=ua,p=V1(c),g=o[h]||(o[h]={}),m=g[d]||(g[d]=[]),m.push(p),n&&(m=a[d]||(a[d]=[]),m.push({[ua]:p}));if(e=e||uP,o[ua]?o[ua]=D3[`${ua}_${e}`](...Object.values(o[ua])):Object.keys(o).forEach(x=>{o[x]=Object.keys(o[x]).map(E=>o[x][E]).reduce((E,A)=>E===void 0?A:D3[`${u[x]}_${e}`](E,A))}),s=Object.keys(a),n&&s.length){const x=i?oLt:sLt;o[x]=e===uP?{[cP]:s.reduce((E,A)=>(E.push(...a[A]),E),[])}:{[aLt]:s.map(E=>({[cP]:a[E]}))}}return o}var D3={[`${ua}_union`]:P0t,[`${ua}_intersect`]:L0t,E_union:function(t,e){if(!t.length)return e;for(var n=0,i=e.length;n<i;++n)t.indexOf(e[n])<0&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter(n=>e.indexOf(n)>=0):e},R_union:function(t,e){var n=Ti(e[0]),i=Ti(e[1]);return n>i&&(n=e[1],i=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<i&&(t[1]=i),t):[n,i]},R_intersect:function(t,e){var n=Ti(e[0]),i=Ti(e[1]);return n>i&&(n=e[1],i=e[0]),t.length?i<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>i&&(t[1]=i),t):[n,i]}};const vLt=":",wLt="@";function AR(t,e,n,i){e[0].type!==nh&&q("First argument to selection functions must be a string literal.");const r=e[0].value,s=e.length>=2&&pe(e).value,o="unit",a=wLt+o,u=vLt+r;s===ER&&!xt(i,a)&&(i[a]=n.getData(r).indataRef(n,o)),xt(i,u)||(i[u]=n.getData(r).tuplesRef())}function ist(t){const e=this.context.data[t];return e?e.values.value:[]}function _Lt(t,e,n){const i=this.context.data[t]["index:"+e],r=i?i.value.get(n):void 0;return r&&r.count}function xLt(t,e){const n=this.context.dataflow,i=this.context.data[t],r=i.input;return n.pulse(r,n.changeset().remove(Ws).insert(e)),1}function SLt(t,e,n){if(t){const i=this.context.dataflow,r=t.mark.source;i.pulse(r,i.changeset().encode(t,e))}return n!==void 0?n:t}const rv=t=>function(e,n){return this.context.dataflow.locale()[t](n)(e)},ELt=rv("format"),rst=rv("timeFormat"),ALt=rv("utcFormat"),$Lt=rv("timeParse"),ILt=rv("utcParse"),gw=new Date(2e3,0,1);function PA(t,e,n){return!Number.isInteger(t)||!Number.isInteger(e)?"":(gw.setYear(2e3),gw.setMonth(t),gw.setDate(e),rst.call(this,gw,n))}function MLt(t){return PA.call(this,t,1,"%B")}function TLt(t){return PA.call(this,t,1,"%b")}function FLt(t){return PA.call(this,0,2+t,"%A")}function kLt(t){return PA.call(this,0,2+t,"%a")}const DLt=":",CLt="@",VF="%",sst="$";function $R(t,e,n,i){e[0].type!==nh&&q("First argument to data functions must be a string literal.");const r=e[0].value,s=DLt+r;if(!xt(s,i))try{i[s]=n.getData(r).tuplesRef()}catch{}}function NLt(t,e,n,i){e[0].type!==nh&&q("First argument to indata must be a string literal."),e[1].type!==nh&&q("Second argument to indata must be a string literal.");const r=e[0].value,s=e[1].value,o=CLt+s;xt(o,i)||(i[o]=n.getData(r).indataRef(n,s))}function er(t,e,n,i){if(e[0].type===nh)fP(n,i,e[0].value);else for(t in n.scales)fP(n,i,t)}function fP(t,e,n){const i=VF+n;if(!xt(e,i))try{e[i]=t.scaleRef(n)}catch{}}function nu(t,e){if(Qt(t))return t;if(at(t)){const n=e.scales[t];return n&&oCt(n.value)?n.value:void 0}}function OLt(t,e,n){e.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=er,n._range=er,n._scale=er;const i=r=>"_["+(r.type===nh?Q(VF+r.value):Q(VF)+"+"+t(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${t(r[1])})`}}function IR(t,e){return function(n,i,r){if(n){const s=nu(n,(r||this).context);return s&&s.path[t](i)}else return e(i)}}const RLt=IR("area",o2t),LLt=IR("bounds",l2t),BLt=IR("centroid",FY);function PLt(t,e){const n=nu(t,(e||this).context);return n&&n.scale()}function zLt(t){const e=this.context.group;let n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n}function MR(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(i){t.warn(i)}return n[n.length-1]}function ULt(){return MR(this.context.dataflow,"warn",arguments)}function jLt(){return MR(this.context.dataflow,"info",arguments)}function qLt(){return MR(this.context.dataflow,"debug",arguments)}function C3(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function WF(t){const e=Nr(t),n=C3(e.r),i=C3(e.g),r=C3(e.b);return .2126*n+.7152*i+.0722*r}function VLt(t,e){const n=WF(t),i=WF(e),r=Math.max(n,i),s=Math.min(n,i);return(r+.05)/(s+.05)}function WLt(){const t=[].slice.call(arguments);return t.unshift({}),Jt(...t)}function ost(t,e){return t===e||t!==t&&e!==e?!0:W(t)?W(e)&&t.length===e.length?GLt(t,e):!1:ut(t)&&ut(e)?ast(t,e):!1}function GLt(t,e){for(let n=0,i=t.length;n<i;++n)if(!ost(t[n],e[n]))return!1;return!0}function ast(t,e){for(const n in t)if(!ost(t[n],e[n]))return!1;return!0}function dP(t){return e=>ast(t,e)}function YLt(t,e,n,i,r,s){const o=this.context.dataflow,a=this.context.data[t],u=a.input,c=o.stamp();let l=a.changes,f,d;if(o._trigger===!1||!(u.value.length||e||i))return 0;if((!l||l.stamp<c)&&(a.changes=l=o.changeset(),l.stamp=c,o.runAfter(()=>{a.modified=!0,o.pulse(u,l).run()},!0,1)),n&&(f=n===!0?Ws:W(n)||uA(n)?n:dP(n),l.remove(f)),e&&l.insert(e),i&&(f=dP(i),u.value.some(f)?l.remove(f):l.insert(i)),r)for(d in s)l.modify(r,d,s[d]);return 1}function HLt(t){const e=t.touches,n=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.hypot(n,i)}function XLt(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)}const hP={};function KLt(t,e){const n=hP[e]||(hP[e]=Vs(e));return W(t)?t.map(n):n(t)}function TR(t){return W(t)||ArrayBuffer.isView(t)?t:null}function FR(t){return TR(t)||(at(t)?t:null)}function JLt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return TR(t).join(...n)}function QLt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return FR(t).indexOf(...n)}function ZLt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return FR(t).lastIndexOf(...n)}function tBt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return FR(t).slice(...n)}function eBt(t,e,n){return Qt(n)&&q("Function argument passed to replace."),String(t).replace(e,n)}function nBt(t){return TR(t).slice().reverse()}function iBt(t,e,n){return JN(t||0,e||0,n||0)}function rBt(t,e){const n=nu(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}function sBt(t,e){const n=nu(t,(e||this).context);return n?n.copy():void 0}function oBt(t,e){const n=nu(t,(e||this).context);return n?n.domain():[]}function aBt(t,e,n){const i=nu(t,(n||this).context);return i?W(e)?(i.invertRange||i.invert)(e):(i.invert||i.invertExtent)(e):void 0}function uBt(t,e){const n=nu(t,(e||this).context);return n&&n.range?n.range():[]}function cBt(t,e,n){const i=nu(t,(n||this).context);return i?i(e):void 0}function lBt(t,e,n,i,r){t=nu(t,(r||this).context);const s=eit(e,n);let o=t.domain(),a=o[0],u=pe(o),c=Li;return u-a?c=qnt(t,a,u):t=(t.interpolator?xe("sequential")().interpolator(t.interpolator()):xe("linear")().interpolate(t.interpolate()).range(t.range())).domain([a=0,u=1]),t.ticks&&(o=t.ticks(+i||15),a!==o[0]&&o.unshift(a),u!==pe(o)&&o.push(u)),o.forEach(l=>s.stop(c(l),t(l))),s}function fBt(t,e,n){const i=nu(t,(n||this).context);return function(r){return i?i.path.context(r)(e):""}}function dBt(t){let e=null;return function(n){return n?R1(n,e=e||Hg(t)):t}}const ust=t=>t.data;function cst(t,e){const n=ist.call(e,t);return n.root&&n.root.lookup||{}}function hBt(t,e,n){const i=cst(t,this),r=i[e],s=i[n];return r&&s?r.path(s).map(ust):void 0}function pBt(t,e){const n=cst(t,this)[e];return n?n.ancestors().map(ust):void 0}const lst=()=>typeof window<"u"&&window||null;function gBt(){const t=lst();return t?t.screen:{}}function mBt(){const t=lst();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]}function yBt(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]}function fst(t,e,n){if(!t)return[];const[i,r]=t,s=new On().set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return Hit(o,s,bBt(e))}function bBt(t){let e=null;if(t){const n=ot(t.marktype),i=ot(t.markname);e=r=>(!n.length||n.some(s=>r.marktype===s))&&(!i.length||i.some(s=>r.name===s))}return e}function vBt(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;t=ot(t);const r=t[t.length-1];return r===void 0||Math.hypot(r[0]-e,r[1]-n)>i?[...t,[e,n]]:t}function wBt(t){return ot(t).reduce((e,n,i)=>{let[r,s]=n;return e+=i==0?`M ${r},${s} `:i===t.length-1?" Z":`L ${r},${s} `},"")}function _Bt(t,e,n){const{x:i,y:r,mark:s}=n,o=new On().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[u,c]of e)u<o.x1&&(o.x1=u),u>o.x2&&(o.x2=u),c<o.y1&&(o.y1=c),c>o.y2&&(o.y2=c);return o.translate(i,r),fst([[o.x1,o.y1],[o.x2,o.y2]],t,s).filter(u=>xBt(u.x,u.y,e))}function xBt(t,e,n){let i=0;for(let r=0,s=n.length-1;r<n.length;s=r++){const[o,a]=n[s],[u,c]=n[r];c>e!=a>e&&t<(o-u)*(e-c)/(a-c)+u&&i++}return i&1}const W1={random(){return Ys()},cumulativeNormal:hA,cumulativeLogNormal:yN,cumulativeUniform:_N,densityNormal:dN,densityLogNormal:mN,densityUniform:wN,quantileNormal:pA,quantileLogNormal:bN,quantileUniform:xN,sampleNormal:dA,sampleLogNormal:gN,sampleUniform:vN,isArray:W,isBoolean:gf,isDate:gl,isDefined(t){return t!==void 0},isNumber:be,isObject:ut,isRegExp:Jtt,isString:at,isTuple:uA,isValid(t){return t!=null&&t===t},toBoolean:KC,toDate(t){return JC(t)},toNumber:Ti,toString:QC,indexof:QLt,join:JLt,lastindexof:ZLt,replace:eBt,reverse:nBt,slice:tBt,flush:Xtt,lerp:Qtt,merge:WLt,pad:eet,peek:pe,pluck:KLt,span:zb,inrange:Up,truncate:net,rgb:Nr,lab:j_,hcl:q_,hsl:z_,luminance:WF,contrast:VLt,sequence:Un,format:ELt,utcFormat:ALt,utcParse:ILt,utcOffset:yet,utcSequence:wet,timeFormat:rst,timeParse:$Lt,timeOffset:met,timeSequence:vet,timeUnitSpecifier:ret,monthFormat:MLt,monthAbbrevFormat:TLt,dayFormat:FLt,dayAbbrevFormat:kLt,quarter:Wtt,utcquarter:Gtt,week:oet,utcweek:cet,dayofyear:set,utcdayofyear:uet,warn:ULt,info:jLt,debug:qLt,extent(t){return Ua(t)},inScope:zLt,intersect:fst,clampRange:Ytt,pinchDistance:HLt,pinchAngle:XLt,screen:gBt,containerSize:yBt,windowSize:mBt,bandspace:iBt,setdata:xLt,pathShape:dBt,panLinear:Utt,panLog:jtt,panPow:qtt,panSymlog:Vtt,zoomLinear:VC,zoomLog:WC,zoomPow:Hx,zoomSymlog:GC,encode:SLt,modify:YLt,lassoAppend:vBt,lassoPath:wBt,intersectLasso:_Bt},SBt=["view","item","group","xy","x","y"],EBt="event.vega.",dst="this.",kR={},hst={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${Q(sst+t)}]`,functions:ABt,constants:Qrt,visitors:kR},GF=tst(hst);function ABt(t){const e=Zrt(t);SBt.forEach(n=>e[n]=EBt+n);for(const n in W1)e[n]=dst+n;return Jt(e,OLt(t,W1,kR)),e}function kn(t,e,n){return arguments.length===1?W1[t]:(W1[t]=e,n&&(kR[t]=n),GF&&(GF.functions[t]=dst+t),this)}kn("bandwidth",rBt,er);kn("copy",sBt,er);kn("domain",oBt,er);kn("range",uBt,er);kn("invert",aBt,er);kn("scale",cBt,er);kn("gradient",lBt,er);kn("geoArea",RLt,er);kn("geoBounds",LLt,er);kn("geoCentroid",BLt,er);kn("geoShape",fBt,er);kn("geoScale",PLt,er);kn("indata",_Lt,NLt);kn("data",ist,$R);kn("treePath",hBt,$R);kn("treeAncestors",pBt,$R);kn("vlSelectionTest",hLt,AR);kn("vlSelectionIdTest",mLt,AR);kn("vlSelectionResolve",bLt,AR);kn("vlSelectionTuples",yLt);function qa(t,e){const n={};let i;try{t=at(t)?t:Q(t)+"",i=SR(t)}catch{q("Expression parse error: "+t)}i.visit(s=>{if(s.type!==Wrt)return;const o=s.callee.name,a=hst.visitors[o];a&&a(o,s.arguments,e,n)});const r=GF(i);return r.globals.forEach(s=>{const o=sst+s;!xt(n,o)&&e.getSignal(s)&&(n[o]=e.signalRef(s))}),{$expr:Jt({code:r.code},e.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function $Bt(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach(i=>e.parseOperator(i)),n.forEach(i=>e.parseOperatorParameters(i)),(t.streams||[]).forEach(i=>e.parseStream(i)),(t.updates||[]).forEach(i=>e.parseUpdate(i)),e.resolve()}const IBt=Mo(["rule"]),pP=Mo(["group","image","rect"]);function MBt(t,e){let n="";return IBt[e]||(t.x2&&(t.x?(pP[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(pP[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function DR(t){return(t+"").toLowerCase()}function TBt(t){return DR(t)==="operator"}function FBt(t){return DR(t)==="collect"}function I0(t,e,n){n.endsWith(";")||(n="return("+n+");");const i=Function(...e.concat(n));return t&&t.functions?i.bind(t.functions):i}function kBt(t,e,n,i){return`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var DBt={operator:(t,e)=>I0(t,["_"],e.code),parameter:(t,e)=>I0(t,["datum","_"],e.code),event:(t,e)=>I0(t,["event"],e.code),handler:(t,e)=>{const n=`var datum=event.item&&event.item.datum;return ${e.code};`;return I0(t,["_","event"],n)},encode:(t,e)=>{const{marktype:n,channels:i}=e;let r="var o=item,datum=o.datum,m=0,$;";for(const s in i){const o="o["+Q(s)+"]";r+=`$=${i[s].code};if(${o}!==$)${o}=$,m=1;`}return r+=MBt(i,n),r+="return m;",I0(t,["item","_"],r)},codegen:{get(t){const e=`[${t.map(Q).join("][")}]`,n=Function("_",`return _${e};`);return n.path=e,n},comparator(t,e){let n;const i=(s,o)=>{const a=e[o];let u,c;return s.path?(u=`a${s.path}`,c=`b${s.path}`):((n=n||{})["f"+o]=s,u=`this.f${o}(a)`,c=`this.f${o}(b)`),kBt(u,c,-a,a)},r=Function("a","b","var u, v; return "+t.map(i).join("")+"0;");return n?r.bind(n):r}}};function CBt(t){const e=this;TBt(t.type)||!t.type?e.operator(t,t.update?e.operatorExpression(t.update):null):e.transform(t,t.type)}function NBt(t){const e=this;if(t.params){const n=e.get(t.id);n||q("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}}function OBt(t,e){e=e||{};const n=this;for(const i in t){const r=t[i];e[i]=W(r)?r.map(s=>gP(s,n,e)):gP(r,n,e)}return e}function gP(t,e,n){if(!t||!ut(t))return t;for(let i=0,r=mP.length,s;i<r;++i)if(s=mP[i],xt(t,s.key))return s.parse(t,e,n);return t}var mP=[{key:"$ref",parse:RBt},{key:"$key",parse:BBt},{key:"$expr",parse:LBt},{key:"$field",parse:PBt},{key:"$encode",parse:UBt},{key:"$compare",parse:zBt},{key:"$context",parse:jBt},{key:"$subflow",parse:qBt},{key:"$tupleid",parse:VBt}];function RBt(t,e){return e.get(t.$ref)||q("Operator not defined: "+t.$ref)}function LBt(t,e,n){t.$params&&e.parseParameters(t.$params,n);const i="e:"+t.$expr.code;return e.fn[i]||(e.fn[i]=qr(e.parameterExpression(t.$expr),t.$fields))}function BBt(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=XC(t.$key,t.$flat,e.expr.codegen))}function PBt(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=Vs(t.$field,t.$name,e.expr.codegen))}function zBt(t,e){const n="c:"+t.$compare+"_"+t.$order,i=ot(t.$compare).map(r=>r&&r.$tupleid?wt:r);return e.fn[n]||(e.fn[n]=YC(i,t.$order,e.expr.codegen))}function UBt(t,e){const n=t.$encode,i={};for(const r in n){const s=n[r];i[r]=qr(e.encodeExpression(s.$expr),s.$fields),i[r].output=s.$output}return i}function jBt(t,e){return e}function qBt(t,e){const n=t.$subflow;return function(i,r,s){const o=e.fork().parse(n),a=o.get(n.operators[0].id),u=o.signals.parent;return u&&u.set(s),a.detachSubflow=()=>e.detach(o),a}}function VBt(){return wt}function WBt(t){var e=this,n=t.filter!=null?e.eventExpression(t.filter):void 0,i=t.stream!=null?e.get(t.stream):void 0,r;t.source?i=e.events(t.source,t.type,n):t.merge&&(r=t.merge.map(s=>e.get(s)),i=r[0].merge.apply(r[0],r.slice(1))),t.between&&(r=t.between.map(s=>e.get(s)),i=i.between(r[0],r[1])),t.filter&&(i=i.filter(n)),t.throttle!=null&&(i=i.throttle(+t.throttle)),t.debounce!=null&&(i=i.debounce(+t.debounce)),i==null&&q("Invalid stream definition: "+JSON.stringify(t)),t.consume&&i.consume(!0),e.stream(t,i)}function GBt(t){var e=this,n=ut(n=t.source)?n.$ref:n,i=e.get(n),r=null,s=t.update,o=void 0;i||q("Source not defined: "+t.source),r=t.target&&t.target.$expr?e.eventExpression(t.target.$expr):e.get(t.target),s&&s.$expr&&(s.$params&&(o=e.parseParameters(s.$params)),s=e.handlerExpression(s.$expr)),e.update(t,i,r,s,o)}const YBt={skip:!0};function HBt(t){var e=this,n={};if(t.signals){var i=n.signals={};Object.keys(e.signals).forEach(s=>{const o=e.signals[s];t.signals(s,o)&&(i[s]=o.value)})}if(t.data){var r=n.data={};Object.keys(e.data).forEach(s=>{const o=e.data[s];t.data(s,o)&&(r[s]=o.input.value)})}return e.subcontext&&t.recurse!==!1&&(n.subcontext=e.subcontext.map(s=>s.getState(t))),n}function XBt(t){var e=this,n=e.dataflow,i=t.data,r=t.signals;Object.keys(r||{}).forEach(s=>{n.update(e.signals[s],r[s],YBt)}),Object.keys(i||{}).forEach(s=>{n.pulse(e.data[s].input,n.changeset().remove(Ws).insert(i[s]))}),(t.subcontext||[]).forEach((s,o)=>{const a=e.subcontext[o];a&&a.setState(s)})}function pst(t,e,n,i){return new gst(t,e,n,i)}function gst(t,e,n,i){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=i||DBt,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function yP(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}gst.prototype=yP.prototype={fork(){const t=new yP(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter(n=>n!==t);const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,i=n.dataflow,r=t.value;if(n.set(t.id,e),FBt(t.type)&&r&&(r.$ingest?i.ingest(e,r.$ingest,r.$format):r.$request?i.preload(e,r.$request,r.$format):i.pulse(e,i.changeset().insert(r))),t.root&&(n.root=e),t.parent){let s=n.get(t.parent.$ref);s?(i.connect(s,[e]),e.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(t.parent.$ref),i.connect(s,[e]),e.targets().add(s)})}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const s in t.data){const o=n.data[s]||(n.data[s]={});t.data[s].forEach(a=>o[a]=e)}},resolve(){return(this.unresolved||[]).forEach(t=>t()),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[DR(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,i,r){this.dataflow.on(e,n,i,r,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:$Bt,parseOperator:CBt,parseOperatorParameters:NBt,parseParameters:OBt,parseStream:WBt,parseUpdate:GBt,getState:HBt,setState:XBt};function KBt(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),mst(e,t.description()))}function mst(t,e){t&&(e==null?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}function JBt(t){t.add(null,e=>(t._background=e.bg,t._resize=1,e.bg),{bg:t._signals.background})}const N3="default";function QBt(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:N3,item:null}));t.on(t.events("view","pointermove"),e,(n,i)=>{const r=e.value,s=r?at(r)?r:r.user:N3,o=i.item&&i.item.cursor||null;return r&&s===r.user&&o==r.item?r:{user:s,item:o}}),t.add(null,function(n){let i=n.cursor,r=this.value;return at(i)||(r=i.item,i=i.user),YF(t,i&&i!==N3?i:r||i),r},{cursor:e})}function YF(t,e){const n=t.globalCursor()?typeof document<"u"&&document.body:t.container();if(n)return e==null?n.style.removeProperty("cursor"):n.style.cursor=e}function gS(t,e){var n=t._runtime.data;return xt(n,e)||q("Unrecognized data set: "+e),n[e]}function ZBt(t,e){return arguments.length<2?gS(this,t).values.value:zA.call(this,t,$h().remove(Ws).insert(e))}function zA(t,e){Uet(e)||q("Second argument to changes must be a changeset.");const n=gS(this,t);return n.modified=!0,this.pulse(n.input,e)}function t7t(t,e){return zA.call(this,t,$h().insert(e))}function e7t(t,e){return zA.call(this,t,$h().remove(e))}function yst(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function bst(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function UA(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}function n7t(t){var e=UA(t),n=yst(t),i=bst(t);t._renderer.background(t.background()),t._renderer.resize(n,i,e),t._handler.origin(e),t._resizeListeners.forEach(r=>{try{r(n,i)}catch(s){t.error(s)}})}function i7t(t,e,n){var i=t._renderer,r=i&&i.canvas(),s,o,a;return r&&(a=UA(t),o=e.changedTouches?e.changedTouches[0]:e,s=kA(o,r),s[0]-=a[0],s[1]-=a[1]),e.dataflow=t,e.item=n,e.vega=r7t(t,n,s),e}function r7t(t,e,n){const i=e?e.mark.marktype==="group"?e:e.mark.group:null;function r(o){var a=i,u;if(o){for(u=e;u;u=u.mark.group)if(u.mark.name===o){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function s(o){if(!o)return n;at(o)&&(o=r(o));const a=n.slice();for(;o;)a[0]-=o.x||0,a[1]-=o.y||0,o=o.mark&&o.mark.group;return a}return{view:Bi(t),item:Bi(e||{}),group:r,xy:s,x:o=>s(o)[0],y:o=>s(o)[1]}}const bP="view",s7t="timer",o7t="window",a7t={trap:!1};function u7t(t){const e=Jt({defaults:{}},t),n=(i,r)=>{r.forEach(s=>{W(i[s])&&(i[s]=Mo(i[s]))})};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}function vst(t,e,n,i){t._eventListeners.push({type:n,sources:ot(e),handler:i})}function c7t(t,e){var n=t._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[e]:r?!r[e]:t.preventDefault()}function mw(t,e,n){const i=t._eventConfig&&t._eventConfig[e];return i===!1||ut(i)&&!i[n]?(t.warn(`Blocked ${e} ${n} event listener.`),!1):!0}function l7t(t,e,n){var i=this,r=new fA(n),s=function(c,l){i.runAsync(null,()=>{t===bP&&c7t(i,e)&&c.preventDefault(),r.receive(i7t(i,c,l))})},o;if(t===s7t)mw(i,"timer",e)&&i.timer(s,e);else if(t===bP)mw(i,"view",e)&&i.addEventListener(e,s,a7t);else if(t===o7t?mw(i,"window",e)&&typeof window<"u"&&(o=[window]):typeof document<"u"&&mw(i,"selector",e)&&(o=Array.from(document.querySelectorAll(t))),!o)i.warn("Can not resolve event source: "+t);else{for(var a=0,u=o.length;a<u;++a)o[a].addEventListener(e,s);vst(i,o,e,s)}return r}function vP(t){return t.item}function wP(t){return t.item.mark.source}function _P(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function f7t(t,e){return t=[t||"hover"],e=[e||"update",t[0]],this.on(this.events("view","pointerover",vP),wP,_P(t)),this.on(this.events("view","pointerout",vP),wP,_P(e)),this}function d7t(){var t=this._tooltip,e=this._timers,n=this._eventListeners,i,r,s;for(i=e.length;--i>=0;)e[i].stop();for(i=n.length;--i>=0;)for(s=n[i],r=s.sources.length;--r>=0;)s.sources[r].removeEventListener(s.type,s.handler);return t&&t.call(this,this._handler,null,null,null),this}function rs(t,e,n){const i=document.createElement(t);for(const r in e)i.setAttribute(r,e[r]);return n!=null&&(i.textContent=n),i}const h7t="vega-bind",p7t="vega-bind-name",g7t="vega-bind-radio";function m7t(t,e,n){if(!e)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:o=>{o!=t.signal(i.signal)&&t.runAsync(null,()=>{r.source=!0,t.signal(i.signal,o)})}},i.debounce&&(r.update=HC(i.debounce,r.update))),(i.input==null&&i.element?y7t:v7t)(r,e,i,t),r.active||(t.on(t._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(t.signal(i.signal))}),r.active=!0),r}function y7t(t,e,n,i){const r=n.event||"input",s=()=>t.update(e.value);i.signal(n.signal,e.value),e.addEventListener(r,s),vst(i,e,r,s),t.set=o=>{e.value=o,e.dispatchEvent(b7t(r))}}function b7t(t){return typeof Event<"u"?new Event(t):{type:t}}function v7t(t,e,n,i){const r=i.signal(n.signal),s=rs("div",{class:h7t}),o=n.input==="radio"?s:s.appendChild(rs("label"));o.appendChild(rs("span",{class:p7t},n.name||n.signal)),e.appendChild(s);let a=w7t;switch(n.input){case"checkbox":a=_7t;break;case"select":a=x7t;break;case"radio":a=S7t;break;case"range":a=E7t;break}a(t,o,n,r)}function w7t(t,e,n,i){const r=rs("input");for(const s in n)s!=="signal"&&s!=="element"&&r.setAttribute(s==="input"?"type":s,n[s]);r.setAttribute("name",n.signal),r.value=i,e.appendChild(r),r.addEventListener("input",()=>t.update(r.value)),t.elements=[r],t.set=s=>r.value=s}function _7t(t,e,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const s=rs("input",r);e.appendChild(s),s.addEventListener("change",()=>t.update(s.checked)),t.elements=[s],t.set=o=>s.checked=!!o||null}function x7t(t,e,n,i){const r=rs("select",{name:n.signal}),s=n.labels||[];n.options.forEach((o,a)=>{const u={value:o};mS(o,i)&&(u.selected=!0),r.appendChild(rs("option",u,(s[a]||o)+""))}),e.appendChild(r),r.addEventListener("change",()=>{t.update(n.options[r.selectedIndex])}),t.elements=[r],t.set=o=>{for(let a=0,u=n.options.length;a<u;++a)if(mS(n.options[a],o)){r.selectedIndex=a;return}}}function S7t(t,e,n,i){const r=rs("span",{class:g7t}),s=n.labels||[];e.appendChild(r),t.elements=n.options.map((o,a)=>{const u={type:"radio",name:n.signal,value:o};mS(o,i)&&(u.checked=!0);const c=rs("input",u);c.addEventListener("change",()=>t.update(o));const l=rs("label",{},(s[a]||o)+"");return l.prepend(c),r.appendChild(l),c}),t.set=o=>{const a=t.elements,u=a.length;for(let c=0;c<u;++c)mS(a[c].value,o)&&(a[c].checked=!0)}}function E7t(t,e,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,s=n.min||Math.min(0,r,+i)||0,o=n.step||Dl(s,r,100),a=rs("input",{type:"range",name:n.signal,min:s,max:r,step:o});a.value=i;const u=rs("span",{},+i);e.appendChild(a),e.appendChild(u);const c=()=>{u.textContent=a.value,t.update(+a.value)};a.addEventListener("input",c),a.addEventListener("change",c),t.elements=[a],t.set=l=>{a.value=l,u.textContent=l}}function mS(t,e){return t===e||t+""==e+""}function wst(t,e,n,i,r,s){return e=e||new i(t.loader()),e.initialize(n,yst(t),bst(t),UA(t),r,s).background(t.background())}function CR(t,e){return e?function(){try{e.apply(this,arguments)}catch(n){t.error(n)}}:null}function A7t(t,e,n,i){const r=new i(t.loader(),CR(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,UA(t),t);return e&&e.handlers().forEach(s=>{r.on(s.type,s.handler)}),r}function $7t(t,e){const n=this,i=n._renderType,r=n._eventConfig.bind,s=CA(i);t=n._el=t?O3(n,t,!0):null,KBt(n),s||n.error("Unrecognized renderer type: "+i);const o=s.handler||Hl,a=t?s.renderer:s.headless;return n._renderer=a?wst(n,n._renderer,t,a):null,n._handler=A7t(n,n._handler,t,o),n._redraw=!0,t&&r!=="none"&&(e=e?n._elBind=O3(n,e,!0):t.appendChild(rs("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&r!=="container"&&(u.element=O3(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{m7t(n,u.element||e,u)})),n}function O3(t,e,n){if(typeof e=="string")if(typeof document<"u"){if(e=document.querySelector(e),!e)return t.error("Signal bind element not found: "+e),null}else return t.error("DOM document instance not found."),null;if(e&&n)try{e.textContent=""}catch(i){e=null,t.error(i)}return e}const M0=t=>+t||0,I7t=t=>({top:t,bottom:t,left:t,right:t});function xP(t){return ut(t)?{top:M0(t.top),bottom:M0(t.bottom),left:M0(t.left),right:M0(t.right)}:I7t(M0(t))}async function NR(t,e,n,i){const r=CA(e),s=r&&r.headless;return s||q("Unrecognized renderer type: "+e),await t.runAsync(),wst(t,null,null,s,n,i).renderAsync(t._scenegraph.root)}async function M7t(t,e){t!==ul.Canvas&&t!==ul.SVG&&t!==ul.PNG&&q("Unrecognized image type: "+t);const n=await NR(this,t,e);return t===ul.SVG?T7t(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function T7t(t,e){const n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}async function F7t(t,e){return(await NR(this,ul.Canvas,t,e)).canvas()}async function k7t(t){return(await NR(this,ul.SVG,t)).svg()}function D7t(t,e,n){return pst(t,Vg,W1,n).parse(e)}function C7t(t){var e=this._runtime.scales;return xt(e,t)||q("Unrecognized scale or projection: "+t),e[t].value}var _st="width",xst="height",OR="padding",SP={skip:!0};function Sst(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===OR?i.left+i.right:0)}function Est(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===OR?i.top+i.bottom:0)}function N7t(t){var e=t._signals,n=e[_st],i=e[xst],r=e[OR];function s(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,a=>{t._width=a.size,t._viewWidth=Sst(t,a.size),s()},{size:n}),t._resizeHeight=t.add(null,a=>{t._height=a.size,t._viewHeight=Est(t,a.size),s()},{size:i});const o=t.add(null,s,{pad:r});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}function O7t(t,e,n,i,r,s){this.runAfter(o=>{let a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal(_st,n,SP),o._resizeWidth.skip(!0)),o.height()!==i&&(a=1,o.signal(xst,i,SP),o._resizeHeight.skip(!0)),o._viewWidth!==t&&(o._resize=1,o._viewWidth=t),o._viewHeight!==e&&(o._resize=1,o._viewHeight=e),(o._origin[0]!==r[0]||o._origin[1]!==r[1])&&(o._resize=1,o._origin=r),a&&o.run("enter"),s&&o.runAfter(u=>u.resize())},!1,1)}function R7t(t){return this._runtime.getState(t||{data:L7t,signals:B7t,recurse:!0})}function L7t(t,e){return e.modified&&W(e.input.value)&&!t.startsWith("_:vega:_")}function B7t(t,e){return!(t==="parent"||e instanceof Vg.proxy)}function P7t(t){return this.runAsync(null,e=>{e._trigger=!1,e._runtime.setState(t)},e=>{e._trigger=!0}),this}function z7t(t,e){function n(i){t({timestamp:Date.now(),elapsed:i})}this._timers.push(hbt(n,e))}function U7t(t,e,n,i){const r=t.element();r&&r.setAttribute("title",j7t(i))}function j7t(t){return t==null?"":W(t)?Ast(t):ut(t)&&!gl(t)?q7t(t):t+""}function q7t(t){return Object.keys(t).map(e=>{const n=t[e];return e+": "+(W(n)?Ast(n):$st(n))}).join(`
`)}function Ast(t){return"["+t.map($st).join(", ")+"]"}function $st(t){return W(t)?"[…]":ut(t)&&!gl(t)?"{…}":t}function V7t(){if(this.renderer()==="canvas"&&this._renderer._canvas){let t=null;const e=()=>{t!=null&&t();const n=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);n.addEventListener("change",e),t=()=>{n.removeEventListener("change",e)},this._renderer._canvas.getContext("2d").pixelRatio=window.devicePixelRatio||1,this._redraw=!0,this._resize=1,this.resize().runAsync()};e()}}function Ist(t,e){const n=this;if(e=e||{},cg.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),e.logLevel!=null&&n.logLevel(e.logLevel),e.locale||t.locale){const s=Jt({},t.locale,e.locale);n.locale(ket(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||ul.Canvas,n._scenegraph=new IO;const i=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||U7t,n._redraw=!0,n._handler=new Hl().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=u7t(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=D7t(n,t,e.expr);n._runtime=r,n._signals=r.signals,n._bind=(t.bindings||[]).map(s=>({state:null,param:Jt({},s)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=Sst(n,n._width),n._viewHeight=Est(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,N7t(n),JBt(n),QBt(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind),e.watchPixelRatio&&n._watchPixelRatio()}function yw(t,e){return xt(t._signals,e)?t._signals[e]:q("Unrecognized signal name: "+Q(e))}function Mst(t,e){const n=(t._targets||[]).filter(i=>i._update&&i._update.handler===e);return n.length?n[0]:null}function EP(t,e,n,i){let r=Mst(n,i);return r||(r=CR(t,()=>i(e,n.value)),r.handler=i,t.on(n,null,r)),t}function AP(t,e,n){const i=Mst(e,n);return i&&e._targets.remove(i),t}J(Ist,cg,{async evaluate(t,e,n){if(await cg.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,n7t(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&c2(this,n),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=t!=null?t+"":null;return e!==this._desc&&mst(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){const i=yw(this,t);return arguments.length===1?i.value:this.update(i,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",xP(t)):xP(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?(CA(t)||q("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(cg.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(yw(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:O7t,addEventListener(t,e,n){let i=e;return n&&n.trap===!1||(i=CR(this,e),i.raw=e),this._handler.on(t,i),this},removeEventListener(t,e){for(var n=this._handler.handlers(t),i=n.length,r,s;--i>=0;)if(s=n[i].type,r=n[i].handler,t===s&&(e===r||e===r.raw)){this._handler.off(s,r);break}return this},addResizeListener(t){const e=this._resizeListeners;return e.includes(t)||e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},addSignalListener(t,e){return EP(this,t,yw(this,t),e)},removeSignalListener(t,e){return AP(this,yw(this,t),e)},addDataListener(t,e){return EP(this,t,gS(this,t).values,e)},removeDataListener(t,e){return AP(this,gS(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=YF(this,null);this._globalCursor=!!t,e&&YF(this,e)}return this}else return this._globalCursor},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:z7t,events:l7t,finalize:d7t,hover:f7t,data:ZBt,change:zA,insert:t7t,remove:e7t,scale:C7t,initialize:$7t,toImageURL:M7t,toCanvas:F7t,toSVG:k7t,getState:R7t,setState:P7t,_watchPixelRatio:V7t});const W7t="view",yS="[",bS="]",Tst="{",Fst="}",G7t=":",kst=",",Y7t="@",H7t=">",X7t=/[[\]{}]/,K7t={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let Dst,Cst;function yf(t,e,n){return Dst=e||W7t,Cst=n||K7t,Nst(t.trim()).map(HF)}function J7t(t){return Cst[t]}function qy(t,e,n,i,r){const s=t.length;let o=0,a;for(;e<s;++e){if(a=t[e],!o&&a===n)return e;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return e}function Nst(t){const e=[],n=t.length;let i=0,r=0;for(;r<n;)r=qy(t,r,kst,yS+Tst,bS+Fst),e.push(t.substring(i,r).trim()),i=++r;if(e.length===0)throw"Empty event selector: "+t;return e}function HF(t){return t[0]==="["?Q7t(t):Z7t(t)}function Q7t(t){const e=t.length;let n=1,i;if(n=qy(t,n,bS,yS,bS),n===e)throw"Empty between selector: "+t;if(i=Nst(t.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+t;if(t=t.slice(n+1).trim(),t[0]!==H7t)throw"Expected '>' after between selector: "+t;i=i.map(HF);const r=HF(t.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}function Z7t(t){const e={source:Dst},n=[];let i=[0,0],r=0,s=0,o=t.length,a=0,u,c;if(t[o-1]===Fst){if(a=t.lastIndexOf(Tst),a>=0){try{i=t9t(t.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,a).trim(),o=t.length}else throw"Unmatched right brace: "+t;a=0}if(!o)throw t;if(t[0]===Y7t&&(r=++a),u=qy(t,a,G7t),u<o&&(n.push(t.substring(s,u).trim()),s=a=++u),a=qy(t,a,yS),a===o)n.push(t.substring(s,o).trim());else if(n.push(t.substring(s,a).trim()),c=[],s=++a,s===o)throw"Unmatched left bracket: "+t;for(;a<o;){if(a=qy(t,a,bS),a===o)throw"Unmatched left bracket: "+t;if(c.push(t.substring(s,a).trim()),a<o-1&&t[++a]!==yS)throw"Expected left bracket: "+t;s=++a}if(!(o=n.length)||X7t.test(n[o-1]))throw"Invalid event selector: "+t;return o>1?(e.type=n[1],r?e.markname=n[0].slice(1):J7t(n[0])?e.marktype=n[0]:e.source=n[0]):e.type=n[0],e.type.slice(-1)==="!"&&(e.consume=!0,e.type=e.type.slice(0,-1)),c!=null&&(e.filter=c),i[0]&&(e.throttle=i[0]),i[1]&&(e.debounce=i[1]),e}function t9t(t){const e=t.split(kst);if(!t.length||e.length>2)throw t;return e.map(n=>{const i=+n;if(i!==i)throw t;return i})}function e9t(t){return ut(t)?t:{type:t||"pad"}}const T0=t=>+t||0,n9t=t=>({top:t,bottom:t,left:t,right:t});function i9t(t){return ut(t)?t.signal?t:{top:T0(t.top),bottom:T0(t.bottom),left:T0(t.left),right:T0(t.right)}:n9t(T0(t))}const ni=t=>ut(t)&&!W(t)?Jt({},t):{value:t};function $P(t,e,n,i){return n!=null?(ut(n)&&!W(n)||W(n)&&n.length&&ut(n[0])?t.update[e]=n:t[i||"enter"][e]={value:n},1):0}function bi(t,e,n){for(const i in e)$P(t,i,e[i]);for(const i in n)$P(t,i,n[i],"update")}function Ym(t,e,n){for(const i in e)n&&xt(n,i)||(t[i]=Jt(t[i]||{},e[i]));return t}function Tp(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const RR="mark",LR="frame",BR="scope",r9t="axis",s9t="axis-domain",o9t="axis-grid",a9t="axis-label",u9t="axis-tick",c9t="axis-title",l9t="legend",f9t="legend-band",d9t="legend-entry",h9t="legend-gradient",Ost="legend-label",p9t="legend-symbol",g9t="legend-title",m9t="title",y9t="title-text",b9t="title-subtitle";function v9t(t,e,n,i,r){const s={},o={};let a,u,c,l;u="lineBreak",e==="text"&&r[u]!=null&&!Tp(u,t)&&R3(s,u,r[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),l=n===LR?r.group:n===RR?Jt({},r.mark,r[e]):null;for(u in l)c=Tp(u,t)||(u==="fill"||u==="stroke")&&(Tp("fill",t)||Tp("stroke",t)),c||R3(s,u,l[u]);ot(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)Tp(h,t)||R3(s,h,d[h])}),t=Jt({},t);for(u in s)l=s[u],l.signal?(a=a||{})[u]=l:o[u]=l;return t.enter=Jt(o,t.enter),a&&(t.update=Jt(a,t.update)),t}function R3(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const Rst=t=>at(t)?Q(t):t.signal?`(${t.signal})`:Lst(t);function jA(t){if(t.gradient!=null)return _9t(t);let e=t.signal?`(${t.signal})`:t.color?w9t(t.color):t.field!=null?Lst(t.field):t.value!==void 0?Q(t.value):void 0;return t.scale!=null&&(e=x9t(t,e)),e===void 0&&(e=null),t.exponent!=null&&(e=`pow(${e},${x2(t.exponent)})`),t.mult!=null&&(e+=`*${x2(t.mult)}`),t.offset!=null&&(e+=`+${x2(t.offset)}`),t.round&&(e=`round(${e})`),e}const bw=(t,e,n,i)=>`(${t}(${[e,n,i].map(jA).join(",")})+'')`;function w9t(t){return t.c?bw("hcl",t.h,t.c,t.l):t.h||t.s?bw("hsl",t.h,t.s,t.l):t.l||t.a?bw("lab",t.l,t.a,t.b):t.r||t.g||t.b?bw("rgb",t.r,t.g,t.b):null}function _9t(t){const e=[t.start,t.stop,t.count].map(n=>n==null?null:Q(n));for(;e.length&&pe(e)==null;)e.pop();return e.unshift(Rst(t.gradient)),`gradient(${e.join(",")})`}function x2(t){return ut(t)?"("+jA(t)+")":t}function Lst(t){return Bst(ut(t)?t:{datum:t})}function Bst(t){let e,n,i;if(t.signal)e="datum",i=t.signal;else if(t.group||t.parent){for(n=Math.max(1,t.level||1),e="item";n-- >0;)e+=".mark.group";t.parent?(i=t.parent,e+=".datum"):i=t.group}else t.datum?(e="datum",i=t.datum):q("Invalid field reference: "+Q(t));return t.signal||(i=at(i)?Za(i).map(Q).join("]["):Bst(i)),e+"["+i+"]"}function x9t(t,e){const n=Rst(t.scale);return t.range!=null?e=`lerp(_range(${n}), ${+t.range})`:(e!==void 0&&(e=`_scale(${n}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${n})`+(+t.band==1?"":"*"+x2(t.band)),t.extra&&(e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`)),e==null&&(e="0")),e}function S9t(t){let e="";return t.forEach(n=>{const i=jA(n);e+=n.test?`(${n.test})?${i}:`:i}),pe(e)===":"&&(e+="null"),e}function Pst(t,e,n,i,r,s){const o={};s=s||{},s.encoders={$encode:o},t=v9t(t,e,n,i,r.config);for(const a in t)o[a]=E9t(t[a],e,s,r);return s}function E9t(t,e,n,i){const r={},s={};for(const o in t)t[o]!=null&&(r[o]=$9t(A9t(t[o]),i,n,s));return{$expr:{marktype:e,channels:r},$fields:Object.keys(s),$output:Object.keys(t)}}function A9t(t){return W(t)?S9t(t):jA(t)}function $9t(t,e,n,i){const r=qa(t,e);return r.$fields.forEach(s=>i[s]=1),Jt(n,r.$params),r.$expr}const I9t="outer",M9t=["value","update","init","react","bind"];function IP(t,e){q(t+' for "outer" push: '+Q(e))}function zst(t,e){const n=t.name;if(t.push===I9t)e.signals[n]||IP("No prior signal definition",n),M9t.forEach(i=>{t[i]!==void 0&&IP("Invalid property ",i)});else{const i=e.addSignal(n,t.value);t.react===!1&&(i.react=!1),t.bind&&e.addBinding(n,t.bind)}}function XF(t,e,n,i){this.id=-1,this.type=t,this.value=e,this.params=n,i&&(this.parent=i)}function qA(t,e,n,i){return new XF(t,e,n,i)}function vS(t,e){return qA("operator",t,e)}function vt(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function G1(t,e){return e?{$field:t,$name:e}:{$field:t}}const KF=G1("key");function MP(t,e){return{$compare:t,$order:e}}function T9t(t,e){const n={$key:t};return e&&(n.$flat=!0),n}const F9t="ascending",k9t="descending";function D9t(t){return ut(t)?(t.order===k9t?"-":"+")+VA(t.op,t.field):""}function VA(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const PR="scope",JF="view";function Vn(t){return t&&t.signal}function C9t(t){return t&&t.expr}function S2(t){if(Vn(t))return!0;if(ut(t)){for(const e in t)if(S2(t[e]))return!0}return!1}function uo(t,e){return t??e}function Cd(t){return t&&t.signal||t}const TP="timer";function Y1(t,e){return(t.merge?O9t:t.stream?R9t:t.type?L9t:q("Invalid stream specification: "+Q(t)))(t,e)}function N9t(t){return t===PR?JF:t||JF}function O9t(t,e){const n=t.merge.map(r=>Y1(r,e)),i=zR({merge:n},t,e);return e.addStream(i).id}function R9t(t,e){const n=Y1(t.stream,e),i=zR({stream:n},t,e);return e.addStream(i).id}function L9t(t,e){let n;t.type===TP?(n=e.event(TP,t.throttle),t={between:t.between,filter:t.filter}):n=e.event(N9t(t.source),t.type);const i=zR({stream:n},t,e);return Object.keys(i).length===1?n:e.addStream(i).id}function zR(t,e,n){let i=e.between;return i&&(i.length!==2&&q('Stream "between" parameter must have 2 entries: '+Q(e)),t.between=[Y1(i[0],n),Y1(i[1],n)]),i=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&i.push(B9t(e.marktype,e.markname,e.markrole)),e.source===PR&&i.push("inScope(event.item)"),i.length&&(t.filter=qa("("+i.join(")&&(")+")",n).$expr),(i=e.throttle)!=null&&(t.throttle=+i),(i=e.debounce)!=null&&(t.debounce=+i),e.consume&&(t.consume=!0),t}function B9t(t,e,n){const i="event.item";return i+(t&&t!=="*"?"&&"+i+".mark.marktype==='"+t+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(e?"&&"+i+".mark.name==='"+e+"'":"")}const P9t={code:"_.$value",ast:{type:"Identifier",value:"value"}};function z9t(t,e,n){const i=t.encode,r={target:n};let s=t.events,o=t.update,a=[];s||q("Signal update missing events specification."),at(s)&&(s=yf(s,e.isSubscope()?PR:JF)),s=ot(s).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[j9t(a)]),s.length&&a.push(s.length>1?{merge:s}:s[0]),i!=null&&(o&&q("Signal encode and update are mutually exclusive."),o="encode(item(),"+Q(i)+")"),r.update=at(o)?qa(o,e):o.expr!=null?qa(o.expr,e):o.value!=null?o.value:o.signal!=null?{$expr:P9t,$params:{$value:e.signalRef(o.signal)}}:q("Invalid signal update specification."),t.force&&(r.options={force:!0}),a.forEach(u=>e.addUpdate(Jt(U9t(u,e),r)))}function U9t(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):Y1(t,e)}}function j9t(t){return{signal:"["+t.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}function q9t(t,e){const n=e.getSignal(t.name);let i=t.update;t.init&&(i?q("Signals can not include both init and update expressions."):(i=t.init,n.initonly=!0)),i&&(i=qa(i,e),n.update=i.$expr,n.params=i.$params),t.on&&t.on.forEach(r=>z9t(r,e,n.id))}const Pe=t=>(e,n,i)=>qA(t,n,e||void 0,i),Ust=Pe("aggregate"),V9t=Pe("axisticks"),jst=Pe("bound"),Po=Pe("collect"),FP=Pe("compare"),W9t=Pe("datajoin"),qst=Pe("encode"),G9t=Pe("expression"),Y9t=Pe("facet"),H9t=Pe("field"),X9t=Pe("key"),K9t=Pe("legendentries"),J9t=Pe("load"),Q9t=Pe("mark"),Z9t=Pe("multiextent"),tPt=Pe("multivalues"),ePt=Pe("overlap"),nPt=Pe("params"),Vst=Pe("prefacet"),iPt=Pe("projection"),rPt=Pe("proxy"),sPt=Pe("relay"),Wst=Pe("render"),oPt=Pe("scale"),Th=Pe("sieve"),aPt=Pe("sortitems"),Gst=Pe("viewlayout"),uPt=Pe("values");let cPt=0;const Yst={min:"min",max:"max",count:"sum"};function lPt(t,e){const n=t.type||"linear";Lnt(n)||q("Unrecognized scale type: "+Q(n)),e.addScale(t.name,{type:n,domain:void 0})}function fPt(t,e){const n=e.getScale(t.name).params;let i;n.domain=Hst(t.domain,t,e),t.range!=null&&(n.range=Kst(t,e,n)),t.interpolate!=null&&_Pt(t.interpolate,n),t.nice!=null&&(n.nice=wPt(t.nice,e)),t.bins!=null&&(n.bins=vPt(t.bins,e));for(i in t)xt(n,i)||i==="name"||(n[i]=Fs(t[i],e))}function Fs(t,e){return ut(t)?t.signal?e.signalRef(t.signal):q("Unsupported object: "+Q(t)):t}function E2(t,e){return t.signal?e.signalRef(t.signal):t.map(n=>Fs(n,e))}function WA(t){q("Can not find data set: "+Q(t))}function Hst(t,e,n){if(!t){(e.domainMin!=null||e.domainMax!=null)&&q("No scale domain defined for domainMin/domainMax to override.");return}return t.signal?n.signalRef(t.signal):(W(t)?dPt:t.fields?pPt:hPt)(t,e,n)}function dPt(t,e,n){return t.map(i=>Fs(i,n))}function hPt(t,e,n){const i=n.getData(t.data);return i||WA(t.data),Yg(e.type)?i.valuesRef(n,t.field,Xst(t.sort,!1)):znt(e.type)?i.domainRef(n,t.field):i.extentRef(n,t.field)}function pPt(t,e,n){const i=t.data,r=t.fields.reduce((s,o)=>(o=at(o)?{data:i,field:o}:W(o)||o.signal?gPt(o,n):o,s.push(o),s),[]);return(Yg(e.type)?mPt:znt(e.type)?yPt:bPt)(t,n,r)}function gPt(t,e){const n="_:vega:_"+cPt++,i=Po({});if(W(t))i.value={$ingest:t};else if(t.signal){const r="setdata("+Q(n)+","+t.signal+")";i.params.input=e.signalRef(r)}return e.addDataPipeline(n,[i,Th({})]),{data:n,field:"data"}}function mPt(t,e,n){const i=Xst(t.sort,!0);let r,s;const o=n.map(c=>{const l=e.getData(c.data);return l||WA(c.data),l.countsRef(e,c.field,i)}),a={groupby:KF,pulse:o};i&&(r=i.op||"count",s=i.field?VA(r,i.field):"count",a.ops=[Yst[r]],a.fields=[e.fieldRef(s)],a.as=[s]),r=e.add(Ust(a));const u=e.add(Po({pulse:vt(r)}));return s=e.add(uPt({field:KF,sort:e.sortRef(i),pulse:vt(u)})),vt(s)}function Xst(t,e){return t&&(!t.field&&!t.op?ut(t)?t.field="key":t={field:"key"}:!t.field&&t.op!=="count"?q("No field provided for sort aggregate op: "+t.op):e&&t.field&&t.op&&!Yst[t.op]&&q("Multiple domain scales can not be sorted using "+t.op)),t}function yPt(t,e,n){const i=n.map(r=>{const s=e.getData(r.data);return s||WA(r.data),s.domainRef(e,r.field)});return vt(e.add(tPt({values:i})))}function bPt(t,e,n){const i=n.map(r=>{const s=e.getData(r.data);return s||WA(r.data),s.extentRef(e,r.field)});return vt(e.add(Z9t({extents:i})))}function vPt(t,e){return t.signal||W(t)?E2(t,e):e.objectProperty(t)}function wPt(t,e){return t.signal?e.signalRef(t.signal):ut(t)?{interval:Fs(t.interval),step:Fs(t.step)}:Fs(t)}function _Pt(t,e){e.interpolate=Fs(t.type||t),t.gamma!=null&&(e.interpolateGamma=Fs(t.gamma))}function Kst(t,e,n){const i=e.config.range;let r=t.range;if(r.signal)return e.signalRef(r.signal);if(at(r)){if(i&&xt(i,r))return t=Jt({},t,{range:i[r]}),Kst(t,e,n);r==="width"?r=[0,{signal:"width"}]:r==="height"?r=Yg(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:q("Unrecognized scale range value: "+Q(r))}else if(r.scheme){n.scheme=W(r.scheme)?E2(r.scheme,e):Fs(r.scheme,e),r.extent&&(n.schemeExtent=E2(r.extent,e)),r.count&&(n.schemeCount=Fs(r.count,e));return}else if(r.step){n.rangeStep=Fs(r.step,e);return}else{if(Yg(t.type)&&!W(r))return Hst(r,t,e);W(r)||q("Unsupported range type: "+Q(r))}return r.map(s=>(W(s)?E2:Fs)(s,e))}function xPt(t,e){const n=e.config.projection||{},i={};for(const r in t)r!=="name"&&(i[r]=QF(t[r],r,e));for(const r in n)i[r]==null&&(i[r]=QF(n[r],r,e));e.addProjection(t.name,i)}function QF(t,e,n){return W(t)?t.map(i=>QF(i,e,n)):ut(t)?t.signal?n.signalRef(t.signal):e==="fit"?t:q("Unsupported parameter object: "+Q(t)):t}const zo="top",Hm="left",Xm="right",Kl="bottom",Jst="center",SPt="vertical",EPt="start",APt="middle",$Pt="end",ZF="index",UR="label",IPt="offset",Qg="perc",MPt="perc2",Cs="value",sv="guide-label",jR="guide-title",TPt="group-title",FPt="group-subtitle",kP="symbol",A2="gradient",tk="discrete",ek="size",kPt="shape",DPt="fill",CPt="stroke",NPt="strokeWidth",OPt="strokeDash",RPt="opacity",qR=[ek,kPt,DPt,CPt,NPt,OPt,RPt],ov={name:1,style:1,interactive:1},ye={value:0},Ns={value:1},GA="group",Qst="rect",VR="rule",LPt="symbol",Fh="text";function H1(t){return t.type=GA,t.interactive=t.interactive||!1,t}function Vr(t,e){const n=(i,r)=>uo(t[i],uo(e[i],r));return n.isVertical=i=>SPt===uo(t.direction,e.direction||(i?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>uo(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>uo(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>uo(t.columns,uo(e.columns,+n.isVertical(!0))),n}function Zst(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function BPt(t,e,n){const i=e.config.style[n];return i&&i[t]}function YA(t,e,n){return`item.anchor === '${EPt}' ? ${t} : item.anchor === '${$Pt}' ? ${e} : ${n}`}const WR=YA(Q(Hm),Q(Xm),Q(Jst));function PPt(t){const e=t("tickBand");let n=t("tickOffset"),i,r;return e?e.signal?(i={signal:`(${e.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${e.signal}) === 'extent'`},ut(n)||(n={signal:`(${e.signal}) === 'extent' ? 0 : ${n}`})):e==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=t("bandPosition"),r=t("tickExtra")),{extra:r,band:i,offset:n}}function tot(t,e){return e?t?ut(t)?Object.assign({},t,{offset:tot(t.offset,e)}):{value:t,offset:e}:e:t}function fs(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=Ym(t.encode,e,ov)):t.interactive=!1,t}function zPt(t,e,n,i){const r=Vr(t,n),s=r.isVertical(),o=r.gradientThickness(),a=r.gradientLength();let u,c,l,f,d;s?(c=[0,1],l=[0,0],f=o,d=a):(c=[0,0],l=[1,0],f=a,d=o);const h={enter:u={opacity:ye,x:ye,y:ye,width:ni(f),height:ni(d)},update:Jt({},u,{opacity:Ns,fill:{gradient:e,start:c,stop:l}}),exit:{opacity:ye}};return bi(h,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),fs({type:Qst,role:h9t,encode:h},i)}function UPt(t,e,n,i,r){const s=Vr(t,n),o=s.isVertical(),a=s.gradientThickness(),u=s.gradientLength();let c,l,f,d,h="";o?(c="y",f="y2",l="x",d="width",h="1-"):(c="x",f="x2",l="y",d="height");const p={opacity:ye,fill:{scale:e,field:Cs}};p[c]={signal:h+"datum."+Qg,mult:u},p[l]=ye,p[f]={signal:h+"datum."+MPt,mult:u},p[d]=ni(a);const g={enter:p,update:Jt({},p,{opacity:Ns}),exit:{opacity:ye}};return bi(g,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),fs({type:Qst,role:f9t,key:Cs,from:r,encode:g},i)}const jPt=`datum.${Qg}<=0?"${Hm}":datum.${Qg}>=1?"${Xm}":"${Jst}"`,qPt=`datum.${Qg}<=0?"${Kl}":datum.${Qg}>=1?"${zo}":"${APt}"`;function DP(t,e,n,i){const r=Vr(t,e),s=r.isVertical(),o=ni(r.gradientThickness()),a=r.gradientLength();let u=r("labelOverlap"),c,l,f,d,h="";const p={enter:c={opacity:ye},update:l={opacity:Ns,text:{field:UR}},exit:{opacity:ye}};return bi(p,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:uo(t.labelLimit,e.gradientLabelLimit)}),s?(c.align={value:"left"},c.baseline=l.baseline={signal:qPt},f="y",d="x",h="1-"):(c.align=l.align={signal:jPt},c.baseline={value:"top"},f="x",d="y"),c[f]=l[f]={signal:h+"datum."+Qg,mult:a},c[d]=l[d]=o,o.offset=uo(t.labelOffset,e.gradientLabelOffset)||0,u=u?{separation:r("labelSeparation"),method:u,order:"datum."+ZF}:void 0,fs({type:Fh,role:Ost,style:sv,key:Cs,from:i,encode:p,overlap:u},n)}function VPt(t,e,n,i,r){const s=Vr(t,e),o=n.entries,a=!!(o&&o.interactive),u=o?o.name:void 0,c=s("clipHeight"),l=s("symbolOffset"),f={data:"value"},d=`(${r}) ? datum.${IPt} : datum.${ek}`,h=c?ni(c):{field:ek},p=`datum.${ZF}`,g=`max(1, ${r})`;let m,y,b,v,w;h.mult=.5,m={enter:y={opacity:ye,x:{signal:d,mult:.5,offset:l},y:h},update:b={opacity:Ns,x:y.x,y:y.y},exit:{opacity:ye}};let _=null,S=null;t.fill||(_=e.symbolBaseFillColor,S=e.symbolBaseStrokeColor),bi(m,{fill:s("symbolFillColor",_),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",S),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),qR.forEach($=>{t[$]&&(b[$]=y[$]={scale:t[$],field:Cs})});const x=fs({type:LPt,role:p9t,key:Cs,from:f,clip:c?!0:void 0,encode:m},n.symbols),E=ni(l);E.offset=s("labelOffset"),m={enter:y={opacity:ye,x:{signal:d,offset:E},y:h},update:b={opacity:Ns,text:{field:UR},x:y.x,y:y.y},exit:{opacity:ye}},bi(m,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const A=fs({type:Fh,role:Ost,style:sv,key:Cs,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!c},width:ye,height:c?ni(c):ye,opacity:ye},exit:{opacity:ye},update:b={opacity:Ns,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(v=`ceil(item.mark.items.length / ${g})`,b.row.signal=`${p}%${v}`,b.column.signal=`floor(${p} / ${v})`,w={field:["row",p]}):(b.row.signal=`floor(${p} / ${g})`,b.column.signal=`${p} % ${g}`,w={field:p}),b.column.signal=`(${r})?${b.column.signal}:${p}`,i={facet:{data:i,name:"value",groupby:ZF}},H1({role:BR,from:i,encode:Ym(m,o,ov),marks:[x,A],name:u,interactive:a,sort:w})}function WPt(t,e){const n=Vr(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const GR='item.orient === "left"',YR='item.orient === "right"',HA=`(${GR} || ${YR})`,GPt=`datum.vgrad && ${HA}`,YPt=YA('"top"','"bottom"','"middle"'),HPt=YA('"right"','"left"','"center"'),XPt=`datum.vgrad && ${YR} ? (${HPt}) : (${HA} && !(datum.vgrad && ${GR})) ? "left" : ${WR}`,KPt=`item._anchor || (${HA} ? "middle" : "start")`,JPt=`${GPt} ? (${GR} ? -90 : 90) : 0`,QPt=`${HA} ? (datum.vgrad ? (${YR} ? "bottom" : "top") : ${YPt}) : "top"`;function ZPt(t,e,n,i){const r=Vr(t,e),s={enter:{opacity:ye},update:{opacity:Ns,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:ye}};return bi(s,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:KPt},angle:{signal:JPt},align:{signal:XPt},baseline:{signal:QPt},text:t.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),fs({type:Fh,role:g9t,style:jR,from:i,encode:s},n)}function tzt(t,e){let n;return ut(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+CP(t.path)+")":t.sphere&&(n="geoShape("+CP(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function CP(t){return ut(t)&&t.signal?t.signal:Q(t)}function eot(t){const e=t.role||"";return e.startsWith("axis")||e.startsWith("legend")||e.startsWith("title")?e:t.type===GA?BR:e||RR}function ezt(t){return{marktype:t.type,name:t.name||void 0,role:t.role||eot(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function nzt(t,e){return t&&t.signal?e.signalRef(t.signal):t!==!1}function HR(t,e){const n=Vet(t.type);n||q("Unrecognized transform type: "+Q(t.type));const i=qA(n.type.toLowerCase(),null,not(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(i)),i.metadata=n.metadata||{},i}function not(t,e,n){const i={},r=t.params.length;for(let s=0;s<r;++s){const o=t.params[s];i[o.name]=izt(o,e,n)}return i}function izt(t,e,n){const i=t.type,r=e[t.name];if(i==="index")return rzt(t,e,n);if(r===void 0){t.required&&q("Missing required "+Q(e.type)+" parameter: "+Q(t.name));return}else{if(i==="param")return szt(t,e,n);if(i==="projection")return n.projectionRef(e[t.name])}return t.array&&!Vn(r)?r.map(s=>NP(t,s,n)):NP(t,r,n)}function NP(t,e,n){const i=t.type;if(Vn(e))return RP(i)?q("Expression references can not be signals."):L3(i)?n.fieldRef(e):LP(i)?n.compareRef(e):n.signalRef(e.signal);{const r=t.expr||L3(i);return r&&ozt(e)?n.exprRef(e.expr,e.as):r&&azt(e)?G1(e.field,e.as):RP(i)?qa(e,n):uzt(i)?vt(n.getData(e).values):L3(i)?G1(e):LP(i)?n.compareRef(e):e}}function rzt(t,e,n){return at(e.from)||q('Lookup "from" parameter must be a string literal.'),n.getData(e.from).lookupRef(n,e.key)}function szt(t,e,n){const i=e[t.name];return t.array?(W(i)||q("Expected an array of sub-parameters. Instead: "+Q(i)),i.map(r=>OP(t,r,n))):OP(t,i,n)}function OP(t,e,n){const i=t.params.length;let r;for(let o=0;o<i;++o){r=t.params[o];for(const a in r.key)if(r.key[a]!==e[a]){r=null;break}if(r)break}r||q("Unsupported parameter: "+Q(e));const s=Jt(not(r,e,n),r.key);return vt(n.add(nPt(s)))}const ozt=t=>t&&t.expr,azt=t=>t&&t.field,uzt=t=>t==="data",RP=t=>t==="expr",L3=t=>t==="field",LP=t=>t==="compare";function czt(t,e,n){let i,r,s,o,a;return t?(i=t.facet)&&(e||q("Only group marks can be faceted."),i.field!=null?o=a=$2(i,n):(t.data?a=vt(n.getData(t.data).aggregate):(s=HR(Jt({type:"aggregate",groupby:ot(i.groupby)},i.aggregate),n),s.params.key=n.keyRef(i.groupby),s.params.pulse=$2(i,n),o=a=vt(n.add(s))),r=n.keyRef(i.groupby,!0))):o=vt(n.add(Po(null,[{}]))),o||(o=$2(t,n)),{key:r,pulse:o,parent:a}}function $2(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:vt(e.getData(t.data).output)}function sh(t,e,n,i,r){this.scope=t,this.input=e,this.output=n,this.values=i,this.aggregate=r,this.index={}}sh.fromEntries=function(t,e){const n=e.length,i=e[n-1],r=e[n-2];let s=e[0],o=null,a=1;for(s&&s.type==="load"&&(s=e[1]),t.add(e[0]);a<n;++a)e[a].params.pulse=vt(e[a-1]),t.add(e[a]),e[a].type==="aggregate"&&(o=e[a]);return new sh(t,s,r,i,o)};function iot(t){return at(t)?t:null}function BP(t,e,n){const i=VA(n.op,n.field);let r;if(e.ops){for(let s=0,o=e.as.length;s<o;++s)if(e.as[s]===i)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((r=n.op.signal)?t.signalRef(r):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(i))}function F0(t,e,n,i,r,s,o){const a=e[n]||(e[n]={}),u=D9t(s);let c=iot(r),l,f;if(c!=null&&(t=e.scope,c=c+(u?"|"+u:""),l=a[c]),!l){const d=s?{field:KF,pulse:e.countsRef(t,r,s)}:{field:t.fieldRef(r),pulse:vt(e.output)};u&&(d.sort=t.sortRef(s)),f=t.add(qA(i,void 0,d)),o&&(e.index[r]=f),l=vt(f),c!=null&&(a[c]=l)}return l}sh.prototype={countsRef(t,e,n){const i=this,r=i.counts||(i.counts={}),s=iot(e);let o,a,u;return s!=null&&(t=i.scope,o=r[s]),o?n&&n.field&&BP(t,o.agg.params,n):(u={groupby:t.fieldRef(e,"key"),pulse:vt(i.output)},n&&n.field&&BP(t,u,n),a=t.add(Ust(u)),o=t.add(Po({pulse:vt(a)})),o={agg:a,ref:vt(o)},s!=null&&(r[s]=o)),o.ref},tuplesRef(){return vt(this.values)},extentRef(t,e){return F0(t,this,"extent","extent",e,!1)},domainRef(t,e){return F0(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return F0(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return F0(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return F0(t,this,"indata","tupleindex",e,!0,!0)}};function lzt(t,e,n){const i=t.from.facet,r=i.name,s=$2(i,e);let o;i.name||q("Facet must have a name: "+Q(i)),i.data||q("Facet must reference a data set: "+Q(i)),i.field?o=e.add(Vst({field:e.fieldRef(i.field),pulse:s})):i.groupby?o=e.add(Y9t({key:e.keyRef(i.groupby),group:vt(e.proxy(n.parent)),pulse:s})):q("Facet must specify groupby or field: "+Q(i));const a=e.fork(),u=a.add(Po()),c=a.add(Th({pulse:vt(u)}));a.addData(r,new sh(a,u,u,c)),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(t).toRuntime()}}function fzt(t,e,n){const i=e.add(Vst({pulse:n.pulse})),r=e.fork();r.add(Th()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(t).toRuntime()}}function rot(t,e,n){const i=t.remove,r=t.insert,s=t.toggle,o=t.modify,a=t.values,u=e.add(vS()),c="if("+t.trigger+',modify("'+n+'",'+[r,i,s,o,a].map(f=>f??"null").join(",")+"),0)",l=qa(c,e);u.update=l.$expr,u.params=l.$params}function XA(t,e){const n=eot(t),i=t.type===GA,r=t.from&&t.from.facet,s=t.overlap;let o=t.layout||n===BR||n===LR,a,u,c,l,f,d,h;const p=n===RR||o||r,g=czt(t.from,i,e);u=e.add(W9t({key:g.key||(t.key?G1(t.key):void 0),pulse:g.pulse,clean:!i}));const m=vt(u);u=c=e.add(Po({pulse:m})),u=e.add(Q9t({markdef:ezt(t),interactive:nzt(t.interactive,e),clip:tzt(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:vt(u)}));const y=vt(u);u=l=e.add(qst(Pst(t.encode,t.type,n,t.style,e,{mod:!1,pulse:y}))),u.params.parent=e.encode(),t.transform&&t.transform.forEach(S=>{const x=HR(S,e),E=x.metadata;(E.generates||E.changes)&&q("Mark transforms should not generate new data."),E.nomod||(l.params.mod=!0),x.params.pulse=vt(u),e.add(u=x)}),t.sort&&(u=e.add(aPt({sort:e.compareRef(t.sort),pulse:vt(u)})));const b=vt(u);(r||o)&&(o=e.add(Gst({layout:e.objectProperty(t.layout),legends:e.legends,mark:y,pulse:b})),d=vt(o));const v=e.add(jst({mark:y,pulse:d||b}));h=vt(v),i&&(p&&(a=e.operators,a.pop(),o&&a.pop()),e.pushState(b,d||h,m),r?lzt(t,e,g):p?fzt(t,e,g):e.parse(t),e.popState(),p&&(o&&a.push(o),a.push(v))),s&&(h=dzt(s,h,e));const w=e.add(Wst({pulse:h})),_=e.add(Th({pulse:vt(w)},void 0,e.parent()));t.name!=null&&(f=t.name,e.addData(f,new sh(e,c,w,_)),t.on&&t.on.forEach(S=>{(S.insert||S.remove||S.toggle)&&q("Marks only support modify triggers."),rot(S,e,f)}))}function dzt(t,e,n){const i=t.method,r=t.bound,s=t.separation,o={separation:Vn(s)?n.signalRef(s.signal):s,method:Vn(i)?n.signalRef(i.signal):i,pulse:e};if(t.order&&(o.sort=n.compareRef({field:t.order})),r){const a=r.tolerance;o.boundTolerance=Vn(a)?n.signalRef(a.signal):+a,o.boundScale=n.scaleRef(r.scale),o.boundOrient=r.orient}return vt(n.add(ePt(o)))}function hzt(t,e){const n=e.config.legend,i=t.encode||{},r=Vr(t,n),s=i.legend||{},o=s.name||void 0,a=s.interactive,u=s.style,c={};let l=0,f,d,h;qR.forEach(v=>t[v]?(c[v]=t[v],l=l||t[v]):0),l||q("Missing valid scale for legend.");const p=pzt(t,e.scaleType(l)),g={title:t.title!=null,scales:c,type:p,vgrad:p!=="symbol"&&r.isVertical()},m=vt(e.add(Po(null,[g]))),y={enter:{x:{value:0},y:{value:0}}},b=vt(e.add(K9t(d={type:p,scale:e.scaleRef(l),count:e.objectProperty(r("tickCount")),limit:e.property(r("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return p===A2?(h=[zPt(t,l,n,i.gradient),DP(t,n,i.labels,b)],d.count=d.count||e.signalRef(`max(2,2*floor((${Cd(r.gradientLength())})/100))`)):p===tk?h=[UPt(t,l,n,i.gradient,b),DP(t,n,i.labels,b)]:(f=WPt(t,n),h=[VPt(t,n,i,b,Cd(f.columns))],d.size=yzt(t,e,h[0].marks)),h=[H1({role:d9t,from:m,encode:y,marks:h,layout:f,interactive:a})],g.title&&h.push(ZPt(t,n,i.title,m)),XA(H1({role:l9t,from:m,encode:Ym(mzt(r,t,n),s,ov),marks:h,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:a,style:u}),e)}function pzt(t,e){let n=t.type||kP;return!t.type&&gzt(t)===1&&(t.fill||t.stroke)&&(n=nO(e)?A2:pF(e)?tk:kP),n!==A2?n:pF(e)?tk:A2}function gzt(t){return qR.reduce((e,n)=>e+(t[n]?1:0),0)}function mzt(t,e,n){const i={enter:{},update:{}};return bi(i,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),i}function yzt(t,e,n){const i=Cd(PP("size",t,n)),r=Cd(PP("strokeWidth",t,n)),s=Cd(bzt(n[1].encode,e,sv));return qa(`max(ceil(sqrt(${i})+${r}),${s})`,e)}function PP(t,e,n){return e[t]?`scale("${e[t]}",datum)`:Zst(t,n[0].encode)}function bzt(t,e,n){return Zst("fontSize",t)||BPt("fontSize",e,n)}const vzt=`item.orient==="${Hm}"?-90:item.orient==="${Xm}"?90:0`;function wzt(t,e){t=at(t)?{text:t}:t;const n=Vr(t,e.config.title),i=t.encode||{},r=i.group||{},s=r.name||void 0,o=r.interactive,a=r.style,u=[],c={},l=vt(e.add(Po(null,[c])));return u.push(Szt(t,n,_zt(t),l)),t.subtitle&&u.push(Ezt(t,n,i.subtitle,l)),XA(H1({role:m9t,from:l,encode:xzt(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:o,style:a}),e)}function _zt(t){const e=t.encode;return e&&e.title||Jt({name:t.name,interactive:t.interactive,style:t.style},e)}function xzt(t,e){const n={enter:{},update:{}};return bi(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:WR},angle:{signal:vzt},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),Ym(n,e,ov)}function Szt(t,e,n,i){const r={value:0},s=t.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return bi(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),fs({type:Fh,role:y9t,style:TPt,from:i,encode:o},n)}function Ezt(t,e,n,i){const r={value:0},s=t.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return bi(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),fs({type:Fh,role:b9t,style:FPt,from:i,encode:o},n)}function Azt(t,e){const n=[];t.transform&&t.transform.forEach(i=>{n.push(HR(i,e))}),t.on&&t.on.forEach(i=>{rot(i,e,t.name)}),e.addDataPipeline(t.name,$zt(t,e,n))}function $zt(t,e,n){const i=[];let r=null,s=!1,o=!1,a,u,c,l,f;for(t.values?Vn(t.values)||S2(t.format)?(i.push(zP(e,t)),i.push(r=Ff())):i.push(r=Ff({$ingest:t.values,$format:t.format})):t.url?S2(t.url)||S2(t.format)?(i.push(zP(e,t)),i.push(r=Ff())):i.push(r=Ff({$request:t.url,$format:t.format})):t.source&&(r=a=ot(t.source).map(d=>vt(e.getData(d).output)),i.push(null)),u=0,c=n.length;u<c;++u)l=n[u],f=l.metadata,!r&&!f.source&&i.push(r=Ff()),i.push(l),f.generates&&(o=!0),f.modifies&&!o&&(s=!0),f.source?r=l:f.changes&&(r=null);return a&&(c=a.length-1,i[0]=sPt({derive:s,pulse:c?a:a[0]}),(s||c)&&i.splice(1,0,Ff())),r||i.push(Ff()),i.push(Th({})),i}function Ff(t){const e=Po({},t);return e.metadata={source:!0},e}function zP(t,e){return J9t({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const sot=t=>t===Kl||t===zo,KA=(t,e,n)=>Vn(t)?Fzt(t.signal,e,n):t===Hm||t===zo?e:n,ii=(t,e,n)=>Vn(t)?Mzt(t.signal,e,n):sot(t)?e:n,_o=(t,e,n)=>Vn(t)?Tzt(t.signal,e,n):sot(t)?n:e,oot=(t,e,n)=>Vn(t)?kzt(t.signal,e,n):t===zo?{value:e}:{value:n},Izt=(t,e,n)=>Vn(t)?Dzt(t.signal,e,n):t===Xm?{value:e}:{value:n},Mzt=(t,e,n)=>aot(`${t} === '${zo}' || ${t} === '${Kl}'`,e,n),Tzt=(t,e,n)=>aot(`${t} !== '${zo}' && ${t} !== '${Kl}'`,e,n),Fzt=(t,e,n)=>XR(`${t} === '${Hm}' || ${t} === '${zo}'`,e,n),kzt=(t,e,n)=>XR(`${t} === '${zo}'`,e,n),Dzt=(t,e,n)=>XR(`${t} === '${Xm}'`,e,n),aot=(t,e,n)=>(e=e!=null?ni(e):e,n=n!=null?ni(n):n,UP(e)&&UP(n)?(e=e?e.signal||Q(e.value):null,n=n?n.signal||Q(n.value):null,{signal:`${t} ? (${e}) : (${n})`}):[Jt({test:t},e)].concat(n||[])),UP=t=>t==null||Object.keys(t).length===1,XR=(t,e,n)=>({signal:`${t} ? (${Vp(e)}) : (${Vp(n)})`}),Czt=(t,e,n,i,r)=>({signal:(i!=null?`${t} === '${Hm}' ? (${Vp(i)}) : `:"")+(n!=null?`${t} === '${Kl}' ? (${Vp(n)}) : `:"")+(r!=null?`${t} === '${Xm}' ? (${Vp(r)}) : `:"")+(e!=null?`${t} === '${zo}' ? (${Vp(e)}) : `:"")+"(null)"}),Vp=t=>Vn(t)?t.signal:t==null?null:Q(t),Nzt=(t,e)=>e===0?0:Vn(t)?{signal:`(${t.signal}) * ${e}`}:{value:t*e},lg=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function sp(t,e,n,i){let r;if(e&&xt(e,t))return e[t];if(xt(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=t[5].toLowerCase()+t.slice(6)}return i[jR][r]}else if(t.startsWith("label")){switch(t){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=t[5].toLowerCase()+t.slice(6)}return i[sv][r]}return null}function jP(t){const e={};for(const n of t)if(n)for(const i in n)e[i]=1;return Object.keys(e)}function Ozt(t,e){var n=e.config,i=n.style,r=n.axis,s=e.scaleType(t.scale)==="band"&&n.axisBand,o=t.orient,a,u,c;if(Vn(o)){const f=jP([n.axisX,n.axisY]),d=jP([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(c of f)a[c]=ii(o,sp(c,n.axisX,r,i),sp(c,n.axisY,r,i));u={};for(c of d)u[c]=Czt(o.signal,sp(c,n.axisTop,r,i),sp(c,n.axisBottom,r,i),sp(c,n.axisLeft,r,i),sp(c,n.axisRight,r,i))}else a=o===zo||o===Kl?n.axisX:n.axisY,u=n["axis"+o[0].toUpperCase()+o.slice(1)];return a||u||s?Jt({},r,a,u,s):r}function Rzt(t,e,n,i){const r=Vr(t,e),s=t.orient;let o,a;const u={enter:o={opacity:ye},update:a={opacity:Ns},exit:{opacity:ye}};bi(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const c=qP(t,0),l=qP(t,1);return o.x=a.x=ii(s,c,ye),o.x2=a.x2=ii(s,l),o.y=a.y=_o(s,c,ye),o.y2=a.y2=_o(s,l),fs({type:VR,role:s9t,from:i,encode:u},n)}function qP(t,e){return{scale:t.scale,range:e}}function Lzt(t,e,n,i,r){const s=Vr(t,e),o=t.orient,a=t.gridScale,u=KA(o,1,-1),c=Bzt(t.offset,u);let l,f,d;const h={enter:l={opacity:ye},update:d={opacity:Ns},exit:f={opacity:ye}};bi(h,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:t.scale,field:Cs,band:r.band,extra:r.extra,offset:r.offset,round:s("tickRound")},g=ii(o,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:c}:{value:0,offset:c},y=a?{scale:a,range:1,mult:u,offset:c}:Jt(g,{mult:u,offset:c});return l.x=d.x=ii(o,p,m),l.y=d.y=_o(o,p,m),l.x2=d.x2=_o(o,y),l.y2=d.y2=ii(o,y),f.x=ii(o,p),f.y=_o(o,p),fs({type:VR,role:o9t,key:Cs,from:i,encode:h},n)}function Bzt(t,e){if(e!==1)if(!ut(t))t=Vn(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);else{let n=t=Jt({},t);for(;n.mult!=null;)if(ut(n.mult))n=n.mult=Jt({},n.mult);else return n.mult=Vn(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e,t;n.mult=e}return t}function Pzt(t,e,n,i,r,s){const o=Vr(t,e),a=t.orient,u=KA(a,-1,1);let c,l,f;const d={enter:c={opacity:ye},update:f={opacity:Ns},exit:l={opacity:ye}};bi(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=ni(r);h.mult=u;const p={scale:t.scale,field:Cs,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")};return f.y=c.y=ii(a,ye,p),f.y2=c.y2=ii(a,h),l.x=ii(a,p),f.x=c.x=_o(a,ye,p),f.x2=c.x2=_o(a,h),l.y=_o(a,p),fs({type:VR,role:u9t,key:Cs,from:i,encode:d},n)}function B3(t,e,n,i,r){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+i+","+r+")"}}function zzt(t,e,n,i,r,s){const o=Vr(t,e),a=t.orient,u=t.scale,c=KA(a,-1,1),l=Cd(o("labelFlush")),f=Cd(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p=l===0||!!l,g;const m=ni(r);m.mult=c,m.offset=ni(o("labelPadding")||0),m.offset.mult=c;const y={scale:u,field:Cs,band:.5,offset:tot(s.offset,o("labelOffset"))},b=ii(a,p?B3(u,l,'"left"','"right"','"center"'):{value:"center"},Izt(a,"left","right")),v=ii(a,oot(a,"bottom","top"),p?B3(u,l,'"top"','"bottom"','"middle"'):{value:"middle"}),w=B3(u,l,`-(${f})`,f,0);p=p&&f;const _={opacity:ye,x:ii(a,y,m),y:_o(a,y,m)},S={enter:_,update:g={opacity:Ns,text:{field:UR},x:_.x,y:_.y,align:b,baseline:v},exit:{opacity:ye,x:_.x,y:_.y}};bi(S,{dx:!d&&p?ii(a,w):null,dy:!h&&p?_o(a,w):null}),bi(S,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const x=o("labelBound");let E=o("labelOverlap");return E=E||x?{separation:o("labelSeparation"),method:E,order:"datum.index",bound:x?{scale:u,orient:a,tolerance:x}:null}:void 0,g.align!==b&&(g.align=lg(g.align,b)),g.baseline!==v&&(g.baseline=lg(g.baseline,v)),fs({type:Fh,role:a9t,style:sv,key:Cs,from:i,encode:S,overlap:E},n)}function Uzt(t,e,n,i){const r=Vr(t,e),s=t.orient,o=KA(s,-1,1);let a,u;const c={enter:a={opacity:ye,anchor:ni(r("titleAnchor",null)),align:{signal:WR}},update:u=Jt({},a,{opacity:Ns,text:ni(t.title)}),exit:{opacity:ye}},l={signal:`lerp(range("${t.scale}"), ${YA(0,1,.5)})`};return u.x=ii(s,l),u.y=_o(s,l),a.angle=ii(s,ye,Nzt(o,90)),a.baseline=ii(s,oot(s,Kl,zo),{value:Kl}),u.angle=a.angle,u.baseline=a.baseline,bi(c,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),jzt(r,s,c,n),c.update.align=lg(c.update.align,a.align),c.update.angle=lg(c.update.angle,a.angle),c.update.baseline=lg(c.update.baseline,a.baseline),fs({type:Fh,role:c9t,style:jR,from:i,encode:c},n)}function jzt(t,e,n,i){const r=(a,u)=>a!=null?(n.update[u]=lg(ni(a),n.update[u]),!1):!Tp(u,i),s=r(t("titleX"),"x"),o=r(t("titleY"),"y");n.enter.auto=o===s?ni(o):ii(e,ni(o),ni(s))}function qzt(t,e){const n=Ozt(t,e),i=t.encode||{},r=i.axis||{},s=r.name||void 0,o=r.interactive,a=r.style,u=Vr(t,n),c=PPt(u),l={scale:t.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:t.title!=null},f=vt(e.add(Po({},[l]))),d=vt(e.add(V9t({scale:e.scaleRef(t.scale),extra:e.property(c.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),h=[];let p;return l.grid&&h.push(Lzt(t,n,i.grid,d,c)),l.ticks&&(p=u("tickSize"),h.push(Pzt(t,n,i.ticks,d,p,c))),l.labels&&(p=l.ticks?p:0,h.push(zzt(t,n,i.labels,d,p,c))),l.domain&&h.push(Rzt(t,n,i.domain,f)),l.title&&h.push(Uzt(t,n,i.title,f)),XA(H1({role:r9t,from:f,encode:Ym(Vzt(u,t),r,ov),marks:h,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:o,style:a}),e)}function Vzt(t,e){const n={enter:{},update:{}};return bi(n,{orient:t("orient"),offset:t("offset")||0,position:uo(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),n}function uot(t,e,n){const i=ot(t.signals),r=ot(t.scales);return n||i.forEach(s=>zst(s,e)),ot(t.projections).forEach(s=>xPt(s,e)),r.forEach(s=>lPt(s,e)),ot(t.data).forEach(s=>Azt(s,e)),r.forEach(s=>fPt(s,e)),(n||i).forEach(s=>q9t(s,e)),ot(t.axes).forEach(s=>qzt(s,e)),ot(t.marks).forEach(s=>XA(s,e)),ot(t.legends).forEach(s=>hzt(s,e)),t.title&&wzt(t.title,e),e.parseLambdas(),e}const Wzt=t=>Ym({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t);function Gzt(t,e){const n=e.config,i=vt(e.root=e.add(vS())),r=Yzt(t,n);r.forEach(c=>zst(c,e)),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const s=e.add(Po()),o=e.add(qst(Pst(Wzt(t.encode),GA,LR,t.style,e,{pulse:vt(s)}))),a=e.add(Gst({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:i,pulse:vt(o)}));e.operators.pop(),e.pushState(vt(o),vt(a),null),uot(t,e,r),e.operators.push(a);let u=e.add(jst({mark:i,pulse:vt(a)}));return u=e.add(Wst({pulse:vt(u)})),u=e.add(Th({pulse:vt(u)})),e.addData("root",new sh(e,s,s,u)),e}function k0(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function Yzt(t,e){const n=o=>uo(t[o],e[o]),i=[k0("background",n("background")),k0("autosize",e9t(n("autosize"))),k0("padding",i9t(n("padding"))),k0("width",n("width")||0),k0("height",n("height")||0)],r=i.reduce((o,a)=>(o[a.name]=a,o),{}),s={};return ot(t.signals).forEach(o=>{xt(r,o.name)?o=Jt(r[o.name],o):i.push(o),s[o.name]=o}),ot(e.signals).forEach(o=>{!xt(s,o.name)&&!xt(r,o.name)&&i.push(o)}),i}function cot(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function VP(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}cot.prototype=VP.prototype={parse(t){return uot(t,this)},fork(){return new VP(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach(e=>{e.$ref=t.id}),t.refs=null),t},proxy(t){const e=t instanceof XF?vt(t):t;return this.add(rPt({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(i,r,s){let o,a;i&&(o=i.data||(i.data={}),a=o[r]||(o[r]=[]),a.push(s))}for(t in this.data){e=this.data[t],n(e.input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values");for(const i in e.index)n(e.index[i],t,"index:"+i)}return this},pushState(t,e,n){this._encode.push(vt(this.add(Th({pulse:t})))),this._parent.push(e),this._lookup.push(n?vt(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return pe(this._parent)},encode(){return pe(this._encode)},lookup(){return pe(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(at(t))return G1(t,e);t.signal||q("Unsupported field reference: "+Q(t));const n=t.signal;let i=this.field[n];if(!i){const r={name:this.signalRef(n)};e&&(r.as=e),this.field[n]=i=vt(this.add(H9t(r)))}return i},compareRef(t){let e=!1;const n=s=>Vn(s)?(e=!0,this.signalRef(s.signal)):C9t(s)?(e=!0,this.exprRef(s.expr)):s,i=ot(t.field).map(n),r=ot(t.order).map(n);return e?vt(this.add(FP({fields:i,orders:r}))):MP(i,r)},keyRef(t,e){let n=!1;const i=s=>Vn(s)?(n=!0,vt(r[s.signal])):s,r=this.signals;return t=ot(t).map(i),n?vt(this.add(X9t({fields:t,flat:e}))):T9t(t,e)},sortRef(t){if(!t)return t;const e=VA(t.op,t.field),n=t.order||F9t;return n.signal?vt(this.add(FP({fields:e,orders:this.signalRef(n.signal)}))):MP(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:t,type:e}),this.events[n]=i}return this.events[n]},hasOwnSignal(t){return xt(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&q("Duplicate signal name: "+Q(t));const n=e instanceof XF?e:this.add(vS(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||q("Unrecognized signal name: "+Q(t)),this.signals[t]},signalRef(t){return this.signals[t]?vt(this.signals[t]):(xt(this.lambdas,t)||(this.lambdas[t]=this.add(vS(null))),vt(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const i=t[e],r=qa(i,this),s=this.lambdas[i];s.params=r.$params,s.update=r.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return!t||!ut(t)?t:this.signalRef(t.signal||KR(t))},exprRef(t,e){const n={expr:qa(t,this)};return e&&(n.expr.$name=e),vt(this.add(G9t(n)))},addBinding(t,e){this.bindings||q("Nested signals do not support binding: "+Q(t)),this.bindings.push(Jt({signal:t},e))},addScaleProj(t,e){xt(this.scales,t)&&q("Duplicate scale or projection name: "+Q(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,oPt(e))},addProjection(t,e){this.addScaleProj(t,iPt(e))},getScale(t){return this.scales[t]||q("Unrecognized scale name: "+Q(t)),this.scales[t]},scaleRef(t){return vt(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return xt(this.data,t)&&q("Duplicate data set name: "+Q(t)),this.data[t]=e},getData(t){return this.data[t]||q("Undefined data set name: "+Q(t)),this.data[t]},addDataPipeline(t,e){return xt(this.data,t)&&q("Duplicate data set name: "+Q(t)),this.addData(t,sh.fromEntries(this,e))}};function KR(t){return(W(t)?Hzt:Xzt)(t)}function Hzt(t){const e=t.length;let n="[";for(let i=0;i<e;++i){const r=t[i];n+=(i>0?",":"")+(ut(r)?r.signal||KR(r):Q(r))}return n+"]"}function Xzt(t){let e="{",n=0,i,r;for(i in t)r=t[i],e+=(++n>1?",":"")+Q(i)+":"+(ut(r)?r.signal||KR(r):Q(r));return e+"}"}function Kzt(){const t="sans-serif",i="#4c78a8",r="#000",s="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:t,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:r,font:t,fontSize:10},"guide-title":{fill:r,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:o},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:s,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:s,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:s,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Jzt(t,e,n){return ut(t)||q("Input Vega specification must be an object."),e=Pm(Kzt(),e,t.config),Gzt(t,new cot(e,n)).toRuntime()}var Qzt="5.28.0";Jt(Vg,J6t,PRt,y8t,H8t,e4t,M4t,a4t,F4t,N4t,V4t,J4t);const Zzt=Object.freeze(Object.defineProperty({__proto__:null,Bounds:On,CanvasHandler:Hl,CanvasRenderer:z1,DATE:Pr,DAY:Mi,DAYOFYEAR:ja,Dataflow:cg,Debug:Rtt,Error:UC,EventStream:fA,Gradient:eit,GroupItem:EA,HOURS:us,Handler:Yl,HybridHandler:RO,HybridRenderer:cS,Info:Ott,Item:SA,MILLISECONDS:To,MINUTES:cs,MONTH:Ni,Marks:ls,MultiPulse:aN,None:Ntt,Operator:Ue,Parameters:lA,Pulse:ml,QUARTER:Br,RenderType:ul,Renderer:ps,ResourceLoader:fO,SECONDS:Gs,SVGHandler:TO,SVGRenderer:DA,SVGStringRenderer:OO,Scenegraph:IO,TIME_UNITS:ZC,Transform:z,View:Ist,WEEK:jn,Warn:jC,YEAR:gi,accessor:qr,accessorFields:Ci,accessorName:En,array:ot,ascending:rA,bandwidthNRD:fN,bin:Yet,bootstrapCI:Het,boundClip:Qit,boundContext:Jb,boundItem:wF,boundMark:wit,boundStroke:Ec,changeset:$h,clampRange:Ytt,codegenExpression:tst,compare:YC,constant:Bi,cumulativeLogNormal:yN,cumulativeNormal:hA,cumulativeUniform:_N,dayofyear:set,debounce:HC,defaultLocale:nN,definition:Vet,densityLogNormal:mN,densityNormal:dN,densityUniform:wN,domChild:Pn,domClear:Es,domCreate:ol,domFind:MO,dotbin:Xet,error:q,expressionFunction:kn,extend:Jt,extent:Ua,extentIndex:Htt,falsy:zc,fastmap:Um,field:Vs,flush:Xtt,font:TA,fontFamily:tv,fontSize:tu,format:u2,formatLocale:Xx,formats:sN,hasOwnProperty:xt,id:Pb,identity:Li,inferType:Cet,inferTypes:Net,ingest:Ae,inherits:J,inrange:Up,interpolate:iO,interpolateColors:_A,interpolateRange:Unt,intersect:Hit,intersectBoxLine:jp,intersectPath:dO,intersectPoint:hO,intersectRule:cit,isArray:W,isBoolean:gf,isDate:gl,isFunction:Qt,isIterable:Ktt,isNumber:be,isObject:ut,isRegExp:Jtt,isString:at,isTuple:uA,key:XC,lerp:Qtt,lineHeight:Wl,loader:oA,locale:ket,logger:qC,lruCache:Ztt,markup:NO,merge:tet,mergeConfig:Pm,multiLineOffset:EO,one:Bm,pad:eet,panLinear:Utt,panLog:jtt,panPow:qtt,panSymlog:Vtt,parse:Jzt,parseExpression:SR,parseSelector:yf,path:cE,pathCurves:uO,pathEqual:Zit,pathParse:Hg,pathRectangle:rit,pathRender:R1,pathSymbols:iit,pathTrail:sit,peek:pe,point:kA,projection:HO,quantileLogNormal:bN,quantileNormal:pA,quantileUniform:xN,quantiles:cN,quantizeInterpolator:jnt,quarter:Wtt,quartiles:lN,get random(){return Ys},randomInteger:e6t,randomKDE:pN,randomLCG:t6t,randomLogNormal:Jet,randomMixture:Qet,randomNormal:hN,randomUniform:Zet,read:Let,regressionConstant:SN,regressionExp:ent,regressionLinear:EN,regressionLoess:rnt,regressionLog:tnt,regressionPoly:int,regressionPow:nnt,regressionQuad:AN,renderModule:CA,repeat:ly,resetDefaultLocale:Jkt,resetSVGClipId:ait,resetSVGDefIds:iRt,responseType:Ret,runtimeContext:pst,sampleCurve:mA,sampleLogNormal:gN,sampleNormal:dA,sampleUniform:vN,scale:xe,sceneEqual:LO,sceneFromJSON:xit,scenePickVisit:tS,sceneToJSON:_it,sceneVisit:Fo,sceneZOrder:pO,scheme:rO,serializeXML:Pit,setHybridRendererOptions:ZOt,setRandom:QDt,span:zb,splitAccessPath:Za,stringValue:Q,textMetrics:is,timeBin:Eet,timeFloor:het,timeFormatLocale:C1,timeInterval:jm,timeOffset:met,timeSequence:vet,timeUnitSpecifier:ret,timeUnits:tN,toBoolean:KC,toDate:JC,toNumber:Ti,toSet:Mo,toString:QC,transform:Wet,transforms:Vg,truncate:net,truthy:Ws,tupleid:wt,typeParsers:fF,utcFloor:pet,utcInterval:qm,utcOffset:yet,utcSequence:wet,utcdayofyear:uet,utcquarter:Gtt,utcweek:cet,version:Qzt,visitArray:Hc,week:oet,writeConfig:zm,zero:tl,zoomLinear:VC,zoomLog:WC,zoomPow:Hx,zoomSymlog:GC},Symbol.toStringTag,{value:"Module"}));function tUt(t,e,n){let i;e.x2&&(e.x?(n&&t.x>t.x2&&(i=t.x,t.x=t.x2,t.x2=i),t.width=t.x2-t.x):t.x=t.x2-(t.width||0)),e.xc&&(t.x=t.xc-(t.width||0)/2),e.y2&&(e.y?(n&&t.y>t.y2&&(i=t.y,t.y=t.y2,t.y2=i),t.height=t.y2-t.y):t.y=t.y2-(t.height||0)),e.yc&&(t.y=t.yc-(t.height||0)/2)}var eUt={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},nUt={"*":(t,e)=>t*e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,">":(t,e)=>t>e,"<":(t,e)=>t<e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"&":(t,e)=>t&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e},iUt={"+":t=>+t,"-":t=>-t,"~":t=>~t,"!":t=>!t};const rUt=Array.prototype.slice,kf=(t,e,n)=>{const i=n?n(e[0]):e[0];return i[t].apply(i,rUt.call(e,1))},sUt=(t,e,n,i,r,s,o)=>new Date(t,e||0,n??1,i||0,r||0,s||0,o||0);var oUt={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(t,e,n)=>Math.max(e,Math.min(n,t)),now:Date.now,utc:Date.UTC,datetime:sUt,date:t=>new Date(t).getDate(),day:t=>new Date(t).getDay(),year:t=>new Date(t).getFullYear(),month:t=>new Date(t).getMonth(),hours:t=>new Date(t).getHours(),minutes:t=>new Date(t).getMinutes(),seconds:t=>new Date(t).getSeconds(),milliseconds:t=>new Date(t).getMilliseconds(),time:t=>new Date(t).getTime(),timezoneoffset:t=>new Date(t).getTimezoneOffset(),utcdate:t=>new Date(t).getUTCDate(),utcday:t=>new Date(t).getUTCDay(),utcyear:t=>new Date(t).getUTCFullYear(),utcmonth:t=>new Date(t).getUTCMonth(),utchours:t=>new Date(t).getUTCHours(),utcminutes:t=>new Date(t).getUTCMinutes(),utcseconds:t=>new Date(t).getUTCSeconds(),utcmilliseconds:t=>new Date(t).getUTCMilliseconds(),length:t=>t.length,join:function(){return kf("join",arguments)},indexof:function(){return kf("indexOf",arguments)},lastindexof:function(){return kf("lastIndexOf",arguments)},slice:function(){return kf("slice",arguments)},reverse:t=>t.slice().reverse(),parseFloat,parseInt,upper:t=>String(t).toUpperCase(),lower:t=>String(t).toLowerCase(),substring:function(){return kf("substring",arguments,String)},split:function(){return kf("split",arguments,String)},replace:function(){return kf("replace",arguments,String)},trim:t=>String(t).trim(),regexp:RegExp,test:(t,e)=>RegExp(t).test(e)};const aUt=["view","item","group","xy","x","y"],nk=new Set([Function,eval,setTimeout,setInterval]);typeof setImmediate=="function"&&nk.add(setImmediate);const uUt={Literal:(t,e)=>e.value,Identifier:(t,e)=>{const n=e.name;return t.memberDepth>0?n:n==="datum"?t.datum:n==="event"?t.event:n==="item"?t.item:eUt[n]||t.params["$"+n]},MemberExpression:(t,e)=>{const n=!e.computed,i=t(e.object);n&&(t.memberDepth+=1);const r=t(e.property);if(n&&(t.memberDepth-=1),nk.has(i[r])){console.error(`Prevented interpretation of member "${r}" which could lead to insecure code execution`);return}return i[r]},CallExpression:(t,e)=>{const n=e.arguments;let i=e.callee.name;return i.startsWith("_")&&(i=i.slice(1)),i==="if"?t(n[0])?t(n[1]):t(n[2]):(t.fn[i]||oUt[i]).apply(t.fn,n.map(t))},ArrayExpression:(t,e)=>e.elements.map(t),BinaryExpression:(t,e)=>nUt[e.operator](t(e.left),t(e.right)),UnaryExpression:(t,e)=>iUt[e.operator](t(e.argument)),ConditionalExpression:(t,e)=>t(e.test)?t(e.consequent):t(e.alternate),LogicalExpression:(t,e)=>e.operator==="&&"?t(e.left)&&t(e.right):t(e.left)||t(e.right),ObjectExpression:(t,e)=>e.properties.reduce((n,i)=>{t.memberDepth+=1;const r=t(i.key);return t.memberDepth-=1,nk.has(t(i.value))?console.error(`Prevented interpretation of property "${r}" which could lead to insecure code execution`):n[r]=t(i.value),n},{})};function D0(t,e,n,i,r,s){const o=a=>uUt[a.type](o,a);return o.memberDepth=0,o.fn=Object.create(e),o.params=n,o.datum=i,o.event=r,o.item=s,aUt.forEach(a=>o.fn[a]=function(){return r.vega[a](...arguments)}),o(t)}var cUt={operator(t,e){const n=e.ast,i=t.functions;return r=>D0(n,i,r)},parameter(t,e){const n=e.ast,i=t.functions;return(r,s)=>D0(n,i,s,r)},event(t,e){const n=e.ast,i=t.functions;return r=>D0(n,i,void 0,void 0,r)},handler(t,e){const n=e.ast,i=t.functions;return(r,s)=>{const o=s.item&&s.item.datum;return D0(n,i,r,o,s)}},encode(t,e){const{marktype:n,channels:i}=e,r=t.functions,s=n==="group"||n==="image"||n==="rect";return(o,a)=>{const u=o.datum;let c=0,l;for(const f in i)l=D0(i[f].ast,r,a,u,void 0,o),o[f]!==l&&(o[f]=l,c=1);return n!=="rule"&&tUt(o,i,s),c}}};const lUt="vega-lite",fUt='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',dUt="5.16.3",hUt=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],pUt="https://vega.github.io/vega-lite/",gUt="Vega-Lite is a concise high-level language for interactive visualization.",mUt=["vega","chart","visualization"],yUt="build/vega-lite.js",bUt="build/vega-lite.min.js",vUt="build/vega-lite.min.js",wUt="build/src/index",_Ut="build/src/index.d.ts",xUt={vl2pdf:"./bin/vl2pdf",vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},SUt=["bin","build","src","vega-lite*","tsconfig.json"],EUt={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.mjs","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"release-it"},AUt={type:"git",url:"https://github.com/vega/vega-lite.git"},$Ut="BSD-3-Clause",IUt={url:"https://github.com/vega/vega-lite/issues"},MUt={"@babel/core":"^7.22.10","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/preset-env":"^7.22.10","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-alias":"^5.0.0","@rollup/plugin-babel":"^6.0.3","@rollup/plugin-commonjs":"^25.0.4","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.2.1","@rollup/plugin-terser":"^0.4.3","@types/chai":"^4.3.5","@types/d3":"^7.4.0","@types/jest":"^29.5.4","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^6.4.1","@typescript-eslint/parser":"^6.4.1",ajv:"^8.12.0","ajv-formats":"^2.1.1",chai:"^4.3.7",cheerio:"^1.0.0-rc.12","conventional-changelog-cli":"^4.0.0",d3:"^7.8.5","del-cli":"^5.0.0",eslint:"^8.47.0","eslint-config-prettier":"^9.0.0","eslint-plugin-jest":"^27.2.3","eslint-plugin-prettier":"^5.0.0","fast-json-stable-stringify":"~2.1.0","highlight.js":"^11.8.0",jest:"^29.6.3","jest-dev-server":"^9.0.0",mkdirp:"^3.0.1",pako:"^2.1.0",prettier:"^3.0.2",puppeteer:"^15.0.0","release-it":"^16.1.5",rollup:"^3.28.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3",serve:"^14.2.1",terser:"^5.19.2","ts-jest":"^29.1.1","ts-json-schema-generator":"^1.3.0",typescript:"~5.2.2","vega-cli":"^5.25.0","vega-datasets":"^2.7.0","vega-embed":"^6.22.2","vega-tooltip":"^0.33.0","yaml-front-matter":"^4.1.1"},TUt={"json-stringify-pretty-compact":"~3.0.0",tslib:"~2.6.2","vega-event-selector":"~3.0.1","vega-expression":"~5.1.0","vega-util":"~1.17.2",yargs:"~17.7.2"},FUt={vega:"^5.24.0"},kUt={node:">=18"},DUt={name:lUt,author:fUt,version:dUt,collaborators:hUt,homepage:pUt,description:gUt,keywords:mUt,main:yUt,unpkg:bUt,jsdelivr:vUt,module:wUt,types:_Ut,bin:xUt,files:SUt,scripts:EUt,repository:AUt,license:$Ut,bugs:IUt,devDependencies:MUt,dependencies:TUt,peerDependencies:FUt,engines:kUt};function JR(t){return!!t.or}function QR(t){return!!t.and}function ZR(t){return!!t.not}function I2(t,e){if(ZR(t))I2(t.not,e);else if(QR(t))for(const n of t.and)I2(n,e);else if(JR(t))for(const n of t.or)I2(n,e);else e(t)}function fg(t,e){return ZR(t)?{not:fg(t.not,e)}:QR(t)?{and:t.and.map(n=>fg(n,e))}:JR(t)?{or:t.or.map(n=>fg(n,e))}:e(t)}const Wt=structuredClone;function lot(t){throw new Error(t)}function Zg(t,e){const n={};for(const i of e)xt(t,i)&&(n[i]=t[i]);return n}function Mr(t,e){const n={...t};for(const i of e)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(t=>Be(t)).join(",")})`};function le(t){if(be(t))return t;const e=at(t)?t:Be(t);if(e.length<250)return e;let n=0;for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function ik(t){return t===!1||t===null}function fe(t,e){return t.includes(e)}function oh(t,e){let n=0;for(const[i,r]of t.entries())if(e(r,i,n++))return!0;return!1}function t8(t,e){let n=0;for(const[i,r]of t.entries())if(!e(r,i,n++))return!1;return!0}function fot(t,...e){for(const n of e)CUt(t,n??{});return t}function CUt(t,e){for(const n of Y(e))zm(t,n,e[n],!0)}function Sa(t,e){const n=[],i={};let r;for(const s of t)r=e(s),!(r in i)&&(i[r]=1,n.push(s));return n}function NUt(t,e){const n=Y(t),i=Y(e);if(n.length!==i.length)return!1;for(const r of n)if(t[r]!==e[r])return!1;return!0}function dot(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}function e8(t,e){for(const n of t)if(e.has(n))return!0;return!1}function rk(t){const e=new Set;for(const n of t){const r=Za(n).map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)e.add(o)}return e}function n8(t,e){return t===void 0||e===void 0?!0:e8(rk(t),rk(e))}function Le(t){return Y(t).length===0}const Y=Object.keys,mi=Object.values,Jl=Object.entries;function X1(t){return t===!0||t===!1}function on(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function Vy(t,e){return ZR(t)?`!(${Vy(t.not,e)})`:QR(t)?`(${t.and.map(n=>Vy(n,e)).join(") && (")})`:JR(t)?`(${t.or.map(n=>Vy(n,e)).join(") || (")})`:e(t)}function wS(t,e){if(e.length===0)return!0;const n=e.shift();return n in t&&wS(t[n],e)&&delete t[n],Le(t)}function av(t){return t.charAt(0).toUpperCase()+t.substr(1)}function i8(t,e="datum"){const n=Za(t),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(Q).join("][")}]`;i.push(`${e}${s}`)}return i.join(" && ")}function hot(t,e="datum"){return`${e}[${Q(Za(t).join("."))}]`}function OUt(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Hs(t){return`${Za(t).map(OUt).join("\\.")}`}function ah(t,e,n){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function r8(t){return`${Za(t).join(".")}`}function tm(t){return t?Za(t).length:0}function Tn(...t){for(const e of t)if(e!==void 0)return e}let pot=42;function got(t){const e=++pot;return t?String(t)+e:e}function RUt(){pot=42}function mot(t){return yot(t)?t:`__${t}`}function yot(t){return t.startsWith("__")}function K1(t){if(t!==void 0)return(t%360+360)%360}function JA(t){return be(t)?!0:!isNaN(t)&&!isNaN(parseFloat(t))}const WP=Object.getPrototypeOf(structuredClone({}));function es(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor.name!==e.constructor.name)return!1;let n,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(i=n;i--!==0;)if(!es(t[i],e[i]))return!1;return!0}if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(i of t.entries())if(!e.has(i[0]))return!1;for(i of t.entries())if(!es(i[1],e.get(i[0])))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(i of t.entries())if(!e.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(i=n;i--!==0;)if(t[i]!==e[i])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&t.valueOf!==WP.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&t.toString!==WP.toString)return t.toString()===e.toString();const r=Object.keys(t);if(n=r.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(e,r[i]))return!1;for(i=n;i--!==0;){const s=r[i];if(!es(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Be(t){const e=[];return function n(i){if(i&&i.toJSON&&typeof i.toJSON=="function"&&(i=i.toJSON()),i===void 0)return;if(typeof i=="number")return isFinite(i)?""+i:"null";if(typeof i!="object")return JSON.stringify(i);let r,s;if(Array.isArray(i)){for(s="[",r=0;r<i.length;r++)r&&(s+=","),s+=n(i[r])||"null";return s+"]"}if(i===null)return"null";if(e.includes(i))throw new TypeError("Converting circular structure to JSON");const o=e.push(i)-1,a=Object.keys(i).sort();for(s="",r=0;r<a.length;r++){const u=a[r],c=n(i[u]);c&&(s&&(s+=","),s+=JSON.stringify(u)+":"+c)}return e.splice(o,1),`{${s}}`}(t)}const Zu="row",tc="column",QA="facet",an="x",ai="y",Uo="x2",iu="y2",bf="xOffset",Km="yOffset",jo="radius",$c="radius2",Qs="theta",Ic="theta2",qo="latitude",Vo="longitude",Wo="latitude2",Xs="longitude2",zr="color",ru="fill",su="stroke",Ur="shape",Mc="size",kh="angle",Tc="opacity",vf="fillOpacity",wf="strokeOpacity",_f="strokeWidth",xf="strokeDash",uv="text",em="order",cv="detail",ZA="key",uh="tooltip",t$="href",e$="url",n$="description",LUt={x:1,y:1,x2:1,y2:1},bot={theta:1,theta2:1,radius:1,radius2:1};function vot(t){return t in bot}const s8={longitude:1,longitude2:1,latitude:1,latitude2:1};function wot(t){switch(t){case qo:return"y";case Wo:return"y2";case Vo:return"x";case Xs:return"x2"}}function _ot(t){return t in s8}const BUt=Y(s8),o8={...LUt,...bot,...s8,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function dg(t){return t===zr||t===ru||t===su}const xot={row:1,column:1,facet:1},ks=Y(xot),a8={...o8,...xot},PUt=Y(a8),{order:vte,detail:wte,tooltip:_te,...zUt}=a8,{row:xte,column:Ste,facet:Ete,...UUt}=zUt;function jUt(t){return!!UUt[t]}function Sot(t){return!!a8[t]}const qUt=[Uo,iu,Wo,Xs,Ic,$c];function Eot(t){return Dh(t)!==t}function Dh(t){switch(t){case Uo:return an;case iu:return ai;case Wo:return qo;case Xs:return Vo;case Ic:return Qs;case $c:return jo}return t}function Ql(t){if(vot(t))switch(t){case Qs:return"startAngle";case Ic:return"endAngle";case jo:return"outerRadius";case $c:return"innerRadius"}return t}function ou(t){switch(t){case an:return Uo;case ai:return iu;case qo:return Wo;case Vo:return Xs;case Qs:return Ic;case jo:return $c}}function jr(t){switch(t){case an:case Uo:return"width";case ai:case iu:return"height"}}function Aot(t){switch(t){case an:return"xOffset";case ai:return"yOffset";case Uo:return"x2Offset";case iu:return"y2Offset";case Qs:return"thetaOffset";case jo:return"radiusOffset";case Ic:return"theta2Offset";case $c:return"radius2Offset"}}function u8(t){switch(t){case an:return"xOffset";case ai:return"yOffset"}}function VUt(t){switch(t){case"xOffset":return"x";case"yOffset":return"y"}}const WUt=Y(o8),{x:Ate,y:$te,x2:Ite,y2:Mte,xOffset:Tte,yOffset:Fte,latitude:kte,longitude:Dte,latitude2:Cte,longitude2:Nte,theta:Ote,theta2:Rte,radius:Lte,radius2:Bte,...c8}=o8,GUt=Y(c8),l8={x:1,y:1},au=Y(l8);function Fn(t){return t in l8}const f8={theta:1,radius:1},YUt=Y(f8);function i$(t){return t==="width"?an:ai}const $ot={xOffset:1,yOffset:1};function lv(t){return t in $ot}const{text:Pte,tooltip:zte,href:Ute,url:jte,description:qte,detail:Vte,key:Wte,order:Gte,...Iot}=c8,HUt=Y(Iot);function XUt(t){return!!c8[t]}function KUt(t){switch(t){case zr:case ru:case su:case Mc:case Ur:case Tc:case _f:case xf:return!0;case vf:case wf:case kh:return!1}}const Mot={...l8,...f8,...$ot,...Iot},r$=Y(Mot);function Fc(t){return!!Mot[t]}function JUt(t,e){return ZUt(t)[e]}const Tot={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:Yte,...QUt}=Tot;function ZUt(t){switch(t){case zr:case ru:case su:case n$:case cv:case ZA:case uh:case t$:case em:case Tc:case vf:case wf:case _f:case QA:case Zu:case tc:return Tot;case an:case ai:case bf:case Km:case qo:case Vo:return QUt;case Uo:case iu:case Wo:case Xs:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Mc:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case xf:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Ur:return{point:"always",geoshape:"always"};case uv:return{text:"always"};case kh:return{point:"always",square:"always",text:"always"};case e$:return{image:"always"};case Qs:return{text:"always",arc:"always"};case jo:return{text:"always",arc:"always"};case Ic:case $c:return{arc:"always"}}}function P3(t){switch(t){case an:case ai:case Qs:case jo:case bf:case Km:case Mc:case kh:case _f:case Tc:case vf:case wf:case Uo:case iu:case Ic:case $c:return;case QA:case Zu:case tc:case Ur:case xf:case uv:case uh:case t$:case e$:case n$:return"discrete";case zr:case ru:case su:return"flexible";case qo:case Vo:case Wo:case Xs:case cv:case ZA:case em:return}}const tjt={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},ejt={count:1,min:1,max:1};function fc(t){return!!t&&!!t.argmin}function Sf(t){return!!t&&!!t.argmax}function d8(t){return at(t)&&!!tjt[t]}const njt=new Set(["count","valid","missing","distinct"]);function Fot(t){return at(t)&&njt.has(t)}function ijt(t){return at(t)&&fe(["min","max"],t)}const rjt=new Set(["count","sum","distinct","valid","missing"]),sjt=new Set(["mean","average","median","q1","q3","min","max"]);function kot(t){return gf(t)&&(t=m$(t,void 0)),"bin"+Y(t).map(e=>s$(t[e])?on(`_${e}_${Jl(t[e])}`):on(`_${e}_${t[e]}`)).join("")}function Xe(t){return t===!0||Ch(t)&&!t.binned}function ui(t){return t==="binned"||Ch(t)&&t.binned===!0}function Ch(t){return ut(t)}function s$(t){return t==null?void 0:t.param}function GP(t){switch(t){case Zu:case tc:case Mc:case zr:case ru:case su:case _f:case Tc:case vf:case wf:case Ur:return 6;case xf:return 4;default:return 10}}function fv(t){return!!(t!=null&&t.expr)}function Sr(t){const e=Y(t||{}),n={};for(const i of e)n[i]=Jr(t[i]);return n}function Dot(t){const{anchor:e,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:u,subtitleFont:c,subtitleFontSize:l,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:h,subtitlePadding:p,...g}=t,m={...g,...a?{fill:a}:{}},y={...e?{anchor:e}:{},...n?{frame:n}:{},...i?{offset:i}:{},...r?{orient:r}:{},...s!==void 0?{angle:s}:{},...o!==void 0?{limit:o}:{}},b={...u?{subtitleColor:u}:{},...c?{subtitleFont:c}:{},...l?{subtitleFontSize:l}:{},...f?{subtitleFontStyle:f}:{},...d?{subtitleFontWeight:d}:{},...h?{subtitleLineHeight:h}:{},...p?{subtitlePadding:p}:{}},v=Zg(t,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:v,nonMarkTitleProperties:y,subtitle:b}}function Jc(t){return at(t)||W(t)&&at(t[0])}function gt(t){return!!(t!=null&&t.signal)}function Ef(t){return!!t.step}function ojt(t){return W(t)?!1:"fields"in t&&!("data"in t)}function ajt(t){return W(t)?!1:"fields"in t&&"data"in t}function Hu(t){return W(t)?!1:"field"in t&&"data"in t}const ujt={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},cjt=Y(ujt),ljt={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},sk=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Cot(t){const e=W(t.condition)?t.condition.map(YP):YP(t.condition);return{...Jr(t),condition:e}}function Jr(t){if(fv(t)){const{expr:e,...n}=t;return{signal:e,...n}}return t}function YP(t){if(fv(t)){const{expr:e,...n}=t;return{signal:e,...n}}return t}function Je(t){if(fv(t)){const{expr:e,...n}=t;return{signal:e,...n}}return gt(t)?t:t!==void 0?{value:t}:void 0}function fjt(t){return gt(t)?t.signal:Q(t)}function HP(t){return gt(t)?t.signal:Q(t.value)}function mo(t){return gt(t)?t.signal:t==null?null:Q(t)}function djt(t,e,n){for(const i of n){const r=dc(i,e.markDef,e.config);r!==void 0&&(t[i]=Je(r))}return t}function Not(t){return[].concat(t.type,t.style??[])}function ke(t,e,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&e[r]!==void 0?e[r]:e[t]!==void 0?e[t]:s&&(!r||r===t)?void 0:dc(t,e,n,i)}function dc(t,e,n,{vgChannel:i}={}){return Tn(i?_S(t,e,n.style):void 0,_S(t,e,n.style),i?n[e.type][i]:void 0,n[e.type][t],i?n.mark[i]:n.mark[t])}function _S(t,e,n){return Oot(t,Not(e),n)}function Oot(t,e,n){e=ot(e);let i;for(const r of e){const s=n[r];s&&s[t]!==void 0&&(i=s[t])}return i}function Rot(t,e){return ot(t).reduce((n,i)=>(n.field.push(tt(i,e)),n.order.push(i.sort??"ascending"),n),{field:[],order:[]})}function Lot(t,e){const n=[...t];return e.forEach(i=>{for(const r of n)if(es(r,i))return;n.push(i)}),n}function Bot(t,e){return es(t,e)||!e?t:t?[...ot(t),...ot(e)].join(", "):e}function Pot(t,e){const n=t.value,i=e.value;if(n==null||i===null)return{explicit:t.explicit,value:null};if((Jc(n)||gt(n))&&(Jc(i)||gt(i)))return{explicit:t.explicit,value:Bot(n,i)};if(Jc(n)||gt(n))return{explicit:t.explicit,value:n};if(Jc(i)||gt(i))return{explicit:t.explicit,value:i};if(!Jc(n)&&!gt(n)&&!Jc(i)&&!gt(i))return{explicit:t.explicit,value:Lot(n,i)};throw new Error("It should never reach here")}function h8(t){return`Invalid specification ${Be(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const hjt='Autosize "fit" only works for single views and layered views.';function XP(t){return`${t=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function KP(t){const e=t=="width"?"Width":"Height",n=t=="width"?"x":"y";return`${e} "container" only works well with autosize "fit" or "fit-${n}".`}function JP(t){return t?`Dropping "fit-${t}" because spec has discrete ${jr(t)}.`:'Dropping "fit" because spec has discrete size.'}function p8(t){return`Unknown field for ${t}. Cannot calculate view size.`}function QP(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function pjt(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function gjt(t){return`The "nearest" transform is not supported for ${t} marks.`}function zot(t){return`Selection not supported for ${t} yet.`}function mjt(t){return`Cannot find a selection named "${t}".`}const yjt="Scale bindings are currently only supported for scales with unbinned, continuous domains.",bjt="Legend bindings are only supported for selections over an individual field or encoding channel.";function vjt(t){return`Lookups can only be performed on selection parameters. "${t}" is a variable parameter.`}function wjt(t){return`Cannot define and lookup the "${t}" selection in the same view. Try moving the lookup into a second, layered view?`}const _jt="The same selection must be used to override scale domains in a layered view.",xjt='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function Sjt(t){return`Unknown repeated value "${t}".`}function ZP(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}const Ejt="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Ajt(t){return`Unrecognized parse "${t}".`}function tz(t,e,n){return`An ancestor parsed field "${t}" as ${n} but a child wants to parse the field as ${e}.`}const $jt="Attempt to add the same child twice.";function Ijt(t){return`Ignoring an invalid transform: ${Be(t)}.`}const Mjt='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function ez(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function Tjt(t){const{parentProjection:e,projection:n}=t;return`Layer's shared projection ${Be(e)} is overridden by a child projection ${Be(n)}.`}const Fjt="Arc marks uses theta channel rather than angle, replacing angle with theta.";function kjt(t){return`${t}Offset dropped because ${t} is continuous`}function Djt(t,e,n){return`Channel ${t} is a ${e}. Converted to {value: ${Be(n)}}.`}function Uot(t){return`Invalid field type "${t}".`}function Cjt(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}function Njt(t){return`Invalid aggregation operator "${t}".`}function jot(t,e){const{fill:n,stroke:i}=e;return`Dropping color ${t} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Ojt(t){return`Position range does not support relative band size for ${t}.`}function ok(t,e){return`Dropping ${Be(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}const Rjt="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function o$(t,e,n){return`${t} dropped as it is incompatible with "${e}"${n?` when ${n}`:""}.`}function Ljt(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}function Bjt(t){return`${t} encoding should be discrete (ordinal / nominal / binned).`}function Pjt(t){return`${t} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function zjt(t){return`Facet encoding dropped as ${t.join(" and ")} ${t.length>1?"are":"is"} also specified.`}function z3(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${e==="ordinal"?"order":"magnitude"}.`}function Ujt(t){return`The ${t} for range marks cannot be an expression`}function jjt(t,e){return`Line mark is for continuous lines and thus cannot be used with ${t&&e?"x2 and y2":t?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function qjt(t,e){return`Specified orient "${t}" overridden with "${e}".`}function Vjt(t){return`Cannot use the scale property "${t}" with non-color channel.`}function Wjt(t){return`Cannot use the relative band size with ${t} scale.`}function Gjt(t){return`Using unaggregated domain with raw field has no effect (${Be(t)}).`}function Yjt(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function Hjt(t){return`Unaggregated domain is currently unsupported for log scale (${Be(t)}).`}function Xjt(t){return`Cannot apply size to non-oriented mark "${t}".`}function Kjt(t,e,n){return`Channel "${t}" does not work with "${e}" scale. We are using "${n}" scale instead.`}function Jjt(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}function qot(t,e,n){return`${n}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function Vot(t){return`The step for "${t}" is dropped because the ${t==="width"?"x":"y"} is continuous.`}function Qjt(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${Be(n)} and ${Be(i)}). Using ${Be(n)}.`}function Zjt(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${Be(n)} and ${Be(i)}). Using the union of the two domains.`}function tqt(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}function eqt(t){return`Dropping sort property ${Be(t)} as unioned domains only support boolean or op "count", "min", and "max".`}const nz="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",nqt="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",iqt="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",rqt="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function sqt(t){return`Cannot stack "${t}" if there is already "${t}2".`}function oqt(t){return`Cannot stack non-linear scale (${t}).`}function aqt(t){return`Stacking is applied even though the aggregate function is non-summative ("${t}").`}function xS(t,e){return`Invalid ${t}: ${Be(e)}.`}function uqt(t){return`Dropping day from datetime ${Be(t)} as day cannot be combined with other units.`}function cqt(t,e){return`${e?"extent ":""}${e&&t?"and ":""}${t?"center ":""}${e&&t?"are ":"is "}not needed when data are aggregated.`}function lqt(t,e,n){return`${t} is not usually used with ${e} for ${n}.`}function fqt(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}function iz(t){return`1D error band does not support ${t}.`}function Wot(t){return`Channel ${t} is required for "binned" bin.`}function dqt(t){return`Channel ${t} should not be used with "binned" bin.`}function hqt(t){return`Domain for ${t} is required for threshold scale.`}const Got=qC(jC);let nm=Got;function pqt(t){return nm=t,nm}function gqt(){return nm=Got,nm}function K(...t){nm.warn(...t)}function mqt(...t){nm.debug(...t)}function Nh(t){if(t&&ut(t)){for(const e of m8)if(e in t)return!0}return!1}const Yot=["january","february","march","april","may","june","july","august","september","october","november","december"],yqt=Yot.map(t=>t.substr(0,3)),Hot=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],bqt=Hot.map(t=>t.substr(0,3));function vqt(t){if(JA(t)&&(t=+t),be(t))return t>4&&K(xS("quarter",t)),t-1;throw new Error(xS("quarter",t))}function wqt(t){if(JA(t)&&(t=+t),be(t))return t-1;{const e=t.toLowerCase(),n=Yot.indexOf(e);if(n!==-1)return n;const i=e.substr(0,3),r=yqt.indexOf(i);if(r!==-1)return r;throw new Error(xS("month",t))}}function _qt(t){if(JA(t)&&(t=+t),be(t))return t%7;{const e=t.toLowerCase(),n=Hot.indexOf(e);if(n!==-1)return n;const i=e.substr(0,3),r=bqt.indexOf(i);if(r!==-1)return r;throw new Error(xS("day",t))}}function g8(t,e){const n=[];if(e&&t.day!==void 0&&Y(t).length>1&&(K(uqt(t)),t=Wt(t),delete t.day),t.year!==void 0?n.push(t.year):n.push(2012),t.month!==void 0){const i=e?wqt(t.month):t.month;n.push(i)}else if(t.quarter!==void 0){const i=e?vqt(t.quarter):t.quarter;n.push(be(i)?i*3:`${i}*3`)}else n.push(0);if(t.date!==void 0)n.push(t.date);else if(t.day!==void 0){const i=e?_qt(t.day):t.day;n.push(be(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=t[i];n.push(typeof r>"u"?0:r)}return n}function ch(t){const n=g8(t,!0).join(", ");return t.utc?`utc(${n})`:`datetime(${n})`}function xqt(t){const n=g8(t,!1).join(", ");return t.utc?`utc(${n})`:`datetime(${n})`}function Sqt(t){const e=g8(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}const Xot={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},m8=Y(Xot);function Eqt(t){return!!Xot[t]}function Oh(t){return ut(t)?t.binned:Kot(t)}function Kot(t){return t&&t.startsWith("binned")}function y8(t){return t.startsWith("utc")}function Aqt(t){return t.substring(3)}const $qt={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function a$(t){return m8.filter(e=>Qot(t,e))}function Jot(t){const e=a$(t);return e[e.length-1]}function Qot(t,e){const n=t.indexOf(e);return!(n<0||n>0&&e==="seconds"&&t.charAt(n-1)==="i"||t.length>n+3&&e==="day"&&t.charAt(n+3)==="o"||n>0&&e==="year"&&t.charAt(n-1)==="f")}function Iqt(t,e,{end:n}={end:!1}){const i=i8(e),r=y8(t)?"utc":"";function s(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let o;const a={};for(const u of m8)Qot(t,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),xqt(a)}function Zot(t){if(!t)return;const e=a$(t);return`timeUnitSpecifier(${Be(e)}, ${Be($qt)})`}function Mqt(t,e,n){if(!t)return;const i=Zot(t);return`${n||y8(t)?"utc":"time"}Format(${e}, ${i})`}function ri(t){if(!t)return;let e;return at(t)?Kot(t)?e={unit:t.substring(6),binned:!0}:e={unit:t}:ut(t)&&(e={...t,...t.unit?{unit:t.unit}:{}}),y8(e.unit)&&(e.utc=!0,e.unit=Aqt(e.unit)),e}function Tqt(t){const{utc:e,...n}=ri(t);return n.unit?(e?"utc":"")+Y(n).map(i=>on(`${i==="unit"?"":`_${i}_`}${n[i]}`)).join(""):(e?"utc":"")+"timeunit"+Y(n).map(i=>on(`_${i}_${n[i]}`)).join("")}function tat(t,e=n=>n){const n=ri(t),i=Jot(n.unit);if(i&&i!=="day"){const r={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:s,part:o}=eat(i,n.step),a={...r,[o]:+r[o]+s};return`${e(ch(a))} - ${e(ch(r))}`}}const Fqt={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function kqt(t){return!!Fqt[t]}function eat(t,e=1){if(kqt(t))return{part:t,step:e};switch(t){case"day":case"dayofyear":return{part:"date",step:e};case"quarter":return{part:"month",step:e*3};case"week":return{part:"date",step:e*7}}}function Dqt(t){return t==null?void 0:t.param}function b8(t){return!!(t!=null&&t.field)&&t.equal!==void 0}function v8(t){return!!(t!=null&&t.field)&&t.lt!==void 0}function w8(t){return!!(t!=null&&t.field)&&t.lte!==void 0}function _8(t){return!!(t!=null&&t.field)&&t.gt!==void 0}function x8(t){return!!(t!=null&&t.field)&&t.gte!==void 0}function S8(t){if(t!=null&&t.field){if(W(t.range)&&t.range.length===2)return!0;if(gt(t.range))return!0}return!1}function E8(t){return!!(t!=null&&t.field)&&(W(t.oneOf)||W(t.in))}function Cqt(t){return!!(t!=null&&t.field)&&t.valid!==void 0}function nat(t){return E8(t)||b8(t)||S8(t)||v8(t)||_8(t)||w8(t)||x8(t)}function Qo(t,e){return y$(t,{timeUnit:e,wrapTime:!0})}function Nqt(t,e){return t.map(n=>Qo(n,e))}function iat(t,e=!0){const{field:n}=t,i=ri(t.timeUnit),{unit:r,binned:s}=i||{},o=tt(t,{expr:"datum"}),a=r?`time(${s?o:Iqt(r,n)})`:o;if(b8(t))return`${a}===${Qo(t.equal,r)}`;if(v8(t)){const u=t.lt;return`${a}<${Qo(u,r)}`}else if(_8(t)){const u=t.gt;return`${a}>${Qo(u,r)}`}else if(w8(t)){const u=t.lte;return`${a}<=${Qo(u,r)}`}else if(x8(t)){const u=t.gte;return`${a}>=${Qo(u,r)}`}else{if(E8(t))return`indexof([${Nqt(t.oneOf,r).join(",")}], ${a}) !== -1`;if(Cqt(t))return A8(a,t.valid);if(S8(t)){const{range:u}=t,c=gt(u)?{signal:`${u.signal}[0]`}:u[0],l=gt(u)?{signal:`${u.signal}[1]`}:u[1];if(c!==null&&l!==null&&e)return"inrange("+a+", ["+Qo(c,r)+", "+Qo(l,r)+"])";const f=[];return c!==null&&f.push(`${a} >= ${Qo(c,r)}`),l!==null&&f.push(`${a} <= ${Qo(l,r)}`),f.length>0?f.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${Be(t)}`)}function A8(t,e=!0){return e?`isValid(${t}) && isFinite(+${t})`:`!isValid(${t}) || !isFinite(+${t})`}function Oqt(t){return nat(t)&&t.timeUnit?{...t,timeUnit:ri(t.timeUnit)}:t}const dv={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function Rqt(t){return t==="quantitative"||t==="temporal"}function rat(t){return t==="ordinal"||t==="nominal"}const lh=dv.quantitative,$8=dv.ordinal,im=dv.temporal,I8=dv.nominal,Jm=dv.geojson;function Lqt(t){if(t)switch(t=t.toLowerCase(),t){case"q":case lh:return"quantitative";case"t":case im:return"temporal";case"o":case $8:return"ordinal";case"n":case I8:return"nominal";case Jm:return"geojson"}}const Tr={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},ak={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Bqt(t,e){const n=ak[t],i=ak[e];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const Pqt={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function rz(t){return Pqt[t]}const sat=new Set(["linear","log","pow","sqrt","symlog"]),oat=new Set([...sat,"time","utc"]);function aat(t){return sat.has(t)}const uat=new Set(["quantile","quantize","threshold"]),zqt=new Set([...oat,...uat,"sequential","identity"]),Uqt=new Set(["ordinal","bin-ordinal","point","band"]);function si(t){return Uqt.has(t)}function ds(t){return zqt.has(t)}function yo(t){return oat.has(t)}function rm(t){return uat.has(t)}const jqt={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0};function qqt(t){return!at(t)&&!!t.name}function cat(t){return t==null?void 0:t.param}function Vqt(t){return t==null?void 0:t.unionWith}function Wqt(t){return ut(t)&&"field"in t}const Gqt={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:Hte,domain:Xte,range:Kte,rangeMax:Jte,rangeMin:Qte,scheme:Zte,...Yqt}=Gqt,Hqt=Y(Yqt);function uk(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(t);case"bins":return!["point","band","identity","ordinal"].includes(t);case"round":return yo(t)||t==="band"||t==="point";case"padding":case"rangeMin":case"rangeMax":return yo(t)||["point","band"].includes(t);case"paddingOuter":case"align":return["point","band"].includes(t);case"paddingInner":return t==="band";case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return yo(t);case"nice":return yo(t)||t==="quantize"||t==="threshold";case"exponent":return t==="pow";case"base":return t==="log";case"constant":return t==="symlog";case"zero":return ds(t)&&!fe(["log","time","utc","threshold","quantile"],t)}}function lat(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":return dg(t)?void 0:Vjt(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Xqt(t,e){return fe([$8,I8],e)?t===void 0||si(t):e===im?fe([Tr.TIME,Tr.UTC,void 0],t):e===lh?aat(t)||rm(t)||t===void 0:!0}function Kqt(t,e,n=!1){if(!Fc(t))return!1;switch(t){case an:case ai:case bf:case Km:case Qs:case jo:return yo(e)||e==="band"?!0:e==="point"?!n:!1;case Mc:case _f:case Tc:case vf:case wf:case kh:return yo(e)||rm(e)||fe(["band","point","ordinal"],e);case zr:case ru:case su:return e!=="band";case xf:case Ur:return e==="ordinal"||rm(e)}}const pr={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},fat=pr.arc,u$=pr.area,c$=pr.bar,Jqt=pr.image,l$=pr.line,f$=pr.point,Qqt=pr.rect,SS=pr.rule,dat=pr.text,M8=pr.tick,Zqt=pr.trail,T8=pr.circle,F8=pr.square,hat=pr.geoshape;function Af(t){return["line","area","trail"].includes(t)}function J1(t){return["rect","bar","image","arc"].includes(t)}const tVt=new Set(Y(pr));function Va(t){return t.type}const eVt=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],nVt=["fill","fillOpacity"],iVt=[...eVt,...nVt],rVt={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},sz=Y(rVt),sVt={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],line:["point"],tick:["bandSize","thickness"]},oVt={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},aVt={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},pat=Y(aVt);function fh(t){return t&&t.band!=null}const uVt={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},gat=5,cVt={binSpacing:1,continuousBandSize:gat,minBandSize:.25,timeUnitBandPosition:.5},lVt={binSpacing:0,continuousBandSize:gat,minBandSize:.25,timeUnitBandPosition:.5},fVt={thickness:1};function dVt(t){return Va(t)?t.type:t}function k8(t){const{channel:e,channelDef:n,markDef:i,scale:r,config:s}=t,o=C8(t);return X(n)&&!Fot(n.aggregate)&&r&&yo(r.get("type"))?hVt({fieldDef:n,channel:e,markDef:i,ref:o,config:s}):o}function hVt({fieldDef:t,channel:e,markDef:n,ref:i,config:r}){return Af(n.type)?i:ke("invalid",n,r)===null?[pVt(t,e),i]:i}function pVt(t,e){const n=D8(t,!0),r=Dh(e)==="y"?{field:{group:"height"}}:{value:0};return{test:n,...r}}function D8(t,e=!0){return A8(at(t)?t:tt(t,{expr:"datum"}),!e)}function gVt(t){const{datum:e}=t;return Nh(e)?ch(e):`${Be(e)}`}function Nd(t,e,n,i){const r={};if(e&&(r.scale=e),uu(t)){const{datum:s}=t;Nh(s)?r.signal=ch(s):gt(s)?r.signal=s.signal:fv(s)?r.signal=s.expr:r.value=s}else r.field=tt(t,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function ES({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:n,offset:i,startSuffix:r,endSuffix:s="end",bandPosition:o=.5}){const a=!gt(o)&&0<o&&o<1?"datum":void 0,u=tt(e,{expr:a,suffix:r}),c=n!==void 0?tt(n,{expr:a}):tt(e,{suffix:s,expr:a}),l={};if(o===0||o===1){l.scale=t;const f=o===0?u:c;l.field=f}else{const f=gt(o)?`(1-${o.signal}) * ${u} + ${o.signal} * ${c}`:`${1-o} * ${u} + ${o} * ${c}`;l.signal=`scale("${t}", ${f})`}return i&&(l.offset=i),l}function mVt({scaleName:t,fieldDef:e}){const n=tt(e,{expr:"datum"}),i=tt(e,{expr:"datum",suffix:"end"});return`abs(scale("${t}", ${i}) - scale("${t}", ${n}))`}function C8({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:c,bandPosition:l}){if(e){if(Xt(e)){const f=o==null?void 0:o.get("type");if(cr(e)){l??(l=Zl({fieldDef:e,fieldDef2:n,markDef:i,config:r}));const{bin:d,timeUnit:h,type:p}=e;if(Xe(d)||l&&h&&p===im)return a!=null&&a.impute?Nd(e,s,{binSuffix:"mid"},{offset:u}):l&&!si(f)?ES({scaleName:s,fieldOrDatumDef:e,bandPosition:l,offset:u}):Nd(e,s,mv(e,t)?{binSuffix:"range"}:{},{offset:u});if(ui(d)){if(X(n))return ES({scaleName:s,fieldOrDatumDef:e,fieldOrDatumDef2:n,bandPosition:l,offset:u});K(Wot(t===an?Uo:iu))}}return Nd(e,s,si(f)?{binSuffix:"range"}:{},{offset:u,band:f==="band"?l??e.bandPosition??.5:void 0})}else if(ko(e)){const f=e.value,d=u?{offset:u}:{};return{...Wy(t,f),...d}}}return Qt(c)&&(c=c()),c&&{...c,...u?{offset:u}:{}}}function Wy(t,e){return fe(["x","x2"],t)&&e==="width"?{field:{group:"width"}}:fe(["y","y2"],t)&&e==="height"?{field:{group:"height"}}:Je(e)}function dh(t){return t&&t!=="number"&&t!=="time"}function mat(t,e,n){return`${t}(${e}${n?`, ${Be(n)}`:""})`}const yVt=" – ";function N8({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:s}){var u,c;if(dh(n))return bo({fieldOrDatumDef:t,format:e,formatType:n,expr:i,config:s});const o=yat(t,i,r),a=sm(t);if(e===void 0&&n===void 0&&s.customFormatTypes){if(a==="quantitative"){if(r&&s.normalizedNumberFormatType)return bo({fieldOrDatumDef:t,format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,expr:i,config:s});if(s.numberFormatType)return bo({fieldOrDatumDef:t,format:s.numberFormat,formatType:s.numberFormatType,expr:i,config:s})}if(a==="temporal"&&s.timeFormatType&&X(t)&&t.timeUnit===void 0)return bo({fieldOrDatumDef:t,format:s.timeFormat,formatType:s.timeFormatType,expr:i,config:s})}if(am(t)){const l=vVt({field:o,timeUnit:X(t)?(u=ri(t.timeUnit))==null?void 0:u.unit:void 0,format:e,formatType:s.timeFormatType,rawTimeFormat:s.timeFormat,isUTCScale:Rh(t)&&((c=t.scale)==null?void 0:c.type)===Tr.UTC});return l?{signal:l}:void 0}if(e=ck({type:a,specifiedFormat:e,config:s,normalizeStack:r}),X(t)&&Xe(t.bin)){const l=tt(t,{expr:i,binSuffix:"end"});return{signal:hv(o,l,e,n,s)}}else return e||sm(t)==="quantitative"?{signal:`${wat(o,e)}`}:{signal:`isValid(${o}) ? ${o} : ""+${o}`}}function yat(t,e,n){return X(t)?n?`${tt(t,{expr:e,suffix:"end"})}-${tt(t,{expr:e,suffix:"start"})}`:tt(t,{expr:e}):gVt(t)}function bo({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o??(o=yat(t,i,r)),o!=="datum.value"&&X(t)&&Xe(t.bin)){const a=tt(t,{expr:i,binSuffix:"end"});return{signal:hv(o,a,e,n,s)}}return{signal:mat(n,o,e)}}function bat(t,e,n,i,r,s){var o;if(!(at(i)&&dh(i))&&!(n===void 0&&i===void 0&&r.customFormatTypes&&sm(t)==="quantitative"&&(r.normalizedNumberFormatType&&om(t)&&t.stack==="normalize"||r.numberFormatType))){if(om(t)&&t.stack==="normalize"&&r.normalizedNumberFormat)return ck({type:"quantitative",config:r,normalizeStack:!0});if(am(t)){const a=X(t)?(o=ri(t.timeUnit))==null?void 0:o.unit:void 0;return a===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:bVt({specifiedFormat:n,timeUnit:a,config:r,omitTimeFormatConfig:s})}return ck({type:e,specifiedFormat:n,config:r})}}function vat(t,e,n){var i;if(t&&(gt(t)||t==="number"||t==="time"))return t;if(am(e)&&n!=="time"&&n!=="utc")return X(e)&&((i=ri(e==null?void 0:e.timeUnit))!=null&&i.utc)?"utc":"time"}function ck({type:t,specifiedFormat:e,config:n,normalizeStack:i}){if(at(e))return e;if(t===lh)return i?n.normalizedNumberFormat:n.numberFormat}function bVt({specifiedFormat:t,timeUnit:e,config:n,omitTimeFormatConfig:i}){return t||(e?{signal:Zot(e)}:i?void 0:n.timeFormat)}function wat(t,e){return`format(${t}, "${e||""}")`}function oz(t,e,n,i){return dh(n)?mat(n,t,e):wat(t,(at(e)?e:void 0)??i.numberFormat)}function hv(t,e,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return hv(t,e,r.numberFormat,r.numberFormatType,r);const s=oz(t,n,i,r),o=oz(e,n,i,r);return`${A8(t,!1)} ? "null" : ${s} + "${yVt}" + ${o}`}function vVt({field:t,timeUnit:e,format:n,formatType:i,rawTimeFormat:r,isUTCScale:s}){return!e||n?!e&&i?`${i}(${t}, '${n}')`:(n=at(n)?n:r,`${s?"utc":"time"}Format(${t}, '${n}')`):Mqt(e,t,s)}const d$="min",wVt={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function az(t){return t in wVt}function _at(t){return!!(t!=null&&t.encoding)}function Ia(t){return t&&(t.op==="count"||!!t.field)}function xat(t){return t&&W(t)}function pv(t){return"row"in t||"column"in t}function O8(t){return!!t&&"header"in t}function h$(t){return"facet"in t}function _Vt(t){return t.param}function xVt(t){return t&&!at(t)&&"repeat"in t}function uz(t){const{field:e,timeUnit:n,bin:i,aggregate:r}=t;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...r?{aggregate:r}:{},field:e}}function R8(t){return"sort"in t}function Zl({fieldDef:t,fieldDef2:e,markDef:n,config:i}){if(Xt(t)&&t.bandPosition!==void 0)return t.bandPosition;if(X(t)){const{timeUnit:r,bin:s}=t;if(r&&!e)return dc("timeUnitBandPosition",n,i);if(Xe(s))return .5}}function Sat({channel:t,fieldDef:e,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var c,l,f;const a=jr(t),u=ke(o?"size":a,i,r,{vgChannel:a});if(u!==void 0)return u;if(X(e)){const{timeUnit:d,bin:h}=e;if(d&&!n)return{band:dc("timeUnitBandSize",i,r)};if(Xe(h)&&!si(s))return{band:1}}if(J1(i.type))return s?si(s)?((c=r[i.type])==null?void 0:c.discreteBandSize)||{band:1}:(l=r[i.type])==null?void 0:l.continuousBandSize:(f=r[i.type])==null?void 0:f.discreteBandSize}function Eat(t,e,n,i){return Xe(t.bin)||t.timeUnit&&cr(t)&&t.type==="temporal"?Zl({fieldDef:t,fieldDef2:e,markDef:n,config:i})!==void 0:!1}function Aat(t){return t&&!!t.sort&&!t.field}function p$(t){return t&&"condition"in t}function g$(t){const e=t==null?void 0:t.condition;return!!e&&!W(e)&&X(e)}function gv(t){const e=t==null?void 0:t.condition;return!!e&&!W(e)&&Xt(e)}function SVt(t){const e=t==null?void 0:t.condition;return!!e&&(W(e)||ko(e))}function X(t){return t&&(!!t.field||t.aggregate==="count")}function sm(t){return t==null?void 0:t.type}function uu(t){return t&&"datum"in t}function dl(t){return cr(t)&&!$S(t)||AS(t)}function cz(t){return cr(t)&&t.type==="quantitative"&&!t.bin||AS(t)}function AS(t){return uu(t)&&be(t.datum)}function Xt(t){return X(t)||uu(t)}function cr(t){return t&&("field"in t||t.aggregate==="count")&&"type"in t}function ko(t){return t&&"value"in t&&"value"in t}function Rh(t){return t&&("scale"in t||"sort"in t)}function om(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function $at(t){return t&&"legend"in t}function Iat(t){return t&&("format"in t||"formatType"in t)}function EVt(t){return Mr(t,["legend","axis","header","scale"])}function AVt(t){return"op"in t}function tt(t,e={}){let n=t.field;const i=e.prefix;let r=e.suffix,s="";if(IVt(t))n=mot("count");else{let o;if(!e.nofn)if(AVt(t))o=t.op;else{const{bin:a,aggregate:u,timeUnit:c}=t;Xe(a)?(o=kot(a),r=(e.binSuffix??"")+(e.suffix??"")):u?Sf(u)?(s=`["${n}"]`,n=`argmax_${u.argmax}`):fc(u)?(s=`["${n}"]`,n=`argmin_${u.argmin}`):o=String(u):c&&!Oh(c)&&(o=Tqt(c),r=(!["range","mid"].includes(e.binSuffix)&&e.binSuffix||"")+(e.suffix??""))}o&&(n=n?`${o}_${n}`:o)}return r&&(n=`${n}_${r}`),i&&(n=`${i}_${n}`),e.forAs?r8(n):e.expr?hot(n,e.expr)+s:Hs(n)+s}function $S(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return X(t)&&!!t.bin;case"temporal":return!1}throw new Error(Uot(t.type))}function $Vt(t){var e;return Rh(t)&&rm((e=t.scale)==null?void 0:e.type)}function IVt(t){return t.aggregate==="count"}function MVt(t,e){var o;const{field:n,bin:i,timeUnit:r,aggregate:s}=t;if(s==="count")return e.countTitle;if(Xe(i))return`${n} (binned)`;if(r&&!Oh(r)){const a=(o=ri(r))==null?void 0:o.unit;if(a)return`${n} (${a$(a).join("-")})`}else if(s)return Sf(s)?`${n} for max ${s.argmax}`:fc(s)?`${n} for min ${s.argmin}`:`${av(s)} of ${n}`;return n}function TVt(t){const{aggregate:e,bin:n,timeUnit:i,field:r}=t;if(Sf(e))return`${r} for argmax(${e.argmax})`;if(fc(e))return`${r} for argmin(${e.argmin})`;const s=i&&!Oh(i)?ri(i):void 0,o=e||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||Xe(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const Mat=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return TVt(t);default:return MVt(t,e)}};let Tat=Mat;function Fat(t){Tat=t}function FVt(){Fat(Mat)}function hg(t,e,{allowDisabling:n,includeDefault:i=!0}){var a;const r=(a=L8(t))==null?void 0:a.title;if(!X(t))return r??t.title;const s=t,o=i?B8(s,e):void 0;return n?Tn(r,s.title,o):r??s.title??o}function L8(t){if(om(t)&&t.axis)return t.axis;if($at(t)&&t.legend)return t.legend;if(O8(t)&&t.header)return t.header}function B8(t,e){return Tat(t,e)}function IS(t){if(Iat(t)){const{format:e,formatType:n}=t;return{format:e,formatType:n}}else{const e=L8(t)??{},{format:n,formatType:i}=e;return{format:n,formatType:i}}}function kVt(t,e){var s;switch(e){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(R8(t)&&W(t.sort))return"ordinal";const{aggregate:n,bin:i,timeUnit:r}=t;if(r)return"temporal";if(i||n&&!Sf(n)&&!fc(n))return"quantitative";if(Rh(t)&&((s=t.scale)!=null&&s.type))switch(ak[t.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Wa(t){if(X(t))return t;if(g$(t))return t.condition}function qn(t){if(Xt(t))return t;if(gv(t))return t.condition}function kat(t,e,n,i={}){if(at(t)||be(t)||gf(t)){const r=at(t)?"string":be(t)?"number":"boolean";return K(Djt(e,r,t)),{value:t}}return Xt(t)?MS(t,e,n,i):gv(t)?{...t,condition:MS(t.condition,e,n,i)}:t}function MS(t,e,n,i){if(Iat(t)){const{format:r,formatType:s,...o}=t;if(dh(s)&&!n.customFormatTypes)return K(ez(e)),MS(o,e,n,i)}else{const r=om(t)?"axis":$at(t)?"legend":O8(t)?"header":null;if(r&&t[r]){const{format:s,formatType:o,...a}=t[r];if(dh(o)&&!n.customFormatTypes)return K(ez(e)),MS({...t,[r]:a},e,n,i)}}return X(t)?P8(t,e,i):DVt(t)}function DVt(t){let e=t.type;if(e)return t;const{datum:n}=t;return e=be(n)?"quantitative":at(n)?"nominal":Nh(n)?"temporal":void 0,{...t,type:e}}function P8(t,e,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=t,a={...t};if(!n&&i&&!d8(i)&&!Sf(i)&&!fc(i)&&(K(Njt(i)),delete a.aggregate),r&&(a.timeUnit=ri(r)),o&&(a.field=`${o}`),Xe(s)&&(a.bin=m$(s,e)),ui(s)&&!Fn(e)&&K(dqt(e)),cr(a)){const{type:u}=a,c=Lqt(u);u!==c&&(a.type=c),u!=="quantitative"&&Fot(i)&&(K(Cjt(u,i)),a.type="quantitative")}else if(!Eot(e)){const u=kVt(a,e);a.type=u}if(cr(a)){const{compatible:u,warning:c}=CVt(a,e)||{};u===!1&&K(c)}if(R8(a)&&at(a.sort)){const{sort:u}=a;if(az(u))return{...a,sort:{encoding:u}};const c=u.substr(1);if(u.charAt(0)==="-"&&az(c))return{...a,sort:{encoding:c,order:"descending"}}}if(O8(a)){const{header:u}=a;if(u){const{orient:c,...l}=u;if(c)return{...a,header:{...l,labelOrient:u.labelOrient||c,titleOrient:u.titleOrient||c}}}}return a}function m$(t,e){return gf(t)?{maxbins:GP(e)}:t==="binned"?{binned:!0}:!t.maxbins&&!t.step?{...t,maxbins:GP(e)}:t}const op={compatible:!0};function CVt(t,e){const n=t.type;if(n==="geojson"&&e!=="shape")return{compatible:!1,warning:`Channel ${e} should not be used with a geojson data.`};switch(e){case Zu:case tc:case QA:return $S(t)?op:{compatible:!1,warning:Bjt(e)};case an:case ai:case bf:case Km:case zr:case ru:case su:case uv:case cv:case ZA:case uh:case t$:case e$:case kh:case Qs:case jo:case n$:return op;case Vo:case Xs:case qo:case Wo:return n!==lh?{compatible:!1,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}:op;case Tc:case vf:case wf:case _f:case Mc:case Ic:case $c:case Uo:case iu:return n==="nominal"&&!t.sort?{compatible:!1,warning:`Channel ${e} should not be used with an unsorted discrete field.`}:op;case Ur:case xf:return!$S(t)&&!$Vt(t)?{compatible:!1,warning:Pjt(e)}:op;case em:return t.type==="nominal"&&!("sort"in t)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:op}}function am(t){const{formatType:e}=IS(t);return e==="time"||!e&&NVt(t)}function NVt(t){return t&&(t.type==="temporal"||X(t)&&!!t.timeUnit)}function y$(t,{timeUnit:e,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var u;const s=e&&((u=ri(e))==null?void 0:u.unit);let o=s||n==="temporal",a;return fv(t)?a=t.expr:gt(t)?a=t.signal:Nh(t)?(o=!0,a=ch(t)):(at(t)||be(t))&&o&&(a=`datetime(${Be(t)})`,Eqt(s)&&(be(t)&&t<1e4||at(t)&&isNaN(Date.parse(t)))&&(a=ch({[s]:t}))),a?i&&o?`time(${a})`:a:r?void 0:Be(t)}function Dat(t,e){const{type:n}=t;return e.map(i=>{const r=X(t)&&!Oh(t.timeUnit)?t.timeUnit:void 0,s=y$(i,{timeUnit:r,type:n,undefinedIfExprNotRequired:!0});return s!==void 0?{signal:s}:i})}function mv(t,e){return Xe(t.bin)?Fc(e)&&["ordinal","nominal"].includes(t.type):(console.warn("Only call this method for binned field defs."),!1)}const lz={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function yv(t){return t==null?void 0:t.condition}const Cat=["domain","grid","labels","ticks","title"],OVt={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Nat={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},RVt={...Nat,style:1,labelExpr:1,encoding:1};function fz(t){return!!RVt[t]}const LVt={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Oat=Y(LVt);function kc(t){return"mark"in t}class b${constructor(e,n){this.name=e,this.run=n}hasMatchingType(e){return kc(e)?dVt(e.mark)===this.name:!1}}function Od(t,e){const n=t&&t[e];return n?W(n)?oh(n,i=>!!i.field):X(n)||g$(n):!1}function Rat(t,e){const n=t&&t[e];return n?W(n)?oh(n,i=>!!i.field):X(n)||uu(n)||gv(n):!1}function Lat(t,e){if(Fn(e)){const n=t[e];if((X(n)||uu(n))&&(rat(n.type)||X(n)&&n.timeUnit)){const i=u8(e);return Rat(t,i)}}return!1}function z8(t){return oh(PUt,e=>{if(Od(t,e)){const n=t[e];if(W(n))return oh(n,i=>!!i.aggregate);{const i=Wa(n);return i&&!!i.aggregate}}return!1})}function Bat(t,e){const n=[],i=[],r=[],s=[],o={};return U8(t,(a,u)=>{if(X(a)){const{field:c,aggregate:l,bin:f,timeUnit:d,...h}=a;if(l||d||f){const p=L8(a),g=p==null?void 0:p.title;let m=tt(a,{forAs:!0});const y={...g?[]:{title:hg(a,e,{allowDisabling:!0})},...h,field:m};if(l){let b;if(Sf(l)?(b="argmax",m=tt({op:"argmax",field:l.argmax},{forAs:!0}),y.field=`${m}.${c}`):fc(l)?(b="argmin",m=tt({op:"argmin",field:l.argmin},{forAs:!0}),y.field=`${m}.${c}`):l!=="boxplot"&&l!=="errorbar"&&l!=="errorband"&&(b=l),b){const v={op:b,as:m};c&&(v.field=c),s.push(v)}}else if(n.push(m),cr(a)&&Xe(f)){if(i.push({bin:f,field:c,as:m}),n.push(tt(a,{binSuffix:"end"})),mv(a,u)&&n.push(tt(a,{binSuffix:"range"})),Fn(u)){const b={field:`${m}_end`};o[`${u}2`]=b}y.bin="binned",Eot(u)||(y.type=lh)}else if(d&&!Oh(d)){r.push({timeUnit:d,field:c,as:m});const b=cr(a)&&a.type!==im&&"time";b&&(u===uv||u===uh?y.formatType=b:XUt(u)?y.legend={formatType:b,...y.legend}:Fn(u)&&(y.axis={formatType:b,...y.axis}))}o[u]=y}else n.push(c),o[u]=t[u]}else o[u]=t[u]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function BVt(t,e,n){const i=JUt(e,n);if(i){if(i==="binned"){const r=t[e===Uo?an:ai];return!!(X(r)&&X(t[e])&&ui(r.bin))}}else return!1;return!0}function PVt(t,e,n,i){const r={};for(const s of Y(t))Sot(s)||K(Ljt(s));for(let s of WUt){if(!t[s])continue;const o=t[s];if(lv(s)){const a=VUt(s),u=r[a];if(X(u)&&Rqt(u.type)&&X(o)&&!u.timeUnit){K(kjt(a));continue}}if(s==="angle"&&e==="arc"&&!t.theta&&(K(Fjt),s=Qs),!BVt(t,s,e)){K(o$(s,e));continue}if(s===Mc&&e==="line"){const a=Wa(t[s]);if(a!=null&&a.aggregate){K(Rjt);continue}}if(s===zr&&(n?"fill"in t:"stroke"in t)){K(jot("encoding",{fill:"fill"in t,stroke:"stroke"in t}));continue}if(s===cv||s===em&&!W(o)&&!ko(o)||s===uh&&W(o)){if(o){if(s===em){const a=t[s];if(Aat(a)){r[s]=a;continue}}r[s]=ot(o).reduce((a,u)=>(X(u)?a.push(P8(u,s)):K(ok(u,s)),a),[])}}else{if(s===uh&&o===null)r[s]=null;else if(!X(o)&&!uu(o)&&!ko(o)&&!p$(o)&&!gt(o)){K(ok(o,s));continue}r[s]=kat(o,s,i)}}return r}function v$(t,e){const n={};for(const i of Y(t)){const r=kat(t[i],i,e,{compositeMark:!0});n[i]=r}return n}function zVt(t){const e=[];for(const n of Y(t))if(Od(t,n)){const i=t[n],r=ot(i);for(const s of r)X(s)?e.push(s):g$(s)&&e.push(s.condition)}return e}function U8(t,e,n){if(t)for(const i of Y(t)){const r=t[i];if(W(r))for(const s of r)e.call(n,s,i);else e.call(n,r,i)}}function UVt(t,e,n,i){return t?Y(t).reduce((r,s)=>{const o=t[s];return W(o)?o.reduce((a,u)=>e.call(i,a,u,s),r):e.call(i,r,o,s)},n):n}function Pat(t,e){return Y(e).reduce((n,i)=>{switch(i){case an:case ai:case t$:case n$:case e$:case Uo:case iu:case bf:case Km:case Qs:case Ic:case jo:case $c:case qo:case Vo:case Wo:case Xs:case uv:case Ur:case kh:case uh:return n;case em:if(t==="line"||t==="trail")return n;case cv:case ZA:{const r=e[i];if(W(r)||X(r))for(const s of ot(r))s.aggregate||n.push(tt(s,{}));return n}case Mc:if(t==="trail")return n;case zr:case ru:case su:case Tc:case vf:case wf:case xf:case _f:{const r=Wa(e[i]);return r&&!r.aggregate&&n.push(tt(r,{})),n}}},[])}function jVt(t){const{tooltip:e,...n}=t;if(!e)return{filteredEncoding:n};let i,r;if(W(e)){for(const s of e)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else e.aggregate?n.tooltip=e:r=e;return W(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function lk(t,e,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=t.map(({fieldPrefix:o,titlePrefix:a})=>{const u=i?` of ${j8(e)}`:"";return{field:o+e.field,type:e.type,title:gt(a)?{signal:`${a}"${escape(u)}"`}:a+u}}),s=zVt(n).map(EVt);return{tooltip:[...r,...Sa(s,le)]}}function j8(t){const{title:e,field:n}=t;return Tn(e,n)}function q8(t,e,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:c,endPositionPrefix:l=void 0,extraEncoding:f={}})=>{const d=j8(n);return zat(t,a,r,{mark:u,encoding:{[e]:{field:`${c}_${n.field}`,type:n.type,...d!==void 0?{title:d}:{},...s!==void 0?{scale:s}:{},...o!==void 0?{axis:o}:{}},...at(l)?{[`${e}2`]:{field:`${l}_${n.field}`}}:{},...i,...f}})}}function zat(t,e,n,i){const{clip:r,color:s,opacity:o}=t,a=t.type;return t[e]||t[e]===void 0&&n[e]?[{...i,mark:{...n[e],...r?{clip:r}:{},...s?{color:s}:{},...o?{opacity:o}:{},...Va(i.mark)?i.mark:{type:i.mark},style:`${a}-${String(e)}`,...gf(t[e])?{}:t[e]}}]:[]}function Uat(t,e,n){const{encoding:i}=t,r=e==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],u=i[`${r}Error2`];return{continuousAxisChannelDef:vw(s,n),continuousAxisChannelDef2:vw(o,n),continuousAxisChannelDefError:vw(a,n),continuousAxisChannelDefError2:vw(u,n),continuousAxis:r}}function vw(t,e){if(t!=null&&t.aggregate){const{aggregate:n,...i}=t;return n!==e&&K(fqt(n,e)),i}else return t}function jat(t,e){const{mark:n,encoding:i}=t,{x:r,y:s}=i;if(Va(n)&&n.orient)return n.orient;if(dl(r)){if(dl(s)){const o=X(r)&&r.aggregate,a=X(s)&&s.aggregate;if(!o&&a===e)return"vertical";if(!a&&o===e)return"horizontal";if(o===e&&a===e)throw new Error("Both x and y cannot have aggregate");return am(s)&&!am(r)?"horizontal":"vertical"}return"horizontal"}else{if(dl(s))return"vertical";throw new Error(`Need a valid continuous axis for ${e}s`)}}const TS="boxplot",qVt=["box","median","outliers","rule","ticks"],VVt=new b$(TS,Vat);function qat(t){return be(t)?"tukey":t}function Vat(t,{config:e}){t={...t,encoding:v$(t.encoding,e)};const{mark:n,encoding:i,params:r,projection:s,...o}=t,a=Va(n)?n:{type:n};r&&K(zot("boxplot"));const u=a.extent??e.boxplot.extent,c=ke("size",a,e),l=a.invalid,f=qat(u),{bins:d,timeUnits:h,transform:p,continuousAxisChannelDef:g,continuousAxis:m,groupby:y,aggregate:b,encodingWithoutContinuousAxis:v,ticksOrient:w,boxOrient:_,customTooltipWithoutAggregatedField:S}=WVt(t,u,e),{color:x,size:E,...A}=v,$=oe=>q8(a,m,g,oe,e.boxplot),I=$(A),k=$(v),T=$({...A,...E?{size:E}:{}}),M=lk([{fieldPrefix:f==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:f==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],g,v),F={type:"tick",color:"black",opacity:1,orient:w,invalid:l,aria:!1},D=f==="min-max"?M:lk([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,v),N=[...I({partName:"rule",mark:{type:"rule",invalid:l,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:D}),...I({partName:"rule",mark:{type:"rule",invalid:l,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:D}),...I({partName:"ticks",mark:F,positionPrefix:"lower_whisker",extraEncoding:D}),...I({partName:"ticks",mark:F,positionPrefix:"upper_whisker",extraEncoding:D})],R=[...f!=="tukey"?N:[],...k({partName:"box",mark:{type:"bar",...c?{size:c}:{},orient:_,invalid:l,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...T({partName:"median",mark:{type:"tick",invalid:l,...ut(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{},...c?{size:c}:{},orient:w,aria:!1},positionPrefix:"mid_box",extraEncoding:M})];if(f==="min-max")return{...o,transform:(o.transform??[]).concat(p),layer:R};const L=`datum["lower_box_${g.field}"]`,B=`datum["upper_box_${g.field}"]`,P=`(${B} - ${L})`,U=`${L} - ${u} * ${P}`,H=`${B} + ${u} * ${P}`,nt=`datum["${g.field}"]`,ft={joinaggregate:Wat(g.field),groupby:y},dt={transform:[{filter:`(${U} <= ${nt}) && (${nt} <= ${H})`},{aggregate:[{op:"min",field:g.field,as:`lower_whisker_${g.field}`},{op:"max",field:g.field,as:`upper_whisker_${g.field}`},{op:"min",field:`lower_box_${g.field}`,as:`lower_box_${g.field}`},{op:"max",field:`upper_box_${g.field}`,as:`upper_box_${g.field}`},...b],groupby:y}],layer:N},{tooltip:et,...ct}=A,{scale:G,axis:st}=g,lt=j8(g),V=Mr(st,["title"]),Vt=zat(a,"outliers",e.boxplot,{transform:[{filter:`(${nt} < ${U}) || (${nt} > ${H})`}],mark:"point",encoding:{[m]:{field:g.field,type:g.type,...lt!==void 0?{title:lt}:{},...G!==void 0?{scale:G}:{},...Le(V)?{}:{axis:V}},...ct,...x?{color:x}:{},...S?{tooltip:S}:{}}})[0];let mt;const ee=[...d,...h,ft];return Vt?mt={transform:ee,layer:[Vt,dt]}:(mt=dt,mt.transform.unshift(...ee)),{...o,layer:[mt,{transform:p,layer:R}]}}function Wat(t){return[{op:"q1",field:t,as:`lower_box_${t}`},{op:"q3",field:t,as:`upper_box_${t}`}]}function WVt(t,e,n){const i=jat(t,TS),{continuousAxisChannelDef:r,continuousAxis:s}=Uat(t,i,TS),o=r.field,a=qat(e),u=[...Wat(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],c=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${e}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${e}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],{[s]:l,...f}=t.encoding,{customTooltipWithoutAggregatedField:d,filteredEncoding:h}=jVt(f),{bins:p,timeUnits:g,aggregate:m,groupby:y,encoding:b}=Bat(h,n),v=i==="vertical"?"horizontal":"vertical",w=i,_=[...p,...g,{aggregate:[...m,...u],groupby:y},...c];return{bins:p,timeUnits:g,transform:_,groupby:y,aggregate:m,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:b,ticksOrient:v,boxOrient:w,customTooltipWithoutAggregatedField:d}}const V8="errorbar",GVt=["ticks","rule"],YVt=new b$(V8,Gat);function Gat(t,{config:e}){t={...t,encoding:v$(t.encoding,e)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:c}=Yat(t,V8,e);delete s.size;const l=q8(a,r,i,s,e.errorbar),f=a.thickness,d=a.size,h={type:"tick",orient:o,aria:!1,...f!==void 0?{thickness:f}:{},...d!==void 0?{size:d}:{}},p=[...l({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:c}),...l({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:c}),...l({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c})];return{...u,transform:n,...p.length>1?{layer:p}:{...p[0]}}}function HVt(t,e){const{encoding:n}=t;if(XVt(n))return{orient:jat(t,e),inputType:"raw"};const i=KVt(n),r=JVt(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${e} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(Xt(a)&&Xt(u))throw new Error(`${e} cannot have both x2 and y2`);if(Xt(a)){if(dl(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${e}`)}else if(Xt(u)){if(dl(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${e}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,c=n.yError,l=n.yError2;if(Xt(u)&&!Xt(a))throw new Error(`${e} cannot have xError2 without xError`);if(Xt(l)&&!Xt(c))throw new Error(`${e} cannot have yError2 without yError`);if(Xt(a)&&Xt(c))throw new Error(`${e} cannot have both xError and yError with both are quantiative`);if(Xt(a)){if(dl(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(Xt(c)){if(dl(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function XVt(t){return(Xt(t.x)||Xt(t.y))&&!Xt(t.x2)&&!Xt(t.y2)&&!Xt(t.xError)&&!Xt(t.xError2)&&!Xt(t.yError)&&!Xt(t.yError2)}function KVt(t){return Xt(t.x2)||Xt(t.y2)}function JVt(t){return Xt(t.xError)||Xt(t.xError2)||Xt(t.yError)||Xt(t.yError2)}function Yat(t,e,n){const{mark:i,encoding:r,params:s,projection:o,...a}=t,u=Va(i)?i:{type:i};s&&K(zot(e));const{orient:c,inputType:l}=HVt(t,e),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:h,continuousAxisChannelDefError2:p,continuousAxis:g}=Uat(t,c,e),{errorBarSpecificAggregate:m,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:v}=QVt(u,f,d,h,p,l,e,n),{[g]:w,[g==="x"?"x2":"y2"]:_,[g==="x"?"xError":"yError"]:S,[g==="x"?"xError2":"yError2"]:x,...E}=r,{bins:A,timeUnits:$,aggregate:I,groupby:k,encoding:T}=Bat(E,n),M=[...I,...m],F=l!=="raw"?[]:k,D=lk(b,f,T,v);return{transform:[...a.transform??[],...A,...$,...M.length===0?[]:[{aggregate:M,groupby:F}],...y],groupby:F,continuousAxisChannelDef:f,continuousAxis:g,encodingWithoutContinuousAxis:T,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:a,tooltipEncoding:D}}function QVt(t,e,n,i,r,s,o,a){let u=[],c=[];const l=e.field;let f,d=!1;if(s==="raw"){const h=t.center?t.center:t.extent?t.extent==="iqr"?"median":"mean":a.errorbar.center,p=t.extent?t.extent:h==="mean"?"stderr":"iqr";if(h==="median"!=(p==="iqr")&&K(lqt(h,p,o)),p==="stderr"||p==="stdev")u=[{op:p,field:l,as:`extent_${l}`},{op:h,field:l,as:`center_${l}`}],c=[{calculate:`datum["center_${l}"] + datum["extent_${l}"]`,as:`upper_${l}`},{calculate:`datum["center_${l}"] - datum["extent_${l}"]`,as:`lower_${l}`}],f=[{fieldPrefix:"center_",titlePrefix:av(h)},{fieldPrefix:"upper_",titlePrefix:dz(h,p,"+")},{fieldPrefix:"lower_",titlePrefix:dz(h,p,"-")}],d=!0;else{let g,m,y;p==="ci"?(g="mean",m="ci0",y="ci1"):(g="median",m="q1",y="q3"),u=[{op:m,field:l,as:`lower_${l}`},{op:y,field:l,as:`upper_${l}`},{op:g,field:l,as:`center_${l}`}],f=[{fieldPrefix:"upper_",titlePrefix:hg({field:l,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:hg({field:l,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:hg({field:l,aggregate:g,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(t.center||t.extent)&&K(cqt(t.center,t.extent)),s==="aggregated-upper-lower"?(f=[],c=[{calculate:`datum["${n.field}"]`,as:`upper_${l}`},{calculate:`datum["${l}"]`,as:`lower_${l}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:l}],c=[{calculate:`datum["${l}"] + datum["${i.field}"]`,as:`upper_${l}`}],r?c.push({calculate:`datum["${l}"] + datum["${r.field}"]`,as:`lower_${l}`}):c.push({calculate:`datum["${l}"] - datum["${i.field}"]`,as:`lower_${l}`}));for(const h of c)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:ah(ah(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:c,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function dz(t,e,n){return`${av(t)} ${n} ${e}`}const W8="errorband",ZVt=["band","borders"],tWt=new b$(W8,Hat);function Hat(t,{config:e}){t={...t,encoding:v$(t.encoding,e)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=Yat(t,W8,e),c=o,l=q8(c,r,i,s,e.errorband),f=t.encoding.x!==void 0&&t.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p={...c.interpolate?{interpolate:c.interpolate}:{},...c.tension&&c.interpolate?{tension:c.tension}:{}};return f?(d={...d,...p,ariaRoleDescription:"errorband"},h={...h,...p,aria:!1}):c.interpolate?K(iz("interpolate")):c.tension&&K(iz("tension")),{...a,transform:n,layer:[...l({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:u})]}}const Xat={};function G8(t,e,n){const i=new b$(t,e);Xat[t]={normalizer:i,parts:n}}function eWt(){return Y(Xat)}G8(TS,Vat,qVt);G8(V8,Gat,GVt);G8(W8,Hat,ZVt);const nWt=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Kat={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Jat={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},iWt=Y(Kat),rWt=Y(Jat),sWt={header:1,headerRow:1,headerColumn:1,headerFacet:1},Qat=Y(sWt),Zat=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],oWt={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},aWt={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Do="_vgsid_",uWt={point:{on:"click",fields:[Do],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[pointerdown, window:pointerup] > window:pointermove!",encodings:["x","y"],translate:"[pointerdown, window:pointerup] > window:pointermove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Y8(t){return t==="legend"||!!(t!=null&&t.legend)}function U3(t){return Y8(t)&&ut(t)}function H8(t){return!!(t!=null&&t.select)}function tut(t){const e=[];for(const n of t||[]){if(H8(n))continue;const{expr:i,bind:r,...s}=n;if(r&&i){const o={...s,bind:r,init:i};e.push(o)}else{const o={...s,...i?{update:i}:{},...r?{bind:r}:{}};e.push(o)}}return e}function cWt(t){return w$(t)||K8(t)||X8(t)}function X8(t){return"concat"in t}function w$(t){return"vconcat"in t}function K8(t){return"hconcat"in t}function eut({step:t,offsetIsDiscrete:e}){return e?t.for??"offset":"position"}function Ga(t){return ut(t)&&t.step!==void 0}function hz(t){return t.view||t.width||t.height}const pz=20,lWt={align:1,bounds:1,center:1,columns:1,spacing:1},fWt=Y(lWt);function dWt(t,e,n){const i=n[e],r={},{spacing:s,columns:o}=i;s!==void 0&&(r.spacing=s),o!==void 0&&(h$(t)&&!pv(t.facet)||X8(t))&&(r.columns=o),w$(t)&&(r.columns=1);for(const a of fWt)if(t[a]!==void 0)if(a==="spacing"){const u=t[a];r[a]=be(u)?u:{row:u.row??s,column:u.column??s}}else r[a]=t[a];return r}function fk(t,e){return t[e]??t[e==="width"?"continuousWidth":"continuousHeight"]}function FS(t,e){const n=kS(t,e);return Ga(n)?n.step:nut}function kS(t,e){const n=t[e]??t[e==="width"?"discreteWidth":"discreteHeight"];return Tn(n,{step:t.step})}const nut=20,hWt={continuousWidth:200,continuousHeight:200,step:nut},pWt={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:hWt,mark:oVt,arc:{},area:{},bar:cVt,circle:{},geoshape:{},image:{},line:{},point:{},rect:lVt,rule:{color:"black"},square:{},text:{color:"black"},tick:fVt,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:jqt,projection:{},legend:oWt,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:uWt,style:{},title:{},facet:{spacing:pz},concat:{spacing:pz},normalizedNumberFormat:".0%"},vu=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],gz={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},mz={blue:vu[0],orange:vu[1],red:vu[2],teal:vu[3],green:vu[4],yellow:vu[5],purple:vu[6],pink:vu[7],brown:vu[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function gWt(t={}){return{signals:[{name:"color",value:ut(t)?{...mz,...t}:mz}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function mWt(t){return{signals:[{name:"fontSize",value:ut(t)?{...gz,...t}:gz}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function yWt(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}function iut(t){const e=Y(t||{}),n={};for(const i of e){const r=t[i];n[i]=yv(r)?Cot(r):Jr(r)}return n}function bWt(t){const e=Y(t),n={};for(const i of e)n[i]=iut(t[i]);return n}const vWt=[...pat,...Oat,...Qat,"background","padding","legend","lineBreak","scale","style","title","view"];function rut(t={}){const{color:e,font:n,fontSize:i,selection:r,...s}=t,o=Pm({},Wt(pWt),n?yWt(n):{},e?gWt(e):{},i?mWt(i):{},s||{});r&&zm(o,"selection",r,!0);const a=Mr(o,vWt);for(const u of["background","lineBreak","padding"])o[u]&&(a[u]=Jr(o[u]));for(const u of pat)o[u]&&(a[u]=Sr(o[u]));for(const u of Oat)o[u]&&(a[u]=iut(o[u]));for(const u of Qat)o[u]&&(a[u]=Sr(o[u]));return o.legend&&(a.legend=Sr(o.legend)),o.scale&&(a.scale=Sr(o.scale)),o.style&&(a.style=bWt(o.style)),o.title&&(a.title=Sr(o.title)),o.view&&(a.view=Sr(o.view)),a}const wWt=new Set(["view",...tVt]),_Wt=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],xWt={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...sVt};function SWt(t){t=Wt(t);for(const e of _Wt)delete t[e];if(t.axis)for(const e in t.axis)yv(t.axis[e])&&delete t.axis[e];if(t.legend)for(const e of nWt)delete t.legend[e];if(t.mark){for(const e of sz)delete t.mark[e];t.mark.tooltip&&ut(t.mark.tooltip)&&delete t.mark.tooltip}t.params&&(t.signals=(t.signals||[]).concat(tut(t.params)),delete t.params);for(const e of wWt){for(const i of sz)delete t[e][i];const n=xWt[e];if(n)for(const i of n)delete t[e][i];AWt(t,e)}for(const e of eWt())delete t[e];EWt(t);for(const e in t)ut(t[e])&&Le(t[e])&&delete t[e];return Le(t)?void 0:t}function EWt(t){const{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:i}=Dot(t.title);Le(e)||(t.style["group-title"]={...t.style["group-title"],...e}),Le(n)||(t.style["group-subtitle"]={...t.style["group-subtitle"],...n}),Le(i)?delete t.title:t.title=i}function AWt(t,e,n,i){const r=i?t[e][i]:t[e];e==="view"&&(n="cell");const s={...r,...t.style[n??e]};Le(s)||(t.style[n??e]=s),i||delete t[e]}function _$(t){return"layer"in t}function $Wt(t){return"repeat"in t}function IWt(t){return!W(t.repeat)&&t.repeat.layer}class J8{map(e,n){return h$(e)?this.mapFacet(e,n):$Wt(e)?this.mapRepeat(e,n):K8(e)?this.mapHConcat(e,n):w$(e)?this.mapVConcat(e,n):X8(e)?this.mapConcat(e,n):this.mapLayerOrUnit(e,n)}mapLayerOrUnit(e,n){if(_$(e))return this.mapLayer(e,n);if(kc(e))return this.mapUnit(e,n);throw new Error(h8(e))}mapLayer(e,n){return{...e,layer:e.layer.map(i=>this.mapLayerOrUnit(i,n))}}mapHConcat(e,n){return{...e,hconcat:e.hconcat.map(i=>this.map(i,n))}}mapVConcat(e,n){return{...e,vconcat:e.vconcat.map(i=>this.map(i,n))}}mapConcat(e,n){const{concat:i,...r}=e;return{...r,concat:i.map(s=>this.map(s,n))}}mapFacet(e,n){return{...e,spec:this.map(e.spec,n)}}mapRepeat(e,n){return{...e,spec:this.map(e.spec,n)}}}const MWt={zero:1,center:1,normalize:1};function TWt(t){return t in MWt}const FWt=new Set([fat,c$,u$,SS,f$,T8,F8,l$,dat,M8]),kWt=new Set([c$,u$,fat]);function ap(t){return X(t)&&sm(t)==="quantitative"&&!t.bin}function yz(t,e,{orient:n,type:i}){const r=e==="x"?"y":"radius",s=e==="x"&&["bar","area"].includes(i),o=t[e],a=t[r];if(X(o)&&X(a))if(ap(o)&&ap(a)){if(o.stack)return e;if(a.stack)return r;const u=X(o)&&!!o.aggregate,c=X(a)&&!!a.aggregate;if(u!==c)return u?e:r;if(s){if(n==="vertical")return r;if(n==="horizontal")return e}}else{if(ap(o))return e;if(ap(a))return r}else{if(ap(o))return s&&n==="vertical"?void 0:e;if(ap(a))return s&&n==="horizontal"?void 0:r}}function DWt(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function sut(t,e){var g,m;const n=Va(t)?t:{type:t},i=n.type;if(!FWt.has(i))return null;const r=yz(e,"x",n)||yz(e,"theta",n);if(!r)return null;const s=e[r],o=X(s)?tt(s,{}):void 0,a=DWt(r),u=[],c=new Set;if(e[a]){const y=e[a],b=X(y)?tt(y,{}):void 0;b&&b!==o&&(u.push(a),c.add(b))}const l=a==="x"?"xOffset":"yOffset",f=e[l],d=X(f)?tt(f,{}):void 0;d&&d!==o&&(u.push(l),c.add(d));const h=GUt.reduce((y,b)=>{if(b!=="tooltip"&&Od(e,b)){const v=e[b];for(const w of ot(v)){const _=Wa(w);if(_.aggregate)continue;const S=tt(_,{});(!S||!c.has(S))&&y.push({channel:b,fieldDef:_})}}return y},[]);let p;return s.stack!==void 0?gf(s.stack)?p=s.stack?"zero":null:p=s.stack:kWt.has(i)&&(p="zero"),!p||!TWt(p)||z8(e)&&h.length===0?null:(g=s==null?void 0:s.scale)!=null&&g.type&&((m=s==null?void 0:s.scale)==null?void 0:m.type)!==Tr.LINEAR?(s!=null&&s.stack&&K(oqt(s.scale.type)),null):Xt(e[ou(r)])?(s.stack!==void 0&&K(sqt(r)),null):(X(s)&&s.aggregate&&!rjt.has(s.aggregate)&&K(aqt(s.aggregate)),{groupbyChannels:u,groupbyFields:c,fieldChannel:r,impute:s.impute===null?!1:Af(i),stackBy:h,offset:p})}function out(t,e,n){const i=Sr(t),r=ke("orient",i,n);if(i.orient=RWt(i.type,e,r),r!==void 0&&r!==i.orient&&K(qjt(i.orient,r)),i.type==="bar"&&i.orient){const a=ke("cornerRadiusEnd",i,n);if(a!==void 0){const u=i.orient==="horizontal"&&e.x2||i.orient==="vertical"&&e.y2?["cornerRadius"]:uVt[i.orient];for(const c of u)i[c]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return ke("opacity",i,n)===void 0&&(i.opacity=NWt(i.type,e)),ke("cursor",i,n)===void 0&&(i.cursor=CWt(i,e,n)),i}function CWt(t,e,n){return e.href||t.href||ke("href",t,n)?"pointer":t.cursor}function NWt(t,e){if(fe([f$,M8,T8,F8],t)&&!z8(e))return .7}function OWt(t,e,{graticule:n}){if(n)return!1;const i=dc("filled",t,e),r=t.type;return Tn(i,r!==f$&&r!==l$&&r!==SS)}function RWt(t,e,n){switch(t){case f$:case T8:case F8:case dat:case Qqt:case Jqt:return}const{x:i,y:r,x2:s,y2:o}=e;switch(t){case c$:if(X(i)&&(ui(i.bin)||X(r)&&r.aggregate&&!i.aggregate))return"vertical";if(X(r)&&(ui(r.bin)||X(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s)return(X(i)&&i.type===lh&&!Xe(i.bin)||AS(i))&&X(r)&&ui(r.bin)?"horizontal":"vertical";if(!o)return(X(r)&&r.type===lh&&!Xe(r.bin)||AS(r))&&X(i)&&ui(i.bin)?"vertical":"horizontal"}case SS:if(s&&!(X(i)&&ui(i.bin))&&o&&!(X(r)&&ui(r.bin)))return;case u$:if(o)return X(r)&&ui(r.bin)?"horizontal":"vertical";if(s)return X(i)&&ui(i.bin)?"vertical":"horizontal";if(t===SS){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case l$:case M8:{const a=cz(i),u=cz(r);if(n)return n;if(a&&!u)return t!=="tick"?"horizontal":"vertical";if(!a&&u)return t!=="tick"?"vertical":"horizontal";if(a&&u)return"vertical";{const c=cr(i)&&i.type===im,l=cr(r)&&r.type===im;if(c&&!l)return"vertical";if(!c&&l)return"horizontal"}return}}return"vertical"}function LWt(t){const{point:e,line:n,...i}=t;return Y(i).length>1?i:i.type}function BWt(t){for(const e of["line","area","rule","trail"])t[e]&&(t={...t,[e]:Mr(t[e],["point","line"])});return t}function j3(t,e={},n){return t.point==="transparent"?{opacity:0}:t.point?ut(t.point)?t.point:{}:t.point!==void 0?null:e.point||n.shape?ut(e.point)?e.point:{}:void 0}function bz(t,e={}){return t.line?t.line===!0?{}:t.line:t.line!==void 0?null:e.line?e.line===!0?{}:e.line:void 0}class PWt{constructor(){this.name="path-overlay"}hasMatchingType(e,n){if(kc(e)){const{mark:i,encoding:r}=e,s=Va(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!j3(s,n[s.type],r);case"area":return!!j3(s,n[s.type],r)||!!bz(s,n[s.type])}}return!1}run(e,n,i){const{config:r}=n,{params:s,projection:o,mark:a,name:u,encoding:c,...l}=e,f=v$(c,r),d=Va(a)?a:{type:a},h=j3(d,r[d.type],f),p=d.type==="area"&&bz(d,r[d.type]),g=[{name:u,...s?{params:s}:{},mark:LWt({...d.type==="area"&&d.opacity===void 0&&d.fillOpacity===void 0?{opacity:.7}:{},...d}),encoding:Mr(f,["shape"])}],m=sut(out(d,f,r),f);let y=f;if(m){const{fieldChannel:b,offset:v}=m;y={...f,[b]:{...f[b],...v?{stack:v}:{}}}}return y=Mr(y,["y2","x2"]),p&&g.push({...o?{projection:o}:{},mark:{type:"line",...Zg(d,["clip","interpolate","tension","tooltip"]),...p},encoding:y}),h&&g.push({...o?{projection:o}:{},mark:{type:"point",opacity:1,filled:!0,...Zg(d,["clip","tooltip"]),...h},encoding:y}),i({...l,layer:g},{...n,config:BWt(r)})}}function zWt(t,e){return e?pv(t)?uut(t,e):aut(t,e):t}function q3(t,e){return e?uut(t,e):t}function dk(t,e,n){const i=e[t];if(xVt(i)){if(i.repeat in n)return{...e,[t]:n[i.repeat]};K(Sjt(i.repeat));return}return e}function aut(t,e){if(t=dk("field",t,e),t!==void 0){if(t===null)return null;if(R8(t)&&Ia(t.sort)){const n=dk("field",t.sort,e);t={...t,...n?{sort:n}:{}}}return t}}function vz(t,e){if(X(t))return aut(t,e);{const n=dk("datum",t,e);return n!==t&&!n.type&&(n.type="nominal"),n}}function wz(t,e){if(Xt(t)){const n=vz(t,e);if(n)return n;if(p$(t))return{condition:t.condition}}else{if(gv(t)){const n=vz(t.condition,e);if(n)return{...t,condition:n};{const{condition:i,...r}=t;return r}}return t}}function uut(t,e){const n={};for(const i in t)if(xt(t,i)){const r=t[i];if(W(r))n[i]=r.map(s=>wz(s,e)).filter(s=>s);else{const s=wz(r,e);s!==void 0&&(n[i]=s)}}return n}class UWt{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(kc(e)){const{encoding:n,mark:i}=e;if(i==="line"||Va(i)&&i.type==="line")for(const r of qUt){const s=Dh(r),o=n[s];if(n[r]&&(X(o)&&!ui(o.bin)||uu(o)))return!0}}return!1}run(e,n,i){const{encoding:r,mark:s}=e;return K(jjt(!!r.x2,!!r.y2)),i({...e,mark:ut(s)?{...s,type:"rule"}:"rule"},n)}}class jWt extends J8{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[VVt,YVt,tWt,new PWt,new UWt]}map(e,n){if(kc(e)){const i=Od(e.encoding,Zu),r=Od(e.encoding,tc),s=Od(e.encoding,QA);if(i||r||s)return this.mapFacetedUnit(e,n)}return super.map(e,n)}mapUnit(e,n){const{parentEncoding:i,parentProjection:r}=n,s=q3(e.encoding,n.repeater),o={...e,...e.name?{name:[n.repeaterPrefix,e.name].filter(u=>u).join("_")}:{},...s?{encoding:s}:{}};if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(o,n.config))return u.run(o,n,a);return o}mapRepeat(e,n){return IWt(e)?this.mapLayerRepeat(e,n):this.mapNonLayerRepeat(e,n)}mapLayerRepeat(e,n){const{repeat:i,spec:r,...s}=e,{row:o,column:a,layer:u}=i,{repeater:c={},repeaterPrefix:l=""}=n;return o||a?this.mapRepeat({...e,repeat:{...o?{row:o}:{},...a?{column:a}:{}},spec:{repeat:{layer:u},spec:r}},n):{...s,layer:u.map(f=>{const d={...c,layer:f},h=`${(r.name?`${r.name}_`:"")+l}child__layer_${on(f)}`,p=this.mapLayerOrUnit(r,{...n,repeater:d,repeaterPrefix:h});return p.name=h,p})}}mapNonLayerRepeat(e,n){const{repeat:i,spec:r,data:s,...o}=e;!W(i)&&e.columns&&(e=Mr(e,["columns"]),K(ZP("repeat")));const a=[],{repeater:u={},repeaterPrefix:c=""}=n,l=!W(i)&&i.row||[u?u.row:null],f=!W(i)&&i.column||[u?u.column:null],d=W(i)&&i||[u?u.repeat:null];for(const p of d)for(const g of l)for(const m of f){const y={repeat:p,row:g,column:m,layer:u.layer},b=(r.name?`${r.name}_`:"")+c+"child__"+(W(i)?`${on(p)}`:(i.row?`row_${on(g)}`:"")+(i.column?`column_${on(m)}`:"")),v=this.map(r,{...n,repeater:y,repeaterPrefix:b});v.name=b,a.push(Mr(v,["data"]))}const h=W(i)?e.columns:i.column?i.column.length:1;return{data:r.data??s,align:"all",...o,columns:h,concat:a}}mapFacet(e,n){const{facet:i}=e;return pv(i)&&e.columns&&(e=Mr(e,["columns"]),K(ZP("facet"))),super.mapFacet(e,n)}mapUnitWithParentEncodingOrProjection(e,n){const{encoding:i,projection:r}=e,{parentEncoding:s,parentProjection:o,config:a}=n,u=xz({parentProjection:o,projection:r}),c=_z({parentEncoding:s,encoding:q3(i,n.repeater)});return this.mapUnit({...e,...u?{projection:u}:{},...c?{encoding:c}:{}},{config:a})}mapFacetedUnit(e,n){const{row:i,column:r,facet:s,...o}=e.encoding,{mark:a,width:u,projection:c,height:l,view:f,params:d,encoding:h,...p}=e,{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:s},n),y=q3(o,n.repeater);return this.mapFacet({...p,...m,facet:g,spec:{...u?{width:u}:{},...l?{height:l}:{},...f?{view:f}:{},...c?{projection:c}:{},mark:a,encoding:y,...d?{params:d}:{}}},n)}getFacetMappingAndLayout(e,n){const{row:i,column:r,facet:s}=e;if(i||r){s&&K(zjt([...i?[Zu]:[],...r?[tc]:[]]));const o={},a={};for(const u of[Zu,tc]){const c=e[u];if(c){const{align:l,center:f,spacing:d,columns:h,...p}=c;o[u]=p;for(const g of["align","center","spacing"])c[g]!==void 0&&(a[g]??(a[g]={}),a[g][u]=c[g])}}return{facetMapping:o,layout:a}}else{const{align:o,center:a,spacing:u,columns:c,...l}=s;return{facetMapping:zWt(l,n.repeater),layout:{...o?{align:o}:{},...a?{center:a}:{},...u?{spacing:u}:{},...c?{columns:c}:{}}}}}mapLayer(e,{parentEncoding:n,parentProjection:i,...r}){const{encoding:s,projection:o,...a}=e,u={...r,parentEncoding:_z({parentEncoding:n,encoding:s,layer:!0}),parentProjection:xz({parentProjection:i,projection:o})};return super.mapLayer({...a,...e.name?{name:[u.repeaterPrefix,e.name].filter(c=>c).join("_")}:{}},u)}}function _z({parentEncoding:t,encoding:e={},layer:n}){let i={};if(t){const r=new Set([...Y(t),...Y(e)]);for(const s of r){const o=e[s],a=t[s];if(Xt(o)){const u={...a,...o};i[s]=u}else gv(o)?i[s]={...o,condition:{...a,...o.condition}}:o||o===null?i[s]=o:(n||ko(a)||gt(a)||Xt(a)||W(a))&&(i[s]=a)}}else i=e;return!i||Le(i)?void 0:i}function xz(t){const{parentProjection:e,projection:n}=t;return e&&n&&K(Tjt({parentProjection:e,projection:n})),n??e}function Q8(t){return"filter"in t}function qWt(t){return(t==null?void 0:t.stop)!==void 0}function cut(t){return"lookup"in t}function VWt(t){return"data"in t}function WWt(t){return"param"in t}function GWt(t){return"pivot"in t}function YWt(t){return"density"in t}function HWt(t){return"quantile"in t}function XWt(t){return"regression"in t}function KWt(t){return"loess"in t}function JWt(t){return"sample"in t}function QWt(t){return"window"in t}function ZWt(t){return"joinaggregate"in t}function tGt(t){return"flatten"in t}function eGt(t){return"calculate"in t}function lut(t){return"bin"in t}function nGt(t){return"impute"in t}function iGt(t){return"timeUnit"in t}function rGt(t){return"aggregate"in t}function sGt(t){return"stack"in t}function oGt(t){return"fold"in t}function aGt(t){return"extent"in t&&!("density"in t)}function uGt(t){return t.map(e=>Q8(e)?{filter:fg(e.filter,Oqt)}:e)}class cGt extends J8{map(e,n){return n.emptySelections??(n.emptySelections={}),n.selectionPredicates??(n.selectionPredicates={}),e=Sz(e,n),super.map(e,n)}mapLayerOrUnit(e,n){if(e=Sz(e,n),e.encoding){const i={};for(const[r,s]of Jl(e.encoding))i[r]=fut(s,n);e={...e,encoding:i}}return super.mapLayerOrUnit(e,n)}mapUnit(e,n){const{selection:i,...r}=e;return i?{...r,params:Jl(i).map(([s,o])=>{const{init:a,bind:u,empty:c,...l}=o;l.type==="single"?(l.type="point",l.toggle=!1):l.type==="multi"&&(l.type="point"),n.emptySelections[s]=c!=="none";for(const f of mi(n.selectionPredicates[s]??{}))f.empty=c!=="none";return{name:s,value:a,select:l,bind:u}})}:e}}function Sz(t,e){const{transform:n,...i}=t;if(n){const r=n.map(s=>{if(Q8(s))return{filter:hk(s,e)};if(lut(s)&&Ch(s.bin))return{...s,bin:dut(s.bin)};if(cut(s)){const{selection:o,...a}=s.from;return o?{...s,from:{param:o,...a}}:s}return s});return{...i,transform:r}}return t}function fut(t,e){var i,r;const n=Wt(t);if(X(n)&&Ch(n.bin)&&(n.bin=dut(n.bin)),Rh(n)&&((r=(i=n.scale)==null?void 0:i.domain)!=null&&r.selection)){const{selection:s,...o}=n.scale.domain;n.scale.domain={...o,...s?{param:s}:{}}}if(p$(n))if(W(n.condition))n.condition=n.condition.map(s=>{const{selection:o,param:a,test:u,...c}=s;return a?s:{...c,test:hk(s,e)}});else{const{selection:s,param:o,test:a,...u}=fut(n.condition,e);n.condition=o?n.condition:{...u,test:hk(n.condition,e)}}return n}function dut(t){const e=t.extent;if(e!=null&&e.selection){const{selection:n,...i}=e;return{...t,extent:{...i,param:n}}}return t}function hk(t,e){const n=i=>fg(i,r=>{var s;const o=e.emptySelections[r]??!0,a={param:r,empty:o};return(s=e.selectionPredicates)[r]??(s[r]=[]),e.selectionPredicates[r].push(a),a});return t.selection?n(t.selection):fg(t.test||t.filter,i=>i.selection?n(i.selection):i)}class pk extends J8{map(e,n){const i=n.selections??[];if(e.params&&!kc(e)){const r=[];for(const s of e.params)H8(s)?i.push(s):r.push(s);e.params=r}return n.selections=i,super.map(e,n)}mapUnit(e,n){const i=n.selections;if(!i||!i.length)return e;const r=(n.path??[]).concat(e.name),s=[];for(const o of i)if(!o.views||!o.views.length)s.push(o);else for(const a of o.views)(at(a)&&(a===e.name||r.includes(a))||W(a)&&a.map(u=>r.indexOf(u)).every((u,c,l)=>u!==-1&&(c===0||u>l[c-1])))&&s.push(o);return s.length&&(e.params=s),e}}for(const t of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const e=pk.prototype[t];pk.prototype[t]=function(n,i){return e.call(this,n,lGt(n,i))}}function lGt(t,e){return t.name?{...e,path:(e.path??[]).concat(t.name)}:e}function hut(t,e){e===void 0&&(e=rut(t.config));const n=pGt(t,e),{width:i,height:r}=t,s=gGt(n,{width:i,height:r,autosize:t.autosize},e);return{...n,...s?{autosize:s}:{}}}const fGt=new jWt,dGt=new cGt,hGt=new pk;function pGt(t,e={}){const n={config:e};return hGt.map(fGt.map(dGt.map(t,n),n),n)}function Ez(t){return at(t)?{type:t}:t??{}}function gGt(t,e,n){let{width:i,height:r}=e;const s=kc(t)||_$(t),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(K(XP("width")),i=void 0),r=="container"&&(K(XP("height")),r=void 0));const a={type:"pad",...o,...n?Ez(n.autosize):{},...Ez(t.autosize)};if(a.type==="fit"&&!s&&(K(hjt),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&K(KP("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&K(KP("height")),!es(a,{type:"pad"}))return a}function mGt(t){return t==="fit"||t==="fit-x"||t==="fit-y"}function yGt(t){return t?`fit-${i$(t)}`:"fit"}const bGt=["background","padding"];function Az(t,e){const n={};for(const i of bGt)t&&t[i]!==void 0&&(n[i]=Jr(t[i]));return e&&(n.params=t.params),n}class Dc{constructor(e={},n={}){this.explicit=e,this.implicit=n}clone(){return new Dc(Wt(this.explicit),Wt(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(e){return Tn(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,{value:n,explicit:i}){n!==void 0&&this.set(e,n,i)}set(e,n,i){return delete this[i?"implicit":"explicit"][e],this[i?"explicit":"implicit"][e]=n,this}copyKeyFromSplit(e,{explicit:n,implicit:i}){n[e]!==void 0?this.set(e,n[e],!0):i[e]!==void 0&&this.set(e,i[e],!1)}copyKeyFromObject(e,n){n[e]!==void 0&&this.set(e,n[e],!0)}copyAll(e){for(const n of Y(e.combine())){const i=e.getWithExplicit(n);this.setWithExplicit(n,i)}}}function oa(t){return{explicit:!0,value:t}}function Gr(t){return{explicit:!1,value:t}}function put(t){return(e,n,i,r)=>{const s=t(e.value,n.value);return s>0?e:s<0?n:x$(e,n,i,r)}}function x$(t,e,n,i){return t.explicit&&e.explicit&&K(Qjt(n,i,t.value,e.value)),t}function tf(t,e,n,i,r=x$){return t===void 0||t.value===void 0?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:es(t.value,e.value)?t:r(t,e,n,i)}class vGt extends Dc{constructor(e={},n={},i=!1){super(e,n),this.explicit=e,this.implicit=n,this.parseNothing=i}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function um(t){return"url"in t}function Q1(t){return"values"in t}function gut(t){return"name"in t&&!um(t)&&!Q1(t)&&!vl(t)}function vl(t){return t&&(mut(t)||yut(t)||Z8(t))}function mut(t){return"sequence"in t}function yut(t){return"sphere"in t}function Z8(t){return"graticule"in t}var Ye;(function(t){t[t.Raw=0]="Raw",t[t.Main=1]="Main",t[t.Row=2]="Row",t[t.Column=3]="Column",t[t.Lookup=4]="Lookup"})(Ye||(Ye={}));function but(t){const{signals:e,hasLegend:n,index:i,...r}=t;return r.field=Hs(r.field),r}function hh(t,e=!0,n=Li){if(W(t)){const i=t.map(r=>hh(r,e,n));return e?`[${i.join(", ")}]`:i}else if(Nh(t))return n(e?ch(t):Sqt(t));return e?n(Be(t)):t}function wGt(t,e){for(const n of mi(t.component.selection??{})){const i=n.name;let r=`${i}${nf}, ${n.resolve==="global"?"true":`{unit: ${Rd(t)}}`}`;for(const s of $$)s.defined(n)&&(s.signals&&(e=s.signals(t,n,e)),s.modifyExpr&&(r=s.modifyExpr(t,n,r)));e.push({name:i+QGt,on:[{events:{signal:n.name+nf},update:`modify(${Q(n.name+ph)}, ${r})`}]})}return t4(e)}function _Gt(t,e){if(t.component.selection&&Y(t.component.selection).length){const n=Q(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:yf("pointermove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return t4(e)}function xGt(t,e){let n=!1;for(const i of mi(t.component.selection??{})){const r=i.name,s=Q(r+ph);if(e.filter(a=>a.name===r).length===0){const a=i.resolve==="global"?"union":i.resolve,u=i.type==="point"?", true, true)":")";e.push({name:i.name,update:`${Rut}(${s}, ${Q(a)}${u}`})}n=!0;for(const a of $$)a.defined(i)&&a.topLevelSignals&&(e=a.topLevelSignals(t,i,e))}return n&&e.filter(r=>r.name==="unit").length===0&&e.unshift({name:"unit",value:{},on:[{events:"pointermove",update:"isTuple(group()) ? group() : unit"}]}),t4(e)}function SGt(t,e){const n=[...e],i=Rd(t,{escape:!1});for(const r of mi(t.component.selection??{})){const s={name:r.name+ph};if(r.project.hasSelectionId&&(s.transform=[{type:"collect",sort:{field:Do}}]),r.init){const a=r.project.items.map(but);s.values=r.project.hasSelectionId?r.init.map(u=>({unit:i,[Do]:hh(u,!1)[0]})):r.init.map(u=>({unit:i,fields:a,values:hh(u,!1)}))}n.filter(a=>a.name===r.name+ph).length||n.push(s)}return n}function vut(t,e){for(const n of mi(t.component.selection??{}))for(const i of $$)i.defined(n)&&i.marks&&(e=i.marks(t,n,e));return e}function EGt(t,e){for(const n of t.children)wn(n)&&(e=vut(n,e));return e}function AGt(t,e,n,i){const r=Uut(t,e.param,e);return{signal:ds(n.get("type"))&&W(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function t4(t){return t.map(e=>(e.on&&!e.on.length&&delete e.on,e))}class Oe{constructor(e,n){this.debugName=n,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,n){if(this._children.includes(e)){K($jt);return}n!==void 0?this._children.splice(n,0,e):this._children.push(e)}removeChild(e){const n=this._children.indexOf(e);return this._children.splice(n,1),n}remove(){let e=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,e++)}insertAsParentOf(e){const n=e.parent;n.removeChild(this),this.parent=n,e.parent=this}swapWithParent(){const e=this._parent,n=e.parent;for(const r of this._children)r.parent=e;this._children=[],e.removeChild(this);const i=e.parent.removeChild(e);this._parent=n,n.addChild(this,i),e.parent=this}}class nr extends Oe{clone(){const e=new this.constructor;return e.debugName=`clone_${this.debugName}`,e._source=this._source,e._name=`clone_${this._name}`,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}constructor(e,n,i,r){super(e,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${got()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}function V3(t){return t.as!==void 0}function $z(t){return`${t}_end`}class Ma extends Oe{clone(){return new Ma(null,Wt(this.timeUnits))}constructor(e,n){super(e),this.timeUnits=n}static makeFromEncoding(e,n){const i=n.reduceFieldDef((r,s,o)=>{const{field:a,timeUnit:u}=s;if(u){let c;if(Oh(u)){if(wn(n)){const{mark:l,markDef:f,config:d}=n,h=Zl({fieldDef:s,markDef:f,config:d});(J1(l)||h)&&(c={timeUnit:ri(u),field:a})}}else c={as:tt(s,{forAs:!0}),field:a,timeUnit:u};if(wn(n)){const{mark:l,markDef:f,config:d}=n,h=Zl({fieldDef:s,markDef:f,config:d});J1(l)&&Fn(o)&&h!==.5&&(c.rectBandPosition=h)}c&&(r[le(c)]=c)}return r},{});return Le(i)?null:new Ma(e,i)}static makeFromTransform(e,n){const{timeUnit:i,...r}={...n},s=ri(i),o={...r,timeUnit:s};return new Ma(e,{[le(o)]:o})}merge(e){this.timeUnits={...this.timeUnits};for(const n in e.timeUnits)this.timeUnits[n]||(this.timeUnits[n]=e.timeUnits[n]);for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}removeFormulas(e){const n={};for(const[i,r]of Jl(this.timeUnits)){const s=V3(r)?r.as:`${r.field}_end`;e.has(s)||(n[i]=r)}this.timeUnits=n}producedFields(){return new Set(mi(this.timeUnits).map(e=>V3(e)?e.as:$z(e.field)))}dependentFields(){return new Set(mi(this.timeUnits).map(e=>e.field))}hash(){return`TimeUnit ${le(this.timeUnits)}`}assemble(){const e=[];for(const n of mi(this.timeUnits)){const{rectBandPosition:i}=n,r=ri(n.timeUnit);if(V3(n)){const{field:s,as:o}=n,{unit:a,utc:u,...c}=r,l=[o,`${o}_end`];e.push({field:Hs(s),type:"timeunit",...a?{units:a$(a)}:{},...u?{timezone:"utc"}:{},...c,as:l}),e.push(...Iz(l,i,r))}else if(n){const{field:s}=n,o=s.replaceAll("\\.","."),a=wut({timeUnit:r,field:o}),u=$z(o);e.push({type:"formula",expr:a,as:u}),e.push(...Iz([o,u],i,r))}}return e}}const S$="offsetted_rect_start",E$="offsetted_rect_end";function wut({timeUnit:t,field:e,reverse:n}){const{unit:i,utc:r}=t,s=Jot(i),{part:o,step:a}=eat(s,t.step);return`${r?"utcOffset":"timeOffset"}('${o}', datum['${e}'], ${n?-a:a})`}function Iz([t,e],n,i){if(n!==void 0&&n!==.5){const r=`datum['${t}']`,s=`datum['${e}']`;return[{type:"formula",expr:Mz([wut({timeUnit:i,field:t,reverse:!0}),r],n+.5),as:`${t}_${S$}`},{type:"formula",expr:Mz([r,s],n+.5),as:`${t}_${E$}`}]}return[]}function Mz([t,e],n){return`${1-n} * ${t} + ${n} * ${e}`}const bv="_tuple_fields";class $Gt{constructor(...e){this.items=e,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const IGt={defined:()=>!0,parse:(t,e,n)=>{const i=e.name,r=e.project??(e.project=new $Gt),s={},o={},a=new Set,u=(p,g)=>{const m=g==="visual"?p.channel:p.field;let y=on(`${i}_${m}`);for(let b=1;a.has(y);b++)y=on(`${i}_${m}_${b}`);return a.add(y),{[g]:y}},c=e.type,l=t.config.selection[c],f=n.value!==void 0?ot(n.value):null;let{fields:d,encodings:h}=ut(n.select)?n.select:{};if(!d&&!h&&f){for(const p of f)if(ut(p))for(const g of Y(p))jUt(g)?(h||(h=[])).push(g):c==="interval"?(K(xjt),h=l.encodings):(d??(d=[])).push(g)}!d&&!h&&(h=l.encodings,"fields"in l&&(d=l.fields));for(const p of h??[]){const g=t.fieldDef(p);if(g){let m=g.field;if(g.aggregate){K(pjt(p,g.aggregate));continue}else if(!m){K(QP(p));continue}if(g.timeUnit&&!Oh(g.timeUnit)){m=t.vgField(p);const y={timeUnit:g.timeUnit,as:m,field:g.field};o[le(y)]=y}if(!s[m]){const y=c==="interval"&&Fc(p)&&ds(t.getScaleComponent(p).get("type"))?"R":g.bin?"R-RE":"E",b={field:m,channel:p,type:y,index:r.items.length};b.signals={...u(b,"data"),...u(b,"visual")},r.items.push(s[m]=b),r.hasField[m]=s[m],r.hasSelectionId=r.hasSelectionId||m===Do,_ot(p)?(b.geoChannel=p,b.channel=wot(p),r.hasChannel[b.channel]=s[m]):r.hasChannel[p]=s[m]}}else K(QP(p))}for(const p of d??[]){if(r.hasField[p])continue;const g={type:"E",field:p,index:r.items.length};g.signals={...u(g,"data")},r.items.push(g),r.hasField[p]=g,r.hasSelectionId=r.hasSelectionId||p===Do}f&&(e.init=f.map(p=>r.items.map(g=>ut(p)?p[g.geoChannel||g.channel]!==void 0?p[g.geoChannel||g.channel]:p[g.field]:p))),Le(o)||(r.timeUnit=new Ma(null,o))},signals:(t,e,n)=>{const i=e.name+bv;return n.filter(s=>s.name===i).length>0||e.project.hasSelectionId?n:n.concat({name:i,value:e.project.items.map(but)})}},ec={defined:t=>t.type==="interval"&&t.resolve==="global"&&t.bind&&t.bind==="scales",parse:(t,e)=>{const n=e.scales=[];for(const i of e.project.items){const r=i.channel;if(!Fc(r))continue;const s=t.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!ds(o)){K(yjt);continue}s.set("selectionExtent",{param:e.name,field:i.field},!0),n.push(i)}},topLevelSignals:(t,e,n)=>{const i=e.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!t.parent||Tz(t)||i.length===0)return n;const r=n.filter(o=>o.name===e.name)[0];let s=r.update;if(s.indexOf(Rut)>=0)r.update=`{${i.map(o=>`${Q(Hs(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${Q(Hs(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(t,e,n)=>{if(t.parent&&!Tz(t))for(const i of e.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function gk(t,e){return`domain(${Q(t.scaleName(e))})`}function Tz(t){return t.parent&&n0(t.parent)&&!t.parent.parent}const pg="_brush",_ut="_scale_trigger",C0="geo_interval_init_tick",xut="_init",MGt="_center",TGt={defined:t=>t.type==="interval",parse:(t,e,n)=>{var i;if(t.hasProjection){const r={...ut(n.select)?n.select:{}};r.fields=[Do],r.encodings||(r.encodings=n.value?Y(n.value):[Vo,qo]),n.select={type:"interval",...r}}if(e.translate&&!ec.defined(e)){const r=`!event.item || event.item.mark.name !== ${Q(e.name+pg)}`;for(const s of e.events){if(!s.between){K(`${s} is not an ordered event stream for interval selections.`);continue}const o=ot((i=s.between[0]).filter??(i.filter=[]));o.indexOf(r)<0&&o.push(r)}}},signals:(t,e,n)=>{const i=e.name,r=i+nf,s=mi(e.project.hasChannel).filter(a=>a.channel===an||a.channel===ai),o=e.init?e.init[0]:null;if(n.push(...s.reduce((a,u)=>a.concat(FGt(t,e,u,o&&o[u.index])),[])),t.hasProjection){const a=Q(t.projectionName()),u=t.projectionName()+MGt,{x:c,y:l}=e.project.hasChannel,f=c&&c.signals.visual,d=l&&l.signals.visual,h=c?o&&o[c.index]:`${u}[0]`,p=l?o&&o[l.index]:`${u}[1]`,g=_=>t.getSizeSignalRef(_).signal,m=`[[${f?f+"[0]":"0"}, ${d?d+"[0]":"0"}],[${f?f+"[1]":g("width")}, ${d?d+"[1]":g("height")}]]`;o&&(n.unshift({name:i+xut,init:`[scale(${a}, [${c?h[0]:h}, ${l?p[0]:p}]), scale(${a}, [${c?h[1]:h}, ${l?p[1]:p}])]`}),(!c||!l)&&(n.find(S=>S.name===u)||n.unshift({name:u,update:`invert(${a}, [${g("width")}/2, ${g("height")}/2])`})));const y=`intersect(${m}, {markname: ${Q(t.getName("marks"))}}, unit.mark)`,b=`{unit: ${Rd(t)}}`,v=`vlSelectionTuples(${y}, ${b})`,w=s.map(_=>_.signals.visual);return n.concat({name:r,on:[{events:[...w.length?[{signal:w.join(" || ")}]:[],...o?[{signal:C0}]:[]],update:v}]})}else{if(!ec.defined(e)){const c=i+_ut,l=s.map(f=>{const d=f.channel,{data:h,visual:p}=f.signals,g=Q(t.scaleName(d)),m=t.getScaleComponent(d).get("type"),y=ds(m)?"+":"";return`(!isArray(${h}) || (${y}invert(${g}, ${p})[0] === ${y}${h}[0] && ${y}invert(${g}, ${p})[1] === ${y}${h}[1]))`});l.length&&n.push({name:c,value:{},on:[{events:s.map(f=>({scale:t.scaleName(f.channel)})),update:l.join(" && ")+` ? ${c} : {}`}]})}const a=s.map(c=>c.signals.data),u=`unit: ${Rd(t)}, fields: ${i+bv}, values`;return n.concat({name:r,...o?{init:`{${u}: ${hh(o)}}`}:{},...a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${u}: [${a}]} : null`}]}:{}})}},topLevelSignals:(t,e,n)=>(wn(t)&&t.hasProjection&&e.init&&(n.filter(r=>r.name===C0).length||n.unshift({name:C0,value:null,on:[{events:"timer{1}",update:`${C0} === null ? {} : ${C0}`}]})),n),marks:(t,e,n)=>{const i=e.name,{x:r,y:s}=e.project.hasChannel,o=r==null?void 0:r.signals.visual,a=s==null?void 0:s.signals.visual,u=`data(${Q(e.name+ph)})`;if(ec.defined(e)||!r&&!s)return n;const c={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(e.resolve==="global")for(const g of Y(c))c[g]=[{test:`${u}.length && ${u}[0].unit === ${Rd(t)}`,...c[g]},{value:0}];const{fill:l,fillOpacity:f,cursor:d,...h}=e.mark,p=Y(h).reduce((g,m)=>(g[m]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(y=>y).join(" && "),value:h[m]},{value:null}],g),{});return[{name:`${i+pg}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:l},fillOpacity:{value:f}},update:c}},...n,{name:i+pg,type:"rect",clip:!0,encode:{enter:{...d?{cursor:{value:d}}:{},fill:{value:"transparent"}},update:{...c,...p}}}]}};function FGt(t,e,n,i){const r=!t.hasProjection,s=n.channel,o=n.signals.visual,a=Q(r?t.scaleName(s):t.projectionName()),u=d=>`scale(${a}, ${d})`,c=t.getSizeSignalRef(s===an?"width":"height").signal,l=`${s}(unit)`,f=e.events.reduce((d,h)=>[...d,{events:h.between[0],update:`[${l}, ${l}]`},{events:h,update:`[${o}[0], clamp(${l}, 0, ${c})]`}],[]);if(r){const d=n.signals.data,h=ec.defined(e),p=t.getScaleComponent(s),g=p?p.get("type"):void 0,m=i?{init:hh(i,!0,u)}:{value:[]};return f.push({events:{signal:e.name+_ut},update:ds(g)?`[${u(`${d}[0]`)}, ${u(`${d}[1]`)}]`:"[0, 0]"}),h?[{name:d,on:[]}]:[{name:o,...m,on:f},{name:d,...i?{init:hh(i)}:{},on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${a}, ${o})`}]}]}else{const d=s===an?0:1,h=e.name+xut,p=i?{init:`[${h}[0][${d}], ${h}[1][${d}]]`}:{value:[]};return[{name:o,...p,on:f}]}}const kGt={defined:t=>t.type==="point",signals:(t,e,n)=>{const i=e.name,r=i+bv,s=e.project,o="(item().isVoronoi ? datum.datum : datum)",a=mi(t.component.selection??{}).reduce((f,d)=>d.type==="interval"?f.concat(d.name+pg):f,[]).map(f=>`indexof(item().mark.name, '${f}') < 0`).join(" && "),u=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${a?` && ${a}`:""}`;let c=`unit: ${Rd(t)}, `;if(e.project.hasSelectionId)c+=`${Do}: ${o}[${Q(Do)}]`;else{const f=s.items.map(d=>{const h=t.fieldDef(d.channel);return h!=null&&h.bin?`[${o}[${Q(t.vgField(d.channel,{}))}], ${o}[${Q(t.vgField(d.channel,{binSuffix:"end"}))}]]`:`${o}[${Q(d.field)}]`}).join(", ");c+=`fields: ${r}, values: [${f}]`}const l=e.events;return n.concat([{name:i+nf,on:l?[{events:l,update:`${u} ? {${c}} : null`,force:!0}]:[]}])}};function Qm(t,e,n,i){const r=p$(e)&&e.condition,s=i(e);if(r){const a=ot(r).map(u=>{const c=i(u);if(_Vt(u)){const{param:l,empty:f}=u;return{test:zut(t,{param:l,empty:f}),...c}}else return{test:NS(t,u.test),...c}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function e4(t,e="text"){const n=t.encoding[e];return Qm(t,n,e,i=>A$(i,t.config))}function A$(t,e,n="datum"){if(t){if(ko(t))return Je(t.value);if(Xt(t)){const{format:i,formatType:r}=IS(t);return N8({fieldOrDatumDef:t,format:i,formatType:r,expr:n,config:e})}}}function Sut(t,e={}){const{encoding:n,markDef:i,config:r,stack:s}=t,o=n.tooltip;if(W(o))return{tooltip:Fz({tooltip:o},s,r,e)};{const a=e.reactiveGeom?"datum.datum":"datum";return Qm(t,o,"tooltip",u=>{const c=A$(u,r,a);if(c)return c;if(u===null)return;let l=ke("tooltip",i,r);if(l===!0&&(l={content:"encoding"}),at(l))return{value:l};if(ut(l))return gt(l)?l:l.content==="encoding"?Fz(n,s,r,e):{signal:a}})}}function Eut(t,e,n,{reactiveGeom:i}={}){const r={...n,...n.tooltipFormat},s={},o=i?"datum.datum":"datum",a=[];function u(l,f){const d=Dh(f),h=cr(l)?l:{...l,type:t[d].type},p=h.title||B8(h,r),g=ot(p).join(", ").replaceAll(/"/g,'\\"');let m;if(Fn(f)){const y=f==="x"?"x2":"y2",b=Wa(t[y]);if(ui(h.bin)&&b){const v=tt(h,{expr:o}),w=tt(b,{expr:o}),{format:_,formatType:S}=IS(h);m=hv(v,w,_,S,r),s[y]=!0}}if((Fn(f)||f===Qs||f===jo)&&e&&e.fieldChannel===f&&e.offset==="normalize"){const{format:y,formatType:b}=IS(h);m=N8({fieldOrDatumDef:h,format:y,formatType:b,expr:o,config:r,normalizeStack:!0}).signal}m??(m=A$(h,r,o).signal),a.push({channel:f,key:g,value:m})}U8(t,(l,f)=>{X(l)?u(l,f):g$(l)&&u(l.condition,f)});const c={};for(const{channel:l,key:f,value:d}of a)!s[l]&&!c[f]&&(c[f]=d);return c}function Fz(t,e,n,{reactiveGeom:i}={}){const r=Eut(t,e,n,{reactiveGeom:i}),s=Jl(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function DGt(t){const{markDef:e,config:n}=t,i=ke("aria",e,n);return i===!1?{}:{...i?{aria:i}:{},...CGt(t),...NGt(t)}}function CGt(t){const{mark:e,markDef:n,config:i}=t;if(i.aria===!1)return{};const r=ke("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:e in ljt?{}:{ariaRoleDescription:{value:e}}}function NGt(t){const{encoding:e,markDef:n,config:i,stack:r}=t,s=e.description;if(s)return Qm(t,s,"description",u=>A$(u,t.config));const o=ke("description",n,i);if(o!=null)return{description:Je(o)};if(i.aria===!1)return{};const a=Eut(e,r,i);if(!Le(a))return{description:{signal:Jl(a).map(([u,c],l)=>`"${l>0?"; ":""}${u}: " + (${c})`).join(" + ")}}}function Qn(t,e,n={}){const{markDef:i,encoding:r,config:s}=e,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u??(u=ke(t,i,s,{vgChannel:o,ignoreVgConfig:!0})),u!==void 0&&(a=Je(u)));const c=r[t];return Qm(e,c,o??t,l=>C8({channel:t,channelDef:l,markDef:i,config:s,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:a}))}function Aut(t,e={filled:void 0}){const{markDef:n,encoding:i,config:r}=t,{type:s}=n,o=e.filled??ke("filled",n,r),a=fe(["bar","point","circle","square","geoshape"],s)?"transparent":void 0,u=ke(o===!0?"color":void 0,n,r,{vgChannel:"fill"})??r.mark[o===!0&&"color"]??a,c=ke(o===!1?"color":void 0,n,r,{vgChannel:"stroke"})??r.mark[o===!1&&"color"],l=o?"fill":"stroke",f={...u?{fill:Je(u)}:{},...c?{stroke:Je(c)}:{}};return n.color&&(o?n.fill:n.stroke)&&K(jot("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...Qn("color",t,{vgChannel:l,defaultValue:o?u:c}),...Qn("fill",t,{defaultValue:i.fill?u:void 0}),...Qn("stroke",t,{defaultValue:i.stroke?c:void 0})}}function OGt(t){const{encoding:e,mark:n}=t,i=e.order;return!Af(n)&&ko(i)?Qm(t,i,"zindex",r=>Je(r.value)):{}}function cm({channel:t,markDef:e,encoding:n={},model:i,bandPosition:r}){const s=`${t}Offset`,o=e[s],a=n[s];if((s==="xOffset"||s==="yOffset")&&a)return{offsetType:"encoding",offset:C8({channel:s,channelDef:a,markDef:e,config:i==null?void 0:i.config,scaleName:i.scaleName(s),scale:i.getScaleComponent(s),stack:null,defaultRef:Je(o),bandPosition:r})};const u=e[s];return u?{offsetType:"visual",offset:u}:{}}function Fi(t,e,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=e,u=r[t],c=r[ou(t)],l=e.scaleName(t),f=e.getScaleComponent(t),{offset:d,offsetType:h}=cm({channel:t,markDef:s,encoding:r,model:e,bandPosition:.5}),p=n4({model:e,defaultPos:n,channel:t,scaleName:l,scale:f}),g=!u&&Fn(t)&&(r.latitude||r.longitude)?{field:e.getName(t)}:RGt({channel:t,channelDef:u,channel2Def:c,markDef:s,config:o,scaleName:l,scale:f,stack:a,offset:d,defaultRef:p,bandPosition:h==="encoding"?0:void 0});return g?{[i||t]:g}:void 0}function RGt(t){const{channel:e,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=t;if(Xt(n)&&r&&e===r.fieldChannel){if(X(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(e==="radius"||e==="theta")&&(a=.5),a!==void 0)return ES({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Nd(n,i,{suffix:"end"},{offset:s})}return k8(t)}function n4({model:t,defaultPos:e,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=t;return()=>{const a=Dh(n),u=Ql(n),c=ke(n,s,o,{vgChannel:u});if(c!==void 0)return Wy(n,c);switch(e){case"zeroOrMin":case"zeroOrMax":if(i){const l=r.get("type");if(!fe([Tr.LOG,Tr.TIME,Tr.UTC],l)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(e==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${t.width.signal},${t.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...t[jr(n)],mult:.5}}}}const LGt={left:"x",center:"xc",right:"x2"},BGt={top:"y",middle:"yc",bottom:"y2"};function $ut(t,e,n,i="middle"){if(t==="radius"||t==="theta")return Ql(t);const r=t==="x"?"align":"baseline",s=ke(r,e,n);let o;return gt(s)?(K(Ujt(r)),o=void 0):o=s,t==="x"?LGt[o||(i==="top"?"left":"center")]:BGt[o||i]}function DS(t,e,{defaultPos:n,defaultPos2:i,range:r}){return r?Iut(t,e,{defaultPos:n,defaultPos2:i}):Fi(t,e,{defaultPos:n})}function Iut(t,e,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=e,o=ou(t),a=jr(t),u=PGt(e,i,o),c=u[a]?$ut(t,r,s):Ql(t);return{...Fi(t,e,{defaultPos:n,vgChannel:c}),...u}}function PGt(t,e,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=t,u=Dh(n),c=jr(n),l=Ql(n),f=i[u],d=t.scaleName(u),h=t.getScaleComponent(u),{offset:p}=n in i||n in s?cm({channel:n,markDef:s,encoding:i,model:t}):cm({channel:u,markDef:s,encoding:i,model:t});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=jr(n),y=t.markDef[m];return y!=null?{[m]:{value:y}}:{[l]:{field:t.getName(n)}}}const g=zGt({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[l]:g}:ww(n,s)||ww(n,{[n]:_S(n,s,a.style),[c]:_S(c,s,a.style)})||ww(n,a[r])||ww(n,a.mark)||{[l]:n4({model:t,defaultPos:e,channel:n,scaleName:d,scale:h})()}}function zGt({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:c}){return Xt(e)&&a&&t.charAt(0)===a.fieldChannel.charAt(0)?Nd(e,s,{suffix:"start"},{offset:u}):k8({channel:t,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:u,defaultRef:c})}function ww(t,e){const n=jr(t),i=Ql(t);if(e[i]!==void 0)return{[i]:Wy(t,e[i])};if(e[t]!==void 0)return{[i]:Wy(t,e[t])};if(e[n]){const r=e[n];if(fh(r))K(Ojt(n));else return{[n]:Wy(t,r)}}}function ef(t,e){const{config:n,encoding:i,markDef:r}=t,s=r.type,o=ou(e),a=jr(e),u=i[e],c=i[o],l=t.getScaleComponent(e),f=l?l.get("type"):void 0,d=r.orient,h=i[a]??i.size??ke("size",r,n,{vgChannel:a}),p=Aot(e),g=s==="bar"&&(e==="x"?d==="vertical":d==="horizontal");return X(u)&&(Xe(u.bin)||ui(u.bin)||u.timeUnit&&!c)&&!(h&&!fh(h))&&!i[p]&&!si(f)?qGt({fieldDef:u,fieldDef2:c,channel:e,model:t}):(Xt(u)&&si(f)||g)&&!c?jGt(u,e,t):Iut(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function UGt(t,e,n,i,r,s,o){if(fh(r))if(n){const u=n.get("type");if(u==="band"){let c=`bandwidth('${e}')`;r.band!==1&&(c=`${r.band} * ${c}`);const l=dc("minBandSize",{type:o},i);return{signal:l?`max(${mo(l)}, ${c})`:c}}else r.band!==1&&(K(Wjt(u)),r=void 0)}else return{mult:r.band,field:{group:t}};else{if(gt(r))return r;if(r)return{value:r}}if(n){const u=n.get("range");if(Ef(u)&&be(u.step))return{value:u.step-2}}if(!s){const{bandPaddingInner:u,barBandPaddingInner:c,rectBandPaddingInner:l}=i.scale,f=Tn(u,o==="bar"?c:l);if(gt(f))return{signal:`(1 - (${f.signal})) * ${t}`};if(be(f))return{signal:`${1-f} * ${t}`}}return{value:FS(i.view,t)-2}}function jGt(t,e,n){var A,$;const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,u=n.scaleName(e),c=n.getScaleComponent(e),l=jr(e),f=ou(e),d=Aot(e),h=n.scaleName(d),p=n.getScaleComponent(u8(e)),g=a==="horizontal"&&e==="y"||a==="vertical"&&e==="x";let m;(r.size||i.size)&&(g?m=Qn("size",n,{vgChannel:l,defaultRef:Je(i.size)}):K(Xjt(i.type)));const y=!!m,b=Sat({channel:e,fieldDef:t,markDef:i,config:s,scaleType:(A=c||p)==null?void 0:A.get("type"),useVlSizeChannel:g});m=m||{[l]:UGt(l,h||u,p||c,s,b,!!t,i.type)};const v=(($=c||p)==null?void 0:$.get("type"))==="band"&&fh(b)&&!y?"top":"middle",w=$ut(e,i,s,v),_=w==="xc"||w==="yc",{offset:S,offsetType:x}=cm({channel:e,markDef:i,encoding:r,model:n,bandPosition:_?.5:0}),E=k8({channel:e,channelDef:t,markDef:i,config:s,scaleName:u,scale:c,stack:o,offset:S,defaultRef:n4({model:n,defaultPos:"mid",channel:e,scaleName:u,scale:c}),bandPosition:_?x==="encoding"?0:.5:gt(b)?{signal:`(1-${b})/2`}:fh(b)?(1-b.band)/2:0});if(l)return{[w]:E,...m};{const I=Ql(f),k=m[l],T=S?{...k,offset:S}:k;return{[w]:E,[I]:W(E)?[E[0],{...E[1],offset:T}]:{...E,offset:T}}}}function kz(t,e,n,i,r,s,o){if(vot(t))return 0;const a=t==="x"||t==="y2",u=a?-e/2:e/2;if(gt(n)||gt(r)||gt(i)||s){const c=mo(n),l=mo(r),f=mo(i),d=mo(s),p=s?`(${o} < ${d} ? ${a?"":"-"}0.5 * (${d} - (${o})) : ${u})`:u,g=f?`${f} + `:"",m=c?`(${c} ? -1 : 1) * `:"",y=l?`(${l} + ${p})`:p;return{signal:g+m+y}}else return r=r||0,i+(n?-r-u:+r+u)}function qGt({fieldDef:t,fieldDef2:e,channel:n,model:i}){var $;const{config:r,markDef:s,encoding:o}=i,a=i.getScaleComponent(n),u=i.scaleName(n),c=a?a.get("type"):void 0,l=a.get("reverse"),f=Sat({channel:n,fieldDef:t,markDef:s,config:r,scaleType:c}),d=($=i.component.axes[n])==null?void 0:$[0],h=(d==null?void 0:d.get("translate"))??.5,p=Fn(n)?ke("binSpacing",s,r)??0:0,g=ou(n),m=Ql(n),y=Ql(g),b=dc("minBandSize",s,r),{offset:v}=cm({channel:n,markDef:s,encoding:o,model:i,bandPosition:0}),{offset:w}=cm({channel:g,markDef:s,encoding:o,model:i,bandPosition:0}),_=mVt({fieldDef:t,scaleName:u}),S=kz(n,p,l,h,v,b,_),x=kz(g,p,l,h,w??v,b,_),E=gt(f)?{signal:`(1-${f.signal})/2`}:fh(f)?(1-f.band)/2:.5,A=Zl({fieldDef:t,fieldDef2:e,markDef:s,config:r});if(Xe(t.bin)||t.timeUnit){const I=t.timeUnit&&A!==.5;return{[y]:Dz({fieldDef:t,scaleName:u,bandPosition:E,offset:x,useRectOffsetField:I}),[m]:Dz({fieldDef:t,scaleName:u,bandPosition:gt(E)?{signal:`1-${E.signal}`}:1-E,offset:S,useRectOffsetField:I})}}else if(ui(t.bin)){const I=Nd(t,u,{},{offset:x});if(X(e))return{[y]:I,[m]:Nd(e,u,{},{offset:S})};if(Ch(t.bin)&&t.bin.step)return{[y]:I,[m]:{signal:`scale("${u}", ${tt(t,{expr:"datum"})} + ${t.bin.step})`,offset:S}}}K(Wot(g))}function Dz({fieldDef:t,scaleName:e,bandPosition:n,offset:i,useRectOffsetField:r}){return ES({scaleName:e,fieldOrDatumDef:t,bandPosition:n,offset:i,...r?{startSuffix:S$,endSuffix:E$}:{}})}const VGt=new Set(["aria","width","height"]);function Zs(t,e){const{fill:n=void 0,stroke:i=void 0}=e.color==="include"?Aut(t):{};return{...WGt(t.markDef,e),...Cz(t,"fill",n),...Cz(t,"stroke",i),...Qn("opacity",t),...Qn("fillOpacity",t),...Qn("strokeOpacity",t),...Qn("strokeWidth",t),...Qn("strokeDash",t),...OGt(t),...Sut(t),...e4(t,"href"),...DGt(t)}}function Cz(t,e,n){const{config:i,mark:r,markDef:s}=t;if(ke("invalid",s,i)==="hide"&&n&&!Af(r)){const a=GGt(t,{invalid:!0,channels:r$});if(a)return{[e]:[{test:a,value:null},...ot(n)]}}return n?{[e]:n}:{}}function WGt(t,e){return cjt.reduce((n,i)=>(!VGt.has(i)&&t[i]!==void 0&&e[i]!=="ignore"&&(n[i]=Je(t[i])),n),{})}function GGt(t,{invalid:e=!1,channels:n}){const i=n.reduce((s,o)=>{const a=t.getScaleComponent(o);if(a){const u=a.get("type"),c=t.vgField(o,{expr:"datum"});c&&ds(u)&&(s[c]=!0)}return s},{}),r=Y(i);if(r.length>0){const s=e?"||":"&&";return r.map(o=>D8(o,e)).join(` ${s} `)}}function i4(t){const{config:e,markDef:n}=t;if(ke("invalid",n,e)){const r=YGt(t,{channels:au});if(r)return{defined:{signal:r}}}return{}}function YGt(t,{invalid:e=!1,channels:n}){const i=n.reduce((s,o)=>{var u;const a=t.getScaleComponent(o);if(a){const c=a.get("type"),l=t.vgField(o,{expr:"datum",binSuffix:(u=t.stack)!=null&&u.impute?"mid":void 0});l&&ds(c)&&(s[l]=!0)}return s},{}),r=Y(i);if(r.length>0){const s=e?"||":"&&";return r.map(o=>D8(o,e)).join(` ${s} `)}}function Nz(t,e){if(e!==void 0)return{[t]:Je(e)}}const W3="voronoi",Mut={defined:t=>t.type==="point"&&t.nearest,parse:(t,e)=>{if(e.events)for(const n of e.events)n.markname=t.getName(W3)},marks:(t,e,n)=>{const{x:i,y:r}=e.project.hasChannel,s=t.mark;if(Af(s))return K(gjt(s)),n;const o={name:t.getName(W3),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...Sut(t,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((c,l)=>{const f=c.name??"";f===t.component.mark[0].name?a=l:f.indexOf(W3)>=0&&(u=!0)}),u||n.splice(a+1,0,o),n}},Tut={defined:t=>t.type==="point"&&t.resolve==="global"&&t.bind&&t.bind!=="scales"&&!Y8(t.bind),parse:(t,e,n)=>Lut(e,n),topLevelSignals:(t,e,n)=>{const i=e.name,r=e.project,s=e.bind,o=e.init&&e.init[0],a=Mut.defined(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,c)=>{const l=on(`${i}_${u.field}`);n.filter(d=>d.name===l).length||n.unshift({name:l,...o?{init:hh(o[c])}:{value:null},on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${Q(u.field)}] : null`}]:[],bind:s[u.field]??s[u.channel]??s})}),n},signals:(t,e,n)=>{const i=e.name,r=e.project,s=n.filter(c=>c.name===i+nf)[0],o=i+bv,a=r.items.map(c=>on(`${i}_${c.field}`)),u=a.map(c=>`${c} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},CS="_toggle",Fut={defined:t=>t.type==="point"&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+CS,value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const n=e.name+nf,i=e.name+CS;return`${i} ? null : ${n}, `+(e.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Rd(t)}}, `)+`${i} ? ${n} : null`}},HGt={defined:t=>t.clear!==void 0&&t.clear!==!1,parse:(t,e)=>{e.clear&&(e.clear=at(e.clear)?yf(e.clear,"view"):e.clear)},topLevelSignals:(t,e,n)=>{if(Tut.defined(e))for(const i of e.project.items){const r=n.findIndex(s=>s.name===on(`${e.name}_${i.field}`));r!==-1&&n[r].on.push({events:e.clear,update:"null"})}return n},signals:(t,e,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:e.clear,update:s})}if(e.type==="interval")for(const r of e.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===e.name+nf);i(r,"null"),Fut.defined(e)&&(r=n.findIndex(s=>s.name===e.name+CS),i(r,"false"))}return n}},kut={defined:t=>{const e=t.resolve==="global"&&t.bind&&Y8(t.bind),n=t.project.items.length===1&&t.project.items[0].field!==Do;return e&&!n&&K(bjt),e&&n},parse:(t,e,n)=>{const i=Wt(n);if(i.select=at(i.select)?{type:i.select,toggle:e.toggle}:{...i.select,toggle:e.toggle},Lut(e,i),ut(n.select)&&(n.select.on||n.select.clear)){const o='event.item && indexof(event.item.mark.role, "legend") < 0';for(const a of e.events)a.filter=ot(a.filter??[]),a.filter.includes(o)||a.filter.push(o)}const r=U3(e.bind)?e.bind.legend:"click",s=at(r)?yf(r,"view"):ot(r);e.bind={legend:{merge:s}}},topLevelSignals:(t,e,n)=>{const i=e.name,r=U3(e.bind)&&e.bind.legend,s=o=>a=>{const u=Wt(a);return u.markname=o,u};for(const o of e.project.items){if(!o.hasLegend)continue;const a=`${on(o.field)}_legend`,u=`${i}_${a}`;if(n.filter(l=>l.name===u).length===0){const l=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift({name:u,...e.init?{}:{value:null},on:[{events:l,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]})}}return n},signals:(t,e,n)=>{const i=e.name,r=e.project,s=n.find(d=>d.name===i+nf),o=i+bv,a=r.items.filter(d=>d.hasLegend).map(d=>on(`${i}_${on(d.field)}_legend`)),c=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;e.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:c}):a.length>0&&(s.update=c,delete s.value,delete s.on);const l=n.find(d=>d.name===i+CS),f=U3(e.bind)&&e.bind.legend;return l&&(e.events?l.on.push({...l.on[0],events:f}):l.on[0].events=f),n}};function XGt(t,e,n){var r;const i=(r=t.fieldDef(e))==null?void 0:r.field;for(const s of mi(t.component.selection??{})){const o=s.project.hasField[i]??s.project.hasChannel[e];if(o&&kut.defined(s)){const a=n.get("selections")??[];a.push(s.name),n.set("selections",a,!1),o.hasLegend=!0}}}const Dut="_translate_anchor",Cut="_translate_delta",KGt={defined:t=>t.type==="interval"&&t.translate,signals:(t,e,n)=>{const i=e.name,r=ec.defined(e),s=i+Dut,{x:o,y:a}=e.project.hasChannel;let u=yf(e.translate,"scope");return r||(u=u.map(c=>(c.between[0].markname=i+pg,c))),n.push({name:s,value:{},on:[{events:u.map(c=>c.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?gk(t,an):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?gk(t,ai):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+Cut,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&Oz(t,e,o,"width",n),a!==void 0&&Oz(t,e,a,"height",n),n}};function Oz(t,e,n,i,r){const s=e.name,o=s+Dut,a=s+Cut,u=n.channel,c=ec.defined(e),l=r.filter(_=>_.name===n.signals[c?"data":"visual"])[0],f=t.getSizeSignalRef(i).signal,d=t.getScaleComponent(u),h=d&&d.get("type"),p=d&&d.get("reverse"),g=c?u===an?p?"":"-":p?"-":"":"",m=`${o}.extent_${u}`,y=`${g}${a}.${u} / ${c?`${f}`:`span(${m})`}`,b=!c||!d?"panLinear":h==="log"?"panLog":h==="symlog"?"panSymlog":h==="pow"?"panPow":"panLinear",v=c?h==="pow"?`, ${d.get("exponent")??1}`:h==="symlog"?`, ${d.get("constant")??1}`:"":"",w=`${b}(${m}, ${y}${v})`;l.on.push({events:{signal:a},update:c?w:`clampRange(${w}, 0, ${f})`})}const Nut="_zoom_anchor",Out="_zoom_delta",JGt={defined:t=>t.type==="interval"&&t.zoom,signals:(t,e,n)=>{const i=e.name,r=ec.defined(e),s=i+Out,{x:o,y:a}=e.project.hasChannel,u=Q(t.scaleName(an)),c=Q(t.scaleName(ai));let l=yf(e.zoom,"scope");return r||(l=l.map(f=>(f.markname=i+pg,f))),n.push({name:i+Nut,on:[{events:l,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",c?`y: invert(${c}, y(unit))`:""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:l,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&Rz(t,e,o,"width",n),a!==void 0&&Rz(t,e,a,"height",n),n}};function Rz(t,e,n,i,r){const s=e.name,o=n.channel,a=ec.defined(e),u=r.filter(b=>b.name===n.signals[a?"data":"visual"])[0],c=t.getSizeSignalRef(i).signal,l=t.getScaleComponent(o),f=l&&l.get("type"),d=a?gk(t,o):u.name,h=s+Out,p=`${s}${Nut}.${o}`,g=!a||!l?"zoomLinear":f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear",m=a?f==="pow"?`, ${l.get("exponent")??1}`:f==="symlog"?`, ${l.get("constant")??1}`:"":"",y=`${g}(${d}, ${p}, ${h}${m})`;u.on.push({events:{signal:h},update:a?y:`clampRange(${y}, 0, ${c})`})}const ph="_store",nf="_tuple",QGt="_modify",Rut="vlSelectionResolve",$$=[kGt,TGt,IGt,Fut,Tut,ec,kut,HGt,KGt,JGt,Mut];function ZGt(t){let e=t.parent;for(;e&&!So(e);)e=e.parent;return e}function Rd(t,{escape:e}={escape:!0}){let n=e?Q(t.name):t.name;const i=ZGt(t);if(i){const{facet:r}=i;for(const s of ks)r[s]&&(n+=` + '__facet_${s}_' + (facet[${Q(i.vgField(s))}])`)}return n}function r4(t){return mi(t.component.selection??{}).reduce((e,n)=>e||n.project.hasSelectionId,!1)}function Lut(t,e){(at(e.select)||!e.select.on)&&delete t.events,(at(e.select)||!e.select.clear)&&delete t.clear,(at(e.select)||!e.select.toggle)&&delete t.toggle}function mk(t){const e=[];return t.type==="Identifier"?[t.name]:t.type==="Literal"?[t.value]:(t.type==="MemberExpression"&&(e.push(...mk(t.object)),e.push(...mk(t.property))),e)}function But(t){return t.object.type==="MemberExpression"?But(t.object):t.object.name==="datum"}function Put(t){const e=SR(t),n=new Set;return e.visit(i=>{i.type==="MemberExpression"&&But(i)&&n.add(mk(i).slice(1).join("."))}),n}class Zm extends Oe{clone(){return new Zm(null,this.model,Wt(this.filter))}constructor(e,n,i){super(e),this.model=n,this.filter=i,this.expr=NS(this.model,this.filter,this),this._dependentFields=Put(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function tYt(t,e){const n={},i=t.config.selection;if(!e||!e.length)return n;for(const r of e){const s=on(r.name),o=r.select,a=at(o)?o:o.type,u=ut(o)?Wt(o):{type:a},c=i[a];for(const d in c)d==="fields"||d==="encodings"||(d==="mark"&&(u[d]={...c[d],...u[d]}),(u[d]===void 0||u[d]===!0)&&(u[d]=Wt(c[d]??u[d])));const l=n[s]={...u,name:s,type:a,init:r.value,bind:r.bind,events:at(u.on)?yf(u.on,"scope"):ot(Wt(u.on))},f=Wt(r);for(const d of $$)d.defined(l)&&d.parse&&d.parse(t,l,f)}return n}function zut(t,e,n,i="datum"){const r=at(e)?e:e.param,s=on(r),o=Q(s+ph);let a;try{a=t.getSelectionComponent(s,r)}catch{return`!!${s}`}if(a.project.timeUnit){const d=n??t.component.data.raw,h=a.project.timeUnit.clone();d.parent?h.insertAsParentOf(d):d.parent=h}const u=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",c=a.resolve==="global"?")":`, ${Q(a.resolve)})`,l=`${u}${o}, ${i}${c}`,f=`length(data(${o}))`;return e.empty===!1?`${f} && ${l}`:`!${f} || ${l}`}function Uut(t,e,n){const i=on(e),r=n.encoding;let s=n.field,o;try{o=t.getSelectionComponent(i,e)}catch{return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&K(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Q(s)}.`);else if(r&&!s){const a=o.project.items.filter(u=>u.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,K((a.length?"Multiple ":"No ")+`matching ${Q(r)} encoding found for selection ${Q(n.param)}. Using "field": ${Q(s)}.`)):s=a[0].field}return`${o.name}[${Q(Hs(s))}]`}function eYt(t,e){for(const[n,i]of Jl(t.component.selection??{})){const r=t.getName(`lookup_${n}`);t.component.data.outputNodes[r]=i.materialized=new nr(new Zm(e,t,{param:n}),r,Ye.Lookup,t.component.data.outputNodeRefCounts)}}function NS(t,e,n){return Vy(e,i=>at(i)?i:Dqt(i)?zut(t,i,n):iat(i))}function nYt(t,e){if(t)return W(t)&&!Jc(t)?t.map(n=>B8(n,e)).join(", "):t}function G3(t,e,n,i){var r,s;t.encode??(t.encode={}),(r=t.encode)[e]??(r[e]={}),(s=t.encode[e]).update??(s.update={}),t.encode[e].update[n]=i}function xy(t,e,n,i={header:!1}){var f,d;const{disable:r,orient:s,scale:o,labelExpr:a,title:u,zindex:c,...l}=t.combine();if(!r){for(const h in l){const p=OVt[h],g=l[h];if(p&&p!==e&&p!=="both")delete l[h];else if(yv(g)){const{condition:m,...y}=g,b=ot(m),v=lz[h];if(v){const{vgProp:w,part:_}=v,S=[...b.map(x=>{const{test:E,...A}=x;return{test:NS(null,E),...A}}),y];G3(l,_,w,S),delete l[h]}else if(v===null){const w={signal:b.map(_=>{const{test:S,...x}=_;return`${NS(null,S)} ? ${HP(x)} : `}).join("")+HP(y)};l[h]=w}}else if(gt(g)){const m=lz[h];if(m){const{vgProp:y,part:b}=m;G3(l,b,y,g),delete l[h]}}fe(["labelAlign","labelBaseline"],h)&&l[h]===null&&delete l[h]}if(e==="grid"){if(!l.grid)return;if(l.encode){const{grid:h}=l.encode;l.encode={...h?{grid:h}:{}},Le(l.encode)&&delete l.encode}return{scale:o,orient:s,...l,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Tn(c,0)}}else{if(!i.header&&t.mainExtracted)return;if(a!==void 0){let p=a;(d=(f=l.encode)==null?void 0:f.labels)!=null&&d.update&&gt(l.encode.labels.update.text)&&(p=ah(a,"datum.label",l.encode.labels.update.text.signal)),G3(l,"labels","text",{signal:p})}if(l.labelAlign===null&&delete l.labelAlign,l.encode){for(const p of Cat)t.hasAxisPart(p)||delete l.encode[p];Le(l.encode)&&delete l.encode}const h=nYt(u,n);return{scale:o,orient:s,grid:!1,...h?{title:h}:{},...l,...n.aria===!1?{aria:!1}:{},zindex:Tn(c,0)}}}}function jut(t){const{axes:e}=t.component,n=[];for(const i of au)if(e[i]){for(const r of e[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=t.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function iYt(t,e){const{x:n=[],y:i=[]}=t;return[...n.map(r=>xy(r,"grid",e)),...i.map(r=>xy(r,"grid",e)),...n.map(r=>xy(r,"main",e)),...i.map(r=>xy(r,"main",e))].filter(r=>r)}function Lz(t,e,n,i){return Object.assign.apply(null,[{},...t.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=e[n==="x"?"axisBottom":"axisLeft"]||{},a=e[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...Y(o),...Y(a)]),c={};for(const l of u.values())c[l]={signal:`${i.signal} === "${s}" ? ${mo(o[l])} : ${mo(a[l])}`};return c}return e[r]})])}function rYt(t,e,n,i){const r=e==="band"?["axisDiscrete","axisBand"]:e==="point"?["axisDiscrete","axisPoint"]:aat(e)?["axisQuantitative"]:e==="time"||e==="utc"?["axisTemporal"]:[],s=t==="x"?"axisX":"axisY",o=gt(n)?"axisOrient":`axis${av(n)}`,a=[...r,...r.map(c=>s+c.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:Lz(a,i,t,n),vgAxisConfig:Lz(u,i,t,n),axisConfigStyle:sYt([...u,...a],i)}}function sYt(t,e){var i;const n=[{}];for(const r of t){let s=(i=e[r])==null?void 0:i.style;if(s){s=ot(s);for(const o of s)n.push(e.style[o])}}return Object.assign.apply(null,n)}function yk(t,e,n,i={}){var s;const r=Oot(t,n,e);if(r!==void 0)return{configFrom:"style",configValue:r};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((s=i[o])==null?void 0:s[t])!==void 0)return{configFrom:o,configValue:i[o][t]};return{}}const Bz={scale:({model:t,channel:e})=>t.scaleName(e),format:({format:t})=>t,formatType:({formatType:t})=>t,grid:({fieldOrDatumDef:t,axis:e,scaleType:n})=>e.grid??oYt(n,t),gridScale:({model:t,channel:e})=>aYt(t,e),labelAlign:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelAlign||Vut(e,n,i),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelBaseline||qut(e,n,i),labelFlush:({axis:t,fieldOrDatumDef:e,channel:n})=>t.labelFlush??cYt(e.type,n),labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:n})=>t.labelOverlap??lYt(e.type,n,X(e)&&!!e.timeUnit,X(e)?e.sort:void 0),orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:n,fieldOrDatumDef:i,scaleType:r})=>{const s=t==="x"?"width":t==="y"?"height":void 0,o=s?e.getSizeSignalRef(s):void 0;return n.tickCount??dYt({fieldOrDatumDef:i,scaleType:r,size:o,values:n.values})},tickMinStep:hYt,title:({axis:t,model:e,channel:n})=>{if(t.title!==void 0)return t.title;const i=Wut(e,n);if(i!==void 0)return i;const r=e.typedFieldDef(n),s=n==="x"?"x2":"y2",o=e.fieldDef(s);return Lot(r?[uz(r)]:[],X(o)?[uz(o)]:[])},values:({axis:t,fieldOrDatumDef:e})=>pYt(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:n})=>t.zindex??gYt(n,e)};function oYt(t,e){return!si(t)&&X(e)&&!Xe(e==null?void 0:e.bin)&&!ui(e==null?void 0:e.bin)}function aYt(t,e){const n=e==="x"?"y":"x";if(t.getScaleComponent(n))return t.scaleName(n)}function uYt(t,e,n,i,r){const s=e==null?void 0:e.labelAngle;if(s!==void 0)return gt(s)?s:K1(s);{const{configValue:o}=yk("labelAngle",i,e==null?void 0:e.style,r);return o!==void 0?K1(o):n===an&&fe([I8,$8],t.type)&&!(X(t)&&t.timeUnit)?270:void 0}}function bk(t){return`(((${t.signal} % 360) + 360) % 360)`}function qut(t,e,n,i){if(t!==void 0)if(n==="x"){if(gt(t)){const r=bk(t),s=gt(e)?`(${e.signal} === "top")`:e==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<t&&t<135||225<t&&t<315)return"middle";if(gt(e)){const r=t<=45||315<=t?"===":"!==";return{signal:`${e.signal} ${r} "top" ? "bottom" : "top"`}}return(t<=45||315<=t)==(e==="top")?"bottom":"top"}else{if(gt(t)){const r=bk(t),s=gt(e)?`(${e.signal} === "left")`:e==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(t<=45||315<=t||135<=t&&t<=225)return i?"middle":null;if(gt(e)){const r=45<=t&&t<=135?"===":"!==";return{signal:`${e.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=t&&t<=135)==(e==="left")?"top":"bottom"}}function Vut(t,e,n){if(t===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(gt(t)){const o=bk(t),a=gt(e)?`(${e.signal} === "${s}")`:e===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((t+r)%180===0)return i?null:"center";if(gt(e)){const o=r<t&&t<180+r?"===":"!==";return{signal:`${`${e.signal} ${o} "${s}"`} ? "left" : "right"`}}return(r<t&&t<180+r)==(e===s)?"left":"right"}function cYt(t,e){if(e==="x"&&fe(["quantitative","temporal"],t))return!0}function lYt(t,e,n,i){if(n&&!ut(i)||t!=="nominal"&&t!=="ordinal")return e==="log"||e==="symlog"?"greedy":!0}function fYt(t){return t==="x"?"bottom":"left"}function dYt({fieldOrDatumDef:t,scaleType:e,size:n,values:i}){var r;if(!i&&!si(e)&&e!=="log"){if(X(t)){if(Xe(t.bin))return{signal:`ceil(${n.signal}/10)`};if(t.timeUnit&&fe(["month","hours","day","quarter"],(r=ri(t.timeUnit))==null?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function hYt({format:t,fieldOrDatumDef:e}){if(t==="d")return 1;if(X(e)){const{timeUnit:n}=e;if(n){const i=tat(n);if(i)return{signal:i}}}}function Wut(t,e){const n=e==="x"?"x2":"y2",i=t.fieldDef(e),r=t.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;if(s&&o)return Bot(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function pYt(t,e){const n=t.values;if(W(n))return Dat(e,n);if(gt(n))return n}function gYt(t,e){return t==="rect"&&$S(e)?1:0}class lm extends Oe{clone(){return new lm(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this._dependentFields=Put(this.transform.calculate)}static parseAllForSortIndex(e,n){return n.forEachFieldDef((i,r)=>{if(Rh(i)&&xat(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,u=a.map((c,l)=>`${iat({field:s,timeUnit:o,equal:c})} ? ${l} : `).join("")+a.length;e=new lm(e,{calculate:u,as:fm(i,r,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${le(this.transform)}`}}function fm(t,e,n){return tt(t,{prefix:e,suffix:"sort_index",...n??{}})}function I$(t,e){return fe(["top","bottom"],e)?"column":fe(["left","right"],e)||t==="row"?"row":"column"}function dm(t,e,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return Tn((e||{})[t],r[t],n.header[t])}function M$(t,e,n,i){const r={};for(const s of t){const o=dm(s,e||{},n,i);o!==void 0&&(r[s]=o)}return r}const s4=["row","column"],o4=["header","footer"];function mYt(t,e){const n=t.component.layoutHeaders[e].title,i=t.config?t.config:void 0,r=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=M$(["titleAnchor","titleAngle","titleOrient"],r.header,i,e),u=I$(e,a),c=K1(o);return{name:`${e}-title`,type:"group",role:`${u}-title`,title:{text:n,...e==="row"?{orient:"left"}:{},style:"guide-title",...Yut(c,u),...Gut(u,c,s),...Hut(i,r,e,iWt,Kat)}}}function Gut(t,e,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Vut(e,t==="row"?"left":"top",t==="row"?"y":"x");return i?{align:i}:{}}function Yut(t,e){const n=qut(t,e==="row"?"left":"top",e==="row"?"y":"x",!0);return n?{baseline:n}:{}}function yYt(t,e){const n=t.component.layoutHeaders[e],i=[];for(const r of o4)if(n[r])for(const s of n[r]){const o=vYt(t,e,r,n,s);o!=null&&i.push(o)}return i}function bYt(t,e){const{sort:n}=t;return Ia(n)?{field:tt(n,{expr:"datum"}),order:n.order??"ascending"}:W(n)?{field:fm(t,e,{expr:"datum"}),order:"ascending"}:{field:tt(t,{expr:"datum"}),order:n??"ascending"}}function vk(t,e,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=M$(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t.header,n,e),c=N8({fieldOrDatumDef:t,format:i,formatType:r,expr:"parent",config:n}).signal,l=I$(e,a);return{text:{signal:u?ah(ah(u,"datum.label",c),"datum.value",tt(t,{expr:"parent"})):c},...e==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...Yut(s,l),...Gut(l,s,o),...Hut(n,t,e,rWt,Jat)}}function vYt(t,e,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=t.config?t.config:void 0;if(o&&r.labels){const{labelOrient:f}=M$(["labelOrient"],o.header,a,e);(e==="row"&&!fe(["top","bottom"],f)||e==="column"&&!fe(["left","right"],f))&&(s=vk(o,e,a))}const u=So(t)&&!pv(t.facet),c=r.axes,l=(c==null?void 0:c.length)>0;if(s||l){const f=e==="row"?"height":"width";return{name:t.getName(`${e}_${n}`),type:"group",role:`${e}-${n}`,...i.facetFieldDef?{from:{data:t.getName(`${e}_domain`)},sort:bYt(o,e)}:{},...l&&u?{from:{data:t.getName(`facet_domain_${e}`)}}:{},...s?{title:s}:{},...r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{},...l?{axes:c}:{}}}}return null}const wYt={column:{start:0,end:1},row:{start:1,end:0}};function _Yt(t,e){return wYt[e][t]}function xYt(t,e){const n={};for(const i of ks){const r=t[i];if(r!=null&&r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=M$(["titleAnchor","titleOrient"],r.facetFieldDef.header,e,i),a=I$(i,o),u=_Yt(s,a);u!==void 0&&(n[a]=u)}}return Le(n)?void 0:n}function Hut(t,e,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=dm(o,e==null?void 0:e.header,t,n);a!==void 0&&(s[r[o]]=a)}return s}function a4(t){return[..._w(t,"width"),..._w(t,"height"),..._w(t,"childWidth"),..._w(t,"childHeight")]}function _w(t,e){const n=e==="width"?"x":"y",i=t.component.layoutSize.get(e);if(!i||i==="merged")return[];const r=t.getSizeSignalRef(e).signal;if(i==="step"){const s=t.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(si(o)&&Ef(a)){const u=t.scaleName(n);return So(t.parent)&&t.parent.component.resolve.scale[n]==="independent"?[Pz(u,a)]:[Pz(u,a),{name:r,update:Xut(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=fk(t.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function Pz(t,e){const n=`${t}_step`;return gt(e.step)?{name:n,update:e.step.signal}:{name:n,value:e.step}}function Xut(t,e,n){const i=e.get("type"),r=e.get("padding"),s=Tn(e.get("paddingOuter"),r);let o=e.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${mo(o)}, ${mo(s)}) * ${t}_step`}function Kut(t){return t==="childWidth"?"width":t==="childHeight"?"height":t}function Jut(t,e){return Y(t).reduce((n,i)=>{const r=t[i];return{...n,...Qm(e,r,i,s=>Je(s.value))}},{})}function Qut(t,e){if(So(e))return t==="theta"?"independent":"shared";if(n0(e))return"shared";if(p4(e))return Fn(t)||t==="theta"||t==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function u4(t,e){const n=t.scale[e],i=Fn(e)?"axis":"legend";return n==="independent"?(t[i][e]==="shared"&&K(tqt(e)),"independent"):t[i][e]||"shared"}const SYt={...aWt,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},Zut=Y(SYt);class EYt extends Dc{}const zz={symbols:AYt,gradient:$Yt,labels:IYt,entries:MYt};function AYt(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r,legendType:s}){if(s!=="symbol")return;const{markDef:o,encoding:a,config:u,mark:c}=n,l=o.filled&&c!=="trail";let f={...djt({},n,iVt),...Aut(n,{filled:l})};const d=r.get("symbolOpacity")??u.legend.symbolOpacity,h=r.get("symbolFillColor")??u.legend.symbolFillColor,p=r.get("symbolStrokeColor")??u.legend.symbolStrokeColor,g=d===void 0?tct(a.opacity)??o.opacity:void 0;if(f.fill){if(i==="fill"||l&&i===zr)delete f.fill;else if(f.fill.field)h?delete f.fill:(f.fill=Je(u.legend.symbolBaseFillColor??"black"),f.fillOpacity=Je(g??1));else if(W(f.fill)){const m=wk(a.fill??a.color)??o.fill??(l&&o.color);m&&(f.fill=Je(m))}}if(f.stroke){if(i==="stroke"||!l&&i===zr)delete f.stroke;else if(f.stroke.field||p)delete f.stroke;else if(W(f.stroke)){const m=Tn(wk(a.stroke||a.color),o.stroke,l?o.color:void 0);m&&(f.stroke={value:m})}}if(i!==Tc){const m=X(e)&&nct(n,r,e);m?f.opacity=[{test:m,...Je(g??1)},Je(u.legend.unselectedOpacity)]:g&&(f.opacity=Je(g))}return f={...f,...t},Le(f)?void 0:f}function $Yt(t,{model:e,legendType:n,legendCmpt:i}){if(n!=="gradient")return;const{config:r,markDef:s,encoding:o}=e;let a={};const c=(i.get("gradientOpacity")??r.legend.gradientOpacity)===void 0?tct(o.opacity)||s.opacity:void 0;return c&&(a.opacity=Je(c)),a={...a,...t},Le(a)?void 0:a}function IYt(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=X(e)?nct(n,r,e):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:c,formatType:l}=s;let f;dh(l)?f=bo({fieldOrDatumDef:e,field:"datum.value",format:c,formatType:l,config:o}):c===void 0&&l===void 0&&o.customFormatTypes&&(e.type==="quantitative"&&o.numberFormatType?f=bo({fieldOrDatumDef:e,field:"datum.value",format:o.numberFormat,formatType:o.numberFormatType,config:o}):e.type==="temporal"&&o.timeFormatType&&X(e)&&e.timeUnit===void 0&&(f=bo({fieldOrDatumDef:e,field:"datum.value",format:o.timeFormat,formatType:o.timeFormatType,config:o})));const d={...u?{opacity:u}:{},...f?{text:f}:{},...t};return Le(d)?void 0:d}function MYt(t,{legendCmpt:e}){const n=e.get("selections");return n!=null&&n.length?{...t,fill:{value:"transparent"}}:t}function tct(t){return ect(t,(e,n)=>Math.max(e,n.value))}function wk(t){return ect(t,(e,n)=>Tn(e,n.value))}function ect(t,e){if(SVt(t))return ot(t.condition).reduce(e,t.value);if(ko(t))return t.value}function nct(t,e,n){const i=e.get("selections");if(!(i!=null&&i.length))return;const r=Q(n.field);return i.map(s=>`(!length(data(${Q(on(s)+ph)})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`).join(" || ")}const Uz={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:n})=>{const{format:i,formatType:r}=e;return bat(t,t.type,i,r,n,!1)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:i}=t;return vat(i,e,n)},gradientLength:t=>{const{legend:e,legendConfig:n}=t;return e.gradientLength??n.gradientLength??OYt(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:n})=>t.labelOverlap??e.labelOverlap??RYt(n),symbolType:({legend:t,markDef:e,channel:n,encoding:i})=>t.symbolType??FYt(e.type,n,i.shape,e.shape),title:({fieldOrDatumDef:t,config:e})=>hg(t,e,{allowDisabling:!0}),type:({legendType:t,scaleType:e,channel:n})=>{if(dg(n)&&yo(e)){if(t==="gradient")return}else if(t==="symbol")return;return t},values:({fieldOrDatumDef:t,legend:e})=>TYt(e,t)};function TYt(t,e){const n=t.values;if(W(n))return Dat(e,n);if(gt(n))return n}function FYt(t,e,n,i){if(e!=="shape"){const r=wk(n)??i;if(r)return r}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function kYt(t){const{legend:e}=t;return Tn(e.type,DYt(t))}function DYt({channel:t,timeUnit:e,scaleType:n}){if(dg(t)){if(fe(["quarter","month","day"],e))return"symbol";if(yo(n))return"gradient"}return"symbol"}function CYt({legendConfig:t,legendType:e,orient:n,legend:i}){return i.direction??t[e?"gradientDirection":"symbolDirection"]??NYt(n,e)}function NYt(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return e==="gradient"?"horizontal":void 0}}function OYt({legendConfig:t,model:e,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=t;if(yo(r))return n==="horizontal"?i==="top"||i==="bottom"?jz(e,"width",o,s):o:jz(e,"height",u,a)}function jz(t,e,n,i){return{signal:`clamp(${t.getSizeSignalRef(e).signal}, ${n}, ${i})`}}function RYt(t){if(fe(["quantile","threshold","log","symlog"],t))return"greedy"}function ict(t){const e=wn(t)?LYt(t):UYt(t);return t.component.legends=e,e}function LYt(t){const{encoding:e}=t,n={};for(const i of[zr,...Zat]){const r=qn(e[i]);!r||!t.getScaleComponent(i)||i===Ur&&X(r)&&r.type===Jm||(n[i]=zYt(t,i))}return n}function BYt(t,e){const n=t.scaleName(e);if(t.mark==="trail"){if(e==="color")return{stroke:n};if(e==="size")return{strokeWidth:n}}return e==="color"?t.markDef.filled?{fill:n}:{stroke:n}:{[e]:n}}function PYt(t,e,n,i){switch(e){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(e==="title"&&t===(i==null?void 0:i.title))return!0}return t===(n||{})[e]}function zYt(t,e){var w;let n=t.legend(e);const{markDef:i,encoding:r,config:s}=t,o=s.legend,a=new EYt({},BYt(t,e));XGt(t,e,a);const u=n!==void 0?!n:o.disable;if(a.set("disable",u,n!==void 0),u)return a;n=n||{};const c=t.getScaleComponent(e).get("type"),l=qn(r[e]),f=X(l)?(w=ri(l.timeUnit))==null?void 0:w.unit:void 0,d=n.orient||s.legend.orient||"right",h=kYt({legend:n,channel:e,timeUnit:f,scaleType:c}),p=CYt({legend:n,legendType:h,orient:d,legendConfig:o}),g={legend:n,channel:e,model:t,markDef:i,encoding:r,fieldOrDatumDef:l,legendConfig:o,config:s,scaleType:c,orient:d,legendType:h,direction:p};for(const _ of Zut){if(h==="gradient"&&_.startsWith("symbol")||h==="symbol"&&_.startsWith("gradient"))continue;const S=_ in Uz?Uz[_](g):n[_];if(S!==void 0){const x=PYt(S,_,n,t.fieldDef(e));(x||s.legend[_]===void 0)&&a.set(_,S,x)}}const m=(n==null?void 0:n.encoding)??{},y=a.get("selections"),b={},v={fieldOrDatumDef:l,model:t,channel:e,legendCmpt:a,legendType:h};for(const _ of["labels","legend","title","symbols","gradient","entries"]){const S=Jut(m[_]??{},t),x=_ in zz?zz[_](S,v):S;x!==void 0&&!Le(x)&&(b[_]={...y!=null&&y.length&&X(l)?{name:`${on(l.field)}_legend_${_}`}:{},...y!=null&&y.length?{interactive:!!y}:{},update:x})}return Le(b)||a.set("encode",b,!!(n!=null&&n.encoding)),a}function UYt(t){const{legends:e,resolve:n}=t.component;for(const i of t.children){ict(i);for(const r of Y(i.component.legends))n.legend[r]=u4(t.component.resolve,r),n.legend[r]==="shared"&&(e[r]=rct(e[r],i.component.legends[r]),e[r]||(n.legend[r]="independent",delete e[r]))}for(const i of Y(e))for(const r of t.children)r.component.legends[i]&&n.legend[i]==="shared"&&delete r.component.legends[i];return e}function rct(t,e){var s,o,a,u;if(!t)return e.clone();const n=t.getWithExplicit("orient"),i=e.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let r=!1;for(const c of Zut){const l=tf(t.getWithExplicit(c),e.getWithExplicit(c),c,"legend",(f,d)=>{switch(c){case"symbolType":return jYt(f,d);case"title":return Pot(f,d);case"type":return r=!0,Gr("symbol")}return x$(f,d,c,"legend")});t.setWithExplicit(c,l)}return r&&((o=(s=t.implicit)==null?void 0:s.encode)!=null&&o.gradient&&wS(t.implicit,["encode","gradient"]),(u=(a=t.explicit)==null?void 0:a.encode)!=null&&u.gradient&&wS(t.explicit,["encode","gradient"])),t}function jYt(t,e){return e.value==="circle"?e:t}function qYt(t,e,n,i){var r,s;t.encode??(t.encode={}),(r=t.encode)[e]??(r[e]={}),(s=t.encode[e]).update??(s.update={}),t.encode[e].update[n]=i}function sct(t){const e=t.component.legends,n={};for(const r of Y(e)){const s=t.getScaleComponent(r),o=Be(s.get("domains"));if(n[o])for(const a of n[o])rct(a,e[r])||n[o].push(e[r]);else n[o]=[e[r].clone()]}return mi(n).flat().map(r=>VYt(r,t.config)).filter(r=>r!==void 0)}function VYt(t,e){var o,a,u;const{disable:n,labelExpr:i,selections:r,...s}=t.combine();if(!n){if(e.aria===!1&&s.aria==null&&(s.aria=!1),(o=s.encode)!=null&&o.symbols){const c=s.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!s.stroke&&(c.stroke={value:"transparent"});for(const l of Zat)s[l]&&delete c[l]}if(s.title||delete s.title,i!==void 0){let c=i;(u=(a=s.encode)==null?void 0:a.labels)!=null&&u.update&&gt(s.encode.labels.update.text)&&(c=ah(i,"datum.label",s.encode.labels.update.text.signal)),qYt(s,"labels","text",{signal:c})}return s}}function WYt(t){return n0(t)||p4(t)?GYt(t):oct(t)}function GYt(t){return t.children.reduce((e,n)=>e.concat(n.assembleProjections()),oct(t))}function oct(t){const e=t.component.projection;if(!e||e.merged)return[];const n=e.combine(),{name:i}=n;if(e.data){const r={signal:`[${e.size.map(o=>o.signal).join(", ")}]`},s=e.data.reduce((o,a)=>{const u=gt(a)?a.signal:`data('${t.lookupDataSource(a)}')`;return fe(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]},...n}]}else return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}]}const YYt=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class act extends Dc{constructor(e,n,i,r){super({...n},{name:e}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function uct(t){t.component.projection=wn(t)?HYt(t):JYt(t)}function HYt(t){if(t.hasProjection){const e=Sr(t.specifiedProjection),n=!(e&&(e.scale!=null||e.translate!=null)),i=n?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,r=n?XYt(t):void 0,s=new act(t.projectionName(!0),{...Sr(t.config.projection)??{},...e??{}},i,r);return s.get("type")||s.set("type","equalEarth",!1),s}}function XYt(t){const e=[],{encoding:n}=t;for(const i of[[Vo,qo],[Xs,Wo]])(qn(n[i[0]])||qn(n[i[1]]))&&e.push({signal:t.getName(`geojson_${e.length}`)});return t.channelHasField(Ur)&&t.typedFieldDef(Ur).type===Jm&&e.push({signal:t.getName(`geojson_${e.length}`)}),e.length===0&&e.push(t.requestDataName(Ye.Main)),e}function KYt(t,e){const n=t8(YYt,r=>!!(!xt(t.explicit,r)&&!xt(e.explicit,r)||xt(t.explicit,r)&&xt(e.explicit,r)&&es(t.get(r),e.get(r))));if(es(t.size,e.size)){if(n)return t;if(es(t.explicit,{}))return e;if(es(e.explicit,{}))return t}return null}function JYt(t){if(t.children.length===0)return;let e;for(const i of t.children)uct(i);const n=t8(t.children,i=>{const r=i.component.projection;if(r)if(e){const s=KYt(e,r);return s&&(e=s),!!s}else return e=r,!0;else return!0});if(e&&n){const i=t.projectionName(!0),r=new act(i,e.specifiedProjection,e.size,Wt(e.data));for(const s of t.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}}function QYt(t,e,n,i){if(mv(e,n)){const r=wn(t)?t.axis(n)??t.legend(n)??{}:{},s=tt(e,{expr:"datum"}),o=tt(e,{expr:"datum",binSuffix:"end"});return{formulaAs:tt(e,{binSuffix:"range",forAs:!0}),formula:hv(s,o,r.format,r.formatType,i)}}return{}}function cct(t,e){return`${kot(t)}_${e}`}function ZYt(t,e){return{signal:t.getName(`${e}_bins`),extentSignal:t.getName(`${e}_extent`)}}function c4(t,e,n){const i=m$(n,void 0)??{},r=cct(i,e);return t.getName(`${r}_bins`)}function tHt(t){return"as"in t}function qz(t,e,n){let i,r;tHt(t)?i=at(t.as)?[t.as,`${t.as}_end`]:[t.as[0],t.as[1]]:i=[tt(t,{forAs:!0}),tt(t,{binSuffix:"end",forAs:!0})];const s={...m$(e,void 0)},o=cct(s,t.field),{signal:a,extentSignal:u}=ZYt(n,o);if(s$(s.extent)){const l=s.extent;r=Uut(n,l.param,l),delete s.extent}const c={bin:s,field:t.field,as:[i],...a?{signal:a}:{},...u?{extentSignal:u}:{},...r?{span:r}:{}};return{key:o,binComponent:c}}class Ta extends Oe{clone(){return new Ta(null,Wt(this.bins))}constructor(e,n){super(e),this.bins=n}static makeFromEncoding(e,n){const i=n.reduceFieldDef((r,s,o)=>{if(cr(s)&&Xe(s.bin)){const{key:a,binComponent:u}=qz(s,s.bin,n);r[a]={...u,...r[a],...QYt(n,s,o,n.config)}}return r},{});return Le(i)?null:new Ta(e,i)}static makeFromTransform(e,n,i){const{key:r,binComponent:s}=qz(n,n.bin,i);return new Ta(e,{[r]:s})}merge(e,n){for(const i of Y(e.bins))i in this.bins?(n(e.bins[i].signal,this.bins[i].signal),this.bins[i].as=Sa([...this.bins[i].as,...e.bins[i].as],le)):this.bins[i]=e.bins[i];for(const i of e.children)e.removeChild(i),i.parent=this;e.remove()}producedFields(){return new Set(mi(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(mi(this.bins).map(e=>e.field))}hash(){return`Bin ${le(this.bins)}`}assemble(){return mi(this.bins).flatMap(e=>{const n=[],[i,...r]=e.as,{extent:s,...o}=e.bin,a={type:"bin",field:Hs(e.field),as:i,signal:e.signal,...s$(s)?{extent:null}:{extent:s},...e.span?{span:{signal:`span(${e.span})`}}:{},...o};!s&&e.extentSignal&&(n.push({type:"extent",field:Hs(e.field),signal:e.extentSignal}),a.extent={signal:e.extentSignal}),n.push(a);for(const u of r)for(let c=0;c<2;c++)n.push({type:"formula",expr:tt({field:i[c]},{expr:"datum"}),as:u[c]});return e.formula&&n.push({type:"formula",expr:e.formula,as:e.formulaAs}),n})}}function eHt(t,e,n,i){var s;const r=wn(i)?i.encoding[ou(e)]:void 0;if(cr(n)&&wn(i)&&Eat(n,r,i.markDef,i.config)){t.add(tt(n,{})),t.add(tt(n,{suffix:"end"}));const{mark:o,markDef:a,config:u}=i,c=Zl({fieldDef:n,markDef:a,config:u});J1(o)&&c!==.5&&Fn(e)&&(t.add(tt(n,{suffix:S$})),t.add(tt(n,{suffix:E$}))),n.bin&&mv(n,e)&&t.add(tt(n,{binSuffix:"range"}))}else if(_ot(e)){const o=wot(e);t.add(i.getName(o))}else t.add(tt(n));return Rh(n)&&Wqt((s=n.scale)==null?void 0:s.range)&&t.add(n.scale.range.field),t}function nHt(t,e){for(const n of Y(e)){const i=e[n];for(const r of Y(i))n in t?t[n][r]=new Set([...t[n][r]??[],...i[r]]):t[n]={[r]:i[r]}}}class xo extends Oe{clone(){return new xo(null,new Set(this.dimensions),Wt(this.measures))}constructor(e,n,i){super(e),this.dimensions=n,this.measures=i}get groupBy(){return this.dimensions}static makeFromEncoding(e,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return!i||(n.forEachFieldDef((o,a)=>{const{aggregate:u,field:c}=o;if(u)if(u==="count")r["*"]??(r["*"]={}),r["*"].count=new Set([tt(o,{forAs:!0})]);else{if(fc(u)||Sf(u)){const l=fc(u)?"argmin":"argmax",f=u[l];r[f]??(r[f]={}),r[f][l]=new Set([tt({op:l,field:f},{forAs:!0})])}else r[c]??(r[c]={}),r[c][u]=new Set([tt(o,{forAs:!0})]);Fc(a)&&n.scaleDomain(a)==="unaggregated"&&(r[c]??(r[c]={}),r[c].min=new Set([tt({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([tt({field:c,aggregate:"max"},{forAs:!0})]))}else eHt(s,a,o,n)}),s.size+Y(r).length===0)?null:new xo(e,s,r)}static makeFromTransform(e,n){const i=new Set,r={};for(const s of n.aggregate){const{op:o,field:a,as:u}=s;o&&(o==="count"?(r["*"]??(r["*"]={}),r["*"].count=new Set([u||tt(s,{forAs:!0})])):(r[a]??(r[a]={}),r[a][o]=new Set([u||tt(s,{forAs:!0})])))}for(const s of n.groupby??[])i.add(s);return i.size+Y(r).length===0?null:new xo(e,i,r)}merge(e){return dot(this.dimensions,e.dimensions)?(nHt(this.measures,e.measures),!0):(mqt("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...Y(this.measures)])}producedFields(){const e=new Set;for(const n of Y(this.measures))for(const i of Y(this.measures[n])){const r=this.measures[n][i];r.size===0?e.add(`${i}_${n}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${le({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],n=[],i=[];for(const s of Y(this.measures))for(const o of Y(this.measures[s]))for(const a of this.measures[s][o])i.push(a),e.push(o),n.push(s==="*"?null:Hs(s));return{type:"aggregate",groupby:[...this.dimensions].map(Hs),ops:e,fields:n,as:i}}}class t0 extends Oe{constructor(e,n,i,r){super(e),this.model=n,this.name=i,this.data=r;for(const s of ks){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]={name:n.getName(`${s}_domain`),fields:[tt(o),...Xe(a)?[tt(o,{binSuffix:"end"})]:[]],...Ia(u)?{sortField:u}:W(u)?{sortIndexField:fm(o,s)}:{}}}}this.childModel=n.child}hash(){let e="Facet";for(const n of ks)this[n]&&(e+=` ${n.charAt(0)}:${le(this[n])}`);return e}get fields(){var n;const e=[];for(const i of ks)(n=this[i])!=null&&n.fields&&e.push(...this[i].fields);return e}dependentFields(){const e=new Set(this.fields);for(const n of ks)this[n]&&(this[n].sortField&&e.add(this[n].sortField.field),this[n].sortIndexField&&e.add(this[n].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const n of au){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(si(r)&&Ef(s)){const o=T$(this.childModel,n),a=h4(o);a?e[n]=a:K(p8(n))}}}return e}assembleRowColumnHeaderData(e,n,i){const r={row:"y",column:"x",facet:void 0}[e],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:c}=this[e];if(u){const{op:l=d$,field:f}=u;s.push(f),o.push(l),a.push(tt(u,{forAs:!0}))}else c&&(s.push(c),o.push("max"),a.push(c));return{name:this[e].name,source:n??this.data,transform:[{type:"aggregate",groupby:this[e].fields,...s.length?{fields:s,ops:o,as:a}:{}}]}}assembleFacetHeaderData(e){var u;const{columns:n}=this.model.layout,{layoutHeaders:i}=this.model.component,r=[],s={};for(const c of s4){for(const l of o4){const f=(i[c]&&i[c][l])??[];for(const d of f)if(((u=d.axes)==null?void 0:u.length)>0){s[c]=!0;break}}if(s[c]){const l=`length(data("${this.facet.name}"))`,f=c==="row"?n?{signal:`ceil(${l} / ${n})`}:1:n?{signal:`min(${l}, ${n})`}:{signal:l};r.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:o,column:a}=s;return(o||a)&&r.unshift(this.assembleRowColumnHeaderData("facet",null,e)),r}assemble(){const e=[];let n=null;const i=this.getChildIndependentFieldsWithStep(),{column:r,row:s,facet:o}=this;if(r&&s&&(i.x||i.y)){n=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(i.x??[],i.y??[]),u=a.map(()=>"distinct");e.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:u}]})}for(const a of[tc,Zu])this[a]&&e.push(this.assembleRowColumnHeaderData(a,n,i));if(o){const a=this.assembleFacetHeaderData(i);a&&e.push(...a)}return e}}function Vz(t){return t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function iHt(t,e){const n=i8(t);if(e==="number")return`toNumber(${n})`;if(e==="boolean")return`toBoolean(${n})`;if(e==="string")return`toString(${n})`;if(e==="date")return`toDate(${n})`;if(e==="flatten")return n;if(e.startsWith("date:")){const i=Vz(e.slice(5,e.length));return`timeParse(${n},'${i}')`}else if(e.startsWith("utc:")){const i=Vz(e.slice(4,e.length));return`utcParse(${n},'${i}')`}else return K(Ajt(e)),null}function rHt(t){const e={};return I2(t.filter,n=>{if(nat(n)){let i=null;b8(n)?i=Jr(n.equal):w8(n)?i=Jr(n.lte):v8(n)?i=Jr(n.lt):_8(n)?i=Jr(n.gt):x8(n)?i=Jr(n.gte):S8(n)?i=n.range[0]:E8(n)&&(i=(n.oneOf??n.in)[0]),i&&(Nh(i)?e[n.field]="date":be(i)?e[n.field]="number":at(i)&&(e[n.field]="string")),n.timeUnit&&(e[n.field]="date")}}),e}function sHt(t){const e={};function n(i){am(i)?e[i.field]="date":i.type==="quantitative"&&ijt(i.aggregate)?e[i.field]="number":tm(i.field)>1?i.field in e||(e[i.field]="flatten"):Rh(i)&&Ia(i.sort)&&tm(i.sort.field)>1&&(i.sort.field in e||(e[i.sort.field]="flatten"))}if((wn(t)||So(t))&&t.forEachFieldDef((i,r)=>{if(cr(i))n(i);else{const s=Dh(r),o=t.fieldDef(s);n({...i,type:o.type})}}),wn(t)){const{mark:i,markDef:r,encoding:s}=t;if(Af(i)&&!t.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];X(a)&&a.type==="quantitative"&&!(a.field in e)&&(e[a.field]="number")}}return e}function oHt(t){const e={};if(wn(t)&&t.component.selection)for(const n of Y(t.component.selection)){const i=t.component.selection[n];for(const r of i.project.items)!r.channel&&tm(r.field)>1&&(e[r.field]="flatten")}return e}class ki extends Oe{clone(){return new ki(null,Wt(this._parse))}constructor(e,n){super(e),this._parse=n}hash(){return`Parse ${le(this._parse)}`}static makeExplicit(e,n,i){var o;let r={};const s=n.data;return!vl(s)&&((o=s==null?void 0:s.format)!=null&&o.parse)&&(r=s.format.parse),this.makeWithAncestors(e,r,{},i)}static makeWithAncestors(e,n,i,r){for(const a of Y(i)){const u=r.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===i[a]||u.value==="derived"||i[a]==="flatten"?delete i[a]:K(tz(a,i[a],u.value)))}for(const a of Y(n)){const u=r.get(a);u!==void 0&&(u===n[a]?delete n[a]:K(tz(a,n[a],u)))}const s=new Dc(n,i);r.copyAll(s);const o={};for(const a of Y(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return Y(o).length===0||r.parseNothing?null:new ki(e,o)}get parse(){return this._parse}merge(e){this._parse={...this._parse,...e.parse},e.remove()}assembleFormatParse(){const e={};for(const n of Y(this._parse)){const i=this._parse[n];tm(n)===1&&(e[n]=i)}return e}producedFields(){return new Set(Y(this._parse))}dependentFields(){return new Set(Y(this._parse))}assembleTransforms(e=!1){return Y(this._parse).filter(n=>e?tm(n)>1:!0).map(n=>{const i=iHt(n,this._parse[n]);return i?{type:"formula",expr:i,as:r8(n)}:null}).filter(n=>n!==null)}}class rf extends Oe{clone(){return new rf(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([Do])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Do}}}class vv extends Oe{clone(){return new vv(null,this.params)}constructor(e,n){super(e),this.params=n}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${le(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class wv extends Oe{clone(){return new wv(null,this.params)}constructor(e,n){super(e),this.params=n}dependentFields(){return new Set}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${le(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class gh extends Oe{constructor(e){super(null),e??(e={name:"source"});let n;if(vl(e)||(n=e.format?{...Mr(e.format,["parse"])}:{}),Q1(e))this._data={values:e.values};else if(um(e)){if(this._data={url:e.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(e.url)[1];fe(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else yut(e)?this._data={values:[{type:"Sphere"}]}:(gut(e)||vl(e))&&(this._data={});this._generator=vl(e),e.name&&(this._name=e.name),n&&!Le(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var Wz=function(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},aHt=function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)},Sy;function l4(t){return t instanceof gh||t instanceof vv||t instanceof wv}class f4{constructor(){Sy.set(this,void 0),Wz(this,Sy,!1,"f")}setModified(){Wz(this,Sy,!0,"f")}get modifiedFlag(){return aHt(this,Sy,"f")}}Sy=new WeakMap;class Lh extends f4{getNodeDepths(e,n,i){i.set(e,n);for(const r of e.children)this.getNodeDepths(r,n+1,i);return i}optimize(e){const i=[...this.getNodeDepths(e,0,new Map).entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class d4 extends f4{optimize(e){this.run(e);for(const n of e.children)this.optimize(n);return this.modifiedFlag}}class uHt extends d4{mergeNodes(e,n){const i=n.shift();for(const r of n)e.removeChild(r),r.parent=i,r.remove()}run(e){const n=e.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[e.children[r]]:i[n[r]].push(e.children[r]);for(const r of Y(i))i[r].length>1&&(this.setModified(),this.mergeNodes(e,i[r]))}}class cHt extends d4{constructor(e){super(),this.requiresSelectionId=e&&r4(e)}run(e){e instanceof rf&&(this.requiresSelectionId&&(l4(e.parent)||e.parent instanceof xo||e.parent instanceof ki)||(this.setModified(),e.remove()))}}class lHt extends f4{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,n){let i=new Set;e instanceof Ma&&(i=e.producedFields(),e8(i,n)&&(this.setModified(),e.removeFormulas(n),e.producedFields.length===0&&e.remove()));for(const r of e.children)this.run(r,new Set([...n,...i]))}}class fHt extends d4{constructor(){super()}run(e){e instanceof nr&&!e.isRequired()&&(this.setModified(),e.remove())}}class dHt extends Lh{run(e){if(!l4(e)&&!(e.numChildren()>1)){for(const n of e.children)if(n instanceof ki)if(e instanceof ki)this.setModified(),e.merge(n);else{if(n8(e.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class hHt extends Lh{run(e){const n=[...e.children],i=e.children.filter(r=>r instanceof ki);if(e.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const u of Y(a))u in r?r[u]!==a[u]&&s.add(u):r[u]=a[u]}for(const o of s)delete r[o];if(!Le(r)){this.setModified();const o=new ki(e,r);for(const a of n){if(a instanceof ki)for(const u of Y(r))delete a.parse[u];e.removeChild(a),a.parent=o,a instanceof ki&&Y(a.parse).length===0&&a.remove()}}}}}class pHt extends Lh{run(e){e instanceof nr||e.numChildren()>0||e instanceof t0||e instanceof gh||(this.setModified(),e.remove())}}class gHt extends Lh{run(e){const n=e.children.filter(r=>r instanceof Ma),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class mHt extends Lh{run(e){const n=e.children.filter(r=>r instanceof xo),i={};for(const r of n){const s=le(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of Y(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(e.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class yHt extends Lh{constructor(e){super(),this.model=e}run(e){const n=!(l4(e)||e instanceof Zm||e instanceof ki||e instanceof rf),i=[],r=[];for(const s of e.children)s instanceof Ta&&(n&&!n8(e.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof Ta?e.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class bHt extends Lh{run(e){const n=[...e.children];if(!oh(n,o=>o instanceof nr)||e.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof nr){let a=o;for(;a.numChildren()===1;){const[u]=a.children;if(u instanceof nr)a=u;else break}r.push(...a.children),s?(e.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Bh extends Oe{clone(){return new Bh(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n}addDimensions(e){this.transform.groupby=Sa(this.transform.groupby.concat(e),n=>n)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){return e.as??tt(e)}hash(){return`JoinAggregateTransform ${le(this.transform)}`}assemble(){const e=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),e.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return{type:"joinaggregate",as:i,ops:n,fields:e,...r!==void 0?{groupby:r}:{}}}}function vHt(t){return t.stack.stackBy.reduce((e,n)=>{const i=n.fieldDef,r=tt(i);return r&&e.push(r),e},[])}function wHt(t){return W(t)&&t.every(e=>at(e))&&t.length>1}class nc extends Oe{clone(){return new nc(null,Wt(this._stack))}constructor(e,n){super(e),this._stack=n}static makeFromTransform(e,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(Tn(f.order,"ascending"));const c={field:a,order:u};let l;return wHt(s)?l=s:at(s)?l=[s,`${s}_end`]:l=[`${n.stack}_start`,`${n.stack}_end`],new nc(e,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:o,sort:c,facetby:[],as:l})}static makeFromEncoding(e,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:s,fieldChannel:o,offset:a,impute:u}=i,c=s.map(h=>{const p=r[h];return Wa(p)}).filter(h=>!!h),l=vHt(n),f=n.encoding.order;let d;if(W(f)||X(f))d=Rot(f);else{const h=Aat(f)?f.sort:o==="y"?"descending":"ascending";d=l.reduce((p,g)=>(p.field.push(g),p.order.push(h),p),{field:[],order:[]})}return new nc(e,{dimensionFieldDefs:c,stackField:n.vgField(o),facetby:[],stackby:l,sort:d,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${le(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:e,impute:n,groupby:i}=this._stack;return e.length>0?e.map(r=>r.bin?n?[tt(r,{binSuffix:"mid"})]:[tt(r,{}),tt(r,{binSuffix:"end"})]:[tt(r)]).flat():i??[]}assemble(){const e=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:s,sort:o,offset:a,impute:u,as:c}=this._stack;if(u)for(const l of i){const{bandPosition:f=.5,bin:d}=l;if(d){const h=tt(l,{expr:"datum"}),p=tt(l,{expr:"datum",binSuffix:"end"});e.push({type:"formula",expr:`${f}*${h}+${1-f}*${p}`,as:tt(l,{binSuffix:"mid",forAs:!0})})}e.push({type:"impute",field:r,groupby:[...s,...n],key:tt(l,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:c,offset:a}),e}}class e0 extends Oe{clone(){return new e0(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n}addDimensions(e){this.transform.groupby=Sa(this.transform.groupby.concat(e),n=>n)}dependentFields(){const e=new Set;return(this.transform.groupby??[]).forEach(e.add,e),(this.transform.sort??[]).forEach(n=>e.add(n.field)),this.transform.window.map(n=>n.field).filter(n=>n!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){return e.as??tt(e)}hash(){return`WindowTransform ${le(this.transform)}`}assemble(){const e=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),e.push(f.field===void 0?null:f.field);const s=this.transform.frame,o=this.transform.groupby;if(s&&s[0]===null&&s[1]===null&&n.every(f=>d8(f)))return{type:"joinaggregate",as:i,ops:n,fields:e,...o!==void 0?{groupby:o}:{}};const a=[],u=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)a.push(f.field),u.push(f.order??"ascending");const c={field:a,order:u},l=this.transform.ignorePeers;return{type:"window",params:r,as:i,ops:n,fields:e,sort:c,...l!==void 0?{ignorePeers:l}:{},...o!==void 0?{groupby:o}:{},...s!==void 0?{frame:s}:{}}}}function _Ht(t){function e(n){if(!(n instanceof t0)){const i=n.clone();if(i instanceof nr){const r=xk+i.getSource();i.setSource(r),t.model.component.data.outputNodes[r]=i}else(i instanceof xo||i instanceof nc||i instanceof e0||i instanceof Bh)&&i.addDimensions(t.fields);for(const r of n.children.flatMap(e))r.parent=i;return[i]}return n.children.flatMap(e)}return e}function _k(t){if(t instanceof t0)if(t.numChildren()===1&&!(t.children[0]instanceof nr)){const e=t.children[0];(e instanceof xo||e instanceof nc||e instanceof e0||e instanceof Bh)&&e.addDimensions(t.fields),e.swapWithParent(),_k(t)}else{const e=t.model.component.data.main;lct(e);const n=_Ht(t),i=t.children.map(n).flat();for(const r of i)r.parent=e}else t.children.map(_k)}function lct(t){if(t instanceof nr&&t.type===Ye.Main&&t.numChildren()===1){const e=t.children[0];e instanceof t0||(e.swapWithParent(),lct(t))}}const xk="scale_",xw=5;function Sk(t){for(const e of t){for(const n of e.children)if(n.parent!==e)return!1;if(!Sk(e.children))return!1}return!0}function to(t,e){let n=!1;for(const i of e)n=t.optimize(i)||n;return n}function Gz(t,e,n){let i=t.sources,r=!1;return r=to(new fHt,i)||r,r=to(new cHt(e),i)||r,i=i.filter(s=>s.numChildren()>0),r=to(new pHt,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=to(new dHt,i)||r,r=to(new yHt(e),i)||r,r=to(new lHt,i)||r,r=to(new hHt,i)||r,r=to(new mHt,i)||r,r=to(new gHt,i)||r,r=to(new uHt,i)||r,r=to(new bHt,i)||r),t.sources=i,r}function xHt(t,e){Sk(t.sources);let n=0,i=0;for(let r=0;r<xw&&Gz(t,e,!0);r++)n++;t.sources.map(_k);for(let r=0;r<xw&&Gz(t,e,!1);r++)i++;Sk(t.sources),Math.max(n,i)===xw&&K(`Maximum optimization runs(${xw}) reached.`)}class Kn{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,n){return new Kn(()=>e(n))}}function fct(t){wn(t)?SHt(t):EHt(t)}function SHt(t){const e=t.component.scales;for(const n of Y(e)){const i=$Ht(t,n);if(e[n].setWithExplicit("domains",i),MHt(t,n),t.component.data.isFaceted){let s=t;for(;!So(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of i.value)Hu(a)&&(a.data=xk+a.data.replace(xk,""))}}}function EHt(t){for(const n of t.children)fct(n);const e=t.component.scales;for(const n of Y(e)){let i,r=null;for(const s of t.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=tf(i,o.getWithExplicit("domains"),"domains","scale",Ek);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&K(_jt),r=a}}e[n].setWithExplicit("domains",i),r&&e[n].set("selectionExtent",r,!0)}}function AHt(t,e,n,i){if(t==="unaggregated"){const{valid:r,reason:s}=Yz(e,n);if(!r){K(s);return}}else if(t===void 0&&i.useUnaggregatedDomain){const{valid:r}=Yz(e,n);if(r)return"unaggregated"}return t}function $Ht(t,e){const n=t.getScaleComponent(e).get("type"),{encoding:i}=t,r=AHt(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);return r!==t.scaleDomain(e)&&(t.specifiedScales[e]={...t.specifiedScales[e],domain:r}),e==="x"&&qn(i.x2)?qn(i.x)?tf(jc(n,r,t,"x"),jc(n,r,t,"x2"),"domain","scale",Ek):jc(n,r,t,"x2"):e==="y"&&qn(i.y2)?qn(i.y)?tf(jc(n,r,t,"y"),jc(n,r,t,"y2"),"domain","scale",Ek):jc(n,r,t,"y2"):jc(n,r,t,e)}function IHt(t,e,n){return t.map(i=>({signal:`{data: ${y$(i,{timeUnit:n,type:e})}}`}))}function Y3(t,e,n){var r;const i=(r=ri(n))==null?void 0:r.unit;return e==="temporal"||i?IHt(t,e,i):[t]}function jc(t,e,n,i){const{encoding:r,markDef:s,mark:o,config:a,stack:u}=n,c=qn(r[i]),{type:l}=c,f=c.timeUnit;if(Vqt(e)){const p=jc(t,void 0,n,i),g=Y3(e.unionWith,l,f);return oa([...g,...p.value])}else{if(gt(e))return oa([e]);if(e&&e!=="unaggregated"&&!cat(e))return oa(Y3(e,l,f))}if(u&&i===u.fieldChannel){if(u.offset==="normalize")return Gr([[0,1]]);const p=n.requestDataName(Ye.Main);return Gr([{data:p,field:n.vgField(i,{suffix:"start"})},{data:p,field:n.vgField(i,{suffix:"end"})}])}const d=Fc(i)&&X(c)?THt(n,i,t):void 0;if(uu(c)){const p=Y3([c.datum],l,f);return Gr(p)}const h=c;if(e==="unaggregated"){const p=n.requestDataName(Ye.Main),{field:g}=c;return Gr([{data:p,field:tt({field:g,aggregate:"min"})},{data:p,field:tt({field:g,aggregate:"max"})}])}else if(Xe(h.bin)){if(si(t))return Gr(t==="bin-ordinal"?[]:[{data:X1(d)?n.requestDataName(Ye.Main):n.requestDataName(Ye.Raw),field:n.vgField(i,mv(h,i)?{binSuffix:"range"}:{}),sort:d===!0||!ut(d)?{field:n.vgField(i,{}),op:"min"}:d}]);{const{bin:p}=h;if(Xe(p)){const g=c4(n,h.field,p);return Gr([new Kn(()=>{const m=n.getSignalName(g);return`[${m}.start, ${m}.stop]`})])}else return Gr([{data:n.requestDataName(Ye.Main),field:n.vgField(i,{})}])}}else if(h.timeUnit&&fe(["time","utc"],t)){const p=r[ou(i)];if(Eat(h,p,s,a)){const g=n.requestDataName(Ye.Main),m=Zl({fieldDef:h,fieldDef2:p,markDef:s,config:a}),y=J1(o)&&m!==.5&&Fn(i);return Gr([{data:g,field:n.vgField(i,y?{suffix:S$}:{})},{data:g,field:n.vgField(i,{suffix:y?E$:"end"})}])}}return Gr(d?[{data:X1(d)?n.requestDataName(Ye.Main):n.requestDataName(Ye.Raw),field:n.vgField(i),sort:d}]:[{data:n.requestDataName(Ye.Main),field:n.vgField(i)}])}function H3(t,e){const{op:n,field:i,order:r}=t;return{op:n??(e?"sum":d$),...i?{field:Hs(i)}:{},...r?{order:r}:{}}}function MHt(t,e){var a;const n=t.component.scales[e],i=t.specifiedScales[e].domain,r=(a=t.fieldDef(e))==null?void 0:a.bin,s=cat(i)&&i,o=Ch(r)&&s$(r.extent)&&r.extent;(s||o)&&n.set("selectionExtent",s??o,!0)}function THt(t,e,n){if(!si(n))return;const i=t.fieldDef(e),r=i.sort;if(xat(r))return{op:"min",field:fm(i,e),order:"ascending"};const{stack:s}=t,o=s?new Set([...s.groupbyFields,...s.stackBy.map(a=>a.fieldDef.field)]):void 0;if(Ia(r)){const a=s&&!o.has(r.field);return H3(r,a)}else if(_at(r)){const{encoding:a,order:u}=r,c=t.fieldDef(a),{aggregate:l,field:f}=c,d=s&&!o.has(f);if(fc(l)||Sf(l))return H3({field:tt(c),order:u},d);if(d8(l)||!l)return H3({op:l,field:f,order:u},d)}else{if(r==="descending")return{op:"min",field:t.vgField(e),order:"descending"};if(fe(["ascending",void 0],r))return!0}}function Yz(t,e){const{aggregate:n,type:i}=t;return n?at(n)&&!sjt.has(n)?{valid:!1,reason:Yjt(n)}:i==="quantitative"&&e==="log"?{valid:!1,reason:Hjt(t)}:{valid:!0}:{valid:!1,reason:Gjt(t)}}function Ek(t,e,n,i){return t.explicit&&e.explicit&&K(Zjt(n,i,t.value,e.value)),{explicit:t.explicit,value:[...t.value,...e.value]}}function FHt(t){const e=Sa(t.map(o=>{if(Hu(o)){const{sort:a,...u}=o;return u}return o}),le),n=Sa(t.map(o=>{if(Hu(o)){const a=o.sort;return a!==void 0&&!X1(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),le);if(e.length===0)return;if(e.length===1){const o=t[0];if(Hu(o)&&n.length>0){let a=n[0];if(n.length>1){K(nz);const u=n.filter(c=>ut(c)&&"op"in c&&c.op!=="min");n.every(c=>ut(c)&&"op"in c)&&u.length===1?a=u[0]:a=!0}else if(ut(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return{...o,sort:a}}return o}const i=Sa(n.map(o=>X1(o)||!("op"in o)||at(o.op)&&o.op in ejt?o:(K(eqt(o)),!0)),le);let r;i.length===1?r=i[0]:i.length>1&&(K(nz),r=!0);const s=Sa(t.map(o=>Hu(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?{data:s[0],fields:e.map(a=>a.field),...r?{sort:r}:{}}:{fields:e,...r?{sort:r}:{}}}function h4(t){if(Hu(t)&&at(t.field))return t.field;if(ojt(t)){let e;for(const n of t.fields)if(Hu(n)&&at(n.field)){if(!e)e=n.field;else if(e!==n.field)return K(nqt),e}return K(iqt),e}else if(ajt(t)){K(rqt);const e=t.fields[0];return at(e)?e:void 0}}function T$(t,e){const i=t.component.scales[e].get("domains").map(r=>(Hu(r)&&(r.data=t.lookupDataSource(r.data)),r));return FHt(i)}function dct(t){return n0(t)||p4(t)?t.children.reduce((e,n)=>e.concat(dct(n)),Hz(t)):Hz(t)}function Hz(t){return Y(t.component.scales).reduce((e,n)=>{const i=t.component.scales[n];if(i.merged)return e;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:c,reverse:l,...f}=r,d=kHt(r.range,s,n,t),h=T$(t,n),p=a?AGt(t,a,i,h):null;return e.push({name:s,type:o,...h?{domain:h}:{},...p?{domainRaw:p}:{},range:d,...l!==void 0?{reverse:l}:{},...f}),e},[])}function kHt(t,e,n,i){if(Fn(n)){if(Ef(t))return{step:{signal:`${e}_step`}}}else if(ut(t)&&Hu(t))return{...t,data:i.lookupDataSource(t.data)};return t}class hct extends Dc{constructor(e,n){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:oh(this.get("domains"),e=>W(e)&&e.length===2&&be(e[0])&&e[0]<=0&&be(e[1])&&e[1]>=0)}}const DHt=["range","scheme"];function CHt(t){const e=t.component.scales;for(const n of r$){const i=e[n];if(!i)continue;const r=NHt(n,t);i.setWithExplicit("range",r)}}function Xz(t,e){const n=t.fieldDef(e);if(n!=null&&n.bin){const{bin:i,field:r}=n,s=jr(e),o=t.getName(s);if(ut(i)&&i.binned&&i.step!==void 0)return new Kn(()=>{const a=t.scaleName(e),u=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${t.getSignalName(o)} / (${u})`});if(Xe(i)){const a=c4(t,r,i);return new Kn(()=>{const u=t.getSignalName(a),c=`(${u}.stop - ${u}.start) / ${u}.step`;return`${t.getSignalName(o)} / (${c})`})}}}function NHt(t,e){const n=e.specifiedScales[t],{size:i}=e,s=e.getScaleComponent(t).get("type");for(const f of DHt)if(n[f]!==void 0){const d=uk(s,f),h=lat(t,f);if(!d)K(qot(s,f,t));else if(h)K(h);else switch(f){case"range":{const p=n.range;if(W(p)){if(Fn(t))return oa(p.map(g=>{if(g==="width"||g==="height"){const m=e.getName(g),y=e.getSignalName.bind(e);return Kn.fromName(y,m)}return g}))}else if(ut(p))return oa({data:e.requestDataName(Ye.Main),field:p.field,sort:{op:"min",field:e.vgField(t)}});return oa(p)}case"scheme":return oa(OHt(n[f]))}}const o=t===an||t==="xOffset"?"width":"height",a=i[o];if(Ga(a)){if(Fn(t))if(si(s)){const f=gct(a,e,t);if(f)return oa({step:f})}else K(Vot(o));else if(lv(t)){const f=t===bf?"x":"y";if(e.getScaleComponent(f).get("type")==="band"){const p=mct(a,s);if(p)return oa(p)}}}const{rangeMin:u,rangeMax:c}=n,l=RHt(t,e);return(u!==void 0||c!==void 0)&&uk(s,"rangeMin")&&W(l)&&l.length===2?oa([u??l[0],c??l[1]]):Gr(l)}function OHt(t){return qqt(t)?{scheme:t.name,...Mr(t,["name"])}:{scheme:t}}function pct(t,e,n,{center:i}={}){const r=jr(t),s=e.getName(r),o=e.getSignalName.bind(e);return t===ai&&ds(n)?i?[Kn.fromName(a=>`${o(a)}/2`,s),Kn.fromName(a=>`-${o(a)}/2`,s)]:[Kn.fromName(o,s),0]:i?[Kn.fromName(a=>`-${o(a)}/2`,s),Kn.fromName(a=>`${o(a)}/2`,s)]:[0,Kn.fromName(o,s)]}function RHt(t,e){const{size:n,config:i,mark:r,encoding:s}=e,{type:o}=qn(s[t]),u=e.getScaleComponent(t).get("type"),{domain:c,domainMid:l}=e.specifiedScales[t];switch(t){case an:case ai:{if(fe(["point","band"],u)){const f=yct(t,n,i.view);if(Ga(f))return{step:gct(f,e,t)}}return pct(t,e,u)}case bf:case Km:return LHt(t,e,u);case Mc:{const f=e.component.scales[t].get("zero"),d=bct(r,f,i),h=zHt(r,n,e,i);return rm(u)?PHt(d,h,BHt(u,i,c,t)):[d,h]}case Qs:return[0,Math.PI*2];case kh:return[0,360];case jo:return[0,new Kn(()=>{const f=e.getSignalName("width"),d=e.getSignalName("height");return`min(${f},${d})/2`})];case _f:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case xf:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Ur:return"symbol";case zr:case ru:case su:return u==="ordinal"?o==="nominal"?"category":"ordinal":l!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Tc:case vf:case wf:return[i.scale.minOpacity,i.scale.maxOpacity]}}function gct(t,e,n){const{encoding:i}=e,r=e.getScaleComponent(n),s=u8(n),o=i[s];if(eut({step:t,offsetIsDiscrete:Xt(o)&&rat(o.type)})==="offset"&&Rat(i,s)){const u=e.getScaleComponent(s);let l=`domain('${e.scaleName(s)}').length`;if(u.get("type")==="band"){const d=u.get("paddingInner")??u.get("padding")??0,h=u.get("paddingOuter")??u.get("padding")??0;l=`bandspace(${l}, ${d}, ${h})`}const f=r.get("paddingInner")??r.get("padding");return{signal:`${t.step} * ${l} / (1-${fjt(f)})`}}else return t.step}function mct(t,e){if(eut({step:t,offsetIsDiscrete:si(e)})==="offset")return{step:t.step}}function LHt(t,e,n){const i=t===bf?"x":"y",r=e.getScaleComponent(i);if(!r)return pct(i,e,n,{center:!0});const s=r.get("type"),o=e.scaleName(i),{markDef:a,config:u}=e;if(s==="band"){const c=yct(i,e.size,e.config.view);if(Ga(c)){const l=mct(c,n);if(l)return l}return[0,{signal:`bandwidth('${o}')`}]}else{const c=e.encoding[i];if(X(c)&&c.timeUnit){const l=tat(c.timeUnit,p=>`scale('${o}', ${p})`),f=e.config.scale.bandWithNestedOffsetPaddingInner,d=Zl({fieldDef:c,markDef:a,config:u})-.5,h=d!==0?` + ${d}`:"";if(f){const p=gt(f)?`${f.signal}/2`+h:`${f/2+d}`,g=gt(f)?`(1 - ${f.signal}/2)`+h:`${1-f/2+d}`;return[{signal:`${p} * (${l})`},{signal:`${g} * (${l})`}]}return[0,{signal:l}]}return lot(`Cannot use ${t} scale if ${i} scale is not discrete.`)}}function yct(t,e,n){const i=t===an?"width":"height",r=e[i];return r||kS(n,i)}function BHt(t,e,n,i){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":return n!==void 0&&W(n)?n.length+1:(K(hqt(i)),3)}}function PHt(t,e,n){const i=()=>{const r=mo(e),s=mo(t),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return gt(e)?new Kn(i):{signal:i()}}function bct(t,e,n){if(e)return gt(e)?{signal:`${e.signal} ? 0 : ${bct(t,!1,n)}`}:0;switch(t){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(o$("size",t))}const Kz=.95;function zHt(t,e,n,i){const r={x:Xz(n,"x"),y:Xz(n,"y")};switch(t){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=Jz(e,r,i.view);return be(s)?s-1:new Kn(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=Jz(e,r,i.view);return be(s)?Math.pow(Kz*s,2):new Kn(()=>`pow(${Kz} * ${s.signal}, 2)`)}}throw new Error(o$("size",t))}function Jz(t,e,n){const i=Ga(t.width)?t.width.step:FS(n,"width"),r=Ga(t.height)?t.height.step:FS(n,"height");return e.x||e.y?new Kn(()=>`min(${[e.x?e.x.signal:i,e.y?e.y.signal:r].join(", ")})`):Math.min(i,r)}function vct(t,e){wn(t)?UHt(t,e):_ct(t,e)}function UHt(t,e){const n=t.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=t;for(const a of Y(n)){const u=o[a],c=n[a],l=t.getScaleComponent(a),f=qn(r[a]),d=u[e],h=l.get("type"),p=l.get("padding"),g=l.get("paddingInner"),m=uk(h,e),y=lat(a,e);if(d!==void 0&&(m?y&&K(y):K(qot(h,e,a))),m&&y===void 0)if(d!==void 0){const b=f.timeUnit,v=f.type;switch(e){case"domainMax":case"domainMin":Nh(u[e])||v==="temporal"||b?c.set(e,{signal:y$(u[e],{type:v,timeUnit:b})},!0):c.set(e,u[e],!0);break;default:c.copyKeyFromObject(e,u)}}else{const b=e in Qz?Qz[e]({model:t,channel:a,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:g,domain:u.domain,domainMin:u.domainMin,domainMax:u.domainMax,markDef:s,config:i,hasNestedOffsetScale:Lat(r,a),hasSecondaryRangeChannel:!!r[ou(a)]}):i.scale[e];b!==void 0&&c.set(e,b,!1)}}}const Qz={bins:({model:t,fieldOrDatumDef:e})=>X(e)?jHt(t,e):void 0,interpolate:({channel:t,fieldOrDatumDef:e})=>qHt(t,e.type),nice:({scaleType:t,channel:e,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:s})=>VHt(t,e,n,i,r,s),padding:({channel:t,scaleType:e,fieldOrDatumDef:n,markDef:i,config:r})=>WHt(t,e,r.scale,n,i,r.bar),paddingInner:({scalePadding:t,channel:e,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:s})=>GHt(t,e,n.type,i,r.scale,s),paddingOuter:({scalePadding:t,channel:e,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:s})=>YHt(t,e,n,i,r.scale,s),reverse:({fieldOrDatumDef:t,scaleType:e,channel:n,config:i})=>{const r=X(t)?t.sort:void 0;return HHt(e,r,n,i.scale)},zero:({channel:t,fieldOrDatumDef:e,domain:n,markDef:i,scaleType:r,config:s,hasSecondaryRangeChannel:o})=>XHt(t,e,n,i,r,s.scale,o)};function wct(t){wn(t)?CHt(t):_ct(t,"range")}function _ct(t,e){const n=t.component.scales;for(const i of t.children)e==="range"?wct(i):vct(i,e);for(const i of Y(n)){let r;for(const s of t.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(e);r=tf(r,a,e,"scale",put((u,c)=>{switch(e){case"range":return u.step&&c.step?u.step-c.step:0}return 0}))}}n[i].setWithExplicit(e,r)}}function jHt(t,e){const n=e.bin;if(Xe(n)){const i=c4(t,e.field,n);return new Kn(()=>t.getSignalName(i))}else if(ui(n)&&Ch(n)&&n.step!==void 0)return{step:n.step}}function qHt(t,e){if(fe([zr,ru,su],t)&&e!=="nominal")return"hcl"}function VHt(t,e,n,i,r,s){var o;if(!((o=Wa(s))!=null&&o.bin||W(n)||r!=null||i!=null||fe([Tr.TIME,Tr.UTC],t)))return Fn(e)?!0:void 0}function WHt(t,e,n,i,r,s){if(Fn(t)){if(yo(e)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(X(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&t==="x"||a==="horizontal"&&t==="y"))return s.continuousBandSize}if(e===Tr.POINT)return n.pointPadding}}function GHt(t,e,n,i,r,s=!1){if(t===void 0){if(Fn(e)){const{bandPaddingInner:o,barBandPaddingInner:a,rectBandPaddingInner:u,bandWithNestedOffsetPaddingInner:c}=r;return s?c:Tn(o,n==="bar"?a:u)}else if(lv(e)&&i===Tr.BAND)return r.offsetBandPaddingInner}}function YHt(t,e,n,i,r,s=!1){if(t===void 0){if(Fn(e)){const{bandPaddingOuter:o,bandWithNestedOffsetPaddingOuter:a}=r;if(s)return a;if(n===Tr.BAND)return Tn(o,gt(i)?{signal:`${i.signal}/2`}:i/2)}else if(lv(e)){if(n===Tr.POINT)return .5;if(n===Tr.BAND)return r.offsetBandPaddingOuter}}}function HHt(t,e,n,i){if(n==="x"&&i.xReverse!==void 0)return ds(t)&&e==="descending"?gt(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(ds(t)&&e==="descending")return!0}function XHt(t,e,n,i,r,s,o){if(!!n&&n!=="unaggregated"&&ds(r)){if(W(n)){const u=n[0],c=n[n.length-1];if(be(u)&&u<=0&&be(c)&&c>=0)return!0}return!1}if(t==="size"&&e.type==="quantitative"&&!rm(r))return!0;if(!(X(e)&&e.bin)&&fe([...au,...YUt],t)){const{orient:u,type:c}=i;return fe(["bar","area","line","trail"],c)&&(u==="horizontal"&&t==="y"||u==="vertical"&&t==="x")?!1:fe(["bar","area"],c)&&!o?!0:s==null?void 0:s.zero}return!1}function KHt(t,e,n,i,r=!1){const s=JHt(e,n,i,r),{type:o}=t;return Fc(e)?o!==void 0?Kqt(e,o)?X(n)&&!Xqt(o,n.type)?(K(Jjt(o,s)),s):o:(K(Kjt(e,o,s)),s):s:null}function JHt(t,e,n,i){var r;switch(e.type){case"nominal":case"ordinal":{if(dg(t)||P3(t)==="discrete")return t==="shape"&&e.type==="ordinal"&&K(z3(t,"ordinal")),"ordinal";if(Fn(t)||lv(t)){if(fe(["rect","bar","image","rule"],n.type)||i)return"band"}else if(n.type==="arc"&&t in f8)return"band";const s=n[jr(t)];return fh(s)||om(e)&&((r=e.axis)!=null&&r.tickBand)?"band":"point"}case"temporal":return dg(t)?"time":P3(t)==="discrete"?(K(z3(t,"temporal")),"ordinal"):X(e)&&e.timeUnit&&ri(e.timeUnit).utc?"utc":"time";case"quantitative":return dg(t)?X(e)&&Xe(e.bin)?"bin-ordinal":"linear":P3(t)==="discrete"?(K(z3(t,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Uot(e.type))}function QHt(t,{ignoreRange:e}={}){xct(t),fct(t);for(const n of Hqt)vct(t,n);e||wct(t)}function xct(t){wn(t)?t.component.scales=ZHt(t):t.component.scales=eXt(t)}function ZHt(t){const{encoding:e,mark:n,markDef:i}=t,r={};for(const s of r$){const o=qn(e[s]);if(o&&n===hat&&s===Ur&&o.type===Jm)continue;let a=o&&o.scale;if(o&&a!==null&&a!==!1){a??(a={});const u=Lat(e,s),c=KHt(a,s,o,i,u);r[s]=new hct(t.scaleName(`${s}`,!0),{value:c,explicit:a.type===c})}}return r}const tXt=put((t,e)=>rz(t)-rz(e));function eXt(t){var e;const n=t.component.scales={},i={},r=t.component.resolve;for(const s of t.children){xct(s);for(const o of Y(s.component.scales))if((e=r.scale)[o]??(e[o]=Qut(o,t)),r.scale[o]==="shared"){const a=i[o],u=s.component.scales[o].getWithExplicit("type");a?Bqt(a.value,u.value)?i[o]=tf(a,u,"type","scale",tXt):(r.scale[o]="independent",delete i[o]):i[o]=u}}for(const s of Y(i)){const o=t.scaleName(s,!0),a=i[s];n[s]=new hct(o,a);for(const u of t.children){const c=u.component.scales[s];c&&(u.renameScale(c.get("name"),o),c.merged=!0)}}return n}class X3{constructor(){this.nameMap={}}rename(e,n){this.nameMap[e]=n}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function wn(t){return(t==null?void 0:t.type)==="unit"}function So(t){return(t==null?void 0:t.type)==="facet"}function p4(t){return(t==null?void 0:t.type)==="concat"}function n0(t){return(t==null?void 0:t.type)==="layer"}class g4{constructor(e,n,i,r,s,o,a){this.type=n,this.parent=i,this.config=s,this.correctDataNames=u=>{var c,l,f;return(c=u.from)!=null&&c.data&&(u.from.data=this.lookupDataSource(u.from.data)),(f=(l=u.from)==null?void 0:l.facet)!=null&&f.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u},this.parent=i,this.config=s,this.view=Sr(a),this.name=e.name??r,this.title=Jc(e.title)?{text:e.title}:e.title?Sr(e.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new X3,this.projectionNameMap=i?i.projectionNameMap:new X3,this.signalNameMap=i?i.signalNameMap:new X3,this.data=e.data,this.description=e.description,this.transforms=uGt(e.transform??[]),this.layout=n==="layer"||n==="unit"?{}:dWt(e,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:h$(e)||(i==null?void 0:i.component.data.isFaceted)&&e.data===void 0},layoutSize:new Dc,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...o?Wt(o):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){QHt(this)}parseProjection(){uct(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){ict(this)}assembleEncodeFromView(e){const{style:n,...i}=e,r={};for(const s of Y(i)){const o=i[s];o!==void 0&&(r[s]=Je(o))}return r}assembleGroupEncodeEntry(e){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(n.description=Je(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...n??{}}:Le(n)?void 0:n}assembleLayout(){if(!this.layout)return;const{spacing:e,...n}=this.layout,{component:i,config:r}=this,s=xYt(i.layoutHeaders,r);return{padding:e,...this.assembleDefaultLayout(),...n,...s?{titleBand:s}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let n=[];for(const i of ks)e[i].title&&n.push(mYt(this,i));for(const i of s4)n=n.concat(yYt(this,i));return n}assembleAxes(){return iYt(this.component.axes,this.config)}assembleLegends(){return sct(this)}assembleProjections(){return WYt(this)}assembleTitle(){const{encoding:e,...n}=this.title??{},i={...Dot(this.config.title).nonMarkTitleProperties,...n,...e?{encode:{update:e}}:{}};if(i.text)return fe(["unit","layer"],this.type)?fe(["middle",void 0],i.anchor)&&(i.frame??(i.frame="group")):i.anchor??(i.anchor="start"),Le(i)?void 0:i}assembleGroup(e=[]){const n={};e=e.concat(this.assembleSignals()),e.length>0&&(n.signals=e);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||So(this.parent)?dct(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(e){return on((this.name?`${this.name}_`:"")+e)}getDataName(e){return this.getName(Ye[e].toLowerCase())}requestDataName(e){const n=this.getDataName(e),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(e){if(So(this.parent)){const n=Kut(e),i=i$(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(si(s)&&Ef(o)){const a=r.get("name"),u=T$(this,i),c=h4(u);if(c){const l=tt({aggregate:"distinct",field:c},{expr:"datum"});return{signal:Xut(a,r,l)}}else return K(p8(i)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const n=this.component.data.outputNodes[e];return n?n.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,n){this.signalNameMap.rename(e,n)}renameScale(e,n){this.scaleNameMap.rename(e,n)}renameProjection(e,n){this.projectionNameMap.rename(e,n)}scaleName(e,n){if(n)return this.getName(e);if(Sot(e)&&Fc(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e)))return this.scaleNameMap.get(this.getName(e))}projectionName(e){if(e)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[e];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,n){let i=this.component.selection[e];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(e,n)),!i)throw new Error(mjt(n));return i}hasAxisOrientSignalRef(){var e,n;return((e=this.component.axes.x)==null?void 0:e.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)==null?void 0:n.some(i=>i.hasOrientSignalRef()))}}class Sct extends g4{vgField(e,n={}){const i=this.fieldDef(e);if(i)return tt(i,n)}reduceFieldDef(e,n){return UVt(this.getMapping(),(i,r,s)=>{const o=Wa(r);return o?e(i,o,s):i},n)}forEachFieldDef(e,n){U8(this.getMapping(),(i,r)=>{const s=Wa(i);s&&e(s,r)},n)}}class F$ extends Oe{clone(){return new F$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Wt(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"value",i[1]??"density"]}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${le(this.transform)}`}assemble(){const{density:e,...n}=this.transform,i={type:"kde",field:e,...n};return this.transform.groupby&&(i.resolve="shared"),i}}class k$ extends Oe{clone(){return new k$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Wt(n)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return`ExtentTransform ${le(this.transform)}`}assemble(){const{extent:e,param:n}=this.transform;return{type:"extent",field:e,signal:n}}}class Z1 extends Oe{clone(){return new Z1(null,{...this.filter})}constructor(e,n){super(e),this.filter=n}static make(e,n){const{config:i,mark:r,markDef:s}=n;if(ke("invalid",s,i)!=="filter")return null;const a=n.reduceFieldDef((u,c,l)=>{const f=Fc(l)&&n.getScaleComponent(l);if(f){const d=f.get("type");ds(d)&&c.aggregate!=="count"&&!Af(r)&&(u[c.field]=c)}return u},{});return Y(a).length?new Z1(e,a):null}dependentFields(){return new Set(Y(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${le(this.filter)}`}assemble(){const e=Y(this.filter).reduce((n,i)=>{const r=this.filter[i],s=tt(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class D$ extends Oe{clone(){return new D$(this.parent,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Wt(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>r[o]??s)}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${le(this.transform)}`}assemble(){const{flatten:e,as:n}=this.transform;return{type:"flatten",fields:e,as:n}}}class C$ extends Oe{clone(){return new C$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Wt(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"key",i[1]??"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${le(this.transform)}`}assemble(){const{fold:e,as:n}=this.transform;return{type:"fold",fields:e,as:n}}}class gg extends Oe{clone(){return new gg(null,Wt(this.fields),this.geojson,this.signal)}static parseAll(e,n){if(n.component.projection&&!n.component.projection.isFit)return e;let i=0;for(const r of[[Vo,qo],[Xs,Wo]]){const s=r.map(o=>{const a=qn(n.encoding[o]);return X(a)?a.field:uu(a)?{expr:`${a.datum}`}:ko(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(e=new gg(e,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(Ur)){const r=n.typedFieldDef(Ur);r.type===Jm&&(e=new gg(e,null,r.field,n.getName(`geojson_${i++}`)))}return e}constructor(e,n,i,r){super(e),this.fields=n,this.geojson=i,this.signal=r}dependentFields(){const e=(this.fields??[]).filter(at);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${le(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class tb extends Oe{clone(){return new tb(null,this.projection,Wt(this.fields),Wt(this.as))}constructor(e,n,i,r){super(e),this.projection=n,this.fields=i,this.as=r}static parseAll(e,n){if(!n.projectionName())return e;for(const i of[[Vo,qo],[Xs,Wo]]){const r=i.map(o=>{const a=qn(n.encoding[o]);return X(a)?a.field:uu(a)?{expr:`${a.datum}`}:ko(a)?{expr:`${a.value}`}:void 0}),s=i[0]===Xs?"2":"";(r[0]||r[1])&&(e=new tb(e,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return e}dependentFields(){return new Set(this.fields.filter(at))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${le(this.fields)} ${le(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Ld extends Oe{clone(){return new Ld(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:n=0,stop:i,step:r}=e;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,n){return new Ld(e,n)}static makeFromEncoding(e,n){const i=n.encoding,r=i.x,s=i.y;if(X(r)&&X(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:u,value:c,frame:l,keyvals:f}=o.impute,d=Pat(n.mark,i);return new Ld(e,{impute:o.field,key:a.field,...u?{method:u}:{},...c!==void 0?{value:c}:{},...l?{frame:l}:{},...f!==void 0?{keyvals:f}:{},...d.length?{groupby:d}:{}})}return null}hash(){return`Impute ${le(this.transform)}`}assemble(){const{impute:e,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,u={type:"impute",field:e,key:n,...i?{keyvals:qWt(i)?this.processSequence(i):i}:{},method:"value",...s?{groupby:s}:{},value:!r||r==="value"?o:null};if(r&&r!=="value"){const c={type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:a,ignorePeers:!1,...s?{groupby:s}:{}},l={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[u,c,l]}else return[u]}}class N$ extends Oe{clone(){return new N$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Wt(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.loess]}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${le(this.transform)}`}assemble(){const{loess:e,on:n,...i}=this.transform;return{type:"loess",x:n,y:e,...i}}}class eb extends Oe{clone(){return new eb(null,Wt(this.transform),this.secondary)}constructor(e,n,i){super(e),this.transform=n,this.secondary=i}static make(e,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(VWt(o)){let u=$ct(o.data,s);u||(u=new gh(o.data),s.push(u));const c=n.getName(`lookup_${r}`);a=new nr(u,c,Ye.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[c]=a}else if(WWt(o)){const u=o.param;i={as:u,...i};let c;try{c=n.getSelectionComponent(on(u),u)}catch{throw new Error(vjt(u))}if(a=c.materialized,!a)throw new Error(wjt(u))}return new eb(e,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?ot(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${le({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e={values:this.transform.from.fields,...this.transform.as?{as:ot(this.transform.as)}:{}};else{let n=this.transform.as;at(n)||(K(Mjt),n="_lookup"),e={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...e,...this.transform.default?{default:this.transform.default}:{}}}}class O$ extends Oe{clone(){return new O$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Wt(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"prob",i[1]??"value"]}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${le(this.transform)}`}assemble(){const{quantile:e,...n}=this.transform;return{type:"quantile",field:e,...n}}}class R$ extends Oe{clone(){return new R$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Wt(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.regression]}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${le(this.transform)}`}assemble(){const{regression:e,on:n,...i}=this.transform;return{type:"regression",x:n,y:e,...i}}}class L$ extends Oe{clone(){return new L$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n}addDimensions(e){this.transform.groupby=Sa((this.transform.groupby??[]).concat(e),n=>n)}producedFields(){}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${le(this.transform)}`}assemble(){const{pivot:e,value:n,groupby:i,limit:r,op:s}=this.transform;return{type:"pivot",field:e,value:n,...r!==void 0?{limit:r}:{},...s!==void 0?{op:s}:{},...i!==void 0?{groupby:i}:{}}}}class B$ extends Oe{clone(){return new B$(null,Wt(this.transform))}constructor(e,n){super(e),this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${le(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function Ect(t){let e=0;function n(i,r){if(i instanceof gh&&!i.isGenerator&&!um(i.data)&&(t.push(r),r={name:null,source:r.name,transform:[]}),i instanceof ki&&(i.parent instanceof gh&&!r.source?(r.format={...r.format??{},parse:i.assembleFormatParse()},r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof t0){r.name||(r.name=`data_${e++}`),!r.source||r.transform.length>0?(t.push(r),i.data=r.name):i.data=r.source,t.push(...i.assemble());return}switch((i instanceof vv||i instanceof wv||i instanceof Z1||i instanceof Zm||i instanceof lm||i instanceof tb||i instanceof xo||i instanceof eb||i instanceof e0||i instanceof Bh||i instanceof C$||i instanceof D$||i instanceof F$||i instanceof N$||i instanceof O$||i instanceof R$||i instanceof rf||i instanceof B$||i instanceof L$||i instanceof k$)&&r.transform.push(i.assemble()),(i instanceof Ta||i instanceof Ma||i instanceof Ld||i instanceof nc||i instanceof gg)&&r.transform.push(...i.assemble()),i instanceof nr&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof nr?i.setSource(r.name):(r.name||(r.name=`data_${e++}`),i.setSource(r.name),i.numChildren()===1&&(t.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof nr&&(!r.source||r.transform.length>0)&&t.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${e++}`);let s=r.name;!r.source||r.transform.length>0?t.push(r):s=r.source;for(const o of i.children)n(o,{name:null,source:s,transform:[]});break}}}return n}function nXt(t){const e=[],n=Ect(e);for(const i of t.children)n(i,{source:t.name,name:null,transform:[]});return e}function iXt(t,e){const n=[],i=Ect(n);let r=0;for(const o of t.sources){o.hasName()||(o.dataName=`source_${r++}`);const a=o.assemble();i(o,a)}for(const o of n)o.transform.length===0&&delete o.transform;let s=0;for(const[o,a]of n.entries())(a.transform??[]).length===0&&!a.source&&n.splice(s++,0,n.splice(o,1)[0]);for(const o of n)for(const a of o.transform??[])a.type==="lookup"&&(a.from=t.outputNodes[a.from].getSource());for(const o of n)o.name in e&&(o.values=e[o.name]);return n}function rXt(t){return t==="top"||t==="left"||gt(t)?"header":"footer"}function sXt(t){for(const e of ks)oXt(t,e);Zz(t,"x"),Zz(t,"y")}function oXt(t,e){var o;const{facet:n,config:i,child:r,component:s}=t;if(t.channelHasField(e)){const a=n[e],u=dm("title",null,i,e);let c=hg(a,i,{allowDisabling:!0,includeDefault:u===void 0||!!u});r.component.layoutHeaders[e].title&&(c=W(c)?c.join(", "):c,c+=` / ${r.component.layoutHeaders[e].title}`,r.component.layoutHeaders[e].title=null);const l=dm("labelOrient",a.header,i,e),f=a.header!==null?Tn((o=a.header)==null?void 0:o.labels,i.header.labels,!0):!1,d=fe(["bottom","right"],l)?"footer":"header";s.layoutHeaders[e]={title:a.header!==null?c:null,facetFieldDef:a,[d]:e==="facet"?[]:[Act(t,e,f)]}}}function Act(t,e,n){const i=e==="row"?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(i)?t.child.getSizeSignalRef(i):void 0,axes:[]}}function Zz(t,e){const{child:n}=t;if(n.component.axes[e]){const{layoutHeaders:i,resolve:r}=t.component;if(r.axis[e]=u4(r,e),r.axis[e]==="shared"){const s=e==="x"?"column":"row",o=i[s];for(const a of n.component.axes[e]){const u=rXt(a.get("orient"));o[u]??(o[u]=[Act(t,s,!1)]);const c=xy(a,"main",t.config,{header:!0});c&&o[u][0].axes.push(c),a.mainExtracted=!0}}}}function aXt(t){m4(t),OS(t,"width"),OS(t,"height")}function uXt(t){m4(t);const e=t.layout.columns===1?"width":"childWidth",n=t.layout.columns===void 0?"height":"childHeight";OS(t,e),OS(t,n)}function m4(t){for(const e of t.children)e.parseLayoutSize()}function OS(t,e){const n=Kut(e),i=i$(n),r=t.component.resolve,s=t.component.layoutSize;let o;for(const a of t.children){const u=a.component.layoutSize.getWithExplicit(n),c=r.scale[i]??Qut(i,t);if(c==="independent"&&u.value==="step"){o=void 0;break}if(o){if(c==="independent"&&o.value!==u.value){o=void 0;break}o=tf(o,u,n,"")}else o=u}if(o){for(const a of t.children)t.renameSignal(a.getName(n),t.getName(e)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(e,o)}else s.setWithExplicit(e,{explicit:!1,value:void 0})}function cXt(t){const{size:e,component:n}=t;for(const i of au){const r=jr(i);if(e[r]){const s=e[r];n.layoutSize.set(r,Ga(s)?"step":s,!0)}else{const s=lXt(t,r);n.layoutSize.set(r,s,!1)}}}function lXt(t,e){const n=e==="width"?"x":"y",i=t.config,r=t.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(si(s)){const a=kS(i.view,e);return Ef(o)||Ga(a)?"step":a}else return fk(i.view,e)}else{if(t.hasProjection||t.mark==="arc")return fk(i.view,e);{const s=kS(i.view,e);return Ga(s)?s.step:s}}}function Ak(t,e,n){return tt(e,{suffix:`by_${tt(t)}`,...n??{}})}class Gy extends Sct{constructor(e,n,i,r){super(e,"facet",n,i,r,e.resolve),this.child=_4(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!pv(e))return{facet:this.initFacetFieldDef(e,"facet")};const n=Y(e),i={};for(const r of n){if(![Zu,tc].includes(r)){K(o$(r,"facet"));break}const s=e[r];if(s.field===void 0){K(ok(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(e,n){const i=P8(e,n);return i.header?i.header=Sr(i.header):i.header===null&&(i.header=null),i}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=P$(this),this.child.parseData()}parseLayoutSize(){m4(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),sXt(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){const e={};for(const n of ks)for(const i of o4){const r=this.component.layoutHeaders[n],s=r[i],{facetFieldDef:o}=r;if(o){const a=dm("titleOrient",o.header,this.config,n);if(["right","bottom"].includes(a)){const u=I$(n,a);e.titleAnchor??(e.titleAnchor={}),e.titleAnchor[u]="end"}}if(s!=null&&s[0]){const a=n==="row"?"height":"width",u=i==="header"?"headerBand":"footerBand";n!=="facet"&&!this.child.component.layoutSize.get(a)&&(e[u]??(e[u]={}),e[u][n]=.5),r.title&&(e.offset??(e.offset={}),e.offset[n==="row"?"rowTitle":"columnTitle"]=10)}}return e}assembleDefaultLayout(){const{column:e,row:n}=this.facet,i=e?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(r="none"),{...this.getHeaderLayoutMixins(),...i?{columns:i}:{},bounds:"full",align:r}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Gy))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(e){return this.parent&&this.parent instanceof Gy?{...this.channelHasField("column")?{encode:{update:{columns:{field:tt(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(e)}:super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],n=[],i=[];if(this.child instanceof Gy){if(this.child.channelHasField("column")){const r=tt(this.child.facet.column);e.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of au){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(si(o)&&Ef(a)){const u=T$(this.child,r),c=h4(u);c?(e.push(c),n.push("distinct"),i.push(`distinct_${c}`)):K(p8(r))}}}return{fields:e,ops:n,as:i}}assembleFacet(){const{name:e,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const l of ks){const f=this.facet[l];if(f){u.push(tt(f));const{bin:d,sort:h}=f;if(Xe(d)&&u.push(tt(f,{binSuffix:"end"})),Ia(h)){const{field:p,op:g=d$}=h,m=Ak(f,h);i&&r?(s.push(m),o.push("max"),a.push(m)):(s.push(p),o.push(g),a.push(m))}else if(W(h)){const p=fm(f,l);s.push(p),o.push("max"),a.push(p)}}}const c=!!i&&!!r;return{name:e,data:n,groupby:u,...c||s.length>0?{aggregate:{...c?{cross:c}:{},...s.length?{fields:s,ops:o,as:a}:{}}}:{}}}facetSortFields(e){const{facet:n}=this,i=n[e];return i?Ia(i.sort)?[Ak(i,i.sort,{expr:"datum"})]:W(i.sort)?[fm(i,e,{expr:"datum"})]:[tt(i,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:n}=this,i=n[e];if(i){const{sort:r}=i;return[(Ia(r)?r.order:!W(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var r;const{facet:e,config:n}=this;if(e.facet)return vk(e.facet,"facet",n);const i={row:["top","bottom"],column:["left","right"]};for(const s of s4)if(e[s]){const o=dm("labelOrient",(r=e[s])==null?void 0:r.header,n,s);if(i[s].includes(o))return vk(e[s],s,n)}}assembleMarks(){const{child:e}=this,n=this.component.data.facetRoot,i=nXt(n),r=e.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||e.assembleTitle(),o=e.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...s?{title:s}:{},...o?{style:o}:{},from:{facet:this.assembleFacet()},sort:{field:ks.map(u=>this.facetSortFields(u)).flat(),order:ks.map(u=>this.facetSortOrder(u)).flat()},...i.length>0?{data:i}:{},...r?{encode:{update:r}}:{},...e.assembleGroup(_Gt(this,[]))}]}getMapping(){return this.facet}}function fXt(t,e){const{row:n,column:i}=e;if(n&&i){let r=null;for(const s of[n,i])if(Ia(s.sort)){const{field:o,op:a=d$}=s.sort;t=r=new Bh(t,{joinaggregate:[{op:a,field:o,as:Ak(s,s.sort,{forAs:!0})}],groupby:[tt(s)]})}return r}return null}function $ct(t,e){var n,i,r,s;for(const o of e){const a=o.data;if(t.name&&o.hasName()&&t.name!==o.dataName)continue;const u=(n=t.format)==null?void 0:n.mesh,c=(i=a.format)==null?void 0:i.feature;if(u&&c)continue;const l=(r=t.format)==null?void 0:r.feature;if((l||c)&&l!==c)continue;const f=(s=a.format)==null?void 0:s.mesh;if(!((u||f)&&u!==f)){if(Q1(t)&&Q1(a)){if(es(t.values,a.values))return o}else if(um(t)&&um(a)){if(t.url===a.url)return o}else if(gut(t)&&t.name===o.dataName)return o}}return null}function dXt(t,e){if(t.data||!t.parent){if(t.data===null){const i=new gh({values:[]});return e.push(i),i}const n=$ct(t.data,e);if(n)return vl(t.data)||(n.data.format=fot({},t.data.format,n.data.format)),!n.hasName()&&t.data.name&&(n.dataName=t.data.name),n;{const i=new gh(t.data);return e.push(i),i}}else return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}function hXt(t,e,n){let i=0;for(const r of e.transforms){let s,o;if(eGt(r))o=t=new lm(t,r),s="derived";else if(Q8(r)){const a=rHt(r);o=t=ki.makeWithAncestors(t,{},a,n)??t,t=new Zm(t,e,r.filter)}else if(lut(r))o=t=Ta.makeFromTransform(t,r,e),s="number";else if(iGt(r))s="date",n.getWithExplicit(r.field).value===void 0&&(t=new ki(t,{[r.field]:s}),n.set(r.field,s,!1)),o=t=Ma.makeFromTransform(t,r);else if(rGt(r))o=t=xo.makeFromTransform(t,r),s="number",r4(e)&&(t=new rf(t));else if(cut(r))o=t=eb.make(t,e,r,i++),s="derived";else if(QWt(r))o=t=new e0(t,r),s="number";else if(ZWt(r))o=t=new Bh(t,r),s="number";else if(sGt(r))o=t=nc.makeFromTransform(t,r),s="derived";else if(oGt(r))o=t=new C$(t,r),s="derived";else if(aGt(r))o=t=new k$(t,r),s="derived";else if(tGt(r))o=t=new D$(t,r),s="derived";else if(GWt(r))o=t=new L$(t,r),s="derived";else if(JWt(r))t=new B$(t,r);else if(nGt(r))o=t=Ld.makeFromTransform(t,r),s="derived";else if(YWt(r))o=t=new F$(t,r),s="derived";else if(HWt(r))o=t=new O$(t,r),s="derived";else if(XWt(r))o=t=new R$(t,r),s="derived";else if(KWt(r))o=t=new N$(t,r),s="derived";else{K(Ijt(r));continue}if(o&&s!==void 0)for(const a of o.producedFields()??[])n.set(a,s,!1)}return t}function P$(t){var g;let e=dXt(t,t.component.data.sources);const{outputNodes:n,outputNodeRefCounts:i}=t.component.data,r=t.data,o=!(r&&(vl(r)||um(r)||Q1(r)))&&t.parent?t.parent.component.data.ancestorParse.clone():new vGt;vl(r)?(mut(r)?e=new wv(e,r.sequence):Z8(r)&&(e=new vv(e,r.graticule)),o.parseNothing=!0):((g=r==null?void 0:r.format)==null?void 0:g.parse)===null&&(o.parseNothing=!0),e=ki.makeExplicit(e,t,o)??e,e=new rf(e);const a=t.parent&&n0(t.parent);(wn(t)||So(t))&&a&&(e=Ta.makeFromEncoding(e,t)??e),t.transforms.length>0&&(e=hXt(e,t,o));const u=oHt(t),c=sHt(t);e=ki.makeWithAncestors(e,{},{...u,...c},o)??e,wn(t)&&(e=gg.parseAll(e,t),e=tb.parseAll(e,t)),(wn(t)||So(t))&&(a||(e=Ta.makeFromEncoding(e,t)??e),e=Ma.makeFromEncoding(e,t)??e,e=lm.parseAllForSortIndex(e,t));const l=t.getDataName(Ye.Raw),f=new nr(e,l,Ye.Raw,i);if(n[l]=f,e=f,wn(t)){const m=xo.makeFromEncoding(e,t);m&&(e=m,r4(t)&&(e=new rf(e))),e=Ld.makeFromEncoding(e,t)??e,e=nc.makeFromEncoding(e,t)??e}wn(t)&&(e=Z1.make(e,t)??e);const d=t.getDataName(Ye.Main),h=new nr(e,d,Ye.Main,i);n[d]=h,e=h,wn(t)&&eYt(t,h);let p=null;if(So(t)){const m=t.getName("facet");e=fXt(e,t.facet)??e,p=new t0(e,t,m,h.getSource()),n[m]=p}return{...t.component.data,outputNodes:n,outputNodeRefCounts:i,raw:f,main:h,facetRoot:p,ancestorParse:o}}class pXt extends g4{constructor(e,n,i,r){var s,o,a,u;super(e,"concat",n,i,r,e.resolve),(((o=(s=e.resolve)==null?void 0:s.axis)==null?void 0:o.x)==="shared"||((u=(a=e.resolve)==null?void 0:a.axis)==null?void 0:u.y)==="shared")&&K(Ejt),this.children=this.getChildren(e).map((c,l)=>_4(c,this,this.getName(`concat_${l}`),void 0,r))}parseData(){this.component.data=P$(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const n of Y(e.component.selection))this.component.selection[n]=e.component.selection[n]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return w$(e)?e.vconcat:K8(e)?e.hconcat:e.concat}parseLayoutSize(){uXt(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=a4(this);for(const n of this.children)e.push(...n.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((n,i)=>i.assembleSelectionData(n),e)}assembleMarks(){return this.children.map(e=>{const n=e.assembleTitle(),i=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return{type:"group",name:e.getName("group"),...n?{title:n}:{},...i?{style:i}:{},...r?{encode:{update:r}}:{},...e.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const e=this.layout.columns;return{...e!=null?{columns:e}:{},bounds:"full",align:"each"}}}function gXt(t){return t===!1||t===null}const mXt={disable:1,gridScale:1,scale:1,...Nat,labelExpr:1,encode:1},Ict=Y(mXt);class y4 extends Dc{constructor(e={},n={},i=!1){super(),this.explicit=e,this.implicit=n,this.mainExtracted=i}clone(){return new y4(Wt(this.explicit),Wt(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!gXt(this.get(e))}hasOrientSignalRef(){return gt(this.explicit.orient)}}function yXt(t,e,n){const{encoding:i,config:r}=t,s=qn(i[e])??qn(i[ou(e)]),o=t.axis(e)||{},{format:a,formatType:u}=o;if(dh(u))return{text:bo({fieldOrDatumDef:s,field:"datum.value",format:a,formatType:u,config:r}),...n};if(a===void 0&&u===void 0&&r.customFormatTypes){if(sm(s)==="quantitative"){if(om(s)&&s.stack==="normalize"&&r.normalizedNumberFormatType)return{text:bo({fieldOrDatumDef:s,field:"datum.value",format:r.normalizedNumberFormat,formatType:r.normalizedNumberFormatType,config:r}),...n};if(r.numberFormatType)return{text:bo({fieldOrDatumDef:s,field:"datum.value",format:r.numberFormat,formatType:r.numberFormatType,config:r}),...n}}if(sm(s)==="temporal"&&r.timeFormatType&&X(s)&&!s.timeUnit)return{text:bo({fieldOrDatumDef:s,field:"datum.value",format:r.timeFormat,formatType:r.timeFormatType,config:r}),...n}}return n}function bXt(t){return au.reduce((e,n)=>(t.component.scales[n]&&(e[n]=[AXt(n,t)]),e),{})}const vXt={bottom:"top",top:"bottom",left:"right",right:"left"};function wXt(t){const{axes:e,resolve:n}=t.component,i={top:0,bottom:0,right:0,left:0};for(const r of t.children){r.parseAxesAndHeaders();for(const s of Y(r.component.axes))n.axis[s]=u4(t.component.resolve,s),n.axis[s]==="shared"&&(e[s]=_Xt(e[s],r.component.axes[s]),e[s]||(n.axis[s]="independent",delete e[s]))}for(const r of au){for(const s of t.children)if(s.component.axes[r]){if(n.axis[r]==="independent"){e[r]=(e[r]??[]).concat(s.component.axes[r]);for(const o of s.component.axes[r]){const{value:a,explicit:u}=o.getWithExplicit("orient");if(!gt(a)){if(i[a]>0&&!u){const c=vXt[a];i[a]>i[c]&&o.set("orient",c,!1)}i[a]++}}}delete s.component.axes[r]}if(n.axis[r]==="independent"&&e[r]&&e[r].length>1)for(const[s,o]of(e[r]||[]).entries())s>0&&o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function _Xt(t,e){if(t){if(t.length!==e.length)return;const n=t.length;for(let i=0;i<n;i++){const r=t[i],s=e[i];if(!!r!=!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;t[i]=xXt(r,s)}}}else return e.map(n=>n.clone());return t}function xXt(t,e){for(const n of Ict){const i=tf(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return Pot(r,s);case"gridScale":return{explicit:r.explicit,value:Tn(r.value,s.value)}}return x$(r,s,n,"axis")});t.setWithExplicit(n,i)}return t}function SXt(t,e,n,i,r){if(e==="disable")return n!==void 0;switch(n=n||{},e){case"titleAngle":case"labelAngle":return t===(gt(n.labelAngle)?n.labelAngle:K1(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===Wut(i,r))return!0}return t===n[e]}const EXt=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function AXt(t,e){var y,b;let n=e.axis(t);const i=new y4,r=qn(e.encoding[t]),{mark:s,config:o}=e,a=(n==null?void 0:n.orient)||((y=o[t==="x"?"axisX":"axisY"])==null?void 0:y.orient)||((b=o.axis)==null?void 0:b.orient)||fYt(t),u=e.getScaleComponent(t).get("type"),c=rYt(t,u,a,e.config),l=n!==void 0?!n:yk("disable",o.style,n==null?void 0:n.style,c).configValue;if(i.set("disable",l,n!==void 0),l)return i;n=n||{};const f=uYt(r,n,t,o.style,c),d=vat(n.formatType,r,u),h=bat(r,r.type,n.format,n.formatType,o,!0),p={fieldOrDatumDef:r,axis:n,channel:t,model:e,scaleType:u,orient:a,labelAngle:f,format:h,formatType:d,mark:s,config:o};for(const v of Ict){const w=v in Bz?Bz[v](p):fz(v)?n[v]:void 0,_=w!==void 0,S=SXt(w,v,n,e,t);if(_&&S)i.set(v,w,S);else{const{configValue:x=void 0,configFrom:E=void 0}=fz(v)&&v!=="values"?yk(v,o.style,n.style,c):{},A=x!==void 0;_&&!A?i.set(v,w,S):(E!=="vgAxisConfig"||EXt.has(v)&&A||yv(x)||gt(x))&&i.set(v,x,!1)}}const g=n.encoding??{},m=Cat.reduce((v,w)=>{if(!i.hasAxisPart(w))return v;const _=Jut(g[w]??{},e),S=w==="labels"?yXt(e,t,_):_;return S!==void 0&&!Le(S)&&(v[w]={update:S}),v},{});return Le(m)||i.set("encode",m,!!n.encoding||n.labelAngle!==void 0),i}function $Xt({encoding:t,size:e}){for(const n of au){const i=jr(n);Ga(e[i])&&dl(t[n])&&(delete e[i],K(Vot(i)))}return e}const IXt={vgMark:"arc",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Fi("x",t,{defaultPos:"mid"}),...Fi("y",t,{defaultPos:"mid"}),...ef(t,"radius"),...ef(t,"theta")})},MXt={vgMark:"area",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...DS("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="horizontal"}),...DS("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="vertical"}),...i4(t)})},TXt={vgMark:"rect",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...ef(t,"x"),...ef(t,"y")})},FXt={vgMark:"shape",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:t=>{const{encoding:e}=t,n=e.shape;return[{type:"geoshape",projection:t.projectionName(),...n&&X(n)&&n.type===Jm?{field:tt(n,{expr:"datum"})}:{}}]}},kXt={vgMark:"image",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...ef(t,"x"),...ef(t,"y"),...e4(t,"url")})},DXt={vgMark:"line",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Fi("x",t,{defaultPos:"mid"}),...Fi("y",t,{defaultPos:"mid"}),...Qn("size",t,{vgChannel:"strokeWidth"}),...i4(t)})},CXt={vgMark:"trail",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Fi("x",t,{defaultPos:"mid"}),...Fi("y",t,{defaultPos:"mid"}),...Qn("size",t),...i4(t)})};function b4(t,e){const{config:n}=t;return{...Zs(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Fi("x",t,{defaultPos:"mid"}),...Fi("y",t,{defaultPos:"mid"}),...Qn("size",t),...Qn("angle",t),...NXt(t,n,e)}}function NXt(t,e,n){return n?{shape:{value:n}}:Qn("shape",t)}const OXt={vgMark:"symbol",encodeEntry:t=>b4(t)},RXt={vgMark:"symbol",encodeEntry:t=>b4(t,"circle")},LXt={vgMark:"symbol",encodeEntry:t=>b4(t,"square")},BXt={vgMark:"rect",encodeEntry:t=>({...Zs(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...ef(t,"x"),...ef(t,"y")})},PXt={vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t,n=e.orient;return!t.encoding.x&&!t.encoding.y&&!t.encoding.latitude&&!t.encoding.longitude?{}:{...Zs(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...DS("x",t,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...DS("y",t,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...Qn("size",t,{vgChannel:"strokeWidth"})}}},zXt={vgMark:"text",encodeEntry:t=>{const{config:e,encoding:n}=t;return{...Zs(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...Fi("x",t,{defaultPos:"mid"}),...Fi("y",t,{defaultPos:"mid"}),...e4(t),...Qn("size",t,{vgChannel:"fontSize"}),...Qn("angle",t),...Nz("align",UXt(t.markDef,n,e)),...Nz("baseline",jXt(t.markDef,n,e)),...Fi("radius",t,{defaultPos:null}),...Fi("theta",t,{defaultPos:null})}}};function UXt(t,e,n){if(ke("align",t,n)===void 0)return"center"}function jXt(t,e,n){if(ke("baseline",t,n)===void 0)return"middle"}const qXt={vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:n}=t,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return{...Zs(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Fi("x",t,{defaultPos:"mid",vgChannel:"xc"}),...Fi("y",t,{defaultPos:"mid",vgChannel:"yc"}),...Qn("size",t,{defaultValue:VXt(t),vgChannel:r}),[s]:Je(ke("thickness",n,e))}}};function VXt(t){const{config:e,markDef:n}=t,{orient:i}=n,r=i==="horizontal"?"width":"height",s=t.getScaleComponent(i==="horizontal"?"x":"y"),o=ke("size",n,e,{vgChannel:r})??e.tick.bandSize;if(o!==void 0)return o;{const a=s?s.get("range"):void 0;return a&&Ef(a)&&be(a.step)?a.step*3/4:FS(e.view,r)*3/4}}const Sw={arc:IXt,area:MXt,bar:TXt,circle:RXt,geoshape:FXt,image:kXt,line:DXt,point:OXt,rect:BXt,rule:PXt,square:LXt,text:zXt,tick:qXt,trail:CXt};function WXt(t){if(fe([l$,u$,Zqt],t.mark)){const e=Pat(t.mark,t.encoding);if(e.length>0)return GXt(t,e)}else if(t.mark===c$){const e=sk.some(n=>ke(n,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&e)return YXt(t)}return v4(t)}const tU="faceted_path_";function GXt(t,e){return[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:tU+t.requestDataName(Ye.Main),data:t.requestDataName(Ye.Main),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:v4(t,{fromPrefix:tU})}]}const eU="stack_group_";function YXt(t){var c;const[e]=v4(t,{fromPrefix:eU}),n=t.scaleName(t.stack.fieldChannel),i=(l={})=>t.vgField(t.stack.fieldChannel,l),r=(l,f)=>{const d=[i({prefix:"min",suffix:"start",expr:f}),i({prefix:"max",suffix:"start",expr:f}),i({prefix:"min",suffix:"end",expr:f}),i({prefix:"max",suffix:"end",expr:f})];return`${l}(${d.map(h=>`scale('${n}',${h})`).join(",")})`};let s,o;t.stack.fieldChannel==="x"?(s={...Zg(e.encode.update,["y","yc","y2","height",...sk]),x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}},o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},e.encode.update={...Mr(e.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(s={...Zg(e.encode.update,["x","xc","x2","width"]),y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}},o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},e.encode.update={...Mr(e.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const l of sk){const f=dc(l,t.markDef,t.config);e.encode.update[l]?(s[l]=e.encode.update[l],delete e.encode.update[l]):f&&(s[l]=Je(f)),f&&(e.encode.update[l]={value:0})}const a=[];if(((c=t.stack.groupbyChannels)==null?void 0:c.length)>0)for(const l of t.stack.groupbyChannels){const f=t.fieldDef(l),d=tt(f);d&&a.push(d),(f!=null&&f.bin||f!=null&&f.timeUnit)&&a.push(tt(f,{binSuffix:"end"}))}return s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((l,f)=>{if(e.encode.update[f])return{...l,[f]:e.encode.update[f]};{const d=dc(f,t.markDef,t.config);return d!==void 0?{...l,[f]:Je(d)}:l}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(Ye.Main),name:eU+t.requestDataName(Ye.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[e]}]}]}function HXt(t){var a;const{encoding:e,stack:n,mark:i,markDef:r,config:s}=t,o=e.order;if(!(!W(o)&&ko(o)&&ik(o.value)||!o&&ik(ke("order",r,s)))){if((W(o)||X(o))&&!n)return Rot(o,{expr:"datum"});if(Af(i)){const u=r.orient==="horizontal"?"y":"x",c=e[u];if(X(c)){const l=c.sort;if(W(l))return{field:tt(c,{prefix:u,suffix:"sort_index",expr:"datum"})};if(Ia(l))return{field:tt({aggregate:z8(t.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(_at(l)){const f=t.fieldDef(l.encoding);return{field:tt(f,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:tt(c,{binSuffix:(a=t.stack)!=null&&a.impute?"mid":void 0,expr:"datum"})}}return}}}function v4(t,e={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=t,o=Tn(i.clip,XXt(t),KXt(t)),a=Not(i),u=r.key,c=HXt(t),l=JXt(t),f=ke("aria",i,s),d=Sw[n].postEncodingTransform?Sw[n].postEncodingTransform(t):null;return[{name:t.getName("marks"),type:Sw[n].vgMark,...o?{clip:!0}:{},...a?{style:a}:{},...u?{key:u.field}:{},...c?{sort:c}:{},...l||{},...f===!1?{aria:f}:{},from:{data:e.fromPrefix+t.requestDataName(Ye.Main)},encode:{update:Sw[n].encodeEntry(t)},...d?{transform:d}:{}}]}function XXt(t){const e=t.getScaleComponent("x"),n=t.getScaleComponent("y");return e!=null&&e.get("selectionExtent")||n!=null&&n.get("selectionExtent")?!0:void 0}function KXt(t){const e=t.component.projection;return e&&!e.isFit?!0:void 0}function JXt(t){if(!t.component.selection)return null;const e=Y(t.component.selection).length;let n=e,i=t.parent;for(;i&&n===0;)n=Y(i.component.selection).length,i=i.parent;return n?{interactive:e>0||t.mark==="geoshape"||!!t.encoding.tooltip}:null}class Mct extends Sct{constructor(e,n,i,r={},s){super(e,"unit",n,i,s,void 0,hz(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const o=Va(e.mark)?{...e.mark}:{type:e.mark},a=o.type;o.filled===void 0&&(o.filled=OWt(o,s,{graticule:e.data&&Z8(e.data)}));const u=this.encoding=PVt(e.encoding||{},a,o.filled,s);this.markDef=out(o,u,s),this.size=$Xt({encoding:u,size:hz(e)?{...r,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}}:r}),this.stack=sut(this.markDef,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegends(u),this.specifiedProjection=e.projection,this.selection=(e.params??[]).filter(c=>H8(c))}get hasProjection(){const{encoding:e}=this,n=this.mark===hat,i=e&&BUt.some(r=>Xt(e[r]));return n||i}scaleDomain(e){const n=this.specifiedScales[e];return n?n.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,n){return r$.reduce((i,r)=>{const s=qn(n[r]);return s&&(i[r]=this.initScale(s.scale??{})),i},{})}initScale(e){const{domain:n,range:i}=e,r=Sr(e);return W(n)&&(r.domain=n.map(Jr)),W(i)&&(r.range=i.map(Jr)),r}initAxes(e){return au.reduce((n,i)=>{const r=e[i];if(Xt(r)||i===an&&Xt(e.x2)||i===ai&&Xt(e.y2)){const s=Xt(r)?r.axis:void 0;n[i]=s&&this.initAxis({...s})}return n},{})}initAxis(e){const n=Y(e),i={};for(const r of n){const s=e[r];i[r]=yv(s)?Cot(s):Jr(s)}return i}initLegends(e){return HUt.reduce((n,i)=>{const r=qn(e[i]);if(r&&KUt(i)){const s=r.legend;n[i]=s&&Sr(s)}return n},{})}parseData(){this.component.data=P$(this)}parseLayoutSize(){cXt(this)}parseSelections(){this.component.selection=tYt(this,this.selection)}parseMarkGroup(){this.component.mark=WXt(this)}parseAxesAndHeaders(){this.component.axes=bXt(this)}assembleSelectionTopLevelSignals(e){return xGt(this,e)}assembleSignals(){return[...jut(this),...wGt(this,[])]}assembleSelectionData(e){return SGt(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return a4(this)}assembleMarks(){let e=this.component.mark??[];return(!this.parent||!n0(this.parent))&&(e=vut(this,e)),e.map(this.correctDataNames)}assembleGroupStyle(){const{style:e}=this.view||{};return e!==void 0?e:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return Od(this.encoding,e)}fieldDef(e){const n=this.encoding[e];return Wa(n)}typedFieldDef(e){const n=this.fieldDef(e);return cr(n)?n:null}}class w4 extends g4{constructor(e,n,i,r,s){super(e,"layer",n,i,s,e.resolve,e.view);const o={...r,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}};this.children=e.layer.map((a,u)=>{if(_$(a))return new w4(a,this,this.getName(`layer_${u}`),o,s);if(kc(a))return new Mct(a,this,this.getName(`layer_${u}`),o,s);throw new Error(h8(a))})}parseData(){this.component.data=P$(this);for(const e of this.children)e.parseData()}parseLayoutSize(){aXt(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const n of Y(e.component.selection))this.component.selection[n]=e.component.selection[n]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){wXt(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),e)}assembleSignals(){return this.children.reduce((e,n)=>e.concat(n.assembleSignals()),jut(this))}assembleLayoutSignals(){return this.children.reduce((e,n)=>e.concat(n.assembleLayoutSignals()),a4(this))}assembleSelectionData(e){return this.children.reduce((n,i)=>i.assembleSelectionData(n),e)}assembleGroupStyle(){const e=new Set;for(const i of this.children)for(const r of ot(i.assembleGroupStyle()))e.add(r);const n=Array.from(e);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const n of this.children)if(e=n.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return EGt(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,n)=>e.concat(n.assembleLegends()),sct(this))}}function _4(t,e,n,i,r){if(h$(t))return new Gy(t,e,n,r);if(_$(t))return new w4(t,e,n,i,r);if(kc(t))return new Mct(t,e,n,i,r);if(cWt(t))return new pXt(t,e,n,r);throw new Error(h8(t))}function QXt(t,e={}){e.logger&&pqt(e.logger),e.fieldTitle&&Fat(e.fieldTitle);try{const n=rut(Pm(e.config,t.config)),i=hut(t,n),r=_4(i,null,"",void 0,n);return r.parse(),xHt(r.component.data,r),{spec:tKt(r,ZXt(t,i.autosize,n,r),t.datasets,t.usermeta),normalized:i}}finally{e.logger&&gqt(),e.fieldTitle&&FVt()}}function ZXt(t,e,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(e===void 0?(e={type:"pad"},i.hasAxisOrientSignalRef()&&(e.resize=!0)):at(e)&&(e={type:e}),r&&s&&mGt(e.type)){if(r==="step"&&s==="step")K(JP()),e.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";K(JP(i$(o)));const a=o==="width"?"height":"width";e.type=yGt(a)}}return{...Y(e).length===1&&e.type?e.type==="pad"?{}:{autosize:e.type}:{autosize:e},...Az(n,!1),...Az(t,!0)}}function tKt(t,e,n={},i){const r=t.config?SWt(t.config):void 0,s=[].concat(t.assembleSelectionData([]),iXt(t.component.data,n)),o=t.assembleProjections(),a=t.assembleTitle(),u=t.assembleGroupStyle(),c=t.assembleGroupEncodeEntry(!0);let l=t.assembleLayoutSignals();l=l.filter(h=>(h.name==="width"||h.name==="height")&&h.value!==void 0?(e[h.name]=+h.value,!1):!0);const{params:f,...d}=e;return{$schema:"https://vega.github.io/schema/vega/v5.json",...t.description?{description:t.description}:{},...d,...a?{title:a}:{},...u?{style:u}:{},...c?{encode:{update:c}}:{},data:s,...o.length>0?{projections:o}:{},...t.assembleGroup([...l,...t.assembleSelectionTopLevelSignals([]),...tut(f)]),...r?{config:r}:{},...i?{usermeta:i}:{}}}const eKt=DUt.version,nKt=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:tm,accessPathWithDatum:i8,compile:QXt,contains:fe,deepEqual:es,deleteNestedProperty:wS,duplicate:Wt,entries:Jl,every:t8,fieldIntersection:n8,flatAccessWithDatum:hot,getFirstDefined:Tn,hasIntersection:e8,hash:le,internalField:mot,isBoolean:X1,isEmpty:Le,isEqual:NUt,isInternalField:yot,isNullOrFalse:ik,isNumeric:JA,keys:Y,logicalExpr:Vy,mergeDeep:fot,never:lot,normalize:hut,normalizeAngle:K1,omit:Mr,pick:Zg,prefixGenerator:rk,removePathFromField:r8,replaceAll:ah,replacePathInField:Hs,resetIdCounter:RUt,setEqual:dot,some:oh,stringify:Be,titleCase:av,unique:Sa,uniqueId:got,vals:mi,varName:on,version:eKt},Symbol.toStringTag,{value:"Module"}));function Tct(t){const[e,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e,version:n}}var iKt="vega-themes",rKt="2.14.0",sKt="Themes for stylized Vega and Vega-Lite visualizations.",oKt=["vega","vega-lite","themes","style"],aKt="BSD-3-Clause",uKt={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},cKt=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],lKt="build/vega-themes.js",x4="build/vega-themes.module.js",fKt="build/vega-themes.min.js",dKt="build/vega-themes.min.js",hKt="build/vega-themes.module.d.ts",pKt={type:"git",url:"https://github.com/vega/vega-themes.git"},gKt=["src","build"],mKt={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},yKt={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@typescript-eslint/eslint-plugin":"^6.0.0","@typescript-eslint/parser":"^6.0.0","browser-sync":"^2.29.3",concurrently:"^8.2.0",eslint:"^8.45.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^5.0.0","gh-pages":"^5.0.0",prettier:"^3.0.0","release-it":"^16.1.0",rollup:"^3.26.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.1.6",vega:"^5.25.0","vega-lite":"^5.9.3"},bKt={vega:"*","vega-lite":"*"},vKt={},wKt={name:iKt,version:rKt,description:sKt,keywords:oKt,license:aKt,author:uKt,contributors:cKt,main:lKt,module:x4,unpkg:fKt,jsdelivr:dKt,types:hKt,repository:pKt,files:gKt,scripts:mKt,devDependencies:yKt,peerDependencies:bKt,dependencies:vKt};const up="#fff",nU="#888",_Kt={background:"#333",view:{stroke:nU},title:{color:up,subtitleColor:up},style:{"guide-label":{fill:up},"guide-title":{fill:up}},axis:{domainColor:up,gridColor:nU,tickColor:up}},Df="#4572a7",xKt={background:"#fff",arc:{fill:Df},area:{fill:Df},line:{stroke:Df,strokeWidth:2},path:{stroke:Df},rect:{fill:Df},shape:{stroke:Df},symbol:{fill:Df,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Cf="#30a2da",K3="#cbcbcb",SKt="#999",EKt="#333",iU="#f0f0f0",rU="#333",AKt={arc:{fill:Cf},area:{fill:Cf},axis:{domainColor:K3,grid:!0,gridColor:K3,gridWidth:1,labelColor:SKt,labelFontSize:10,titleColor:EKt,tickColor:K3,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:iU,group:{fill:iU},legend:{labelColor:rU,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:rU,titleFontSize:14,titlePadding:10},line:{stroke:Cf,strokeWidth:2},path:{stroke:Cf,strokeWidth:.5},rect:{fill:Cf},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Cf},bar:{binSpacing:2,fill:Cf,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Nf="#000",$Kt={group:{fill:"#e5e5e5"},arc:{fill:Nf},area:{fill:Nf},line:{stroke:Nf},path:{stroke:Nf},rect:{fill:Nf},shape:{stroke:Nf},symbol:{fill:Nf,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},IKt=22,MKt="normal",sU="Benton Gothic, sans-serif",oU=11.5,TKt="normal",Of="#82c6df",J3="Benton Gothic Bold, sans-serif",aU="normal",uU=13,N0={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},FKt={background:"#ffffff",title:{anchor:"start",color:"#000000",font:J3,fontSize:IKt,fontWeight:MKt},arc:{fill:Of},area:{fill:Of},line:{stroke:Of,strokeWidth:2},path:{stroke:Of},rect:{fill:Of},shape:{stroke:Of},symbol:{fill:Of,size:30},axis:{labelFont:sU,labelFontSize:oU,labelFontWeight:TKt,titleFont:J3,titleFontSize:uU,titleFontWeight:aU},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:sU,labelFontSize:oU,symbolType:"square",titleFont:J3,titleFontSize:uU,titleFontWeight:aU},range:{category:N0["category-6"],diverging:N0["fireandice-6"],heatmap:N0["fire-7"],ordinal:N0["fire-7"],ramp:N0["fire-7"]}},Rf="#ab5787",Ew="#979797",kKt={background:"#f9f9f9",arc:{fill:Rf},area:{fill:Rf},line:{stroke:Rf},path:{stroke:Rf},rect:{fill:Rf},shape:{stroke:Rf},symbol:{fill:Rf,size:30},axis:{domainColor:Ew,domainWidth:.5,gridWidth:.2,labelColor:Ew,tickColor:Ew,tickWidth:.2,titleColor:Ew},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Lf="#3e5c69",DKt={background:"#fff",arc:{fill:Lf},area:{fill:Lf},line:{stroke:Lf},path:{stroke:Lf},rect:{fill:Lf},shape:{stroke:Lf},symbol:{fill:Lf},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},bs="#1696d2",cU="#000000",CKt="#FFFFFF",Aw="Lato",Q3="Lato",NKt="Lato",OKt="#DEDDDD",RKt=18,O0={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},LKt={background:CKt,title:{anchor:"start",fontSize:RKt,font:Aw},axisX:{domain:!0,domainColor:cU,domainWidth:1,grid:!1,labelFontSize:12,labelFont:Q3,labelAngle:0,tickColor:cU,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Aw},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:OKt,gridWidth:1,labelFontSize:12,labelFont:Q3,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Aw,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:Q3,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Aw,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:O0["six-groups-cat-1"],diverging:O0["diverging-colors"],heatmap:O0["diverging-colors"],ordinal:O0["six-groups-seq"],ramp:O0["shades-blue"]},area:{fill:bs},rect:{fill:bs},line:{color:bs,stroke:bs,strokeWidth:5},trail:{color:bs,stroke:bs,strokeWidth:0,size:1},path:{stroke:bs,strokeWidth:.5},point:{filled:!0},text:{font:NKt,color:bs,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:bs,stroke:null}},arc:{fill:bs},shape:{stroke:bs},symbol:{fill:bs,size:30}},Bf="#3366CC",lU="#ccc",$w="Arial, sans-serif",BKt={arc:{fill:Bf},area:{fill:Bf},path:{stroke:Bf},rect:{fill:Bf},shape:{stroke:Bf},symbol:{stroke:Bf},circle:{fill:Bf},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:$w,fontSize:12},"guide-title":{font:$w,fontSize:12},"group-title":{font:$w,fontSize:12}},title:{font:$w,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:lU,tickColor:lU,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},S4=t=>t*(1/3+1),fU=S4(9),dU=S4(10),hU=S4(12),R0="Segoe UI",pU="wf_standard-font, helvetica, arial, sans-serif",gU="#252423",L0="#605E5C",mU="transparent",PKt="#C8C6C4",io="#118DFF",zKt="#12239E",UKt="#E66C37",jKt="#6B007B",qKt="#E044A7",VKt="#744EC2",WKt="#D9B300",GKt="#D64550",Fct=io,kct="#DEEFFF",yU=[kct,Fct],YKt=[kct,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",Fct],HKt={view:{stroke:mU},background:mU,font:R0,header:{titleFont:pU,titleFontSize:hU,titleColor:gU,labelFont:R0,labelFontSize:dU,labelColor:L0},axis:{ticks:!1,grid:!1,domain:!1,labelColor:L0,labelFontSize:fU,titleFont:pU,titleColor:gU,titleFontSize:hU,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:PKt,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:io},line:{stroke:io,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:R0,fontSize:fU,fill:L0},arc:{fill:io},area:{fill:io,line:!0,opacity:.6},path:{stroke:io},rect:{fill:io},point:{fill:io,filled:!0,size:75},shape:{stroke:io},symbol:{fill:io,strokeWidth:1.5,size:50},legend:{titleFont:R0,titleFontWeight:"bold",titleColor:L0,labelFont:R0,labelFontSize:dU,labelColor:L0,symbolType:"circle",symbolSize:75},range:{category:[io,zKt,UKt,jKt,qKt,VKt,WKt,GKt],diverging:yU,heatmap:yU,ordinal:YKt}},Z3='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',bU=400,XKt=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],KKt=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function z$({type:t,background:e}){const n=t==="dark"?"#161616":"#ffffff",i=t==="dark"?"#f4f4f4":"#161616",r=t==="dark"?XKt:KKt,s=t==="dark"?"#d4bbff":"#6929c4";return{background:e,arc:{fill:s},area:{fill:s},path:{stroke:s},rect:{fill:s},shape:{stroke:s},symbol:{stroke:s},circle:{fill:s},view:{fill:n,stroke:n},group:{fill:n},title:{color:i,anchor:"start",dy:-15,fontSize:16,font:Z3,fontWeight:600},axis:{labelColor:i,labelFontSize:12,grid:!0,gridColor:"#525252",titleColor:i,labelAngle:0},style:{"guide-label":{font:Z3,fill:i,fontWeight:bU},"guide-title":{font:Z3,fill:i,fontWeight:bU}},range:{category:r,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const JKt=z$({type:"light",background:"#ffffff"}),QKt=z$({type:"light",background:"#f4f4f4"}),ZKt=z$({type:"dark",background:"#262626"}),tJt=z$({type:"dark",background:"#161616"}),eJt=wKt.version,nJt=Object.freeze(Object.defineProperty({__proto__:null,carbong10:QKt,carbong100:tJt,carbong90:ZKt,carbonwhite:JKt,dark:_Kt,excel:xKt,fivethirtyeight:AKt,ggplot2:$Kt,googlecharts:BKt,latimes:FKt,powerbi:HKt,quartz:kKt,urbaninstitute:LKt,version:eJt,vox:DKt},Symbol.toStringTag,{value:"Module"}));function iJt(t,e,n,i){if(W(t))return`[${t.map(r=>e(at(r)?r:vU(r,n))).join(", ")}]`;if(ut(t)){let r="";const{title:s,image:o,...a}=t;s&&(r+=`<h2>${e(s)}</h2>`),o&&(r+=`<img src="${new URL(e(o),i||location.href).href}">`);const u=Object.keys(a);if(u.length>0){r+="<table>";for(const c of u){let l=a[c];l!==void 0&&(ut(l)&&(l=vU(l,n)),r+=`<tr><td class="key">${e(c)}</td><td class="value">${e(l)}</td></tr>`)}r+="</table>"}return r||"{}"}return e(t)}function rJt(t){const e=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=e.indexOf(this)+1;return e.length=r,e.length>t?"[Object]":e.indexOf(i)>=0?"[Circular]":(e.push(i),i)}}function vU(t,e){return JSON.stringify(t,rJt(e))}var sJt=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black;
}
#vg-tooltip-element.visible {
  visibility: visible;
}
#vg-tooltip-element h2 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 13px;
}
#vg-tooltip-element table {
  border-spacing: 0;
}
#vg-tooltip-element table tr {
  border: none;
}
#vg-tooltip-element table tr td {
  overflow: hidden;
  text-overflow: ellipsis;
  padding-top: 2px;
  padding-bottom: 2px;
}
#vg-tooltip-element table tr td.key {
  color: #808080;
  max-width: 150px;
  text-align: right;
  padding-right: 4px;
}
#vg-tooltip-element table tr td.value {
  display: block;
  max-width: 300px;
  max-height: 7em;
  text-align: left;
}
#vg-tooltip-element.dark-theme {
  background-color: rgba(32, 32, 32, 0.9);
  border: 1px solid #f5f5f5;
  color: white;
}
#vg-tooltip-element.dark-theme td.key {
  color: #bfbfbf;
}
`;const Dct="vg-tooltip-element",oJt={offsetX:10,offsetY:10,id:Dct,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:aJt,maxDepth:2,formatTooltip:iJt,baseURL:""};function aJt(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function uJt(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw new Error("Invalid HTML ID");return sJt.toString().replace(Dct,t)}function cJt(t,e,n,i){let r=t.clientX+n;r+e.width>window.innerWidth&&(r=+t.clientX-n-e.width);let s=t.clientY+i;return s+e.height>window.innerHeight&&(s=+t.clientY-i-e.height),{x:r,y:s}}class lJt{constructor(e){this.options={...oJt,...e};const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=uJt(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(e,n,i,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),(document.fullscreenElement??document.body).appendChild(this.el)),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth,this.options.baseURL),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:s,y:o}=cJt(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.style.top=`${o}px`,this.el.style.left=`${s}px`}}var tM={};function fJt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var eM,wU;function dJt(){return wU||(wU=1,eM=function(t){t.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}),eM}var hJt=Se;Se.Node=mh;Se.create=Se;function Se(t){var e=this;if(e instanceof Se||(e=new Se),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(r){e.push(r)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)e.push(arguments[n]);return e}Se.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e};Se.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};Se.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};Se.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)gJt(this,arguments[t]);return this.length};Se.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)mJt(this,arguments[t]);return this.length};Se.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};Se.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};Se.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,i=0;n!==null;i++)t.call(e,n.value,i,this),n=n.next};Se.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,i=this.length-1;n!==null;i--)t.call(e,n.value,i,this),n=n.prev};Se.prototype.get=function(t){for(var e=0,n=this.head;n!==null&&e<t;e++)n=n.next;if(e===t&&n!==null)return n.value};Se.prototype.getReverse=function(t){for(var e=0,n=this.tail;n!==null&&e<t;e++)n=n.prev;if(e===t&&n!==null)return n.value};Se.prototype.map=function(t,e){e=e||this;for(var n=new Se,i=this.head;i!==null;)n.push(t.call(e,i.value,this)),i=i.next;return n};Se.prototype.mapReverse=function(t,e){e=e||this;for(var n=new Se,i=this.tail;i!==null;)n.push(t.call(e,i.value,this)),i=i.prev;return n};Se.prototype.reduce=function(t,e){var n,i=this.head;if(arguments.length>1)n=e;else if(this.head)i=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)n=t(n,i.value,r),i=i.next;return n};Se.prototype.reduceReverse=function(t,e){var n,i=this.tail;if(arguments.length>1)n=e;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)n=t(n,i.value,r),i=i.prev;return n};Se.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;n!==null;e++)t[e]=n.value,n=n.next;return t};Se.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;n!==null;e++)t[e]=n.value,n=n.prev;return t};Se.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var n=new Se;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=0,r=this.head;r!==null&&i<t;i++)r=r.next;for(;r!==null&&i<e;i++,r=r.next)n.push(r.value);return n};Se.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var n=new Se;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=this.length,r=this.tail;r!==null&&i>e;i--)r=r.prev;for(;r!==null&&i>t;i--,r=r.prev)n.push(r.value);return n};Se.prototype.splice=function(t,e,...n){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var i=0,r=this.head;r!==null&&i<t;i++)r=r.next;for(var s=[],i=0;r&&i<e;i++)s.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<n.length;i++)r=pJt(this,r,n[i]);return s};Se.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;n!==null;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=e,this.tail=t,this};function pJt(t,e,n){var i=e===t.head?new mh(n,null,e,t):new mh(n,e,e.next,t);return i.next===null&&(t.tail=i),i.prev===null&&(t.head=i),t.length++,i}function gJt(t,e){t.tail=new mh(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function mJt(t,e){t.head=new mh(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function mh(t,e,n,i){if(!(this instanceof mh))return new mh(t,e,n,i);this.list=i,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{dJt()(Se)}catch{}const yJt=hJt,ld=Symbol("max"),Bu=Symbol("length"),cp=Symbol("lengthCalculator"),Yy=Symbol("allowStale"),Ed=Symbol("maxAge"),Nu=Symbol("dispose"),_U=Symbol("noDisposeOnSet"),Xn=Symbol("lruList"),ro=Symbol("cache"),Cct=Symbol("updateAgeOnGet"),nM=()=>1;class bJt{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[ld]=e.max||1/0;const n=e.length||nM;if(this[cp]=typeof n!="function"?nM:n,this[Yy]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[Ed]=e.maxAge||0,this[Nu]=e.dispose,this[_U]=e.noDisposeOnSet||!1,this[Cct]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[ld]=e||1/0,B0(this)}get max(){return this[ld]}set allowStale(e){this[Yy]=!!e}get allowStale(){return this[Yy]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[Ed]=e,B0(this)}get maxAge(){return this[Ed]}set lengthCalculator(e){typeof e!="function"&&(e=nM),e!==this[cp]&&(this[cp]=e,this[Bu]=0,this[Xn].forEach(n=>{n.length=this[cp](n.value,n.key),this[Bu]+=n.length})),B0(this)}get lengthCalculator(){return this[cp]}get length(){return this[Bu]}get itemCount(){return this[Xn].length}rforEach(e,n){n=n||this;for(let i=this[Xn].tail;i!==null;){const r=i.prev;xU(this,e,i,n),i=r}}forEach(e,n){n=n||this;for(let i=this[Xn].head;i!==null;){const r=i.next;xU(this,e,i,n),i=r}}keys(){return this[Xn].toArray().map(e=>e.key)}values(){return this[Xn].toArray().map(e=>e.value)}reset(){this[Nu]&&this[Xn]&&this[Xn].length&&this[Xn].forEach(e=>this[Nu](e.key,e.value)),this[ro]=new Map,this[Xn]=new yJt,this[Bu]=0}dump(){return this[Xn].map(e=>RS(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[Xn]}set(e,n,i){if(i=i||this[Ed],i&&typeof i!="number")throw new TypeError("maxAge must be a number");const r=i?Date.now():0,s=this[cp](n,e);if(this[ro].has(e)){if(s>this[ld])return mg(this,this[ro].get(e)),!1;const u=this[ro].get(e).value;return this[Nu]&&(this[_U]||this[Nu](e,u.value)),u.now=r,u.maxAge=i,u.value=n,this[Bu]+=s-u.length,u.length=s,this.get(e),B0(this),!0}const o=new vJt(e,n,s,r,i);return o.length>this[ld]?(this[Nu]&&this[Nu](e,n),!1):(this[Bu]+=o.length,this[Xn].unshift(o),this[ro].set(e,this[Xn].head),B0(this),!0)}has(e){if(!this[ro].has(e))return!1;const n=this[ro].get(e).value;return!RS(this,n)}get(e){return iM(this,e,!0)}peek(e){return iM(this,e,!1)}pop(){const e=this[Xn].tail;return e?(mg(this,e),e.value):null}del(e){mg(this,this[ro].get(e))}load(e){this.reset();const n=Date.now();for(let i=e.length-1;i>=0;i--){const r=e[i],s=r.e||0;if(s===0)this.set(r.k,r.v);else{const o=s-n;o>0&&this.set(r.k,r.v,o)}}}prune(){this[ro].forEach((e,n)=>iM(this,n,!1))}}const iM=(t,e,n)=>{const i=t[ro].get(e);if(i){const r=i.value;if(RS(t,r)){if(mg(t,i),!t[Yy])return}else n&&(t[Cct]&&(i.value.now=Date.now()),t[Xn].unshiftNode(i));return r.value}},RS=(t,e)=>{if(!e||!e.maxAge&&!t[Ed])return!1;const n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[Ed]&&n>t[Ed]},B0=t=>{if(t[Bu]>t[ld])for(let e=t[Xn].tail;t[Bu]>t[ld]&&e!==null;){const n=e.prev;mg(t,e),e=n}},mg=(t,e)=>{if(e){const n=e.value;t[Nu]&&t[Nu](n.key,n.value),t[Bu]-=n.length,t[ro].delete(n.key),t[Xn].removeNode(e)}};class vJt{constructor(e,n,i,r,s){this.key=e,this.value=n,this.length=i,this.now=r,this.maxAge=s||0}}const xU=(t,e,n,i)=>{let r=n.value;RS(t,r)&&(mg(t,n),t[Yy]||(r=void 0)),r&&e.call(i,r.value,r.key,t)};var wJt=bJt;const _Jt=Object.freeze({loose:!0}),xJt=Object.freeze({}),SJt=t=>t?typeof t!="object"?_Jt:t:xJt;var E4=SJt,$k={exports:{}};const EJt="2.0.0",Nct=256,AJt=Number.MAX_SAFE_INTEGER||9007199254740991,$Jt=16,IJt=Nct-6,MJt=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var A4={MAX_LENGTH:Nct,MAX_SAFE_COMPONENT_LENGTH:$Jt,MAX_SAFE_BUILD_LENGTH:IJt,MAX_SAFE_INTEGER:AJt,RELEASE_TYPES:MJt,SEMVER_SPEC_VERSION:EJt,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const TJt=typeof process=="object"&&tM&&tM.NODE_DEBUG&&/\bsemver\b/i.test(tM.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var U$=TJt;(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:r}=A4,s=U$;e=t.exports={};const o=e.re=[],a=e.safeRe=[],u=e.src=[],c=e.t={};let l=0;const f="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",r],[f,i]],h=g=>{for(const[m,y]of d)g=g.split(`${m}*`).join(`${m}{0,${y}}`).split(`${m}+`).join(`${m}{1,${y}}`);return g},p=(g,m,y)=>{const b=h(m),v=l++;s(g,v,m),c[g]=v,u[v]=m,o[v]=new RegExp(m,y?"g":void 0),a[v]=new RegExp(b,y?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),p("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${f}+`),p("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),p("FULL",`^${u[c.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),p("LOOSE",`^${u[c.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),p("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),p("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),p("COERCERTL",u[c.COERCE],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",p("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",p("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})($k,$k.exports);var $4=$k.exports;const SU=/^[0-9]+$/,Oct=(t,e)=>{const n=SU.test(t),i=SU.test(e);return n&&i&&(t=+t,e=+e),t===e?0:n&&!i?-1:i&&!n?1:t<e?-1:1},FJt=(t,e)=>Oct(e,t);var kJt={compareIdentifiers:Oct,rcompareIdentifiers:FJt};const Iw=U$,{MAX_LENGTH:EU,MAX_SAFE_INTEGER:Mw}=A4,{safeRe:AU,t:$U}=$4,DJt=E4,{compareIdentifiers:lp}=kJt;let CJt=class Zo{constructor(e,n){if(n=DJt(n),e instanceof Zo){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>EU)throw new TypeError(`version is longer than ${EU} characters`);Iw("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const i=e.trim().match(n.loose?AU[$U.LOOSE]:AU[$U.FULL]);if(!i)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Mw||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Mw||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Mw||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const s=+r;if(s>=0&&s<Mw)return s}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Iw("SemVer.compare",this.version,this.options,e),!(e instanceof Zo)){if(typeof e=="string"&&e===this.version)return 0;e=new Zo(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Zo||(e=new Zo(e,this.options)),lp(this.major,e.major)||lp(this.minor,e.minor)||lp(this.patch,e.patch)}comparePre(e){if(e instanceof Zo||(e=new Zo(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{const i=this.prerelease[n],r=e.prerelease[n];if(Iw("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return lp(i,r)}while(++n)}compareBuild(e){e instanceof Zo||(e=new Zo(e,this.options));let n=0;do{const i=this.build[n],r=e.build[n];if(Iw("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return lp(i,r)}while(++n)}inc(e,n,i){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,i),this.inc("pre",n,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,i),this.inc("pre",n,i);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const r=Number(i)?1:0;if(!n&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[r];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(n===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(r)}}if(n){let s=[n,r];i===!1&&(s=[n]),lp(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var I4=CJt;const IU=I4,NJt=(t,e,n)=>new IU(t,n).compare(new IU(e,n));var i0=NJt;const OJt=i0,RJt=(t,e,n)=>OJt(t,e,n)===0;var LJt=RJt;const BJt=i0,PJt=(t,e,n)=>BJt(t,e,n)!==0;var zJt=PJt;const UJt=i0,jJt=(t,e,n)=>UJt(t,e,n)>0;var qJt=jJt;const VJt=i0,WJt=(t,e,n)=>VJt(t,e,n)>=0;var GJt=WJt;const YJt=i0,HJt=(t,e,n)=>YJt(t,e,n)<0;var XJt=HJt;const KJt=i0,JJt=(t,e,n)=>KJt(t,e,n)<=0;var QJt=JJt;const ZJt=LJt,tQt=zJt,eQt=qJt,nQt=GJt,iQt=XJt,rQt=QJt,sQt=(t,e,n,i)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return ZJt(t,n,i);case"!=":return tQt(t,n,i);case">":return eQt(t,n,i);case">=":return nQt(t,n,i);case"<":return iQt(t,n,i);case"<=":return rQt(t,n,i);default:throw new TypeError(`Invalid operator: ${e}`)}};var oQt=sQt,rM,MU;function aQt(){if(MU)return rM;MU=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(l,f){if(f=n(f),l instanceof e){if(l.loose===!!f.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),o("comparator",l,f),this.options=f,this.loose=!!f.loose,this.parse(l),this.semver===t?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(l){const f=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],d=l.match(f);if(!d)throw new TypeError(`Invalid comparator: ${l}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new a(d[2],this.options.loose):this.semver=t}toString(){return this.value}test(l){if(o("Comparator.test",l,this.options.loose),this.semver===t||l===t)return!0;if(typeof l=="string")try{l=new a(l,this.options)}catch{return!1}return s(l,this.operator,this.semver,this.options)}intersects(l,f){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(l.value,f).test(this.value):l.operator===""?l.value===""?!0:new u(this.value,f).test(l.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||s(this.semver,"<",l.semver,f)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||s(this.semver,">",l.semver,f)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}rM=e;const n=E4,{safeRe:i,t:r}=$4,s=oQt,o=U$,a=I4,u=Rct();return rM}var sM,TU;function Rct(){if(TU)return sM;TU=1;class t{constructor(M,F){if(F=i(F),M instanceof t)return M.loose===!!F.loose&&M.includePrerelease===!!F.includePrerelease?M:new t(M.raw,F);if(M instanceof r)return this.raw=M.value,this.set=[[M]],this.format(),this;if(this.options=F,this.loose=!!F.loose,this.includePrerelease=!!F.includePrerelease,this.raw=M.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(D=>this.parseRange(D.trim())).filter(D=>D.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const D=this.set[0];if(this.set=this.set.filter(N=>!p(N[0])),this.set.length===0)this.set=[D];else if(this.set.length>1){for(const N of this.set)if(N.length===1&&g(N[0])){this.set=[N];break}}}this.format()}format(){return this.range=this.set.map(M=>M.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(M){const D=((this.options.includePrerelease&&d)|(this.options.loose&&h))+":"+M,N=n.get(D);if(N)return N;const R=this.options.loose,L=R?a[u.HYPHENRANGELOOSE]:a[u.HYPHENRANGE];M=M.replace(L,I(this.options.includePrerelease)),s("hyphen replace",M),M=M.replace(a[u.COMPARATORTRIM],c),s("comparator trim",M),M=M.replace(a[u.TILDETRIM],l),s("tilde trim",M),M=M.replace(a[u.CARETTRIM],f),s("caret trim",M);let B=M.split(" ").map(nt=>y(nt,this.options)).join(" ").split(/\s+/).map(nt=>$(nt,this.options));R&&(B=B.filter(nt=>(s("loose invalid filter",nt,this.options),!!nt.match(a[u.COMPARATORLOOSE])))),s("range list",B);const P=new Map,U=B.map(nt=>new r(nt,this.options));for(const nt of U){if(p(nt))return[nt];P.set(nt.value,nt)}P.size>1&&P.has("")&&P.delete("");const H=[...P.values()];return n.set(D,H),H}intersects(M,F){if(!(M instanceof t))throw new TypeError("a Range is required");return this.set.some(D=>m(D,F)&&M.set.some(N=>m(N,F)&&D.every(R=>N.every(L=>R.intersects(L,F)))))}test(M){if(!M)return!1;if(typeof M=="string")try{M=new o(M,this.options)}catch{return!1}for(let F=0;F<this.set.length;F++)if(k(this.set[F],M,this.options))return!0;return!1}}sM=t;const e=wJt,n=new e({max:1e3}),i=E4,r=aQt(),s=U$,o=I4,{safeRe:a,t:u,comparatorTrimReplace:c,tildeTrimReplace:l,caretTrimReplace:f}=$4,{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:h}=A4,p=T=>T.value==="<0.0.0-0",g=T=>T.value==="",m=(T,M)=>{let F=!0;const D=T.slice();let N=D.pop();for(;F&&D.length;)F=D.every(R=>N.intersects(R,M)),N=D.pop();return F},y=(T,M)=>(s("comp",T,M),T=_(T,M),s("caret",T),T=v(T,M),s("tildes",T),T=x(T,M),s("xrange",T),T=A(T,M),s("stars",T),T),b=T=>!T||T.toLowerCase()==="x"||T==="*",v=(T,M)=>T.trim().split(/\s+/).map(F=>w(F,M)).join(" "),w=(T,M)=>{const F=M.loose?a[u.TILDELOOSE]:a[u.TILDE];return T.replace(F,(D,N,R,L,B)=>{s("tilde",T,D,N,R,L,B);let P;return b(N)?P="":b(R)?P=`>=${N}.0.0 <${+N+1}.0.0-0`:b(L)?P=`>=${N}.${R}.0 <${N}.${+R+1}.0-0`:B?(s("replaceTilde pr",B),P=`>=${N}.${R}.${L}-${B} <${N}.${+R+1}.0-0`):P=`>=${N}.${R}.${L} <${N}.${+R+1}.0-0`,s("tilde return",P),P})},_=(T,M)=>T.trim().split(/\s+/).map(F=>S(F,M)).join(" "),S=(T,M)=>{s("caret",T,M);const F=M.loose?a[u.CARETLOOSE]:a[u.CARET],D=M.includePrerelease?"-0":"";return T.replace(F,(N,R,L,B,P)=>{s("caret",T,N,R,L,B,P);let U;return b(R)?U="":b(L)?U=`>=${R}.0.0${D} <${+R+1}.0.0-0`:b(B)?R==="0"?U=`>=${R}.${L}.0${D} <${R}.${+L+1}.0-0`:U=`>=${R}.${L}.0${D} <${+R+1}.0.0-0`:P?(s("replaceCaret pr",P),R==="0"?L==="0"?U=`>=${R}.${L}.${B}-${P} <${R}.${L}.${+B+1}-0`:U=`>=${R}.${L}.${B}-${P} <${R}.${+L+1}.0-0`:U=`>=${R}.${L}.${B}-${P} <${+R+1}.0.0-0`):(s("no pr"),R==="0"?L==="0"?U=`>=${R}.${L}.${B}${D} <${R}.${L}.${+B+1}-0`:U=`>=${R}.${L}.${B}${D} <${R}.${+L+1}.0-0`:U=`>=${R}.${L}.${B} <${+R+1}.0.0-0`),s("caret return",U),U})},x=(T,M)=>(s("replaceXRanges",T,M),T.split(/\s+/).map(F=>E(F,M)).join(" ")),E=(T,M)=>{T=T.trim();const F=M.loose?a[u.XRANGELOOSE]:a[u.XRANGE];return T.replace(F,(D,N,R,L,B,P)=>{s("xRange",T,D,N,R,L,B,P);const U=b(R),H=U||b(L),nt=H||b(B),ft=nt;return N==="="&&ft&&(N=""),P=M.includePrerelease?"-0":"",U?N===">"||N==="<"?D="<0.0.0-0":D="*":N&&ft?(H&&(L=0),B=0,N===">"?(N=">=",H?(R=+R+1,L=0,B=0):(L=+L+1,B=0)):N==="<="&&(N="<",H?R=+R+1:L=+L+1),N==="<"&&(P="-0"),D=`${N+R}.${L}.${B}${P}`):H?D=`>=${R}.0.0${P} <${+R+1}.0.0-0`:nt&&(D=`>=${R}.${L}.0${P} <${R}.${+L+1}.0-0`),s("xRange return",D),D})},A=(T,M)=>(s("replaceStars",T,M),T.trim().replace(a[u.STAR],"")),$=(T,M)=>(s("replaceGTE0",T,M),T.trim().replace(a[M.includePrerelease?u.GTE0PRE:u.GTE0],"")),I=T=>(M,F,D,N,R,L,B,P,U,H,nt,ft,dt)=>(b(D)?F="":b(N)?F=`>=${D}.0.0${T?"-0":""}`:b(R)?F=`>=${D}.${N}.0${T?"-0":""}`:L?F=`>=${F}`:F=`>=${F}${T?"-0":""}`,b(U)?P="":b(H)?P=`<${+U+1}.0.0-0`:b(nt)?P=`<${U}.${+H+1}.0-0`:ft?P=`<=${U}.${H}.${nt}-${ft}`:T?P=`<${U}.${H}.${+nt+1}-0`:P=`<=${P}`,`${F} ${P}`.trim()),k=(T,M,F)=>{for(let D=0;D<T.length;D++)if(!T[D].test(M))return!1;if(M.prerelease.length&&!F.includePrerelease){for(let D=0;D<T.length;D++)if(s(T[D].semver),T[D].semver!==r.ANY&&T[D].semver.prerelease.length>0){const N=T[D].semver;if(N.major===M.major&&N.minor===M.minor&&N.patch===M.patch)return!0}return!1}return!0};return sM}const uQt=Rct(),cQt=(t,e,n)=>{try{e=new uQt(e,n)}catch{return!1}return e.test(t)};var lQt=cQt,Lct=fJt(lQt);function fQt(t,e,n){const i=t.open(e),r=1e4,s=250,{origin:o}=new URL(e);let a=~~(r/s);function u(l){l.source===i&&(a=0,t.removeEventListener("message",u,!1))}t.addEventListener("message",u,!1);function c(){a<=0||(i.postMessage(n,o),setTimeout(c,s),a-=1)}setTimeout(c,s)}var dQt=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
}
.vega-embed.has-actions {
  padding-right: 38px;
}
.vega-embed details:not([open]) > :not(summary) {
  display: none !important;
}
.vega-embed summary {
  list-style: none;
  position: absolute;
  top: 0;
  right: 0;
  padding: 6px;
  z-index: 1000;
  background: white;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
  color: #1b1e23;
  border: 1px solid #aaa;
  border-radius: 999px;
  opacity: 0.2;
  transition: opacity 0.4s ease-in;
  cursor: pointer;
  line-height: 0px;
}
.vega-embed summary::-webkit-details-marker {
  display: none;
}
.vega-embed summary:active {
  box-shadow: #aaa 0px 0px 0px 1px inset;
}
.vega-embed summary svg {
  width: 14px;
  height: 14px;
}
.vega-embed details[open] summary {
  opacity: 0.7;
}
.vega-embed:hover summary, .vega-embed:focus-within summary {
  opacity: 1 !important;
  transition: opacity 0.2s ease;
}
.vega-embed .vega-actions {
  position: absolute;
  z-index: 1001;
  top: 35px;
  right: -9px;
  display: flex;
  flex-direction: column;
  padding-bottom: 8px;
  padding-top: 8px;
  border-radius: 4px;
  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
  border: 1px solid #d9d9d9;
  background: white;
  animation-duration: 0.15s;
  animation-name: scale-in;
  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
  text-align: left;
}
.vega-embed .vega-actions a {
  padding: 8px 16px;
  font-family: sans-serif;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  color: #434a56;
  text-decoration: none;
}
.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {
  background-color: #f7f7f9;
  color: black;
}
.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
  content: "";
  display: inline-block;
  position: absolute;
}
.vega-embed .vega-actions::before {
  left: auto;
  right: 14px;
  top: -16px;
  border: 8px solid rgba(0, 0, 0, 0);
  border-bottom-color: #d9d9d9;
}
.vega-embed .vega-actions::after {
  left: auto;
  right: 15px;
  top: -14px;
  border: 7px solid rgba(0, 0, 0, 0);
  border-bottom-color: #fff;
}
.vega-embed .chart-wrapper.fit-x {
  width: 100%;
}
.vega-embed .chart-wrapper.fit-y {
  height: 100%;
}

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px;
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
`;function Bct(t,...e){for(const n of e)hQt(t,n);return t}function hQt(t,e){for(const n of Object.keys(e))zm(t,n,e[n],!0)}const ra=Zzt;let nb=nKt;const Tw=typeof window<"u"?window:void 0;var CU;nb===void 0&&((CU=Tw==null?void 0:Tw.vl)!=null&&CU.compile)&&(nb=Tw.vl);const pQt={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},gQt={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Ey={vega:"Vega","vega-lite":"Vega-Lite"},LS={vega:ra.version,"vega-lite":nb?nb.version:"not available"},mQt={vega:t=>t,"vega-lite":(t,e)=>nb.compile(t,{config:e}).spec},yQt=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,bQt="chart-wrapper";function vQt(t){return typeof t=="function"}function FU(t,e,n,i){const r=`<html><head>${e}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+t+s),o.document.title=`${Ey[i]} JSON Source`}function wQt(t,e){if(t.$schema){const n=Tct(t.$schema);e&&e!==n.library&&console.warn(`The given visualization spec is written in ${Ey[n.library]}, but mode argument sets ${Ey[e]??e}.`);const i=n.library;return Lct(LS[i],`^${n.version.slice(1)}`)||console.warn(`The input spec uses ${Ey[i]} ${n.version}, but the current version of ${Ey[i]} is v${LS[i]}.`),i}return"mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t?"vega-lite":"marks"in t||"signals"in t||"scales"in t||"axes"in t?"vega":e??"vega"}function Pct(t){return!!(t&&"load"in t)}function kU(t){return Pct(t)?t:ra.loader(t)}function _Qt(t){var n;const e=((n=t.usermeta)==null?void 0:n.embedOptions)??{};return at(e.defaultStyle)&&(e.defaultStyle=!1),e}async function xQt(t,e,n={}){let i,r;at(e)?(r=kU(n.loader),i=JSON.parse(await r.load(e))):i=e;const s=_Qt(i),o=s.loader;(!r||o)&&(r=kU(n.loader??o));const a=await DU(s,r),u=await DU(n,r),c={...Bct(u,a),config:Pm(u.config??{},a.config??{})};return await EQt(t,i,c,r)}async function DU(t,e){const n=at(t.config)?JSON.parse(await e.load(t.config)):t.config??{},i=at(t.patch)?JSON.parse(await e.load(t.patch)):t.patch;return{...t,...i?{patch:i}:{},...n?{config:n}:{}}}function SQt(t){const e=t.getRootNode?t.getRootNode():document;return e instanceof ShadowRoot?{root:e,rootContainer:e}:{root:document,rootContainer:document.head??document.body}}async function EQt(t,e,n={},i){const r=n.theme?Pm(nJt[n.theme],n.config??{}):n.config,s=gf(n.actions)?n.actions:Bct({},pQt,n.actions??{}),o={...gQt,...n.i18n},a=n.renderer??"canvas",u=n.logLevel??ra.Warn,c=n.downloadFileName??"visualization",l=typeof t=="string"?document.querySelector(t):t;if(!l)throw new Error(`${t} does not exist`);if(n.defaultStyle!==!1){const _="vega-embed-style",{root:S,rootContainer:x}=SQt(l);if(!S.getElementById(_)){const E=document.createElement("style");E.id=_,E.innerHTML=n.defaultStyle===void 0||n.defaultStyle===!0?dQt.toString():n.defaultStyle,x.appendChild(E)}}const f=wQt(e,n.mode);let d=mQt[f](e,r);if(f==="vega-lite"&&d.$schema){const _=Tct(d.$schema);Lct(LS.vega,`^${_.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${_.version}, but current version is v${LS.vega}.`)}l.classList.add("vega-embed"),s&&l.classList.add("has-actions"),l.innerHTML="";let h=l;if(s){const _=document.createElement("div");_.classList.add(bQt),l.appendChild(_),h=_}const p=n.patch;if(p&&(d=p instanceof Function?p(d):eA(d,p,!0,!1).newDocument),n.formatLocale&&ra.formatLocale(n.formatLocale),n.timeFormatLocale&&ra.timeFormatLocale(n.timeFormatLocale),n.expressionFunctions)for(const _ in n.expressionFunctions){const S=n.expressionFunctions[_];"fn"in S?ra.expressionFunction(_,S.fn,S.visitor):S instanceof Function&&ra.expressionFunction(_,S)}const{ast:g}=n,m=ra.parse(d,f==="vega-lite"?{}:r,{ast:g}),y=new(n.viewClass||ra.View)(m,{loader:i,logLevel:u,renderer:a,...g?{expr:ra.expressionInterpreter??n.expr??cUt}:{}});if(y.addSignalListener("autosize",(_,S)=>{const{type:x}=S;x=="fit-x"?(h.classList.add("fit-x"),h.classList.remove("fit-y")):x=="fit-y"?(h.classList.remove("fit-x"),h.classList.add("fit-y")):x=="fit"?h.classList.add("fit-x","fit-y"):h.classList.remove("fit-x","fit-y")}),n.tooltip!==!1){const{loader:_,tooltip:S}=n,x=_&&!Pct(_)?_==null?void 0:_.baseURL:void 0,E=vQt(S)?S:new lJt({baseURL:x,...S===!0?{}:S}).call;y.tooltip(E)}let{hover:b}=n;if(b===void 0&&(b=f==="vega"),b){const{hoverSet:_,updateSet:S}=typeof b=="boolean"?{}:b;y.hover(_,S)}n&&(n.width!=null&&y.width(n.width),n.height!=null&&y.height(n.height),n.padding!=null&&y.padding(n.padding)),await y.initialize(h,n.bind).runAsync();let v;if(s!==!1){let _=l;if(n.defaultStyle!==!1||n.forceActionsMenu){const x=document.createElement("details");x.title=o.CLICK_TO_VIEW_ACTIONS,l.append(x),_=x;const E=document.createElement("summary");E.innerHTML=yQt,x.append(E),v=A=>{x.contains(A.target)||x.removeAttribute("open")},document.addEventListener("click",v)}const S=document.createElement("div");if(_.append(S),S.classList.add("vega-actions"),s===!0||s.export!==!1){for(const x of["svg","png"])if(s===!0||s.export===!0||s.export[x]){const E=o[`${x.toUpperCase()}_ACTION`],A=document.createElement("a"),$=ut(n.scaleFactor)?n.scaleFactor[x]:n.scaleFactor;A.text=E,A.href="#",A.target="_blank",A.download=`${c}.${x}`,A.addEventListener("mousedown",async function(I){I.preventDefault();const k=await y.toImageURL(x,$);this.href=k}),S.append(A)}}if(s===!0||s.source!==!1){const x=document.createElement("a");x.text=o.SOURCE_ACTION,x.href="#",x.addEventListener("click",function(E){FU(a3(e),n.sourceHeader??"",n.sourceFooter??"",f),E.preventDefault()}),S.append(x)}if(f==="vega-lite"&&(s===!0||s.compiled!==!1)){const x=document.createElement("a");x.text=o.COMPILED_ACTION,x.href="#",x.addEventListener("click",function(E){FU(a3(d),n.sourceHeader??"",n.sourceFooter??"","vega"),E.preventDefault()}),S.append(x)}if(s===!0||s.editor!==!1){const x=n.editorUrl??"https://vega.github.io/editor/",E=document.createElement("a");E.text=o.EDITOR_ACTION,E.href="#",E.addEventListener("click",function(A){fQt(window,x,{config:r,mode:f,renderer:a,spec:a3(e)}),A.preventDefault()}),S.append(E)}}function w(){v&&document.removeEventListener("click",v),y.finalize()}return{view:y,spec:e,vgSpec:d,finalize:w,embedOptions:n}}const AQt={$schema:"https://vega.github.io/schema/vega-lite/v5.json",layer:[{data:{name:"table"},params:[{name:"brush",select:{type:"interval",encodings:["x"]}}],mark:"bar",encoding:{x:{timeUnit:"utcmonth",field:"date",type:"ordinal"},y:{field:"precipitation",type:"quantitative"},opacity:{condition:{param:"brush",value:1},value:.7}}},{data:{name:"filteredTable"},mark:"rule",encoding:{y:{field:"precipitation",type:"quantitative"},color:{value:"firebrick"},size:{value:3}}}]};class $Qt extends BS{constructor(e){super();const{view:n,table:i,dataset:r,selection:s}=e;this.view=n,this.table=i,this.dataset=r,this.selection=s,this.selection&&this.view.addSignalListener("brush",(o,a)=>{const u=a.utcmonth_date,c=u?i_(s0("date"),[s0(xM(u.at(0))),s0(xM(u.at(-1)))],!1):null,l=this.view.scale("x"),f={source:this,schema:{type:"interval",scales:[{type:"time",domain:l.domain(),range:l.range()}]},value:c,predicate:c};s.activate(f),s.update(f)})}query(e=[]){return Jn.select({date:s0("date"),precipitation:Vq("precipitation")}).from(this.table).groupby(s0("date")).where(e)}queryResult(e){return this.view.data(this.dataset,Array.from(e)).resize().run(),this}}class IQt extends BS{constructor(e){const{view:n,table:i,dataset:r,filter:s}=e;super(s),this.view=n,this.table=i,this.dataset=r}query(e=[]){return Jn.select({precipitation:Vq("precipitation")}).from(this.table).where(e)}queryResult(e){return this.view.data(this.dataset,Array.from(e)).run(),this}}async function MQt(){const t=document.createElement("div"),e=await xQt(t,AQt,{actions:!1}),n=await l0t({log:!1});K0().databaseConnector(n),await K0().exec(Zdt("weather",`${window.location}seattle-weather.csv`));const i=Qq.intersect(),r=new $Qt({view:e.view,table:"weather",dataset:"table",selection:i});K0().connect(r);const s=new IQt({view:e.view,table:"weather",dataset:"filteredTable",filter:i});K0().connect(s),document.querySelector("#plots").replaceChildren(PFt(B7(P7("2em"),BFt({from:"weather",column:"weather",label:"Weather",as:i})),zFt(4),B7(t,P7("1em"),ZFt(KFt(GFt("weather",{filterBy:i}),{x:"temp_max",y:"wind",fill:"steelblue",fillOpacity:.3,r:2}),QFt({as:i}),qFt(JW),VFt(350),WFt(240)))))}MQt()});export default TQt();
